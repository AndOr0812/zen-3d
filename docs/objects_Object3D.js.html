<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: objects/Object3D.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: objects/Object3D.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {generateUUID} from '../base.js';
import {SHADOW_TYPE} from '../const.js';
import {Vector3} from '../math/Vector3.js';
import {Euler} from '../math/Euler.js';
import {Quaternion} from '../math/Quaternion.js';
import {Matrix4} from '../math/Matrix4.js';

/**
 * This is the base class for most objects in zen3d
 * and provides a set of properties and methods for manipulating objects in 3D space.
 * @constructor
 */
function Object3D() {

    /**
     * UUID of this object instance. 
     * This gets automatically assigned, so this shouldn't be edited.
     * @type {string}
     */
    this.uuid = generateUUID();

    /**
     * Optional name of the object (doesn't need to be unique). 
     * Default is an empty string.
     * @type {string}
     */
    this.name = "";

    /**
     * Type of the object.
     * Set by Subclass
     * @type {OBJECT_TYPE} 
     */
    this.type = "";

    // position
    this.position = new Vector3();
    // scale
    this.scale = new Vector3(1, 1, 1);

    // euler rotate
    var euler = this.euler = new Euler();
    // quaternion rotate
    var quaternion = this.quaternion = new Quaternion();

    // bind euler and quaternion
    euler.onChange(function() {
        quaternion.setFromEuler(euler, false);
    });
    quaternion.onChange(function() {
        euler.setFromQuaternion(quaternion, undefined, false);
    });

    // transform matrix
    this.matrix = new Matrix4();
    // world transform matrix
    this.worldMatrix = new Matrix4();

    // children
    this.children = new Array();
    // parent
    this.parent = null;

    // shadow
    this.castShadow = false;
    this.receiveShadow = false;
    this.shadowType = SHADOW_TYPE.PCF_SOFT;

    // frustum test
    this.frustumCulled = true;

    /**
     * Object gets rendered if true. Default is true.
     * @type {boolean} 
     */
    this.visible = true;

    /**
     * This value allows the default rendering order of scene graph objects to be overridden although opaque and transparent objects remain sorted independently. 
     * Sorting is from lowest to highest renderOrder. 
     * Default value is 0.
     * @type {number}
     */
    this.renderOrder = 0;

    this.userData = {};
}

Object.defineProperties(Object3D.prototype, {
    /**
     * rotation set by euler
     **/
    rotation: {
        get: function() {
            return this.euler;
        },
        set: function(euler) {
            var _euler = this.euler;
            _euler.copyFrom(euler);

            this.quaternion.setFromEuler(euler);
        }
    }
});

Object.assign(Object3D.prototype, {

    onBeforeRender: function () {},
	onAfterRender: function () {},

    /**
     * add child to object3d
     */
    add: function(object) {
        this.children.push(object);
        object.parent = this;
    },

    /**
     * remove child from object3d
     */
    remove: function(object) {
        var index = this.children.indexOf(object);
        if (index !== -1) {
            this.children.splice(index, 1);
        }
        object.parent = null;
    },

    /**
     * get object by name
     */
    getObjectByName: function(name) {
        return this.getObjectByProperty('name', name);
    },

    /**
     * get object by property
     */
    getObjectByProperty: function(name, value) {
        if (this[name] === value) return this;

        for (var i = 0, l = this.children.length; i &lt; l; i++) {

            var child = this.children[i];
            var object = child.getObjectByProperty(name, value);

            if (object !== undefined) {

                return object;

            }

        }

        return undefined;
    },

    /**
     * update matrix
     */
    updateMatrix: function() {
        var matrix = this.matrix.transform(this.position, this.scale, this.quaternion);

        this.worldMatrix.copy(matrix);

        if (this.parent) {
            var parentMatrix = this.parent.worldMatrix;
            this.worldMatrix.premultiply(parentMatrix);
        }

        var children = this.children;
        for (var i = 0, l = children.length; i &lt; l; i++) {
            children[i].updateMatrix();
        }
    },

    /*
     * get world direction
     * must call after world matrix updated
     */
    getWorldDirection: function() {

        var position = new Vector3();
        var quaternion = new Quaternion();
        var scale = new Vector3();

        return function getWorldDirection(optionalTarget) {

            var result = optionalTarget || new Vector3();

            this.worldMatrix.decompose(position, quaternion, scale);

            result.set(0, 0, 1).applyQuaternion(quaternion);

            return result;

        };
    }(),

    /**
     * set view by look at, this func will set quaternion of this object
     */
    lookAt: function() {

        var m = new Matrix4();

        return function lookAt(target, up) {

            m.lookAtRH(target, this.position, up);
            this.quaternion.setFromRotationMatrix(m);

        };

    }(),

    /**
     * raycast
     */
    raycast: function() {
        // implemental by subclass
    },

    traverse: function ( callback ) {
        callback( this );

        var children = this.children;
        for ( var i = 0, l = children.length; i &lt; l; i ++ ) {
            children[ i ].traverse( callback );
        }
    },

    clone: function ( recursive ) {
        return new this.constructor().copy( this, recursive );
    },

    copy: function( source, recursive ) {
        if ( recursive === undefined ) recursive = true;

        this.name = source.name;

        this.type = source.type;

        this.position.copy( source.position );
        this.quaternion.copy( source.quaternion );
        this.scale.copy( source.scale );

        this.matrix.copy( source.matrix );
        this.worldMatrix.copy( source.worldMatrix );

        this.castShadow = source.castShadow;
        this.receiveShadow = source.receiveShadow;

        this.frustumCulled = source.frustumCulled;

        this.userData = JSON.parse( JSON.stringify( source.userData ) );

        if ( recursive === true ) {

            for ( var i = 0; i &lt; source.children.length; i ++ ) {

                var child = source.children[ i ];
                this.add( child.clone() );

            }

        }

        return this;
    }

});

export {Object3D};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BasicMaterial.html">BasicMaterial</a></li><li><a href="CubeGeometry.html">CubeGeometry</a></li><li><a href="CylinderGeometry.html">CylinderGeometry</a></li><li><a href="DepthMaterial.html">DepthMaterial</a></li><li><a href="DistanceMaterial.html">DistanceMaterial</a></li><li><a href="Euler.html">Euler</a></li><li><a href="FileLoader.html">FileLoader</a></li><li><a href="Geometry.html">Geometry</a></li><li><a href="Group.html">Group</a></li><li><a href="ImageLoader.html">ImageLoader</a></li><li><a href="LambertMaterial.html">LambertMaterial</a></li><li><a href="Line.html">Line</a></li><li><a href="LineDashedMaterial.html">LineDashedMaterial</a></li><li><a href="LineLoopMaterial.html">LineLoopMaterial</a></li><li><a href="LineMaterial.html">LineMaterial</a></li><li><a href="Material.html">Material</a></li><li><a href="Matrix3.html">Matrix3</a></li><li><a href="Matrix4.html">Matrix4</a></li><li><a href="Mesh.html">Mesh</a></li><li><a href="Object3D.html">Object3D</a></li><li><a href="PBRMaterial.html">PBRMaterial</a></li><li><a href="PhongMaterial.html">PhongMaterial</a></li><li><a href="PlaneGeometry.html">PlaneGeometry</a></li><li><a href="Points.html">Points</a></li><li><a href="PointsMaterial.html">PointsMaterial</a></li><li><a href="Quaternion.html">Quaternion</a></li><li><a href="Renderer.html">Renderer</a></li><li><a href="RenderTarget2D.html">RenderTarget2D</a></li><li><a href="RenderTargetBack.html">RenderTargetBack</a></li><li><a href="RenderTargetBase.html">RenderTargetBase</a></li><li><a href="RenderTargetCube.html">RenderTargetCube</a></li><li><a href="Scene.html">Scene</a></li><li><a href="ShaderMaterial.html">ShaderMaterial</a></li><li><a href="SkinnedMesh.html">SkinnedMesh</a></li><li><a href="SphereGeometry.html">SphereGeometry</a></li><li><a href="Texture2D.html">Texture2D</a></li><li><a href="TextureBase.html">TextureBase</a></li><li><a href="TextureCube.html">TextureCube</a></li><li><a href="Vector2.html">Vector2</a></li><li><a href="Vector3.html">Vector3</a></li><li><a href="Vector4.html">Vector4</a></li></ul><h3>Global</h3><ul><li><a href="global.html#add">add</a></li><li><a href="global.html#getObjectByName">getObjectByName</a></li><li><a href="global.html#getObjectByProperty">getObjectByProperty</a></li><li><a href="global.html#lookAt">lookAt</a></li><li><a href="global.html#raycast">raycast</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#resize">resize</a></li><li><a href="global.html#rotation">rotation</a></li><li><a href="global.html#setFromAxisAngle">setFromAxisAngle</a></li><li><a href="global.html#Spherical">Spherical</a></li><li><a href="global.html#transform">transform</a></li><li><a href="global.html#updateMatrix">updateMatrix</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Aug 24 2018 00:02:47 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
