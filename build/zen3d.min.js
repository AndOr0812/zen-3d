!function(t){var e=t.zen3d=t.zen3d||{},i=function(){},n=function(t,e){i.prototype=e.prototype,t.superClass=e.prototype,t.prototype=new i,t.prototype.constructor=t};e.inherit=n;var r=function(){if(!t.navigator)return!0;var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")};e.isMobile=r;var a=function(t,e){var i=["","WEBKIT_","MOZ_"],n=null;for(var r in i)if(n=t.getExtension(i[r]+e))break;return n};e.getExtension=a;var o=function(t){var e=t>>16&255,i=t>>8&255,n=255&t;return[e,i,n]};e.hex2RGB=o}(window),function(){var t={MESH:"mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group"};zen3d.OBJECT_TYPE=t;var e={AMBIENT:"ambient",DIRECT:"direct",POINT:"point"};zen3d.LIGHT_TYPE=e;var i={BASIC:"basic",LAMBERT:"lambert",PHONE:"phone"};zen3d.MATERIAL_TYPE=i}(),function(){var t=function(e,i,n,r){this.x=e||0,this.y=i||0,this.z=n||0,this.order=r||t.DefaultOrder};t.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],t.DefaultOrder="XYZ",t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this},t.prototype.set=function(t,e,i){return this.x=t||0,this.y=e||0,this.z=i||0,this.order=order||this.order,this},zen3d.Euler=t}(),function(){var t=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};t.prototype.identify=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},t.prototype.set=function(t,e,i,n,r,a,o,s,h,c,u,f,d,l,p,v){var _=this.elements;return _[0]=t,_[4]=e,_[8]=i,_[12]=n,_[1]=r,_[5]=a,_[9]=o,_[13]=s,_[2]=h,_[6]=c,_[10]=u,_[14]=f,_[3]=d,_[7]=l,_[11]=p,_[15]=v,this},t.prototype.copy=function(t){return this.elements.set(t.elements),this},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiplyMatrices=function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[4],s=i[8],h=i[12],c=i[1],u=i[5],f=i[9],d=i[13],l=i[2],p=i[6],v=i[10],_=i[14],E=i[3],m=i[7],y=i[11],T=i[15],g=n[0],b=n[4],L=n[8],z=n[12],x=n[1],A=n[5],M=n[9],S=n[13],P=n[2],I=n[6],U=n[10],N=n[14],R=n[3],O=n[7],w=n[11],C=n[15];return r[0]=a*g+o*x+s*P+h*R,r[4]=a*b+o*A+s*I+h*O,r[8]=a*L+o*M+s*U+h*w,r[12]=a*z+o*S+s*N+h*C,r[1]=c*g+u*x+f*P+d*R,r[5]=c*b+u*A+f*I+d*O,r[9]=c*L+u*M+f*U+d*w,r[13]=c*z+u*S+f*N+d*C,r[2]=l*g+p*x+v*P+_*R,r[6]=l*b+p*A+v*I+_*O,r[10]=l*L+p*M+v*U+_*w,r[14]=l*z+p*S+v*N+_*C,r[3]=E*g+m*x+y*P+T*R,r[7]=E*b+m*A+y*I+T*O,r[11]=E*L+m*M+y*U+T*w,r[15]=E*z+m*S+y*N+T*C,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},t.prototype.inverse=function(){return this.getInverse(this)},t.prototype.getInverse=function(t){var e=this.elements,i=t.elements,n=i[0],r=i[1],a=i[2],o=i[3],s=i[4],h=i[5],c=i[6],u=i[7],f=i[8],d=i[9],l=i[10],p=i[11],v=i[12],_=i[13],E=i[14],m=i[15],y=d*E*u-_*l*u+_*c*p-h*E*p-d*c*m+h*l*m,T=v*l*u-f*E*u-v*c*p+s*E*p+f*c*m-s*l*m,g=f*_*u-v*d*u+v*h*p-s*_*p-f*h*m+s*d*m,b=v*d*c-f*_*c-v*h*l+s*_*l+f*h*E-s*d*E,L=n*y+r*T+a*g+o*b;if(0===L)return console.warn("can't invert matrix, determinant is 0"),this.identity();var z=1/L;return e[0]=y*z,e[1]=(_*l*o-d*E*o-_*a*p+r*E*p+d*a*m-r*l*m)*z,e[2]=(h*E*o-_*c*o+_*a*u-r*E*u-h*a*m+r*c*m)*z,e[3]=(d*c*o-h*l*o-d*a*u+r*l*u+h*a*p-r*c*p)*z,e[4]=T*z,e[5]=(f*E*o-v*l*o+v*a*p-n*E*p-f*a*m+n*l*m)*z,e[6]=(v*c*o-s*E*o-v*a*u+n*E*u+s*a*m-n*c*m)*z,e[7]=(s*l*o-f*c*o+f*a*u-n*l*u-s*a*p+n*c*p)*z,e[8]=g*z,e[9]=(v*d*o-f*_*o-v*r*p+n*_*p+f*r*m-n*d*m)*z,e[10]=(s*_*o-v*h*o+v*r*u-n*_*u-s*r*m+n*h*m)*z,e[11]=(f*h*o-s*d*o-f*r*u+n*d*u+s*r*p-n*h*p)*z,e[12]=b*z,e[13]=(f*_*a-v*d*a+v*r*l-n*_*l-f*r*E+n*d*E)*z,e[14]=(v*h*a-s*_*a-v*r*c+n*_*c+s*r*E-n*h*E)*z,e[15]=(s*d*a-f*h*a+f*r*c-n*d*c-s*r*l+n*h*l)*z,this},t.prototype.transform=function(t,e,i){var n=i.toMatrix4(),r=n.elements,a=this.elements;return a[0]=r[0]*e.x,a[1]=r[1]*e.y,a[2]=r[2]*e.z,a[3]=0,a[4]=r[4]*e.x,a[5]=r[5]*e.y,a[6]=r[6]*e.z,a[7]=0,a[8]=r[8]*e.x,a[9]=r[9]*e.y,a[10]=r[10]*e.z,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this},zen3d.Matrix4=t}(),function(){var t=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};t.prototype.set=function(t,e,i,n){return this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1,this},t.prototype.setFromEuler=function(t){var e=Math.cos(t.x/2),i=Math.cos(t.y/2),n=Math.cos(t.z/2),r=Math.sin(t.x/2),a=Math.sin(t.y/2),o=Math.sin(t.z/2),s=t.order;return"XYZ"===s?(this.x=r*i*n+e*a*o,this.y=e*a*n-r*i*o,this.z=e*i*o+r*a*n,this.w=e*i*n-r*a*o):"YXZ"===s?(this.x=r*i*n+e*a*o,this.y=e*a*n-r*i*o,this.z=e*i*o-r*a*n,this.w=e*i*n+r*a*o):"ZXY"===s?(this.x=r*i*n-e*a*o,this.y=e*a*n+r*i*o,this.z=e*i*o+r*a*n,this.w=e*i*n-r*a*o):"ZYX"===s?(this.x=r*i*n-e*a*o,this.y=e*a*n+r*i*o,this.z=e*i*o-r*a*n,this.w=e*i*n+r*a*o):"YZX"===s?(this.x=r*i*n+e*a*o,this.y=e*a*n+r*i*o,this.z=e*i*o-r*a*n,this.w=e*i*n-r*a*o):"XZY"===s&&(this.x=r*i*n-e*a*o,this.y=e*a*n-r*i*o,this.z=e*i*o+r*a*n,this.w=e*i*n+r*a*o),this},t.prototype.toMatrix4=function(t){t||(t=new zen3d.Matrix4);var e=t.elements,i=2*this.x*this.y,n=2*this.x*this.z,r=2*this.x*this.w,a=2*this.y*this.z,o=2*this.y*this.w,s=2*this.z*this.w,h=this.x*this.x,c=this.y*this.y,u=this.z*this.z,f=this.w*this.w;return e[0]=h-c-u+f,e[4]=i-s,e[8]=n+o,e[12]=0,e[1]=i+s,e[5]=-h+c-u+f,e[9]=a-r,e[13]=0,e[2]=n-o,e[6]=a+r,e[10]=-h-c+u+f,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t},zen3d.Quaternion=t}(),function(){var t=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};t.prototype.set=function(t,e,i){return this.x=t||0,this.y=e||0,this.z=i||0,this},t.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},t.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(t){t=t||1;var e=this.getLength();if(0!=e){var i=t/e;return this.x*=i,this.y*=i,void(this.z*=i)}},t.prototype.subtract=function(e,i){return i||(i=new t),i.set(this.x-e.x,this.y-e.y,this.z-e.z),i},t.prototype.crossProduct=function(e,i){return i||(i=new t),i.x=this.y*e.z-this.z*e.y,i.y=this.z*e.x-this.x*e.z,i.z=this.x*e.y-this.y*e.x,i},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.applyQuaternion=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,o=t.z,s=t.w,h=s*e+a*n-o*i,c=s*i+o*e-r*n,u=s*n+r*i-a*e,f=-r*e-a*i-o*n;return this.x=h*s+f*-r+c*-o-u*-a,this.y=c*s+f*-a+u*-r-h*-o,this.z=u*s+f*-o+h*-a-c*-r,this},zen3d.Vector3=t}(),function(){var t={transpose:"mat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \n",inverse:"mat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \n",vertexBase:["attribute vec3 a_Position;","uniform mat4 u_Projection;","uniform mat4 u_View;","uniform mat4 u_Model;","#ifdef USE_NORMAL","attribute vec3 a_Normal;","varying vec3 v_Normal;","#endif","#ifdef USE_DIFFUSE_MAP","attribute vec2 a_Uv;","varying vec2 v_Uv;","#endif","#if defined(USE_POINT_LIGHT) || defined(USE_PHONE)","varying vec3 v_VmPos;","#endif","void main() {","gl_Position = u_Projection * u_View * u_Model * vec4(a_Position, 1.0);","#ifdef USE_NORMAL","v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(a_Normal, 1.0)).xyz;","#endif","#ifdef USE_DIFFUSE_MAP","v_Uv = a_Uv;","#endif","#if defined(USE_POINT_LIGHT) || defined(USE_PHONE)","v_VmPos = (u_View * u_Model * vec4(a_Position, 1.0)).xyz;","#endif","}"].join("\n"),fragmentBase:["precision mediump float;","#ifdef USE_DIFFUSE_MAP","varying vec2 v_Uv;","uniform sampler2D texture;","#endif","#ifdef USE_DIFFUSE_COLOR","uniform vec4 u_Color;","#endif","#ifdef USE_AMBIENT_LIGHT","struct AmbientLight","{","vec4 color;","float intensity;","};","uniform AmbientLight u_Ambient[USE_AMBIENT_LIGHT];","#endif","#ifdef USE_DIRECT_LIGHT","struct DirectLight","{","vec3 direction;","vec4 color;","float intensity;","};","uniform DirectLight u_Directional[USE_DIRECT_LIGHT];","#endif","#ifdef USE_POINT_LIGHT","struct PointLight","{","vec3 position;","vec4 color;","float intensity;","};","uniform PointLight u_Point[USE_POINT_LIGHT];","#endif","#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif","#if defined(USE_POINT_LIGHT) || defined(USE_PHONE)","varying vec3 v_VmPos;","uniform mat4 u_ViewMat;","#endif","#ifdef USE_DIRECT_LIGHT","uniform mat4 u_ViewITMat;","#endif","#ifdef USE_PHONE","uniform vec3 u_Eye;","uniform float u_Specular;","#endif","#if defined(USE_LAMBERT) || defined(USE_PHONE)","void RE_Lambert(vec4 k, vec4 light, vec3 N, vec3 L, inout vec4 reflectLight) {","float dotNL = max(dot(N, L), 0.);","reflectLight += k * light * dotNL;","}","#endif","#ifdef USE_PHONE","void RE_Phone(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 R = max(dot(2.0 * N, L), 0.) * N - L;","reflectLight += k * light * pow(max(dot(V, R), 0.), n_s);","}","void RE_BlinnPhone(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 H = normalize(L + V);","reflectLight += k * light * pow(max(dot(N, H), 0.), n_s);","}","#endif","void main() {","gl_FragColor = vec4(0., 0., 0., 0.);","#ifdef USE_DIFFUSE_MAP","vec4 color = texture2D(texture, v_Uv);","#endif","#ifdef USE_DIFFUSE_COLOR","vec4 color = u_Color;","#endif","#ifdef USE_NORMAL","vec3 N = normalize(v_Normal);","#endif","#ifdef USE_BASIC","gl_FragColor += color;","#endif","#ifdef USE_LIGHT","vec4 light;","vec3 L;","#endif","#ifdef USE_PHONE","vec3 V;","#endif","#ifdef USE_AMBIENT_LIGHT","for(int i = 0; i < USE_AMBIENT_LIGHT; i++) {","gl_FragColor += color * u_Ambient[i].color * u_Ambient[i].intensity;","}","#endif","#ifdef USE_DIRECT_LIGHT","for(int i = 0; i < USE_DIRECT_LIGHT; i++) {","L = (u_ViewITMat * vec4(-u_Directional[i].direction, 1.0)).xyz;","light = u_Directional[i].color * u_Directional[i].intensity;","L = normalize(L);","#if defined(USE_LAMBERT) || defined(USE_PHONE)","RE_Lambert(color, light, N, L, gl_FragColor);","#endif","#ifdef USE_PHONE","V = normalize( ( u_ViewMat * vec4(u_Eye, 1.0) ).xyz - v_VmPos);","RE_BlinnPhone(color, light, N, normalize(L), V, u_Specular, gl_FragColor);","#endif","}","#endif","#ifdef USE_POINT_LIGHT","for(int i = 0; i < USE_POINT_LIGHT; i++) {","L = ( u_ViewMat * vec4(u_Point[i].position, 1.0) ).xyz - v_VmPos;","float dist = max(1. - length(L) * .005, 0.0);","light = u_Point[i].color * u_Point[i].intensity * dist;","L = normalize(L);","#if defined(USE_LAMBERT) || defined(USE_PHONE)","RE_Lambert(color, light, N, L, gl_FragColor);","#endif","#ifdef USE_PHONE","V = normalize( ( u_ViewMat * vec4(u_Eye, 1.0) ).xyz - v_VmPos);","RE_BlinnPhone(color, light, N, normalize(L), V, u_Specular, gl_FragColor);","#endif","}","#endif","}"].join("\n")};zen3d.ShaderLib=t}(),function(){function t(t,e,i){var n=t.createShader(e);t.shaderSource(n,i),t.compileShader(n);var r=t.getShaderParameter(n,t.COMPILE_STATUS);return r||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(n))),n}function e(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),n}function i(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;n>r;r++){var a=t.getActiveUniform(e,r),o=a.name,s=a.type;i[o]={type:s,size:a.size,location:t.getUniformLocation(e,o)}}return i}function n(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;n>r;r++){var a=t.getActiveAttrib(e,r),o=a.name,s=a.type;i[o]={type:s,size:1,location:t.getAttribLocation(e,o)}}return i}function r(t){var e="";for(var i in t)e+=t[i]+"_";return e}function a(t,e){var i=e.materialType==h.BASIC,n=[!i&&e.pointLightNum>0?"#define USE_POINT_LIGHT "+e.pointLightNum:"",!i&&(e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0)?"#define USE_LIGHT":"",!i&&(e.pointLightNum>0||e.directLightNum>0)?"#define USE_NORMAL":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useDiffuseColor?"#define USE_DIFFUSE_COLOR":"",e.materialType==h.BASIC?"#define USE_BASIC":"",e.materialType==h.LAMBERT?"#define USE_LAMBERT":"",e.materialType==h.PHONE?"#define USE_PHONE":"",zen3d.ShaderLib.inverse,zen3d.ShaderLib.transpose,zen3d.ShaderLib.vertexBase].join("\n"),r=[(!i&&e.pointLightNum)>0?"#define USE_POINT_LIGHT "+e.pointLightNum:"",(!i&&e.directLightNum)>0?"#define USE_DIRECT_LIGHT "+e.directLightNum:"",(!i&&e.ambientLightNum)>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",!i&&(e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0)?"#define USE_LIGHT":"",!i&&(e.pointLightNum>0||e.directLightNum>0)?"#define USE_NORMAL":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useDiffuseColor?"#define USE_DIFFUSE_COLOR":"",e.materialType==h.BASIC?"#define USE_BASIC":"",e.materialType==h.LAMBERT?"#define USE_LAMBERT":"",e.materialType==h.PHONE?"#define USE_PHONE":"",zen3d.ShaderLib.fragmentBase].join("\n");return new s(t,n,r)}var o={},s=function(r,a,o){this.vshaderSource=a,this.fshaderSource=o,this.vertexShader=t(r,r.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=t(r,r.FRAGMENT_SHADER,this.fshaderSource),this.id=e(r,this.vertexShader,this.fragmentShader),this.uniforms=i(r,this.id),this.attributes=n(r,this.id)},h=zen3d.MATERIAL_TYPE,c=function(t,e,i){var n,s=i[0],h=i[1],c=i[2],u={useDiffuseMap:!!e.map,useDiffuseColor:!e.map,ambientLightNum:s,directLightNum:h,pointLightNum:c,materialType:e.type},f=r(u),d=o;return d[f]?n=d[f]:(n=a(t,u),d[f]=n),n};zen3d.getProgram=c}(),function(){var t=zen3d.MATERIAL_TYPE,e=function(t){this.view=t;var e=this.gl=t.getContext("webgl",{antialias:!0,stencil:!0});this.width=t.clientWidth,this.height=t.clientHeight,this.vertices=new Float32Array(4e4),this.vertexBuffer=e.createBuffer(),this.indices=new Uint16Array(12e3),this.indexBuffer=e.createBuffer(),e.enable(e.STENCIL_TEST),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),this.cache=new zen3d.RenderCache,this.camera=null};e.prototype.render=function(t,e){this.camera=e,t.updateMatrix(),this.cache.cache(t),this.cache.sort(),this.flush(),this.cache.clear()},e.prototype.flush=function(){this.flushList(this.cache.opaqueObjects),this.flushList(this.cache.transparentObjects)},e.prototype.flushList=function(e){for(var i=this.camera,n=this.vertices,r=this.indices,a=this.cache.ambientLights,o=this.cache.directLights,s=this.cache.pointLights,h=a.length,c=o.length,u=s.length,f=0,d=e.length;d>f;f++){for(var l=e[f],p=l.geometry,v=l.material,_=(this.lights,0),E=0,m=0,y=p.verticesArray,T=y.length;T>m;m++)n[_++]=y[m];for(var g=0,b=p.indicesArray,L=b.length;L>g;g++)r[E++]=b[g];var z=this.gl;z.bindBuffer(z.ARRAY_BUFFER,this.vertexBuffer),z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var x=n.subarray(0,_);z.bufferData(z.ARRAY_BUFFER,x,z.STREAM_DRAW);var A=r.subarray(0,E);z.bufferData(z.ELEMENT_ARRAY_BUFFER,A,z.STATIC_DRAW);var M=zen3d.getProgram(z,v,[h,c,u]),S=M.uniforms,P=M.attributes;z.useProgram(M.id);var I=P.a_Position.location;z.vertexAttribPointer(I,3,z.FLOAT,!1,68,0),z.enableVertexAttribArray(I);var U=i.projectionMatrix.elements;z.uniformMatrix4fv(S.u_Projection.location,!1,U);var N=i.viewMatrix.elements;z.uniformMatrix4fv(S.u_View.location,!1,N);var R=l.worldMatrix.elements;z.uniformMatrix4fv(S.u_Model.location,!1,R);var O=v.type==t.BASIC;if(!O){for(var g=0;h>g;g++){var w=a[g],C=w.intensity,B=zen3d.hex2RGB(w.color),D=S["u_Ambient["+g+"].intensity"].location,G=S["u_Ambient["+g+"].color"].location;z.uniform4f(G,B[0]/255,B[1]/255,B[2]/255,1),z.uniform1f(D,C)}for(var H=new zen3d.Matrix4,g=0;c>g;g++){var w=o[g],C=w.intensity,F=w.direction,B=zen3d.hex2RGB(w.color),V=S["u_Directional["+g+"].direction"].location,Y=S["u_Directional["+g+"].intensity"].location,j=S["u_Directional["+g+"].color"].location;z.uniform3f(V,F.x,F.y,F.z),z.uniform1f(Y,C),z.uniform4f(j,B[0]/255,B[1]/255,B[2]/255,1)}for(var g=0;u>g;g++){var w=s[g],X=w.position,C=w.intensity,B=zen3d.hex2RGB(w.color),k=S["u_Point["+g+"].position"].location;z.uniform3f(k,X.x,X.y,X.z);var Z=S["u_Point["+g+"].intensity"].location;z.uniform1f(Z,C);var q=S["u_Point["+g+"].color"].location;z.uniform4f(q,B[0]/255,B[1]/255,B[2]/255,1)}if(c>0){var W=H.copy(i.viewMatrix).inverse().transpose().elements;z.uniformMatrix4fv(S.u_ViewITMat.location,!1,W)}if(u>0||c>0&&v.type==t.PHONE){var N=i.viewMatrix.elements;z.uniformMatrix4fv(S.u_ViewMat.location,!1,N)}if(c>0||u>0){var J=P.a_Normal.location;z.vertexAttribPointer(J,3,z.FLOAT,!1,68,12),z.enableVertexAttribArray(J)}if(v.type==t.PHONE){var K=i.position,Q=z.getUniformLocation(M.id,"u_Eye");z.uniform3f(Q,K.x,K.y,K.z);var $=v.specular,tt=z.getUniformLocation(M.id,"u_Specular");z.uniform1f(tt,$)}}if(v.map){var et=P.a_Uv.location;z.vertexAttribPointer(et,2,z.FLOAT,!1,68,52),z.enableVertexAttribArray(et),z.activeTexture(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,v.map.glTexture)}else{var B=zen3d.hex2RGB(v.color);z.uniform4f(S.u_Color.location,B[0]/255,B[1]/255,B[2]/255,1)}z.drawElements(z.TRIANGLES,E,z.UNSIGNED_SHORT,0)}},zen3d.Renderer=e}(),function(){var t=zen3d.OBJECT_TYPE,e=zen3d.LIGHT_TYPE,i=function(){this.opaqueObjects=new Array,this.transparentObjects=new Array,this.ambientLights=new Array,this.directLights=new Array,this.pointLights=new Array};i.prototype.cache=function(i){switch(i.type){case t.MESH:var n=i.material;n.checkMapInit()&&(n.transparent?this.transparentObjects.push(i):this.opaqueObjects.push(i));break;case t.LIGHT:i.lightType==e.AMBIENT?this.ambientLights.push(i):i.lightType==e.DIRECT?this.directLights.push(i):i.lightType==e.POINT&&this.pointLights.push(i);break;case t.CAMERA:break;case t.SCENE:break;case t.GROUP:break;default:console.log("undefined object type")}for(var r=i.children,a=0,o=r.length;o>a;a++)this.cache(r[a])},i.prototype.sort=function(){this.opaqueObjects.sort(function(t,e){var i=t.position.z,n=e.position.z;return i-n}),this.transparentObjects.sort(function(t,e){var i=t.position.z,n=e.position.z;return n-i})},i.prototype.clear=function(){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.ambientLights.length=0,this.directLights.length=0,this.pointLights.length=0},zen3d.RenderCache=i}(),function(){var t=function(t,e){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1),this.euler=new zen3d.Euler,this.quaternion=new zen3d.Quaternion,this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null};Object.defineProperties(t.prototype,{rotation:{get:function(){return this.euler},set:function(t){var e=this.euler;e.copyFrom(t),this.quaternion.setFromEuler(t)}}}),t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1),t.parent=null},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,n=0,r=i.length;r>n;n++)i[n].updateMatrix()},zen3d.Object3D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE};zen3d.inherit(t,zen3d.Object3D),zen3d.Scene=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(t,zen3d.Object3D),zen3d.Group=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=16777215,this.intensity=1};zen3d.inherit(t,zen3d.Object3D),zen3d.Light=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(t,zen3d.Light),zen3d.AmbientLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.direction=new zen3d.Vector3};zen3d.inherit(t,zen3d.Light),zen3d.DirectionalLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2};zen3d.inherit(t,zen3d.Light),zen3d.PointLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(t,zen3d.Object3D),t.prototype.setLookAt=function(t,e){var i=this.position,n=new zen3d.Vector3;i.subtract(t,n),n.normalize();var r=new zen3d.Vector3;e.crossProduct(n,r),r.normalize();var a=new zen3d.Vector3;n.crossProduct(r,a),this.viewMatrix.set(-r.x,-r.y,-r.z,-r.dotProduct(i),a.x,a.y,a.z,-a.dotProduct(i),n.x,n.y,n.z,-n.dotProduct(i),0,0,0,1)},t.prototype.setOrtho=function(t,e,i,n,r,a){this.projectionMatrix.set(2/(e-t),0,0,-(e+t)/(e-t),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1)},t.prototype.setPerspective=function(t,e,i,n){this.projectionMatrix.set(1/(e*Math.tan(t/2)),0,0,0,0,1/Math.tan(t/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},zen3d.Camera=t}(),function(){var t=function(){this.verticesArray=new Array,this.indicesArray=new Array,this.verticesCount=0};zen3d.Geometry=t}(),function(){var t=function(e,i,n){t.superClass.constructor.call(this),this.buildGeometry(e,i,n)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i){this.verticesArray.push(.5*-t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*e,.5*-i,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*e,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-e,.5*i,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-e,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*e,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-e,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-e,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*e,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34),this.verticesCount=36},zen3d.CubeGeometry=t}(),function(){var t=function(e,i,n,r){t.superClass.constructor.call(this),this.buildGeometry(e,i,n||1,r||1)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i,n){for(var r=i+1,a=n+1,o=this.verticesArray,s=this.indicesArray,h=0,c=0,u=0;a>u;u++)for(var f=0;r>f;f++){var d=(f/i-.5)*t,l=(u/n-.5)*e;if(o[h++]=d,o[h++]=0,o[h++]=l,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=0,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=f/i*1,o[h++]=1*(1-u/n),o[h++]=f/i*1,o[h++]=1*(1-u/n),f!=i&&u!=n){base=f+u*r;var p=1;s[c++]=base*p,s[c++]=(base+r+1)*p,s[c++]=(base+r)*p,s[c++]=base*p,s[c++]=(base+1)*p,s[c++]=(base+r+1)*p}}this.verticesCount=r*a},zen3d.PlaneGeometry=t}(),function(){var t=function(e,i,n){t.superClass.constructor.call(this),this.buildGeometry(e,i||20,n||20)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i){var n=!0,r=0,a=0,o=0,s=17,h=s-9,c=this.verticesArray,u=this.indicesArray,f=0,d=0,l=0,p=0,v=0,_=0;for(a=0;i>=a;++a){f=d;var E=Math.PI*a/i,m=-t*Math.cos(E),y=t*Math.sin(E);for(r=0;e>=r;++r){var T=2*Math.PI*r/e,g=y*Math.cos(T),b=y*Math.sin(T),L=1/Math.sqrt(g*g+b*b+m*m),z=Math.sqrt(b*b+g*g);if(v=0,_=z>.007?g/z:0,l=-m,p=b,r==e?(c[d++]=c[f],c[d++]=c[f+1],c[d++]=c[f+2],c[d++]=g*L,c[d++]=l*L,c[d++]=p*L,c[d++]=z>.007?-b/z:1,c[d++]=v,c[d++]=_,c[d+0]=1,c[d+1]=1,c[d+2]=1,c[d+3]=1):(c[d++]=g,c[d++]=l,c[d++]=p,c[d++]=g*L,c[d++]=l*L,c[d++]=p*L,c[d++]=z>.007?-b/z:1,c[d++]=v,c[d++]=_,c[d]=1,c[d+1]=1,c[d+2]=1,c[d+3]=1),r>0&&a>0){var x=(e+1)*a+r,A=(e+1)*a+r-1,M=(e+1)*(a-1)+r-1,S=(e+1)*(a-1)+r;a==i?(c[d-9]=c[f],c[d-8]=c[f+1],c[d-7]=c[f+2],n?(u[o++]=x,u[o++]=S,u[o++]=M):(u[o++]=x,u[o++]=M,u[o++]=S)):1==a?n?(u[o++]=x,u[o++]=M,u[o++]=A):(u[o++]=x,u[o++]=A,u[o++]=M):n?(u[o++]=x,u[o++]=S,u[o++]=M,u[o++]=x,u[o++]=M,u[o++]=A):(u[o++]=x,u[o++]=M,u[o++]=S,u[o++]=x,u[o++]=A,u[o++]=M)}d+=h}}var s=17,h=s-2,d=13;for(a=0;i>=a;++a)for(r=0;e>=r;++r)c[d++]=r/e,c[d++]=a/i,d+=h;this.verticesCount=(i+1)*(e+1)},zen3d.SphereGeometry=t}(),function(){var t=function(t){this.gl=t,this.width=0,this.height=0,this.isInit=!1,this.glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)};t.prototype.uploadImage=function(t,e){var i=this.gl;e&&i.bindTexture(i.TEXTURE_2D,this.glTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),this.width=t.width,this.height=t.height,this.isInit=!0},t.prototype.uploadCheckerboard=function(t,e){for(var i=this.gl,n=new Uint8Array(t*e*4),r=[[255,255,255,255],[0,0,0,255]],a=0,o=5,s=0;e>s;s++)for(var h=0;t>h;h++){if(0==h?a=1:h%o==0&&(a=(a+1)%2),s%o==0&&0==h){var c=r[0];r[0]=r[1],r[1]=c}n[s*(4*t)+4*h+0]=r[a][0],n[s*(4*t)+4*h+1]=r[a][1],n[s*(4*t)+4*h+2]=r[a][2],n[s*(4*t)+4*h+3]=r[a][3]}i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,n),this.width=t,this.height=e,this.isInit=!0},zen3d.Texture=t}(),function(){var t=function(){this.type="",this.color=16777215,this.map=null,this.opacity=1,this.transparent=!1};t.prototype.checkMapInit=function(){return!this.map||this.map.isInit},zen3d.Material=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.BASIC};zen3d.inherit(t,zen3d.Material),zen3d.BasicMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LAMBERT};zen3d.inherit(t,zen3d.Material),zen3d.LambertMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PHONE,this.specular=10};zen3d.inherit(t,zen3d.Material),zen3d.PhoneMaterial=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this),this.geometry=e,this.material=i,this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(t,zen3d.Object3D),zen3d.Mesh=t}();