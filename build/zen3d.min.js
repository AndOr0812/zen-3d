!function(t){var i=t.zen3d=t.zen3d||{},e=function(){},n=function(t,i){e.prototype=i.prototype,t.superClass=i.prototype,t.prototype=new e,t.prototype.constructor=t};i.inherit=n;var r=function(){if(!t.navigator)return!0;var i=navigator.userAgent.toLowerCase();return-1!=i.indexOf("mobile")||-1!=i.indexOf("android")};i.isMobile=r;var o=function(t,i){var e=["","WEBKIT_","MOZ_"],n=null;for(var r in e)if(n=t.getExtension(e[r]+i))break;return n};i.getExtension=o;var a=function(t){var i=t>>16&255,e=t>>8&255,n=255&t;return[i,e,n]};i.hex2RGB=a}(window),function(){var t={MESH:"mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group"};zen3d.OBJECT_TYPE=t;var i={AMBIENT:"ambient",DIRECT:"direct",POINT:"point"};zen3d.LIGHT_TYPE=i;var e={COLOR:"color",TEXTURE:"texture"};zen3d.MATERIAL_TYPE=e}(),function(){var t=function(i,e,n,r){this.x=i||0,this.y=e||0,this.z=n||0,this.order=r||t.DefaultOrder};t.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],t.DefaultOrder="XYZ",t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this},t.prototype.set=function(t,i,e){return this.x=t||0,this.y=i||0,this.z=e||0,this.order=order||this.order,this},zen3d.Euler=t}(),function(){var t=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};t.prototype.identify=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},t.prototype.set=function(t,i,e,n,r,o,a,s,h,c,u,f,d,l,p,v){var m=this.elements;return m[0]=t,m[4]=i,m[8]=e,m[12]=n,m[1]=r,m[5]=o,m[9]=a,m[13]=s,m[2]=h,m[6]=c,m[10]=u,m[14]=f,m[3]=d,m[7]=l,m[11]=p,m[15]=v,this},t.prototype.copy=function(t){return this.elements.set(t.elements),this},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiplyMatrices=function(t,i){var e=t.elements,n=i.elements,r=this.elements,o=e[0],a=e[4],s=e[8],h=e[12],c=e[1],u=e[5],f=e[9],d=e[13],l=e[2],p=e[6],v=e[10],m=e[14],y=e[3],_=e[7],E=e[11],T=e[15],b=n[0],g=n[4],z=n[8],x=n[12],L=n[1],M=n[5],A=n[9],I=n[13],U=n[2],P=n[6],S=n[10],R=n[14],w=n[3],O=n[7],C=n[11],D=n[15];return r[0]=o*b+a*L+s*U+h*w,r[4]=o*g+a*M+s*P+h*O,r[8]=o*z+a*A+s*S+h*C,r[12]=o*x+a*I+s*R+h*D,r[1]=c*b+u*L+f*U+d*w,r[5]=c*g+u*M+f*P+d*O,r[9]=c*z+u*A+f*S+d*C,r[13]=c*x+u*I+f*R+d*D,r[2]=l*b+p*L+v*U+m*w,r[6]=l*g+p*M+v*P+m*O,r[10]=l*z+p*A+v*S+m*C,r[14]=l*x+p*I+v*R+m*D,r[3]=y*b+_*L+E*U+T*w,r[7]=y*g+_*M+E*P+T*O,r[11]=y*z+_*A+E*S+T*C,r[15]=y*x+_*I+E*R+T*D,this},t.prototype.transpose=function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},t.prototype.getInverse=function(t){var i=this.elements,e=t.elements,n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],h=e[5],c=e[6],u=e[7],f=e[8],d=e[9],l=e[10],p=e[11],v=e[12],m=e[13],y=e[14],_=e[15],E=d*y*u-m*l*u+m*c*p-h*y*p-d*c*_+h*l*_,T=v*l*u-f*y*u-v*c*p+s*y*p+f*c*_-s*l*_,b=f*m*u-v*d*u+v*h*p-s*m*p-f*h*_+s*d*_,g=v*d*c-f*m*c-v*h*l+s*m*l+f*h*y-s*d*y,z=n*E+r*T+o*b+a*g;if(0===z)return console.warn("can't invert matrix, determinant is 0"),this.identity();var x=1/z;return i[0]=E*x,i[1]=(m*l*a-d*y*a-m*o*p+r*y*p+d*o*_-r*l*_)*x,i[2]=(h*y*a-m*c*a+m*o*u-r*y*u-h*o*_+r*c*_)*x,i[3]=(d*c*a-h*l*a-d*o*u+r*l*u+h*o*p-r*c*p)*x,i[4]=T*x,i[5]=(f*y*a-v*l*a+v*o*p-n*y*p-f*o*_+n*l*_)*x,i[6]=(v*c*a-s*y*a-v*o*u+n*y*u+s*o*_-n*c*_)*x,i[7]=(s*l*a-f*c*a+f*o*u-n*l*u-s*o*p+n*c*p)*x,i[8]=b*x,i[9]=(v*d*a-f*m*a-v*r*p+n*m*p+f*r*_-n*d*_)*x,i[10]=(s*m*a-v*h*a+v*r*u-n*m*u-s*r*_+n*h*_)*x,i[11]=(f*h*a-s*d*a-f*r*u+n*d*u+s*r*p-n*h*p)*x,i[12]=g*x,i[13]=(f*m*o-v*d*o+v*r*l-n*m*l-f*r*y+n*d*y)*x,i[14]=(v*h*o-s*m*o-v*r*c+n*m*c+s*r*y-n*h*y)*x,i[15]=(s*d*o-f*h*o+f*r*c-n*d*c-s*r*l+n*h*l)*x,this},t.prototype.transform=function(t,i,e){var n=e.toMatrix4(),r=n.elements,o=this.elements;return o[0]=r[0]*i.x,o[1]=r[1]*i.y,o[2]=r[2]*i.z,o[3]=0,o[4]=r[4]*i.x,o[5]=r[5]*i.y,o[6]=r[6]*i.z,o[7]=0,o[8]=r[8]*i.x,o[9]=r[9]*i.y,o[10]=r[10]*i.z,o[11]=0,o[12]=t.x,o[13]=t.y,o[14]=t.z,o[15]=1,this},zen3d.Matrix4=t}(),function(){var t=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1};t.prototype.set=function(t,i,e,n){return this.x=t||0,this.y=i||0,this.z=e||0,this.w=void 0!==n?n:1,this},t.prototype.setFromEuler=function(t){var i=Math.cos(t.x/2),e=Math.cos(t.y/2),n=Math.cos(t.z/2),r=Math.sin(t.x/2),o=Math.sin(t.y/2),a=Math.sin(t.z/2),s=t.order;return"XYZ"===s?(this.x=r*e*n+i*o*a,this.y=i*o*n-r*e*a,this.z=i*e*a+r*o*n,this.w=i*e*n-r*o*a):"YXZ"===s?(this.x=r*e*n+i*o*a,this.y=i*o*n-r*e*a,this.z=i*e*a-r*o*n,this.w=i*e*n+r*o*a):"ZXY"===s?(this.x=r*e*n-i*o*a,this.y=i*o*n+r*e*a,this.z=i*e*a+r*o*n,this.w=i*e*n-r*o*a):"ZYX"===s?(this.x=r*e*n-i*o*a,this.y=i*o*n+r*e*a,this.z=i*e*a-r*o*n,this.w=i*e*n+r*o*a):"YZX"===s?(this.x=r*e*n+i*o*a,this.y=i*o*n+r*e*a,this.z=i*e*a-r*o*n,this.w=i*e*n-r*o*a):"XZY"===s&&(this.x=r*e*n-i*o*a,this.y=i*o*n-r*e*a,this.z=i*e*a+r*o*n,this.w=i*e*n+r*o*a),this},t.prototype.toMatrix4=function(t){t||(t=new zen3d.Matrix4);var i=t.elements,e=2*this.x*this.y,n=2*this.x*this.z,r=2*this.x*this.w,o=2*this.y*this.z,a=2*this.y*this.w,s=2*this.z*this.w,h=this.x*this.x,c=this.y*this.y,u=this.z*this.z,f=this.w*this.w;return i[0]=h-c-u+f,i[4]=e-s,i[8]=n+a,i[12]=0,i[1]=e+s,i[5]=-h+c-u+f,i[9]=o-r,i[13]=0,i[2]=n-a,i[6]=o+r,i[10]=-h-c+u+f,i[14]=0,i[3]=0,i[7]=0,i[11]=0,i[15]=1,t},zen3d.Quaternion=t}(),function(){var t=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0};t.prototype.set=function(t,i,e){return this.x=t||0,this.y=i||0,this.z=e||0,this},t.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},t.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(t){t=t||1;var i=this.getLength();if(0!=i){var e=t/i;return this.x*=e,this.y*=e,void(this.z*=e)}},t.prototype.subtract=function(i,e){return e||(e=new t),e.set(this.x-i.x,this.y-i.y,this.z-i.z),e},t.prototype.crossProduct=function(i,e){return e||(e=new t),e.x=this.y*i.z-this.z*i.y,e.y=this.z*i.x-this.x*i.z,e.z=this.x*i.y-this.y*i.x,e},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.applyQuaternion=function(t){var i=this.x,e=this.y,n=this.z,r=t.x,o=t.y,a=t.z,s=t.w,h=s*i+o*n-a*e,c=s*e+a*i-r*n,u=s*n+r*e-o*i,f=-r*i-o*e-a*n;return this.x=h*s+f*-r+c*-a-u*-o,this.y=c*s+f*-o+u*-r-h*-a,this.z=u*s+f*-a+h*-o-c*-r,this},zen3d.Vector3=t}(),function(){var t={transpose:"mat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \n",inverse:"mat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \n",vertexBase:["attribute vec3 a_Position;","attribute vec3 a_Normal;","varying vec3 v_Normal;","#ifdef USE_DIFFUSE_MAP","attribute vec2 a_Uv;","varying vec2 v_Uv;","#endif","uniform mat4 u_Projection;","uniform mat4 u_View;","uniform mat4 u_Model;","#ifdef USE_POINT_LIGHT","varying vec3 v_VmPos;","#endif","void main() {","gl_Position = u_Projection * u_View * u_Model * vec4(a_Position, 1.0);","v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(a_Normal, 1.0)).xyz;","#ifdef USE_DIFFUSE_MAP","v_Uv = a_Uv;","#endif","#ifdef USE_POINT_LIGHT","v_VmPos = (u_View * u_Model * vec4(a_Position, 1.0)).xyz;","#endif","}"].join("\n"),fragmentBase:["precision mediump float;","#ifdef USE_DIFFUSE_MAP","varying vec2 v_Uv;","uniform sampler2D texture;","#endif","#ifdef USE_DIFFUSE_COLOR","uniform vec4 u_Color;","#endif","#ifdef USE_AMBIENT_LIGHT","struct AmbientLight","{","vec4 color;","float intensity;","};","uniform AmbientLight u_Ambient[USE_AMBIENT_LIGHT];","#endif","#ifdef USE_DIRECT_LIGHT","struct DirectLight","{","vec3 direction;","vec4 color;","float intensity;","};","uniform DirectLight u_Directional[USE_DIRECT_LIGHT];","#endif","#ifdef USE_POINT_LIGHT","struct PointLight","{","vec3 position;","vec4 color;","float intensity;","};","uniform PointLight u_Point[USE_POINT_LIGHT];","#endif","varying vec3 v_Normal;","#ifdef USE_POINT_LIGHT","varying vec3 v_VmPos;","uniform mat4 u_ViewMat;","#endif","#ifdef USE_DIRECT_LIGHT","uniform mat4 u_ViewITMat;","#endif","void main() {","#ifdef USE_DIFFUSE_MAP","vec4 color = texture2D(texture, v_Uv);","#endif","#ifdef USE_DIFFUSE_COLOR","vec4 color = u_Color;","#endif","#ifdef USE_LIGHT","vec3 normal = normalize(v_Normal);","#endif","gl_FragColor = vec4(0., 0., 0., 0.);","#ifdef USE_AMBIENT_LIGHT","for(int i = 0; i < USE_AMBIENT_LIGHT; i++) {","gl_FragColor += color * u_Ambient[i].color * u_Ambient[i].intensity;","}","#endif","#ifdef USE_DIRECT_LIGHT","for(int i = 0; i < USE_DIRECT_LIGHT; i++) {","vec3 direction = (u_ViewITMat * vec4(-u_Directional[i].direction, 0.0)).xyz;","direction = normalize(direction);","float dotL = dot(direction, normal);","float dL = max(dotL * u_Directional[i].intensity, 0.);","gl_FragColor += color * u_Directional[i].color * dL;","}","#endif","#ifdef USE_POINT_LIGHT","for(int i = 0; i < USE_POINT_LIGHT; i++) {","vec3 direction2 = ( u_ViewMat * vec4(u_Point[i].position, 1.0) ).xyz - v_VmPos;","float dist = max(1. - length(direction2) * .005, 0.0);","direction2 = normalize(direction2);","float dotL2 = dot(direction2, normal);","float pL = max(dotL2 * dist * u_Point[i].intensity, 0.);","gl_FragColor += color * u_Point[i].color * pL;","}","#endif","}"].join("\n")};zen3d.ShaderLib=t}(),function(){function t(t,i,e){var n=t.createShader(i);t.shaderSource(n,e),t.compileShader(n);var r=t.getShaderParameter(n,t.COMPILE_STATUS);return r||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(n))),n}function i(t,i,e){var n=t.createProgram();return t.attachShader(n,i),t.attachShader(n,e),t.linkProgram(n),n}function e(t){var i="";for(var e in t)i+=t[e]+"_";return i}function n(t,i){var e=[i.pointLightNum>0?"#define USE_POINT_LIGHT "+i.pointLightNum:"",i.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",i.useDiffuseColor?"#define USE_DIFFUSE_COLOR":"",zen3d.ShaderLib.inverse,zen3d.ShaderLib.transpose,zen3d.ShaderLib.vertexBase].join("\n"),n=[i.pointLightNum>0?"#define USE_POINT_LIGHT "+i.pointLightNum:"",i.directLightNum>0?"#define USE_DIRECT_LIGHT "+i.directLightNum:"",i.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+i.ambientLightNum:"",i.pointLightNum>0||i.directLightNum>0||i.ambientLightNum>0?"#define USE_LIGHT":"",i.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",i.useDiffuseColor?"#define USE_DIFFUSE_COLOR":"",zen3d.ShaderLib.fragmentBase].join("\n");return new o(t,e,n)}var r={},o=function(e,n,r){this.vshaderSource=n,this.fshaderSource=r,this.vertexShader=t(e,e.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=t(e,e.FRAGMENT_SHADER,this.fshaderSource),this.id=i(e,this.vertexShader,this.fragmentShader)},a=function(t,i,o){var a,s=o.ambientLights.length,h=o.directLights.length,c=o.pointLights.length,u={useDiffuseMap:"texture"==i.type,useDiffuseColor:"color"==i.type,ambientLightNum:s,directLightNum:h,pointLightNum:c},f=e(u),d=r;return d[f]?a=d[f]:(a=n(t,u),d[f]=a),a};zen3d.getProgram=a}(),function(){var t=function(t){this.view=t;var i=this.gl=t.getContext("webgl",{antialias:!0,stencil:!0});this.width=t.clientWidth,this.height=t.clientHeight,this.vertices=new Float32Array(4e4),this.vertexBuffer=i.createBuffer(),this.indices=new Uint16Array(12e3),this.indexBuffer=i.createBuffer(),i.enable(i.STENCIL_TEST),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),this.lights={directLights:new Array,ambientLights:new Array,pointLights:new Array},this.opaqueObjects=new Array,this.transparentObjects=new Array,this.camera=null};t.prototype.render=function(t,i){this.clear(),this.camera=i,t.updateMatrix(),this.cacheObjects(t),this.opaqueObjects.sort(function(t,i){var e=t.position.z,n=i.position.z;return e-n}),this.transparentObjects.sort(function(t,i){var e=t.position.z,n=i.position.z;return n-e}),this.flush()};var i=zen3d.OBJECT_TYPE,e=zen3d.LIGHT_TYPE,n=zen3d.MATERIAL_TYPE;t.prototype.cacheObjects=function(t){switch(t.type){case i.MESH:this.cacheObject(t);break;case i.LIGHT:t.lightType==e.AMBIENT?this.lights.ambientLights.push(t):t.lightType==e.DIRECT?this.lights.directLights.push(t):t.lightType==e.POINT&&this.lights.pointLights.push(t);break;case i.CAMERA:break;case i.SCENE:break;case i.GROUP:break;default:console.log("undefined object type")}for(var n=t.children,r=0,o=n.length;o>r;r++)this.cacheObjects(n[r])},t.prototype.cacheObject=function(t){var i=t.material;(i.type!=n.TEXTURE||i.checkMapInit())&&(i.transparent?this.transparentObjects.push(t):this.opaqueObjects.push(t))},t.prototype.flush=function(){this.flushList(this.opaqueObjects),this.flushList(this.transparentObjects)},t.prototype.flushList=function(t){for(var i=this.camera,e=this.vertices,r=this.indices,o=0,a=t.length;a>o;o++){for(var s=t[o],h=s.geometry,c=s.material,u=this.lights,f=0,d=0,l=0,p=h.verticesArray,v=p.length;v>l;l++)e[f++]=p[l];for(var m=0,y=h.indicesArray,_=y.length;_>m;m++)r[d++]=y[m];var E=this.gl;E.bindBuffer(E.ARRAY_BUFFER,this.vertexBuffer),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var T=e.subarray(0,f);E.bufferData(E.ARRAY_BUFFER,T,E.STREAM_DRAW);var b=r.subarray(0,d);E.bufferData(E.ELEMENT_ARRAY_BUFFER,b,E.STATIC_DRAW);var g=zen3d.getProgram(E,c,u);E.useProgram(g.id);var z=E.getAttribLocation(g.id,"a_Position");E.vertexAttribPointer(z,3,E.FLOAT,!1,68,0),E.enableVertexAttribArray(z);var x=E.getAttribLocation(g.id,"a_Normal");E.vertexAttribPointer(x,3,E.FLOAT,!1,68,12),E.enableVertexAttribArray(x);var L=i.projectionMatrix.elements,M=E.getUniformLocation(g.id,"u_Projection");E.uniformMatrix4fv(M,!1,L);var A=i.viewMatrix.elements,I=E.getUniformLocation(g.id,"u_View");E.uniformMatrix4fv(I,!1,A);var U=s.worldMatrix.elements,P=E.getUniformLocation(g.id,"u_Model");E.uniformMatrix4fv(P,!1,U);for(var S=u.ambientLights,m=0;m<S.length;m++){var R=S[m],w=R.intensity,O=zen3d.hex2RGB(R.color),C=E.getUniformLocation(g.id,"u_Ambient["+m+"].intensity"),D=E.getUniformLocation(g.id,"u_Ambient["+m+"].color");E.uniform4f(D,O[0]/255,O[1]/255,O[2]/255,1),E.uniform1f(C,w)}for(var G=u.directLights,N=new zen3d.Matrix4,m=0;m<G.length;m++){var R=G[m],w=R.intensity,B=R.direction,O=zen3d.hex2RGB(R.color),F=E.getUniformLocation(g.id,"u_Directional["+m+"].direction"),H=E.getUniformLocation(g.id,"u_Directional["+m+"].intensity"),Y=E.getUniformLocation(g.id,"u_Directional["+m+"].color");E.uniform3f(F,B.x,B.y,B.z),E.uniform1f(H,w),E.uniform4f(Y,O[0]/255,O[1]/255,O[2]/255,1)}for(var j=u.pointLights,m=0;m<j.length;m++){var R=j[m],X=R.position,w=R.intensity,O=zen3d.hex2RGB(R.color),V=E.getUniformLocation(g.id,"u_Point["+m+"].position");E.uniform3f(V,X.x,X.y,X.z);var Z=E.getUniformLocation(g.id,"u_Point["+m+"].intensity");E.uniform1f(Z,w);var q=E.getUniformLocation(g.id,"u_Point["+m+"].color");E.uniform4f(q,O[0]/255,O[1]/255,O[2]/255,1)}if(G.length>0){var k=N.copy(i.viewMatrix).inverse().transpose().elements,W=E.getUniformLocation(g.id,"u_ViewITMat");E.uniformMatrix4fv(W,!1,k)}else if(j.length>0){var A=i.viewMatrix.elements,J=E.getUniformLocation(g.id,"u_ViewMat");E.uniformMatrix4fv(J,!1,A)}if(c.type==n.COLOR){var O=zen3d.hex2RGB(c.color),K=E.getUniformLocation(g.id,"u_Color");E.uniform4f(K,O[0]/255,O[1]/255,O[2]/255,1)}else if(c.type==n.TEXTURE){var Q=E.getAttribLocation(g.id,"a_Uv");E.vertexAttribPointer(Q,2,E.FLOAT,!1,68,52),E.enableVertexAttribArray(Q),E.activeTexture(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,c.diffuseMap.glTexture)}E.drawElements(E.TRIANGLES,d,E.UNSIGNED_SHORT,0)}},t.prototype.clear=function(t){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.lights.ambientLights.length=0,this.lights.directLights.length=0,this.lights.pointLights.length=0,this.camera=null},zen3d.Renderer=t}(),function(){var t=function(t,i){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1),this.euler=new zen3d.Euler,this.quaternion=new zen3d.Quaternion,this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null};Object.defineProperties(t.prototype,{rotation:{get:function(){return this.euler},set:function(t){var i=this.euler;i.copyFrom(t),this.quaternion.setFromEuler(t)}}}),t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var i=this.children.indexOf(t);-1!==i&&this.children.splice(i,1),t.parent=null},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(t),this.parent){var i=this.parent.worldMatrix;this.worldMatrix.premultiply(i)}for(var e=this.children,n=0,r=e.length;r>n;n++)e[n].updateMatrix()},zen3d.Object3D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE};zen3d.inherit(t,zen3d.Object3D),zen3d.Scene=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(t,zen3d.Object3D),zen3d.Group=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=16777215,this.intensity=1};zen3d.inherit(t,zen3d.Object3D),zen3d.Light=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(t,zen3d.Light),zen3d.AmbientLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.direction=new zen3d.Vector3};zen3d.inherit(t,zen3d.Light),zen3d.DirectionalLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2};zen3d.inherit(t,zen3d.Light),zen3d.PointLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(t,zen3d.Object3D),t.prototype.setLookAt=function(t,i){var e=this.position,n=new zen3d.Vector3;e.subtract(t,n),n.normalize();var r=new zen3d.Vector3;i.crossProduct(n,r),r.normalize();var o=new zen3d.Vector3;n.crossProduct(r,o),this.viewMatrix.set(-r.x,-r.y,-r.z,-r.dotProduct(e),o.x,o.y,o.z,-o.dotProduct(e),n.x,n.y,n.z,-n.dotProduct(e),0,0,0,1)},t.prototype.setOrtho=function(t,i,e,n,r,o){this.projectionMatrix.set(2/(i-t),0,0,-(i+t)/(i-t),0,2/(n-e),0,-(n+e)/(n-e),0,0,-2/(o-r),-(o+r)/(o-r),0,0,0,1)},t.prototype.setPerspective=function(t,i,e,n){this.projectionMatrix.set(1/(i*Math.tan(t/2)),0,0,0,0,1/Math.tan(t/2),0,0,0,0,-(n+e)/(n-e),-2*n*e/(n-e),0,0,-1,0)},zen3d.Camera=t}(),function(){var t=function(){this.verticesArray=new Array,this.indicesArray=new Array,this.verticesCount=0};zen3d.Geometry=t}(),function(){var t=function(i,e,n){t.superClass.constructor.call(this),this.buildGeometry(i,e,n)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,i,e){this.verticesArray.push(.5*-t,.5*-i,.5*-e,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*i,.5*-e,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*i,.5*-e,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*i,.5*-e,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-i,.5*-e,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-i,.5*-e,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-i,.5*e,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-i,.5*e,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*i,.5*e,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*i,.5*e,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*i,.5*e,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-i,.5*e,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-i,.5*-e,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-i,.5*-e,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*-i,.5*e,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-i,.5*e,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-i,.5*e,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-i,.5*-e,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-i,.5*-e,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*i,.5*-e,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*i,.5*e,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*i,.5*e,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-i,.5*e,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-i,.5*-e,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*i,.5*-e,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*i,.5*-e,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*i,.5*e,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*i,.5*e,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*i,.5*e,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*i,.5*-e,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*i,.5*-e,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-i,.5*-e,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-i,.5*e,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-i,.5*e,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*i,.5*e,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*i,.5*-e,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34),this.verticesCount=36},zen3d.CubeGeometry=t}(),function(){var t=function(i,e,n,r){t.superClass.constructor.call(this),this.buildGeometry(i,e,n||1,r||1)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,i,e,n){for(var r=e+1,o=n+1,a=this.verticesArray,s=this.indicesArray,h=0,c=0,u=0;o>u;u++)for(var f=0;r>f;f++){var d=(f/e-.5)*t,l=(u/n-.5)*i;if(a[h++]=d,a[h++]=0,a[h++]=l,a[h++]=0,a[h++]=1,a[h++]=0,a[h++]=1,a[h++]=0,a[h++]=0,a[h++]=1,a[h++]=1,a[h++]=1,a[h++]=1,a[h++]=f/e*1,a[h++]=1*(1-u/n),a[h++]=f/e*1,a[h++]=1*(1-u/n),f!=e&&u!=n){base=f+u*r;var p=1;s[c++]=base*p,s[c++]=(base+r+1)*p,s[c++]=(base+r)*p,s[c++]=base*p,s[c++]=(base+1)*p,s[c++]=(base+r+1)*p}}this.verticesCount=r*o},zen3d.PlaneGeometry=t}(),function(){var t=function(i,e,n){t.superClass.constructor.call(this),this.buildGeometry(i,e||20,n||20)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,i,e){var n=!0,r=0,o=0,a=0,s=17,h=s-9,c=this.verticesArray,u=this.indicesArray,f=0,d=0,l=0,p=0,v=0,m=0;for(o=0;e>=o;++o){f=d;var y=Math.PI*o/e,_=-t*Math.cos(y),E=t*Math.sin(y);for(r=0;i>=r;++r){var T=2*Math.PI*r/i,b=E*Math.cos(T),g=E*Math.sin(T),z=1/Math.sqrt(b*b+g*g+_*_),x=Math.sqrt(g*g+b*b);if(v=0,m=x>.007?b/x:0,l=-_,p=g,r==i?(c[d++]=c[f],c[d++]=c[f+1],c[d++]=c[f+2],c[d++]=b*z,c[d++]=l*z,c[d++]=p*z,c[d++]=x>.007?-g/x:1,c[d++]=v,c[d++]=m,c[d+0]=1,c[d+1]=1,c[d+2]=1,c[d+3]=1):(c[d++]=b,c[d++]=l,c[d++]=p,c[d++]=b*z,c[d++]=l*z,c[d++]=p*z,c[d++]=x>.007?-g/x:1,c[d++]=v,c[d++]=m,c[d]=1,c[d+1]=1,c[d+2]=1,c[d+3]=1),r>0&&o>0){var L=(i+1)*o+r,M=(i+1)*o+r-1,A=(i+1)*(o-1)+r-1,I=(i+1)*(o-1)+r;o==e?(c[d-9]=c[f],c[d-8]=c[f+1],c[d-7]=c[f+2],n?(u[a++]=L,u[a++]=I,u[a++]=A):(u[a++]=L,u[a++]=A,u[a++]=I)):1==o?n?(u[a++]=L,u[a++]=A,u[a++]=M):(u[a++]=L,u[a++]=M,u[a++]=A):n?(u[a++]=L,u[a++]=I,u[a++]=A,u[a++]=L,u[a++]=A,u[a++]=M):(u[a++]=L,u[a++]=A,u[a++]=I,u[a++]=L,u[a++]=M,u[a++]=A)}d+=h}}var s=17,h=s-2,d=13;for(o=0;e>=o;++o)for(r=0;i>=r;++r)c[d++]=r/i,c[d++]=o/e,d+=h;this.verticesCount=(e+1)*(i+1)},zen3d.SphereGeometry=t}(),function(){var t=function(t){this.gl=t,this.width=0,this.height=0,this.isInit=!1,this.glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)};t.prototype.uploadImage=function(t,i){var e=this.gl;i&&e.bindTexture(e.TEXTURE_2D,this.glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),this.width=t.width,this.height=t.height,this.isInit=!0},t.prototype.uploadCheckerboard=function(t,i){for(var e=this.gl,n=new Uint8Array(t*i*4),r=[[255,255,255,255],[0,0,0,255]],o=0,a=5,s=0;i>s;s++)for(var h=0;t>h;h++){if(0==h?o=1:h%a==0&&(o=(o+1)%2),s%a==0&&0==h){var c=r[0];r[0]=r[1],r[1]=c}n[s*(4*t)+4*h+0]=r[o][0],n[s*(4*t)+4*h+1]=r[o][1],n[s*(4*t)+4*h+2]=r[o][2],n[s*(4*t)+4*h+3]=r[o][3]}e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,n),this.width=t,this.height=i,this.isInit=!0},zen3d.Texture=t}(),function(){var t=function(){this.type="",this.transparent=!1};zen3d.Material=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.COLOR,this.color=16777215};zen3d.inherit(t,zen3d.Material),zen3d.ColorMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.TEXTURE,this.diffuseMap=null};zen3d.inherit(t,zen3d.Material),t.prototype.checkMapInit=function(){return this.diffuseMap.isInit},zen3d.TextureMaterial=t}(),function(){var t=function(i,e){t.superClass.constructor.call(this),this.geometry=i,this.material=e,this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(t,zen3d.Object3D),zen3d.Mesh=t}();