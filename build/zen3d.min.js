!function(t){var e=t.zen3d=t.zen3d||{},i=function(){},n=function(t,e){i.prototype=e.prototype,t.superClass=e.prototype,t.prototype=new i,t.prototype.constructor=t};e.inherit=n;var r=function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,i[r]=e[19===r?3&t|8:t]);return i.join("")}};e.generateUUID=r();var a=function(){if(!t.navigator)return!0;var e=navigator.userAgent.toLowerCase();return e.indexOf("mobile")!=-1||e.indexOf("android")!=-1};e.isMobile=a();var o=function(){return!!document};e.isWeb=o();var s=function(t,e){var i=["","WEBKIT_","MOZ_"],n=null;for(var r in i)if(n=t.getExtension(i[r]+e))break;return n};e.getExtension=s;var h=function(t,e,i){var n=new Uint8Array(t*e*4),r=[[255,255,255,255],[0,0,0,255]];i=i||5;for(var a=0,o=0;o<e;o++)for(var s=0;s<t;s++){if(0==s?a=1:s%i==0&&(a=(a+1)%2),o%i==0&&0==s){var h=r[0];r[0]=r[1],r[1]=h}n[o*(4*t)+4*s+0]=r[a][0],n[o*(4*t)+4*s+1]=r[a][1],n[o*(4*t)+4*s+2]=r[a][2],n[o*(4*t)+4*s+3]=r[a][3]}return n};e.createCheckerBoardPixels=h;var u=function(t){return 0===(t&t-1)&&0!==t};e.isPowerOfTwo=u;var c=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))};e.nearestPowerOfTwo=c;var d=function(t,e,i){var n=new Image;n.onload=function(){e(n)},n.src=t};e.requireImage=d;var l=function(t,e,i,n){var r=new XMLHttpRequest;r.onreadystatechange=function(t){if(4==t.target.readyState){var i=t.target.response;n&&n.parse&&(i=JSON.parse(i)),e(i)}},n&&"POST"===n.method?(r.open("POST",t,!0),r.send(n.data)):(r.open("GET",t,!0),r.send())};e.requireHttp=l}(window),function(){var t={MESH:"mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group",POINT:"point",CANVAS2D:"canvas2d",SPRITE:"sprite"};zen3d.OBJECT_TYPE=t;var e={AMBIENT:"ambient",DIRECT:"direct",POINT:"point",SPOT:"spot"};zen3d.LIGHT_TYPE=e;var i={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",CUBE:"cube",POINT:"point",CANVAS2D:"canvas2d",SPRITE:"sprite"};zen3d.MATERIAL_TYPE=i;var n={NORMAL:"normal",EXP2:"exp2"};zen3d.FOG_TYPE=n;var r={NONE:"none",NORMAL:"normal",ADD:"add"};zen3d.BLEND_TYPE=r;var a={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"};zen3d.CULL_FACE_TYPE=a;var o={FRONT:"front",BACK:"back",DOUBLE:"double"};zen3d.DRAW_SIDE=o;var s={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067};zen3d.WEBGL_TEXTURE_TYPE=s;var h={DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410};zen3d.WEBGL_PIXEL_FORMAT=h;var u={UNSIGNED_BYTE:5121,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635};zen3d.WEBGL_PIXEL_TYPE=u;var c={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};zen3d.WEBGL_TEXTURE_FILTER=c;var d={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648};zen3d.WEBGL_TEXTURE_WRAP=d;var l={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,BYTE:65535,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};zen3d.WEBGL_UNIFORM_TYPE=l;var p={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FLOAT:5126,BYTE:65535,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};zen3d.WEBGL_ATTRIBUTE_TYPE=p}(),function(){var t=function(e,i,n,r){this._x=e||0,this._y=i||0,this._z=n||0,this._order=r||t.DefaultOrder};t.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],t.DefaultOrder="XYZ",Object.defineProperties(t.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),t.prototype.copyFrom=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},t.prototype.set=function(t,e,i,n){return this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||this._order,this.onChangeCallback(),this},t.prototype.setFromRotationMatrix=function(t,e,i){var n=function(t,e,i){return Math.max(e,Math.min(i,t))},r=t.elements,a=r[0],o=r[4],s=r[8],h=r[1],u=r[5],c=r[9],d=r[2],l=r[6],p=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(l,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-d,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===e?(this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(l,p),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===e?(this._z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-d,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(l,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("given unsupported order: "+e),this._order=e,i!==!1&&this.onChangeCallback(),this},t.prototype.setFromQuaternion=function(t,e,i){var n=zen3d.helpMatrix;return t.toMatrix4(n),this.setFromRotationMatrix(n,e,i)},t.prototype.onChange=function(t){return this.onChangeCallback=t,this},t.prototype.onChangeCallback=function(){},zen3d.Euler=t}(),function(){var t=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])};t.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},t.prototype.set=function(t,e,i,n,r,a,o,s,h){var u=this.elements;return u[0]=t,u[3]=e,u[6]=i,u[1]=n,u[4]=r,u[7]=a,u[2]=o,u[5]=s,u[8]=h,this},t.prototype.copy=function(t){return this.elements.set(t.elements),this},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiplyMatrices=function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[3],s=i[6],h=i[1],u=i[4],c=i[7],d=i[2],l=i[5],p=i[8],f=n[0],_=n[3],v=n[6],m=n[1],g=n[4],E=n[7],T=n[2],y=n[5],x=n[8];return r[0]=a*f+o*m+s*T,r[3]=a*_+o*g+s*y,r[6]=a*v+o*E+s*x,r[1]=h*f+u*m+c*T,r[4]=h*_+u*g+c*y,r[7]=h*v+u*E+c*x,r[2]=d*f+l*m+p*T,r[5]=d*_+l*g+p*y,r[8]=d*v+l*E+p*x,this},t.prototype.transform=function(t,e,i,n,r,a,o){var s=this.elements,h=1,u=0;if(r%360){var c=r;h=Math.cos(c),u=Math.sin(c)}return s[0]=h*i,s[3]=-u*n,s[6]=t,s[1]=u*i,s[4]=h*n,s[7]=e,s[2]=0,s[5]=0,s[8]=1,(a||o)&&(s[6]-=a*s[0]+o*s[3],s[7]-=a*s[1]+o*s[4]),this},zen3d.Matrix3=t}(),function(){var t=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};t.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},t.prototype.set=function(t,e,i,n,r,a,o,s,h,u,c,d,l,p,f,_){var v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=n,v[1]=r,v[5]=a,v[9]=o,v[13]=s,v[2]=h,v[6]=u,v[10]=c,v[14]=d,v[3]=l,v[7]=p,v[11]=f,v[15]=_,this},t.prototype.copy=function(t){return this.elements.set(t.elements),this},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiplyMatrices=function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[4],s=i[8],h=i[12],u=i[1],c=i[5],d=i[9],l=i[13],p=i[2],f=i[6],_=i[10],v=i[14],m=i[3],g=i[7],E=i[11],T=i[15],y=n[0],x=n[4],M=n[8],z=n[12],w=n[1],b=n[5],A=n[9],S=n[13],L=n[2],P=n[6],C=n[10],R=n[14],F=n[3],O=n[7],N=n[11],U=n[15];return r[0]=a*y+o*w+s*L+h*F,r[4]=a*x+o*b+s*P+h*O,r[8]=a*M+o*A+s*C+h*N,r[12]=a*z+o*S+s*R+h*U,r[1]=u*y+c*w+d*L+l*F,r[5]=u*x+c*b+d*P+l*O,r[9]=u*M+c*A+d*C+l*N,r[13]=u*z+c*S+d*R+l*U,r[2]=p*y+f*w+_*L+v*F,r[6]=p*x+f*b+_*P+v*O,r[10]=p*M+f*A+_*C+v*N,r[14]=p*z+f*S+_*R+v*U,r[3]=m*y+g*w+E*L+T*F,r[7]=m*x+g*b+E*P+T*O,r[11]=m*M+g*A+E*C+T*N,r[15]=m*z+g*S+E*R+T*U,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},t.prototype.inverse=function(){return this.getInverse(this)},t.prototype.getInverse=function(t){var e=this.elements,i=t.elements,n=i[0],r=i[1],a=i[2],o=i[3],s=i[4],h=i[5],u=i[6],c=i[7],d=i[8],l=i[9],p=i[10],f=i[11],_=i[12],v=i[13],m=i[14],g=i[15],E=l*m*c-v*p*c+v*u*f-h*m*f-l*u*g+h*p*g,T=_*p*c-d*m*c-_*u*f+s*m*f+d*u*g-s*p*g,y=d*v*c-_*l*c+_*h*f-s*v*f-d*h*g+s*l*g,x=_*l*u-d*v*u-_*h*p+s*v*p+d*h*m-s*l*m,M=n*E+r*T+a*y+o*x;if(0===M)return console.warn("can't invert matrix, determinant is 0"),this.identity();var z=1/M;return e[0]=E*z,e[1]=(v*p*o-l*m*o-v*a*f+r*m*f+l*a*g-r*p*g)*z,e[2]=(h*m*o-v*u*o+v*a*c-r*m*c-h*a*g+r*u*g)*z,e[3]=(l*u*o-h*p*o-l*a*c+r*p*c+h*a*f-r*u*f)*z,e[4]=T*z,e[5]=(d*m*o-_*p*o+_*a*f-n*m*f-d*a*g+n*p*g)*z,e[6]=(_*u*o-s*m*o-_*a*c+n*m*c+s*a*g-n*u*g)*z,e[7]=(s*p*o-d*u*o+d*a*c-n*p*c-s*a*f+n*u*f)*z,e[8]=y*z,e[9]=(_*l*o-d*v*o-_*r*f+n*v*f+d*r*g-n*l*g)*z,e[10]=(s*v*o-_*h*o+_*r*c-n*v*c-s*r*g+n*h*g)*z,e[11]=(d*h*o-s*l*o-d*r*c+n*l*c+s*r*f-n*h*f)*z,e[12]=x*z,e[13]=(d*v*a-_*l*a+_*r*p-n*v*p-d*r*m+n*l*m)*z,e[14]=(_*h*a-s*v*a-_*r*u+n*v*u+s*r*m-n*h*m)*z,e[15]=(s*l*a-d*h*a+d*r*u-n*l*u-s*r*p+n*h*p)*z,this},t.prototype.transform=function(t,e,i){var n=i.toMatrix4(),r=n.elements,a=this.elements;return a[0]=r[0]*e.x,a[1]=r[1]*e.y,a[2]=r[2]*e.z,a[3]=0,a[4]=r[4]*e.x,a[5]=r[5]*e.y,a[6]=r[6]*e.z,a[7]=0,a[8]=r[8]*e.x,a[9]=r[9]*e.y,a[10]=r[10]*e.z,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this},t.prototype.makeRotationFromQuaternion=function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,a=t.w,o=i+i,s=n+n,h=r+r,u=i*o,c=i*s,d=i*h,l=n*s,p=n*h,f=r*h,_=a*o,v=a*s,m=a*h;return e[0]=1-(l+f),e[4]=c-m,e[8]=d+v,e[1]=c+m,e[5]=1-(u+f),e[9]=p-_,e[2]=d-v,e[6]=p+_,e[10]=1-(u+l),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this};var e,i;t.prototype.decompose=function(n,r,a){void 0===e&&(e=new zen3d.Vector3,i=new t);var o=this.elements,s=e.set(o[0],o[1],o[2]).getLength(),h=e.set(o[4],o[5],o[6]).getLength(),u=e.set(o[8],o[9],o[10]).getLength(),c=this.determinant();c<0&&(s=-s),n.x=o[12],n.y=o[13],n.z=o[14],i.elements.set(this.elements);var d=1/s,l=1/h,p=1/u;return i.elements[0]*=d,i.elements[1]*=d,i.elements[2]*=d,i.elements[4]*=l,i.elements[5]*=l,i.elements[6]*=l,i.elements[8]*=p,i.elements[9]*=p,i.elements[10]*=p,r.setFromRotationMatrix(i),a.x=s,a.y=h,a.z=u,this},t.prototype.determinant=function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],o=t[5],s=t[9],h=t[13],u=t[2],c=t[6],d=t[10],l=t[14],p=t[3],f=t[7],_=t[11],v=t[15];return p*(+r*s*c-n*h*c-r*o*d+i*h*d+n*o*l-i*s*l)+f*(+e*s*l-e*h*d+r*a*d-n*a*l+n*h*u-r*s*u)+_*(+e*h*c-e*o*l-r*a*c+i*a*l+r*o*u-i*h*u)+v*(-n*o*u-e*s*c+e*o*d+n*a*c-i*a*d+i*s*u)},t.prototype.fromArray=function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},t.prototype.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},zen3d.Matrix4=t,zen3d.helpMatrix=new t}(),function(){var t=function(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1};Object.defineProperties(t.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),t.prototype.set=function(t,e,i,n){return this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1,this.onChangeCallback(),this},t.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=void 0!==t.w?t.w:1,this.onChangeCallback(),this},t.prototype.setFromEuler=function(t,e){var i=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),a=Math.sin(t._x/2),o=Math.sin(t._y/2),s=Math.sin(t._z/2),h=t._order;return"XYZ"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r-a*o*s):"YXZ"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r+a*o*s):"ZXY"===h?(this._x=a*n*r-i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r-a*o*s):"ZYX"===h?(this._x=a*n*r-i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r+a*o*s):"YZX"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r-a*o*s):"XZY"===h&&(this._x=a*n*r-i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r+a*o*s),e!==!1&&this.onChangeCallback(),this},t.prototype.setFromRotationMatrix=function(t){var e,i=t.elements,n=i[0],r=i[4],a=i[8],o=i[1],s=i[5],h=i[9],u=i[2],c=i[6],d=i[10],l=n+s+d;return l>0?(e=.5/Math.sqrt(l+1),this._w=.25/e,this._x=(c-h)*e,this._y=(a-u)*e,this._z=(o-r)*e):n>s&&n>d?(e=2*Math.sqrt(1+n-s-d),this._w=(c-h)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(a+u)/e):s>d?(e=2*Math.sqrt(1+s-n-d),this._w=(a-u)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*Math.sqrt(1+d-n-s),this._w=(o-r)/e,this._x=(a+u)/e,this._y=(h+c)/e,this._z=.25*e),this.onChangeCallback(),this},t.prototype.toMatrix4=function(t){t||(t=new zen3d.Matrix4);var e=t.elements,i=2*this._x*this._y,n=2*this._x*this._z,r=2*this._x*this._w,a=2*this._y*this._z,o=2*this._y*this._w,s=2*this._z*this._w,h=this._x*this._x,u=this._y*this._y,c=this._z*this._z,d=this._w*this._w;return e[0]=h-u-c+d,e[4]=i-s,e[8]=n+o,e[12]=0,e[1]=i+s,e[5]=-h+u-c+d,e[9]=a-r,e[13]=0,e[2]=n-o,e[6]=a+r,e[10]=-h-u+c+d,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t},t.prototype.setFromAxisAngle=function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},t.prototype.onChange=function(t){return this.onChangeCallback=t,this},t.prototype.onChangeCallback=function(){},zen3d.Quaternion=t}(),function(){var t=function(t,e){this.x=t||0,this.y=e||0};t.prototype.set=function(t,e){return this.x=t||0,this.y=e||0,this},t.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},t.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},t.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},t.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(t){t=t||1;var e=this.getLength();if(0!=e){var i=t/e;return this.x*=i,this.y*=i,this}},t.prototype.subtract=function(e,i){return i||(i=new t),i.set(this.x-e.x,this.y-e.y),i},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},t.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},t.prototype.distanceToSquared=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},t.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},t.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},zen3d.Vector2=t}(),function(){var t=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};t.prototype.set=function(t,e,i){return this.x=t||0,this.y=e||0,this.z=i||0,this},t.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},t.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},t.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},t.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(t){t=t||1;var e=this.getLength();if(0!=e){var i=t/e;return this.x*=i,this.y*=i,this.z*=i,this}},t.prototype.subtract=function(e,i){return i||(i=new t),i.set(this.x-e.x,this.y-e.y,this.z-e.z),i},t.prototype.crossVectors=function(t,e){var i=t.x,n=t.y,r=t.z,a=e.x,o=e.y,s=e.z;return this.x=n*s-r*o,this.y=r*a-i*s,this.z=i*o-n*a,this},t.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.applyQuaternion=function(t){var e=this.x,i=this.y,n=this.z,r=t._x,a=t._y,o=t._z,s=t._w,h=s*e+a*n-o*i,u=s*i+o*e-r*n,c=s*n+r*i-a*e,d=-r*e-a*i-o*n;return this.x=h*s+d*-r+u*-o-c*-a,this.y=u*s+d*-a+c*-r-h*-o,this.z=c*s+d*-o+h*-a-u*-r,this},t.prototype.applyMatrix4=function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],this},t.prototype.transformDirection=function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},t.prototype.setFromMatrixPosition=function(t){return this.setFromMatrixColumn(t,3)},t.prototype.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},t.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.distanceToSquared=function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},t.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},t.prototype.unproject=function(){var t;return function(e){return void 0===t&&(t=new zen3d.Matrix4),t.multiplyMatrices(e.worldMatrix,t.getInverse(e.projectionMatrix)),this.applyProjection(t)}}(),t.prototype.applyProjection=function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},zen3d.Vector3=t}(),function(){var t=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};t.prototype.set=function(t,e,i,n){return this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1,this},t.prototype.applyMatrix4=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},zen3d.Vector4=t}(),function(){var t=function(t,e){this.min=void 0!==t?t:new zen3d.Vector2((+(1/0)),(+(1/0))),this.max=void 0!==e?e:new zen3d.Vector2((-(1/0)),(-(1/0)))};t.prototype.set=function(t,e,i,n){this.min.set(t,e),this.max.set(i,n)},t.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},zen3d.Box2=t}(),function(){var t=function(t,e){this.min=void 0!==t?t:new zen3d.Vector3((+(1/0)),(+(1/0)),(+(1/0))),this.max=void 0!==e?e:new zen3d.Vector3((-(1/0)),(-(1/0)),(-(1/0)))};t.prototype.set=function(t,e){this.min.copy(t),this.max.copy(e)},t.prototype.setFromPoints=function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},t.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},t.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},t.prototype.setFromArray=function(t,e){for(var i=+(1/0),n=+(1/0),r=+(1/0),a=-(1/0),o=-(1/0),s=-(1/0),h=void 0!==e?e:3,u=0,c=t.length;u<c;u+=h){var d=t[u],l=t[u+1],p=t[u+2];d<i&&(i=d),l<n&&(n=l),p<r&&(r=p),d>a&&(a=d),l>o&&(o=l),p>s&&(s=p)}return this.min.set(i,n,r),this.max.set(a,o,s),this},t.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},t.prototype.getCenter=function(t){var e=t||new zen3d.Vector3;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},t.prototype.applyMatrix4=function(){var t=[new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),t.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},zen3d.Box3=t}(),function(){var t=function(t,e){this.center=void 0!==t?t:new zen3d.Vector3,this.radius=void 0!==e?e:0};t.prototype.setFromArray=function(){var t=new zen3d.Box3,e=new zen3d.Vector3;return function(i,n){var r=void 0!==n?n:3,a=this.center;t.setFromArray(i,r).getCenter(a);for(var o=0,s=0,h=i.length;s<h;s+=r){var u=i[s],c=i[s+1],d=i[s+2];e.set(u,c,d),o=Math.max(o,a.distanceToSquared(e))}return this.radius=Math.sqrt(o),this}}(),t.prototype.applyMatrix4=function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},t.prototype.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},zen3d.Sphere=t}(),function(){var t=function(t,e){this.normal=void 0!==t?t:new zen3d.Vector3(1,0,0),this.constant=void 0!==e?e:0};t.prototype.set=function(t,e){return this.normal.copy(t),this.constant=e,this},t.prototype.setComponents=function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},t.prototype.normalize=function(){var t=1/this.normal.getLength();return this.normal.multiplyScalar(t),this.constant*=t,this},t.prototype.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},zen3d.Plane=t}(),function(){var t=function(t,e,i,n,r,a){this.planes=[void 0!==t?t:new zen3d.Plane,void 0!==e?e:new zen3d.Plane,void 0!==i?i:new zen3d.Plane,void 0!==n?n:new zen3d.Plane,void 0!==r?r:new zen3d.Plane,void 0!==a?a:new zen3d.Plane]};t.prototype.set=function(t,e,i,n,r,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(r),o[5].copy(a),this},t.prototype.setFromMatrix=function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],o=i[3],s=i[4],h=i[5],u=i[6],c=i[7],d=i[8],l=i[9],p=i[10],f=i[11],_=i[12],v=i[13],m=i[14],g=i[15];return e[0].setComponents(o-n,c-s,f-d,g-_).normalize(),e[1].setComponents(o+n,c+s,f+d,g+_).normalize(),e[2].setComponents(o+r,c+h,f+l,g+v).normalize(),e[3].setComponents(o-r,c-h,f-l,g-v).normalize(),e[4].setComponents(o-a,c-u,f-p,g-m).normalize(),e[5].setComponents(o+a,c+u,f+p,g+m).normalize(),this},t.prototype.intersectsSphere=function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++){var a=e[r].distanceToPoint(i);if(a<n)return!1}return!0},t.prototype.intersectsBox=function(){var t=new zen3d.Vector3,e=new zen3d.Vector3;return function(i){for(var n=this.planes,r=0;r<6;r++){var a=n[r];t.x=a.normal.x>0?i.min.x:i.max.x,e.x=a.normal.x>0?i.max.x:i.min.x,t.y=a.normal.y>0?i.min.y:i.max.y,e.y=a.normal.y>0?i.max.y:i.min.y,t.z=a.normal.z>0?i.min.z:i.max.z,e.z=a.normal.z>0?i.max.z:i.min.z;var o=a.distanceToPoint(t),s=a.distanceToPoint(e);if(o<0&&s<0)return!1}return!0}}(),zen3d.Frustum=t}(),function(){var t=function(t,e,i){return this.r=0,this.g=0,this.b=0,void 0===e&&void 0===i?this.setHex(t):this.setRGB(t,e,i)};t.prototype.setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},t.prototype.setRGB=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},t.prototype.setHSL=function(){function t(t,e){return(t%e+e)%e}function e(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(i,n,r){if(i=t(i,1),n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r)),0===n)this.r=this.g=this.b=r;else{var a=r<=.5?r*(1+n):r+n-r*n,o=2*r-a;this.r=e(o,a,i+1/3),this.g=e(o,a,i),this.b=e(o,a,i-1/3)}return this}}(),zen3d.Color3=t}(),function(){var t=function(t,e){this.origin=void 0!==t?t:new zen3d.Vector3,this.direction=void 0!==e?e:new zen3d.Vector3};t.prototype.set=function(t,e){this.origin.copy(t),this.direction.copy(e)},t.prototype.at=function(t,e){var i=e||new zen3d.Vector3;return i.copy(this.direction).multiplyScalar(t).add(this.origin)},t.prototype.intersectsSphere=function(){var t=new zen3d.Vector3;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,a=e.radius*e.radius;if(r>a)return null;var o=Math.sqrt(a-r),s=n-o,h=n+o;return s<0&&h<0?null:s<0?this.at(h,i):this.at(s,i)}}(),t.prototype.intersectsBox=function(t,e){var i,n,r,a,o,s,h=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return h>=0?(i=(t.min.x-d.x)*h,n=(t.max.x-d.x)*h):(i=(t.max.x-d.x)*h,n=(t.min.x-d.x)*h),u>=0?(r=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(r=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),i>a||r>n?null:((r>i||i!==i)&&(i=r),(a<n||n!==n)&&(n=a),c>=0?(o=(t.min.z-d.z)*c,s=(t.max.z-d.z)*c):(o=(t.max.z-d.z)*c,s=(t.min.z-d.z)*c),i>s||o>n?null:((o>i||i!==i)&&(i=o),(s<n||n!==n)&&(n=s),n<0?null:this.at(i>=0?i:n,e)))},t.prototype.intersectTriangle=function(){var t=new zen3d.Vector3,e=new zen3d.Vector3,i=new zen3d.Vector3,n=new zen3d.Vector3;return function(r,a,o,s,h){e.subVectors(a,r),i.subVectors(o,r),n.crossVectors(e,i);var u,c=this.direction.dot(n);if(c>0){if(s)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}t.subVectors(this.origin,r);var d=u*this.direction.dot(i.crossVectors(t,i));if(d<0)return null;var l=u*this.direction.dot(e.cross(t));if(l<0)return null;if(d+l>c)return null;var p=-u*t.dot(n);return p<0?null:this.at(p/c,h)}}(),t.prototype.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},t.prototype.applyMatrix4=function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},zen3d.Ray=t}(),function(){function t(t,e,i){this.a=void 0!==t?t:new zen3d.Vector3,this.b=void 0!==e?e:new zen3d.Vector3,this.c=void 0!==i?i:new zen3d.Vector3}t.prototype.set=function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this},t.normal=function(){var t=new zen3d.Vector3;return function(e,i,n,r){var a=r||new zen3d.Vector3;a.subVectors(n,i),t.subVectors(e,i),a.cross(t);var o=a.getLengthSquared();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}}(),t.barycoordFromPoint=function(){var t=new zen3d.Vector3,e=new zen3d.Vector3,i=new zen3d.Vector3;return function(n,r,a,o,s){t.subVectors(o,r),e.subVectors(a,r),i.subVectors(n,r);var h=t.dot(t),u=t.dot(e),c=t.dot(i),d=e.dot(e),l=e.dot(i),p=h*d-u*u,f=s||new zen3d.Vector3;if(0===p)return f.set(-2,-1,-1);var _=1/p,v=(d*c-u*l)*_,m=(h*l-u*c)*_;return f.set(1-v-m,m,v)}}(),t.containsPoint=function(){var e=new zen3d.Vector3;return function(i,n,r,a){var o=t.barycoordFromPoint(i,n,r,a,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),zen3d.Triangle=t}(),function(){var t=function(){this.eventMap={}};t.prototype.addEventListener=function(t,e,i){var n=this.eventMap[t];n||(n=this.eventMap[t]=[]),n.push({listener:e,thisObject:i||this})},t.prototype.removeEventListener=function(t,e,i){var n=this.eventMap[t];if(n)for(var r=0,a=n.length;r<a;r++){var o=n[r];if(o.listener==e&&o.thisObject==(i||this)){n.splice(r,1);break}}},t.prototype.dispatchEvent=function(t){t.target=this,this.notifyListener(t)},t.prototype.notifyListener=function(t){var e=this.eventMap[t.type];if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];r.listener.call(r.thisObject,t)}},zen3d.EventDispatcher=t}(),function(){function t(t,e){return t.distance-e.distance}function e(t,i,n,r){if(t.raycast(i,n),r===!0)for(var a=t.children,o=0,s=a.length;o<s;o++)e(a[o],i,n,!0)}var i=function(t,e,i,n){this.ray=new zen3d.Ray(t,e),this.near=i||0,this.far=n||1/0};i.prototype.set=function(t,e){this.ray.set(t,e)},i.prototype.setFromCamera=function(t,e){this.ray.origin.setFromMatrixPosition(e.worldMatrix),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()},i.prototype.intersectObject=function(i,n){var r=[];return e(i,this,r,n),r.sort(t),r},i.prototype.intersectObjects=function(i,n){var r=[];if(Array.isArray(i)===!1)return console.warn("Raycaster.intersectObjects: objects is not an Array."),r;for(var a=0,o=i.length;a<o;a++)e(i[a],this,r,n);return r.sort(t),r},zen3d.Raycaster=i}(),function(){function t(t,e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var e=function(e){this.precision="highp",this.maxPrecision=t(e,this.precision),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE)};zen3d.WebGLCapabilities=e}(),function(){function t(t,e,i,n){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var o=0;o<n;o++)t.texImage2D(i+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return a}var e=zen3d.BLEND_TYPE,i=zen3d.CULL_FACE_TYPE,n=function(e,i){this.gl=e,this.capabilities=i,this.states={},this.currentBlending=null,this.currentPremultipliedAlpha=null,this.currentCullFace=null,this.currentViewport=new zen3d.Vector4,this.currentClearColor=new zen3d.Vector4,this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBuffers={},this.emptyTextures={},this.emptyTextures[e.TEXTURE_2D]=t(e,e.TEXTURE_2D,e.TEXTURE_2D,1),this.emptyTextures[e.TEXTURE_CUBE_MAP]=t(e,e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.currentFlipSided=!1};n.prototype.setBlend=function(t,i){var n=this.gl;t!==e.NONE?this.enable(n.BLEND):this.disable(n.BLEND),t===this.currentBlending&&i===this.currentPremultipliedAlpha||(t===e.NORMAL&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA))),t===e.ADD&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE,n.ONE,n.ONE)):(n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE))),this.currentBlending=t,this.currentPremultipliedAlpha=i)},n.prototype.setFlipSided=function(t){var e=this.gl;this.currentFlipSided!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t)},n.prototype.setCullFace=function(t){var e=this.gl;t!==i.NONE?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===i.BACK?e.cullFace(e.BACK):t===i.FRONT?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),
this.currentCullFace=t},n.prototype.viewport=function(t,e,i,n){var r=this.currentViewport;if(r.x!==t||r.y!==e||r.z!==i||r.w!==n){var a=this.gl;a.viewport(t,e,i,n),r.set(t,e,i,n)}},n.prototype.clearColor=function(t,e,i,n){var r=this.currentClearColor;if(r.x!==t||r.y!==e||r.z!==i||r.w!==n){var a=this.gl;a.clearColor(t,e,i,n),r.set(t,e,i,n)}},n.prototype.activeTexture=function(t){var e=this.gl;void 0===t&&(t=e.TEXTURE0+this.capabilities.maxTextures-1),this.currentTextureSlot!==t&&(e.activeTexture(t),this.currentTextureSlot=t)},n.prototype.bindTexture=function(t,e){var i=this.gl;null===this.currentTextureSlot&&this.activeTexture();var n=this.currentBoundTextures[this.currentTextureSlot];void 0===n&&(n={type:void 0,texture:void 0},this.currentBoundTextures[this.currentTextureSlot]=n),n.type===t&&n.texture===e||(i.bindTexture(t,e||this.emptyTextures[t]),n.type=t,n.texture=e)},n.prototype.bindBuffer=function(t,e){var i=this.gl,n=this.currentBoundBuffers[t];n!==e&&(i.bindBuffer(t,e),this.currentBoundBuffers[t]=e)},n.prototype.enable=function(t){this.states[t]!==!0&&(this.gl.enable(t),this.states[t]=!0)},n.prototype.disable=function(t){this.states[t]!==!1&&(this.gl.disable(t),this.states[t]=!1)},zen3d.WebGLState=n}(),function(){var t=function(){this.properties={}};t.prototype.get=function(t){var e=t.uuid,i=this.properties[e];return void 0===i&&(i={},this.properties[e]=i),i},t.prototype.delete=function(t){delete this.properties[t.uuid]},t.prototype.clear=function(){this.properties={}},zen3d.WebGLProperties=t}(),function(){function t(t){return t.wrapS!==o.CLAMP_TO_EDGE||t.wrapT!==o.CLAMP_TO_EDGE||t.minFilter!==a.NEAREST&&t.minFilter!==a.LINEAR}function e(t){return t===a.NEAREST||t===a.NEAREST_MIPMAP_LINEAR||t===a.NEAREST_MIPMAP_NEAREST?a.NEAREST:a.LINEAR}function i(t){return h(t.width)&&h(t.height)}function n(t){if(s&&(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");e.width=u(t.width),e.height=u(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,e.width,e.height),console.warn("image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}function r(t,e){if(t.width>e||t.height>e){if(!s)return console.warn("image is too big ("+t.width+"x"+t.height+"). max size is "+e+"x"+e,t),t;var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i);var r=n.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}var a=zen3d.WEBGL_TEXTURE_FILTER,o=zen3d.WEBGL_TEXTURE_WRAP,s=zen3d.isWeb,h=zen3d.isPowerOfTwo,u=zen3d.nearestPowerOfTwo,c=function(t,e,i,n){this.gl=t,this.state=e,this.properties=i,this.capabilities=n};c.prototype.setTexture2D=function(e,a){var o=this.gl,s=this.state,h=this.properties.get(e);if(e.version>0&&h.__version!==e.version){void 0===h.__webglTexture&&(e.addEventListener("dispose",this.onTextureDispose,this),h.__webglTexture=o.createTexture()),s.activeTexture(o.TEXTURE0+a),s.bindTexture(o.TEXTURE_2D,h.__webglTexture);var u=r(e.image,this.capabilities.maxTextureSize);t(e)&&i(u)===!1&&(u=n(u));var c=i(u);this.setTextureParameters(e,c);var d,l=e.mipmaps,p=e.pixelFormat,f=e.pixelType;if(l.length>0&&c){for(var _=0,v=l.length;_<v;_++)d=l[_],o.texImage2D(o.TEXTURE_2D,_,p,p,f,d);e.generateMipmaps=!1}else o.texImage2D(o.TEXTURE_2D,0,p,p,f,u);return e.generateMipmaps&&c&&o.generateMipmap(o.TEXTURE_2D),void(h.__version=e.version)}s.activeTexture(o.TEXTURE0+a),s.bindTexture(o.TEXTURE_2D,h.__webglTexture)},c.prototype.setTextureCube=function(t,e){var n=this.gl,a=this.state,o=this.properties.get(t);if(t.version>0&&o.__version!==t.version){void 0===o.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),o.__webglTexture=n.createTexture()),a.activeTexture(n.TEXTURE0+e),a.bindTexture(n.TEXTURE_CUBE_MAP,o.__webglTexture);for(var s=[],h=0;h<6;h++)s[h]=r(t.images[h],this.capabilities.maxCubemapSize);var u=s[0],c=i(u);this.setTextureParameters(t,c);for(var d=t.pixelFormat,l=t.pixelType,h=0;h<6;h++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,d,d,l,s[h]);return t.generateMipmaps&&c&&n.generateMipmap(n.TEXTURE_CUBE_MAP),void(o.__version=t.version)}a.activeTexture(n.TEXTURE0+e),a.bindTexture(n.TEXTURE_CUBE_MAP,o.__webglTexture)},c.prototype.setTextureParameters=function(t,i){var n=this.gl,r=t.textureType;i?(n.texParameteri(r,n.TEXTURE_WRAP_S,t.wrapS),n.texParameteri(r,n.TEXTURE_WRAP_T,t.wrapT),n.texParameteri(r,n.TEXTURE_MAG_FILTER,t.magFilter),n.texParameteri(r,n.TEXTURE_MIN_FILTER,t.minFilter)):(n.texParameteri(r,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(r,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),t.wrapS===n.CLAMP_TO_EDGE&&t.wrapT===n.CLAMP_TO_EDGE||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to zen3d.TEXTURE_WRAP.CLAMP_TO_EDGE.",t),n.texParameteri(r,n.TEXTURE_MAG_FILTER,e(t.magFilter)),n.texParameteri(r,n.TEXTURE_MIN_FILTER,e(t.minFilter)),(t.minFilter!==n.NEAREST&&t.minFilter!==n.LINEAR||t.magFilter!==n.NEAREST&&t.magFilter!==n.LINEAR)&&console.warn("Texture is not power of two. Texture.minFilter and Texture.magFilter should be set to zen3d.TEXTURE_FILTER.NEAREST or zen3d.TEXTURE_FILTER.LINEAR.",t))},c.prototype.setRenderTarget2D=function(t){var e=this.gl,n=this.state,r=this.properties.get(t),a=this.properties.get(t.texture);if(void 0!==a.__webglTexture&&void 0!==r.__webglFramebuffer)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer);else{t.addEventListener("dispose",this.onRenderTargetDispose,this),a.__webglTexture=e.createTexture(),r.__webglFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),n.bindTexture(e.TEXTURE_2D,a.__webglTexture);var o=i(t);this.setTextureParameters(t.texture,o);var s=t.texture.pixelFormat,h=t.texture.pixelType;if(e.texImage2D(e.TEXTURE_2D,0,s,t.width,t.height,0,s,h,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.__webglTexture,0),t.texture.generateMipmaps&&o&&e.generateMipmap(e.TEXTURE_2D),n.bindTexture(e.TEXTURE_2D,null),t.depthBuffer){r.__webglDepthbuffer=e.createRenderbuffer();var u=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,u),t.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,u)):(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,u)),e.bindRenderbuffer(e.RENDERBUFFER,null)}}},c.prototype.setRenderTargetCube=function(t){var e=this.gl,n=this.state,r=this.properties.get(t),a=this.properties.get(t.texture);if(void 0!==a.__webglTexture&&void 0!==r.__webglFramebuffer)e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,a.__webglTexture,0);else{t.addEventListener("dispose",this.onRenderTargetDispose,this),a.__webglTexture=e.createTexture(),r.__webglFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,r.__webglFramebuffer),n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture);var o=i(t);this.setTextureParameters(t.texture,o);for(var s=t.texture.pixelFormat,h=t.texture.pixelType,u=0;u<6;u++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,s,t.width,t.height,0,s,h,null);if(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,a.__webglTexture,0),t.texture.generateMipmaps&&o&&e.generateMipmap(e.TEXTURE_CUBE_MAP),n.bindTexture(e.TEXTURE_CUBE_MAP,null),t.depthBuffer){r.__webglDepthbuffer=e.createRenderbuffer();var c=r.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,c),t.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,c)):(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,c)),e.bindRenderbuffer(e.RENDERBUFFER,null)}}},c.prototype.updateRenderTargetMipmap=function(t){var e=this.gl,n=this.state,r=t.texture;if(r.generateMipmaps&&i(t)&&r.minFilter!==e.NEAREST&&r.minFilter!==e.LINEAR){var a=r.textureType,o=this.properties.get(r).__webglTexture;n.bindTexture(a,o),e.generateMipmap(a),n.bindTexture(a,null)}},c.prototype.onTextureDispose=function(t){var e=this.gl,i=t.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onTextureDispose,this),n.__webglTexture&&e.deleteTexture(n.__webglTexture),this.properties.delete(i)},c.prototype.onRenderTargetDispose=function(t){var e=this.gl,i=t.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onRenderTargetDispose,this),n.__webglTexture&&e.deleteTexture(textureProperties.__webglTexture),n.__webglFramebuffer&&e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),this.properties.delete(i)},zen3d.WebGLTexture=c}(),function(){var t=function(t,e,i,n){this.gl=t,this.state=e,this.properties=i,this.capabilities=n};t.prototype.setGeometry=function(t){var e=this.gl,i=this.state,n=this.properties.get(t);if(t.dirty){void 0===n.__webglVAO&&(t.addEventListener("dispose",this.onGeometryDispose,this),n.__webglVAO=e.createBuffer()),i.bindBuffer(e.ARRAY_BUFFER,n.__webglVAO);var r=new Float32Array(t.verticesArray);if(e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),t.indicesArray.length>0){void 0===n.__webglEAO&&(n.__webglEAO=e.createBuffer()),i.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.__webglEAO);var a=new Uint16Array(t.indicesArray);e.bufferData(e.ELEMENT_ARRAY_BUFFER,a,e.STATIC_DRAW)}return void(t.dirty=!1)}i.bindBuffer(e.ARRAY_BUFFER,n.__webglVAO),t.indicesArray.length>0&&i.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.__webglEAO)},t.prototype.onGeometryDispose=function(t){var e=this.gl,i=t.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onGeometryDispose,this),n.__webglVAO&&e.deleteBuffer(n.__webglVAO),n.__webglEAO&&e.deleteBuffer(n.__webglEAO),this.properties.delete(i)},zen3d.WebGLGeometry=t}(),function(){var t=zen3d.WEBGL_UNIFORM_TYPE,e=function(t,e,i){this.gl=t,this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getUniformLocation(e,this.name),this.value=void 0,this._setDefaultValue(),this.setValue=void 0,this._generateSetValue(),this.upload=void 0,this._generateUpload()};e.prototype._setDefaultValue=function(){var e=this.type;switch(e){case t.FLOAT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.value=0;break;case t.FLOAT_VEC2:case t.BOOL_VEC2:case t.INT_VEC2:this.value=[0,0];break;case t.FLOAT_VEC3:case t.BOOL_VEC3:case t.INT_VEC3:this.value=[0,0,0];break;case t.FLOAT_VEC4:case t.BOOL_VEC4:case t.INT_VEC4:this.value=[0,0,0,0];break;case t.FLOAT_MAT2:this.value=new Float32Array([1,0,0,1]);break;case t.FLOAT_MAT3:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case t.FLOAT_MAT4:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},e.prototype._generateSetValue=function(){var e=this.type;switch(e){case t.FLOAT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.setValue=function(t){this.value=t,this.upload()};break;case t.FLOAT_VEC2:case t.BOOL_VEC2:case t.INT_VEC2:this.setValue=function(t,e){this.value[0]=t,this.value[1]=e,this.upload()};break;case t.FLOAT_VEC3:case t.BOOL_VEC3:case t.INT_VEC3:this.setValue=function(t,e,i){this.value[0]=t,this.value[1]=e,this.value[2]=i,this.upload()};break;case t.FLOAT_VEC4:case t.BOOL_VEC4:case t.INT_VEC4:this.setValue=function(t,e,i,n){this.value[0]=t,this.value[1]=e,this.value[2]=i,this.value[3]=n,this.upload()};break;case t.FLOAT_MAT2:case t.FLOAT_MAT3:case t.FLOAT_MAT4:this.setValue=function(t){this.value.set(t),this.upload()}}},e.prototype._generateUpload=function(){var e=this.gl,i=this.type,n=this.location;switch(i){case t.FLOAT:this.upload=function(){var t=this.value;e.uniform1f(n,t)};break;case t.FLOAT_VEC2:this.upload=function(){var t=this.value;e.uniform2f(n,t[0],t[1])};break;case t.FLOAT_VEC3:this.upload=function(){var t=this.value;e.uniform3f(n,t[0],t[1],t[2])};break;case t.FLOAT_VEC4:this.upload=function(){var t=this.value;e.uniform4f(n,t[0],t[1],t[2],t[3])};break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:case t.BOOL:case t.INT:this.upload=function(){var t=this.value;e.uniform1i(n,t)};break;case t.BOOL_VEC2:case t.INT_VEC2:this.upload=function(){var t=this.value;e.uniform2i(n,t[0],t[1])};break;case t.BOOL_VEC3:case t.INT_VEC3:this.upload=function(){var t=this.value;e.uniform3i(n,t[0],t[1],t[2])};break;case t.BOOL_VEC4:case t.INT_VEC4:this.upload=function(){var t=this.value;e.uniform4i(n,t[0],t[1],t[2],t[3])};break;case t.FLOAT_MAT2:this.upload=function(){var t=this.value;e.uniformMatrix2fv(n,!1,t)};break;case t.FLOAT_MAT3:this.upload=function(){var t=this.value;e.uniformMatrix3fv(n,!1,t)};break;case t.FLOAT_MAT4:this.upload=function(){var t=this.value;e.uniformMatrix4fv(n,!1,t)}}},zen3d.WebGLUniform=e}(),function(){var t=zen3d.WEBGL_ATTRIBUTE_TYPE,e=function(t,e,i){this.gl=t,this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getAttribLocation(e,this.name),this.count=0,this.initCount(t),this.format=t.FLOAT,this.initFormat(t)};e.prototype.initCount=function(e){var i=this.type;switch(i){case t.FLOAT:case t.BYTE:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:this.count=1;break;case t.FLOAT_VEC2:this.count=2;break;case t.FLOAT_VEC3:this.count=3;break;case t.FLOAT_VEC4:this.count=4}},e.prototype.initFormat=function(e){var i=this.type;switch(i){case t.FLOAT:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:this.format=e.FLOAT;break;case t.UNSIGNED_BYTE:this.format=e.UNSIGNED_BYTE;break;case t.UNSIGNED_SHORT:this.format=e.UNSIGNED_SHORT;break;case t.BYTE:this.format=e.BYTE}},zen3d.WebGLAttribute=e}(),function(){zen3d.ShaderChunk={RE_BlinnPhong:"void RE_BlinnPhong(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {\n    vec3 H = normalize(L + V);\n    reflectLight += k * light * pow(max(dot(N, H), 0.), n_s);\n}",RE_Lambert:"void RE_Lambert(vec4 k, vec4 light, vec3 N, vec3 L, inout vec4 reflectLight) {\n    float dotNL = max(dot(N, L), 0.);\n    reflectLight += k * light * dotNL;\n}",RE_Phong:"void RE_Phong(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {\n    vec3 R = max(dot(2.0 * N, L), 0.) * N - L;\n    reflectLight += k * light * pow(max(dot(V, R), 0.), n_s);\n}",ambientlight_pars_frag:"struct AmbientLight\n{\n    vec4 color;\n    float intensity;\n};\nuniform AmbientLight u_Ambient[USE_AMBIENT_LIGHT];",begin_frag:"vec4 outColor = vec4(u_Color, u_Opacity);",common_frag:"uniform mat4 u_View;\nuniform float u_Opacity;\nuniform vec3 u_Color;\nuniform vec3 u_CameraPosition;",common_vert:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\n#include <transpose>\n#include <inverse>\nuniform mat4 u_Projection;\nuniform mat4 u_View;\nuniform mat4 u_Model;\nuniform vec3 u_CameraPosition;",diffuseMap_frag:"#ifdef USE_DIFFUSE_MAP\n    outColor *= texture2D(texture, v_Uv);\n#endif",diffuseMap_pars_frag:"#ifdef USE_DIFFUSE_MAP\n    uniform sampler2D texture;\n#endif",directlight_pars_frag:"struct DirectLight\n{\n    vec3 direction;\n    vec4 color;\n    float intensity;\n    int shadow;\n};\nuniform DirectLight u_Directional[USE_DIRECT_LIGHT];",end_frag:"gl_FragColor = outColor;",envMap_frag:"#ifdef USE_ENV_MAP\n    vec4 envColor = textureCube(envMap, v_EnvPos);\n    outColor += envColor * u_EnvMap_Intensity;\n#endif",envMap_pars_frag:"#ifdef USE_ENV_MAP\n    varying vec3 v_EnvPos;\n    uniform samplerCube envMap;\n    uniform float u_EnvMap_Intensity;\n#endif",envMap_pars_vert:"#ifdef USE_ENV_MAP\n    varying vec3 v_EnvPos;\n#endif",envMap_vert:"#ifdef USE_ENV_MAP\n    v_EnvPos = reflect(normalize((u_Model * vec4(a_Position, 1.0)).xyz - u_CameraPosition), (transpose(inverse(u_Model)) * vec4(a_Normal, 1.0)).xyz);\n#endif",fog_frag:"#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    #ifdef USE_EXP2_FOG\n        float fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );\n    #else\n        float fogFactor = smoothstep( u_FogNear, u_FogFar, depth );\n    #endif\n    gl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );\n#endif",fog_pars_frag:"#ifdef USE_FOG\n    uniform vec3 u_FogColor;\n    #ifdef USE_EXP2_FOG\n        uniform float u_FogDensity;\n    #else\n        uniform float u_FogNear;\n        uniform float u_FogFar;\n    #endif\n#endif",inverse:"mat4 inverse(mat4 m) {\n    float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}",light_frag:"#ifdef USE_LIGHT\n    vec4 light;\n    vec3 L;\n    vec4 reflectLight = vec4(0., 0., 0., 0.);\n    vec4 diffuseColor = outColor.xyzw;\n    #ifdef USE_AMBIENT_LIGHT\n    for(int i = 0; i < USE_AMBIENT_LIGHT; i++) {\n        reflectLight += diffuseColor * u_Ambient[i].color * u_Ambient[i].intensity;\n    }\n    #endif\n    #if defined(USE_PHONG) && ( defined(USE_DIRECT_LIGHT) || defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) )\n        vec3 V = normalize( (u_View * vec4(u_CameraPosition, 1.)).xyz - v_ViewModelPos);\n    #endif\n    #ifdef USE_DIRECT_LIGHT\n    for(int i = 0; i < USE_DIRECT_LIGHT; i++) {\n        L = -u_Directional[i].direction;\n        light = u_Directional[i].color * u_Directional[i].intensity;\n        L = normalize(L);\n        RE_Lambert(diffuseColor, light, N, L, reflectLight);\n        #ifdef USE_PHONG\n        RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);\n        #endif\n    }\n    #endif\n    #ifdef USE_POINT_LIGHT\n    for(int i = 0; i < USE_POINT_LIGHT; i++) {\n        L = u_Point[i].position - v_ViewModelPos;\n        float dist = pow(clamp(1. - length(L) / u_Point[i].distance, 0.0, 1.0), u_Point[i].decay);\n        light = u_Point[i].color * u_Point[i].intensity * dist;\n        L = normalize(L);\n        RE_Lambert(diffuseColor, light, N, L, reflectLight);\n        #ifdef USE_PHONG\n        RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);\n        #endif\n    }\n    #endif\n    #ifdef USE_SPOT_LIGHT\n    for(int i = 0; i < USE_SPOT_LIGHT; i++) {\n        L = u_Spot[i].position - v_ViewModelPos;\n        float lightDistance = length(L);\n        L = normalize(L);\n        float angleCos = dot( L, -normalize(u_Spot[i].direction) );\n        if( all( bvec2(angleCos > u_Spot[i].coneCos, lightDistance < u_Spot[i].distance) ) ) {\n            float spotEffect = smoothstep( u_Spot[i].coneCos, u_Spot[i].penumbraCos, angleCos );\n            float dist = pow(clamp(1. - lightDistance / u_Spot[i].distance, 0.0, 1.0), u_Spot[i].decay);\n            light = u_Spot[i].color * u_Spot[i].intensity * dist * spotEffect;\n            RE_Lambert(diffuseColor, light, N, L, reflectLight);\n            #ifdef USE_PHONG\n            RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);\n            #endif\n        }\n    }\n    #endif\n    outColor = reflectLight.xyzw;\n#endif",light_pars_frag:"#ifdef USE_AMBIENT_LIGHT\n    #include <ambientlight_pars_frag>\n#endif\n#ifdef USE_DIRECT_LIGHT\n    #include <directlight_pars_frag>\n#endif\n#ifdef USE_POINT_LIGHT\n    #include <pointlight_pars_frag>\n#endif\n#ifdef USE_SPOT_LIGHT\n    #include <spotlight_pars_frag>\n#endif",normalMap_pars_frag:"#include <tbn>\n#include <tsn>\nuniform sampler2D normalMap;",normal_frag:"#ifdef USE_NORMAL\n    vec3 N;\n    #ifdef USE_NORMAL_MAP\n        vec3 normalMapColor = texture2D(normalMap, v_Uv).rgb;\n        mat3 tspace = tsn(normalize(v_Normal), -v_ViewModelPos, vec2(v_Uv.x, 1.0 - v_Uv.y));\n        N = normalize(tspace * (normalMapColor * 2.0 - 1.0));\n    #else\n        N = normalize(v_Normal);\n    #endif\n#endif",normal_pars_frag:"#ifdef USE_NORMAL\n    varying vec3 v_Normal;\n#endif",normal_pars_vert:"#ifdef USE_NORMAL\n    varying vec3 v_Normal;\n#endif",normal_vert:"#ifdef USE_NORMAL\n    v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(a_Normal, 1.0)).xyz;\n#endif",packing:"const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8;    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}",pointlight_pars_frag:"struct PointLight\n{\n    vec3 position;\n    vec4 color;\n    float intensity;\n    float distance;\n    float decay;\n    int shadow;\n};\nuniform PointLight u_Point[USE_POINT_LIGHT];",premultipliedAlpha_frag:"#ifdef USE_PREMULTIPLIED_ALPHA\n    gl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;\n#endif",pvm_vert:"gl_Position = u_Projection * u_View * u_Model * vec4(a_Position, 1.0);",shadowMap_frag:"#ifdef USE_SHADOW\n    outColor *= getShadowMask();\n#endif",shadowMap_pars_frag:"#ifdef USE_SHADOW\n    #include <packing>\n    #ifdef USE_DIRECT_LIGHT\n        uniform sampler2D directionalShadowMap[ USE_DIRECT_LIGHT ];\n        varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];\n    #endif\n    #ifdef USE_POINT_LIGHT\n        uniform samplerCube pointShadowMap[ USE_POINT_LIGHT ];\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        uniform sampler2D spotShadowMap[ USE_SPOT_LIGHT ];\n        varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];\n    #endif\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n    }\n    float textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {\n        return step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );\n    }\n    float getShadow( sampler2D shadowMap, vec4 shadowCoord ) {\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += 0.0003;\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n        bool frustumTest = all( frustumTestVec );\n        if ( frustumTest ) {\n            return texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n        }\n        return 1.0;\n    }\n    float getPointShadow( samplerCube shadowMap, vec3 V ) {\n        return textureCubeCompare( shadowMap, normalize(V), length(V) / 1000.);\n    }\n    float getShadowMask() {\n        float shadow = 1.0;\n        #ifdef USE_DIRECT_LIGHT\n            for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {\n                shadow *= bool( u_Directional[i].shadow ) ? getShadow( directionalShadowMap[ i ], vDirectionalShadowCoord[ i ] ) : 1.0;\n            }\n        #endif\n        #ifdef USE_POINT_LIGHT\n            for ( int i = 0; i < USE_POINT_LIGHT; i ++ ) {\n                vec3 worldV = (vec4(v_ViewModelPos, 1.) * u_View - vec4(u_Point[i].position, 1.) * u_View).xyz;\n                shadow *= bool( u_Point[i].shadow ) ? getPointShadow( pointShadowMap[ i ], worldV ) : 1.0;\n            }\n        #endif\n        #ifdef USE_SPOT_LIGHT\n            for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {\n                shadow *= bool( u_Spot[i].shadow ) ? getShadow( spotShadowMap[ i ], vSpotShadowCoord[ i ] ) : 1.0;\n            }\n        #endif\n        return shadow;\n    }\n#endif",shadowMap_pars_vert:"#ifdef USE_SHADOW\n    #ifdef USE_DIRECT_LIGHT\n        uniform mat4 directionalShadowMatrix[ USE_DIRECT_LIGHT ];\n        varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];\n    #endif\n    #ifdef USE_POINT_LIGHT\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        uniform mat4 spotShadowMatrix[ USE_SPOT_LIGHT ];\n        varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];\n    #endif\n#endif",shadowMap_vert:"#ifdef USE_SHADOW\n    vec4 worldPosition = u_Model * vec4(a_Position, 1.0);\n    #ifdef USE_DIRECT_LIGHT\n        for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {\n            vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n    #ifdef USE_POINT_LIGHT\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {\n            vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n#endif",spotlight_pars_frag:"struct SpotLight\n{\n    vec3 position;\n    vec4 color;\n    float intensity;\n    float distance;\n    float decay;\n    float coneCos;\n    float penumbraCos;\n    vec3 direction;\n    int shadow;\n};\nuniform SpotLight u_Spot[USE_SPOT_LIGHT];",tbn:"mat3 tbn(vec3 N, vec3 p, vec2 uv) {\n    vec3 dp1 = dFdx(p.xyz);\n    vec3 dp2 = dFdy(p.xyz);\n    vec2 duv1 = dFdx(uv.st);\n    vec2 duv2 = dFdy(uv.st);\n    vec3 dp2perp = cross(dp2, N);\n    vec3 dp1perp = cross(N, dp1);\n    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n    float invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B)));\n    return mat3(T * invmax, B * invmax, N);\n}",transpose:"mat4 transpose(mat4 inMatrix) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}",tsn:"mat3 tsn(vec3 N, vec3 V, vec2 uv) {\n    vec3 q0 = dFdx( V.xyz );\n    vec3 q1 = dFdy( V.xyz );\n    vec2 st0 = dFdx( uv.st );\n    vec2 st1 = dFdy( uv.st );\n    vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n    mat3 tsn = mat3( S, T, N );\n    return tsn;\n}",uv_pars_frag:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)\n    varying vec2 v_Uv;\n#endif",uv_pars_vert:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)\n    attribute vec2 a_Uv;\n    varying vec2 v_Uv;\n#endif",uv_vert:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)\n    v_Uv = a_Uv;\n#endif",viewModelPos_pars_frag:"#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )\n    varying vec3 v_ViewModelPos;\n#endif",viewModelPos_pars_vert:"#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )\n    varying vec3 v_ViewModelPos;\n#endif",viewModelPos_vert:"#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )\n    v_ViewModelPos = (u_View * u_Model * vec4(a_Position, 1.0)).xyz;\n#endif"}}(),function(){zen3d.ShaderLib={basic_frag:"#include <common_frag>\n#include <uv_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <envMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <diffuseMap_frag>\n    #include <envMap_frag>\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",basic_vert:"#include <common_vert>\n#include <uv_pars_vert>\n#include <envMap_pars_vert>\nvoid main() {\n    #include <pvm_vert>\n    #include <uv_vert>\n    #include <envMap_vert>\n}",canvas2d_frag:"#include <common_frag>\nvarying vec2 v_Uv;\nuniform sampler2D spriteTexture;\nvoid main() {\n    #include <begin_frag>\n    outColor *= texture2D(spriteTexture, v_Uv);\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n}",canvas2d_vert:"#include <common_vert>\nattribute vec2 a_Uv;\nvarying vec2 v_Uv;\nvoid main() {\n    #include <pvm_vert>\n    v_Uv = a_Uv;\n}",cube_frag:"#include <common_frag>\nuniform samplerCube cubeMap;\nvarying vec3 v_ModelPos;\nvoid main() {\n    #include <begin_frag>\n    outColor *= textureCube(cubeMap, v_ModelPos);\n    #include <end_frag>\n}",cube_vert:"#include <common_vert>\nvarying vec3 v_ModelPos;\nvoid main() {\n    #include <pvm_vert>\n    v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;\n}",depth_frag:"#include <common_frag>\nuniform vec3 lightPos;\nvarying vec3 v_ModelPos;\n#include <packing>\nvoid main() {\n    gl_FragColor = packDepthToRGBA(length(v_ModelPos - lightPos) / 1000.);\n}",depth_vert:"#include <common_vert>\nvarying vec3 v_ModelPos;\nvoid main() {\n    #include <pvm_vert>\n    v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;\n}",lambert_frag:"#include <common_frag>\n#include <uv_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <RE_Lambert>\n#include <envMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <diffuseMap_frag>\n    #include <normal_frag>\n    #include <light_frag>\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",lambert_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\nvoid main() {\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",phong_frag:"#include <common_frag>\nuniform float u_Specular;\nuniform vec4 u_SpecularColor;\n#include <uv_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <RE_Lambert>\n#include <RE_Phong>\n#include <RE_BlinnPhong>\n#include <envMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <diffuseMap_frag>\n    #include <normal_frag>\n    #include <light_frag>\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",phong_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\nvoid main() {\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",
points_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #ifdef USE_DIFFUSE_MAP\n        outColor *= texture2D(texture, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));\n    #endif\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",points_vert:"#include <common_vert>\nuniform float u_PointSize;\nuniform float u_PointScale;\nvoid main() {\n    #include <pvm_vert>\n    vec4 mvPosition = u_View * u_Model * vec4(a_Position, 1.0);\n    #ifdef USE_SIZEATTENUATION\n        gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n    #else\n        gl_PointSize = u_PointSize;\n    #endif\n}",sprite_frag:"uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\n    vec4 texture = texture2D( map, vUV );\n    if ( texture.a < alphaTest ) discard;\n    gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n    if ( fogType > 0 ) {\n        float depth = gl_FragCoord.z / gl_FragCoord.w;\n        float fogFactor = 0.0;\n        if ( fogType == 1 ) {\n            fogFactor = smoothstep( fogNear, fogFar, depth );\n        } else {\n            const float LOG2 = 1.442695;\n            fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n            fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n        }\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}",sprite_vert:"uniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\n    vUV = uvOffset + uv * uvScale;\n    vec2 alignedPosition = position * scale;\n    vec2 rotatedPosition;\n    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n    vec4 finalPosition;\n    finalPosition = viewMatrix * modelMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n    finalPosition.xy += rotatedPosition;\n    finalPosition = projectionMatrix * finalPosition;\n    gl_Position = finalPosition;\n}"}}(),function(){function t(t,e,i){var n=t.createShader(e);t.shaderSource(n,i),t.compileShader(n);var r=t.getShaderParameter(n,t.COMPILE_STATUS);return r||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(n))),n}function e(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),n}function i(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;r++){var a=t.getActiveUniform(e,r),o=a.name,s=new zen3d.WebGLUniform(t,e,a);i[o]=s}return i}function n(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var a=t.getActiveAttrib(e,r),o=a.name,s=new zen3d.WebGLAttribute(t,e,a);i[o]=s}return i}function r(t){var e="";for(var i in t)e+=t[i]+"_";return e}function a(t,e){var i=e.materialType==h.BASIC,n=e.materialType==h.CUBE,r=zen3d.ShaderLib.basic_vert,a=zen3d.ShaderLib.basic_frag;switch(e.materialType){case h.BASIC:r=zen3d.ShaderLib.basic_vert,a=zen3d.ShaderLib.basic_frag;break;case h.LAMBERT:r=zen3d.ShaderLib.lambert_vert,a=zen3d.ShaderLib.lambert_frag;break;case h.PHONG:r=zen3d.ShaderLib.phong_vert,a=zen3d.ShaderLib.phong_frag;break;case h.CUBE:r=zen3d.ShaderLib.cube_vert,a=zen3d.ShaderLib.cube_frag;break;case h.POINT:r=zen3d.ShaderLib.points_vert,a=zen3d.ShaderLib.points_frag}r=u(r),a=u(a);var o,c;i?(o=[e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":""].join("\n"),c=[e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",e.fog?"#define USE_FOG":"",e.fogExp2?"#define USE_EXP2_FOG":""].join("\n")):n?(o=[""].join("\n"),c=[""].join("\n")):(o=[e.pointLightNum>0?"#define USE_POINT_LIGHT "+e.pointLightNum:"",e.spotLightNum>0?"#define USE_SPOT_LIGHT "+e.spotLightNum:"",e.directLightNum>0?"#define USE_DIRECT_LIGHT "+e.directLightNum:"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0?"#define USE_NORMAL":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useNormalMap?"#define USE_NORMAL_MAP":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.useShadow?"#define USE_SHADOW":"",e.materialType==h.LAMBERT?"#define USE_LAMBERT":"",e.materialType==h.PHONG?"#define USE_PHONG":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":""].join("\n"),c=[e.pointLightNum>0?"#define USE_POINT_LIGHT "+e.pointLightNum:"",e.spotLightNum>0?"#define USE_SPOT_LIGHT "+e.spotLightNum:"",e.directLightNum>0?"#define USE_DIRECT_LIGHT "+e.directLightNum:"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0?"#define USE_NORMAL":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useNormalMap?"#define USE_NORMAL_MAP":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.useShadow?"#define USE_SHADOW":"",e.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",e.fog?"#define USE_FOG":"",e.fogExp2?"#define USE_EXP2_FOG":"",e.materialType==h.LAMBERT?"#define USE_LAMBERT":"",e.materialType==h.PHONG?"#define USE_PHONG":""].join("\n"));var d=["precision "+e.precision+" float;","precision "+e.precision+" int;",o,r].join("\n"),l=["#extension GL_OES_standard_derivatives : enable","precision "+e.precision+" float;","precision "+e.precision+" int;",c,"#define LOG2 1.442695","#define saturate(a) clamp( a, 0.0, 1.0 )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )",a].join("\n");return new s(t,d,l)}var o={},s=function(r,a,o){this.vshaderSource=a,this.fshaderSource=o,this.vertexShader=t(r,r.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=t(r,r.FRAGMENT_SHADER,this.fshaderSource),this.id=e(r,this.vertexShader,this.fragmentShader),this.uniforms=i(r,this.id),this.attributes=n(r,this.id)},h=zen3d.MATERIAL_TYPE,u=function(t){function e(t,e){var i=zen3d.ShaderChunk[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return u(i)}var i=/#include +<([\w\d.]+)>/g;return t.replace(i,e)},c=function(t,e,i,n,s){var u=i.material;if(u.type===h.CANVAS2D)return l(t,e);var c,d=n[0],p=n[1],f=n[2],_=n[3],v=e.capabilities.maxPrecision,m={precision:v,useDiffuseMap:!!u.map,useNormalMap:!!u.normalMap,useEnvMap:!!u.envMap,useDiffuseColor:!u.map,ambientLightNum:d,directLightNum:p,pointLightNum:f,spotLightNum:_,materialType:u.type,useShadow:i.receiveShadow,premultipliedAlpha:u.premultipliedAlpha,fog:!!s,fogExp2:!!s&&s.fogType===zen3d.FOG_TYPE.EXP2,sizeAttenuation:u.sizeAttenuation},g=r(m),E=o;return E[g]?c=E[g]:(c=a(t,m),E[g]=c),c},d=function(t,e){var i,n=o,r="depth",a=e.capabilities.maxPrecision;if(n[r])i=n[r];else{var h=["precision "+a+" float;","precision "+a+" int;",u(zen3d.ShaderLib.depth_vert)].join("\n"),c=["#extension GL_OES_standard_derivatives : enable","precision "+a+" float;","precision "+a+" int;",u(zen3d.ShaderLib.depth_frag)].join("\n");i=new s(t,h,c),n[r]=i}return i},l=function(t,e){var i,n=o,r="canvas2d",a=e.capabilities.maxPrecision;if(n[r])i=n[r];else{var h=["precision "+a+" float;","precision "+a+" int;",u(zen3d.ShaderLib.canvas2d_vert)].join("\n"),c=["#extension GL_OES_standard_derivatives : enable","precision "+a+" float;","precision "+a+" int;",u(zen3d.ShaderLib.canvas2d_frag)].join("\n");i=new s(t,h,c),n[r]=i}return i},p=function(t,e){var i,n=o,r="sprite",a=e.capabilities.maxPrecision;if(n[r])i=n[r];else{var h=["precision "+a+" float;","precision "+a+" int;",u(zen3d.ShaderLib.sprite_vert)].join("\n"),c=["#extension GL_OES_standard_derivatives : enable","precision "+a+" float;","precision "+a+" int;",u(zen3d.ShaderLib.sprite_frag)].join("\n");i=new s(t,h,c),n[r]=i}return i};zen3d.getProgram=c,zen3d.getDepthProgram=d,zen3d.getSpriteProgram=p}(),function(){var t=zen3d.MATERIAL_TYPE,e=zen3d.CULL_FACE_TYPE,i=zen3d.BLEND_TYPE,n=zen3d.DRAW_SIDE,r=function(t){this.view=t;var i=this.gl=t.getContext("webgl",{antialias:!0,alpha:!1,stencil:!0});this.width=t.width,this.height=t.height,this.autoClear=!0;var n=new zen3d.WebGLProperties;this.properties=n;var r=new zen3d.WebGLCapabilities(i);this.capabilities=r;var a=new zen3d.WebGLState(i,r);a.enable(i.STENCIL_TEST),a.enable(i.DEPTH_TEST),a.setCullFace(e.BACK),a.setFlipSided(!1),a.viewport(0,0,this.width,this.height),a.clearColor(0,0,0,0),this.state=a,this.texture=new zen3d.WebGLTexture(i,a,n,r),this.geometry=new zen3d.WebGLGeometry(i,a,n,r),this.cache=new zen3d.RenderCache;zen3d.getExtension(i,"OES_standard_derivatives"),zen3d.getExtension(i,"GL_OES_standard_derivatives");this._usedTextureUnits=0,this._currentRenderTarget=null,this._currentViewport=new zen3d.Vector4(0,0,this.width,this.height)};r.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e,this.setViewport(0,0,t,e)},r.prototype.setViewport=function(t,e,i,n){this._currentViewport.set(t,e,i,n),this.state.viewport(t,e,i,n)},r.prototype.render=function(t,e,i,n){t.updateMatrix(),e.viewMatrix.getInverse(e.worldMatrix),this.cache.cacheScene(t,e),this.cache.sort(),this.renderShadow(),void 0===i&&(i=null),this.setRenderTarget(i),(this.autoClear||n)&&(this.state.clearColor(0,0,0,0),this.clear(!0,!0,!0)),this.renderList(this.cache.opaqueObjects),this.renderList(this.cache.transparentObjects),this.renderList(this.cache.canvas2dObjects),this.renderSprites(this.cache.sprites),this.cache.clear(),i&&this.texture.updateRenderTargetMipmap(i)},r.prototype.renderShadow=function(){for(var t=this.gl,r=this.cache.shadowLights,o=0;o<r.length;o++)for(var s=r[o],h=s.shadow,u=h.camera,c=h.renderTarget,d=s.lightType==zen3d.LIGHT_TYPE.POINT,l=d?6:1,p=this.cache.shadowObjects,f=0;f<l;f++){if(d?(h.update(s,f),c.activeCubeFace=f):h.update(s),this.setRenderTarget(c),this.state.clearColor(1,1,1,1),this.clear(!0,!0),0==p.length)return;for(var _=0,v=p.length;_<v;_++){var m=p[_],g=m.material;this.geometry.setGeometry(m.geometry);var E=zen3d.getDepthProgram(t,this);t.useProgram(E.id);var T=E.attributes.a_Position;t.vertexAttribPointer(T.location,T.count,T.format,!1,68,0),t.enableVertexAttribArray(T.location);var y=E.uniforms;for(var x in y){var M=y[x];switch(x){case"u_Projection":var z=u.projectionMatrix.elements;M.setValue(z);break;case"u_View":var w=u.viewMatrix.elements;M.setValue(w);break;case"u_Model":var b=m.worldMatrix.elements;M.setValue(b);break;case"lightPos":a.setFromMatrixPosition(s.worldMatrix),M.setValue(a.x,a.y,a.z)}}this.state.setBlend(i.NONE),this.state.enable(t.DEPTH_TEST),this.state.setCullFace(g.side===n.DOUBLE?e.NONE:e.BACK),this.state.setFlipSided(g.side===n.BACK),t.drawElements(t.TRIANGLES,m.geometry.getIndicesCount(),t.UNSIGNED_SHORT,0)}}};var a=new zen3d.Vector3;r.prototype.renderList=function(r){for(var o=this.cache.camera,s=this.cache.fog,h=this.gl,u=this.cache.ambientLights,c=this.cache.directLights,d=this.cache.pointLights,l=this.cache.spotLights,p=u.length,f=c.length,_=d.length,v=l.length,m=0,g=r.length;m<g;m++){var E=r[m],T=E.object,y=E.material,x=E.geometry;this.geometry.setGeometry(x);var M=zen3d.getProgram(h,this,T,[p,f,_,v],s);h.useProgram(M.id);var z=M.attributes;for(var w in z){var b=z[w];switch(w){case"a_Position":h.vertexAttribPointer(b.location,b.count,b.format,!1,4*x.vertexSize,0);break;case"a_Normal":h.vertexAttribPointer(b.location,b.count,b.format,!1,4*x.vertexSize,12);break;case"a_Uv":T.type===zen3d.OBJECT_TYPE.CANVAS2D?h.vertexAttribPointer(b.location,b.count,b.format,!1,4*x.vertexSize,12):h.vertexAttribPointer(b.location,b.count,b.format,!1,4*x.vertexSize,52);break;default:console.warn("attribute "+w+" not found!")}h.enableVertexAttribArray(b.location)}var A=M.uniforms;for(var w in A){var S=A[w];switch(w){case"u_Projection":if(T.type===zen3d.OBJECT_TYPE.CANVAS2D&&T.isScreenCanvas)var L=T.orthoCamera.projectionMatrix.elements;else var L=o.projectionMatrix.elements;S.setValue(L);break;case"u_View":if(T.type===zen3d.OBJECT_TYPE.CANVAS2D&&T.isScreenCanvas)var P=T.orthoCamera.viewMatrix.elements;else var P=o.viewMatrix.elements;S.setValue(P);break;case"u_Model":var C=T.worldMatrix.elements;S.setValue(C);break;case"u_Color":var R=y.color;S.setValue(R.r,R.g,R.b);break;case"u_Opacity":S.setValue(y.opacity);break;case"texture":var F=this.allocTexUnit();this.texture.setTexture2D(y.map,F),S.setValue(F);break;case"normalMap":var F=this.allocTexUnit();this.texture.setTexture2D(y.normalMap,F),S.setValue(F);break;case"envMap":var F=this.allocTexUnit();this.texture.setTextureCube(y.envMap,F),S.setValue(F);break;case"cubeMap":var F=this.allocTexUnit();this.texture.setTextureCube(y.cubeMap,F),S.setValue(F);break;case"u_EnvMap_Intensity":S.setValue(y.envMapIntensity);break;case"u_Specular":S.setValue(y.specular);break;case"u_SpecularColor":var R=y.specularColor;S.setValue(R.r,R.g,R.b,1);break;case"u_CameraPosition":a.setFromMatrixPosition(o.worldMatrix),S.setValue(a.x,a.y,a.z);break;case"u_FogColor":var R=s.color;S.setValue(R.r,R.g,R.b);break;case"u_FogDensity":S.setValue(s.density);break;case"u_FogNear":S.setValue(s.near);break;case"u_FogFar":S.setValue(s.far);break;case"u_PointSize":S.setValue(y.size);break;case"u_PointScale":var O=.5*this.height;S.setValue(O)}}var N=y.type===t.BASIC,U=y.type===t.CUBE,I=y.type===t.POINT,V=T.type===zen3d.OBJECT_TYPE.CANVAS2D;if(!(N||U||I||V)){for(var D=0;D<p;D++){var B=u[D],G=B.intensity,R=B.color,H=A["u_Ambient["+D+"].intensity"],k=A["u_Ambient["+D+"].color"];H.setValue(G),k.setValue(R.r,R.g,R.b,1)}for(var D=0;D<f;D++){var B=c[D],G=B.intensity;B.getWorldDirection(a),a.transformDirection(o.viewMatrix);var R=B.color,X=A["u_Directional["+D+"].direction"],j=A["u_Directional["+D+"].intensity"],Y=A["u_Directional["+D+"].color"];X.setValue(a.x,a.y,a.z),j.setValue(G),Y.setValue(R.r,R.g,R.b,1);var W=A["u_Directional["+D+"].shadow"];if(W.setValue(B.castShadow?1:0),B.castShadow&&T.receiveShadow){var q=A["directionalShadowMatrix["+D+"]"];q.setValue(B.shadow.matrix.elements);var Z=A["directionalShadowMap["+D+"]"],F=this.allocTexUnit();this.texture.setTexture2D(B.shadow.map,F),Z.setValue(F)}}for(var D=0;D<_;D++){var B=d[D];a.setFromMatrixPosition(B.worldMatrix).applyMatrix4(o.viewMatrix);var G=B.intensity,R=B.color,J=B.distance,K=B.decay,Q=A["u_Point["+D+"].position"];Q.setValue(a.x,a.y,a.z);var $=A["u_Point["+D+"].intensity"];$.setValue(G);var tt=A["u_Point["+D+"].color"];tt.setValue(R.r,R.g,R.b,1);var et=A["u_Point["+D+"].distance"];et.setValue(J);var it=A["u_Point["+D+"].decay"];it.setValue(K);var nt=A["u_Point["+D+"].shadow"];if(nt.setValue(B.castShadow?1:0),B.castShadow&&T.receiveShadow){var rt=A["pointShadowMap["+D+"]"],F=this.allocTexUnit();this.texture.setTextureCube(B.shadow.map,F),rt.setValue(F)}}for(var D=0;D<v;D++){var B=l[D];a.setFromMatrixPosition(B.worldMatrix).applyMatrix4(o.viewMatrix);var at=A["u_Spot["+D+"].position"];at.setValue(a.x,a.y,a.z);var G=B.intensity,R=B.color,J=B.distance,K=B.decay;B.getWorldDirection(a),a.transformDirection(o.viewMatrix);var ot=A["u_Spot["+D+"].direction"];ot.setValue(a.x,a.y,a.z);var st=A["u_Spot["+D+"].intensity"];st.setValue(G);var ht=A["u_Spot["+D+"].color"];ht.setValue(R.r,R.g,R.b,1);var ut=A["u_Spot["+D+"].distance"];ut.setValue(J);var ct=A["u_Spot["+D+"].decay"];ct.setValue(K);var dt=Math.cos(B.angle),lt=Math.cos(B.angle*(1-B.penumbra)),pt=A["u_Spot["+D+"].coneCos"];pt.setValue(dt);var ft=A["u_Spot["+D+"].penumbraCos"];ft.setValue(lt);var _t=A["u_Spot["+D+"].shadow"];if(_t.setValue(B.castShadow?1:0),B.castShadow&&T.receiveShadow){var vt=A["spotShadowMatrix["+D+"]"];vt.setValue(B.shadow.matrix.elements);var mt=A["spotShadowMap["+D+"]"],F=this.allocTexUnit();this.texture.setTexture2D(B.shadow.map,F),mt.setValue(F)}}}if(y.transparent?this.state.setBlend(y.blending,y.premultipliedAlpha):this.state.setBlend(i.NONE),y.depthTest?this.state.enable(h.DEPTH_TEST):this.state.disable(h.DEPTH_TEST),this.state.setCullFace(y.side===n.DOUBLE?e.NONE:e.BACK),this.state.setFlipSided(y.side===n.BACK),T.type===zen3d.OBJECT_TYPE.POINT)h.drawArrays(h.POINTS,0,x.getVerticesCount());else if(T.type===zen3d.OBJECT_TYPE.CANVAS2D)for(var gt=0,Et=0;Et<T.drawArray.length;Et++){var Tt=T.drawArray[Et],F=this.allocTexUnit();this.texture.setTexture2D(Tt.texture,F),A.spriteTexture.setValue(F),h.drawElements(h.TRIANGLES,6*Tt.count,h.UNSIGNED_SHORT,2*gt),gt+=6*Tt.count,this._usedTextureUnits=0}else h.drawElements(h.TRIANGLES,x.getIndicesCount(),h.UNSIGNED_SHORT,0);this._usedTextureUnits=0}};var o=new zen3d.Vector3,s=new zen3d.Quaternion,h=new zen3d.Vector3;r.prototype.renderSprites=function(t){if(0!==this.cache.sprites.length){var r=this.cache.camera,a=this.cache.fog,u=this.gl;this.geometry.setGeometry(zen3d.Sprite.geometry);var c=zen3d.getSpriteProgram(u,this);u.useProgram(c.id);var d=c.attributes,l=d.position;u.vertexAttribPointer(l.location,l.count,l.format,!1,16,0),u.enableVertexAttribArray(l.location);var p=d.uv;u.vertexAttribPointer(p.location,p.count,p.format,!1,16,8),u.enableVertexAttribArray(p.location);var f=c.uniforms;f.projectionMatrix.setValue(r.projectionMatrix.elements);var _=0;a?(f.fogColor.setValue(a.color.r,a.color.g,a.color.b),a.fogType===zen3d.FOG_TYPE.NORMAL?(f.fogNear.setValue(a.near),f.fogFar.setValue(a.far),f.fogType.setValue(1),_=1):a.fogType===zen3d.FOG_TYPE.EXP2&&(f.fogDensity.setValue(a.density),f.fogType.setValue(2),_=2)):(f.fogType.setValue(0),_=0);for(var v=[],m=0,g=t.length;m<g;m++){var E=t[m].object,T=E.material;f.alphaTest.setValue(0),f.viewMatrix.setValue(r.viewMatrix.elements),f.modelMatrix.setValue(E.worldMatrix.elements),E.worldMatrix.decompose(o,s,h),v[0]=h.x,v[1]=h.y;var y=0;a&&T.fog&&(y=_),f.fogType.setValue(y),null!==T.map?(f.uvOffset.setValue(0,0),f.uvScale.setValue(1,1)):(f.uvOffset.setValue(0,0),f.uvScale.setValue(1,1)),f.opacity.setValue(T.opacity),f.color.setValue(T.color.r,T.color.g,T.color.b),f.rotation.setValue(T.rotation),f.scale.setValue(v[0],v[1]),T.transparent?this.state.setBlend(T.blending,T.premultipliedAlpha):this.state.setBlend(i.NONE),T.depthTest?this.state.enable(u.DEPTH_TEST):this.state.disable(u.DEPTH_TEST),this.state.setCullFace(T.side===n.DOUBLE?e.NONE:e.BACK),this.state.setFlipSided(T.side===n.BACK);var x=this.allocTexUnit();this.texture.setTexture2D(T.map,x),f.map.setValue(x),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),this._usedTextureUnits=0}}},r.prototype.setRenderTarget=function(t){var e=this.gl;if(!t)return void(this._currentRenderTarget===t||(e.bindFramebuffer(e.FRAMEBUFFER,null),this._currentRenderTarget=null,this.state.viewport(this._currentViewport.x,this._currentViewport.y,this._currentViewport.z,this._currentViewport.w)));var i=void 0!==t.activeCubeFace;if(this._currentRenderTarget!==t)i?this.texture.setRenderTargetCube(t):this.texture.setRenderTarget2D(t),this._currentRenderTarget=t;else if(i){var n=this.properties.get(t.texture);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,n.__webglTexture,0)}this.state.viewport(0,0,t.width,t.height)},r.prototype.clear=function(t,e,i){var n=this.gl,r=0;(void 0===t||t)&&(r|=n.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=n.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=n.STENCIL_BUFFER_BIT),n.clear(r)},r.prototype.allocTexUnit=function(){var t=this._usedTextureUnits;return t>=this.capabilities.maxTextures&&console.warn("trying to use "+t+" texture units while this GPU supports only "+this.capabilities.maxTextures),this._usedTextureUnits+=1,t},zen3d.Renderer=r}(),function(){var t=zen3d.OBJECT_TYPE,e=zen3d.LIGHT_TYPE,i=function(){this.opaqueObjects=new Array,this.transparentObjects=new Array,this.canvas2dObjects=new Array,this.shadowObjects=new Array,this.sprites=new Array,this.ambientLights=new Array,this.directLights=new Array,this.pointLights=new Array,this.spotLights=new Array,this.shadowLights=new Array,this.camera=null,this.fog=null},n=new zen3d.Vector3,r=new zen3d.Frustum,a=new zen3d.Matrix4,o=new zen3d.Sphere;i.prototype.cacheScene=function(t,e){this.camera=e,this.fog=t.fog,this.cacheObject(t)},i.prototype.cacheObject=function(i){var s=this.camera;switch(i.type){case t.POINT:case t.CANVAS2D:case t.MESH:if(i.frustumCulled){o.copy(i.geometry.boundingSphere).applyMatrix4(i.worldMatrix),a.multiplyMatrices(s.projectionMatrix,s.viewMatrix),r.setFromMatrix(a);var h=r.intersectsSphere(o);if(!h)break}var u,c=i.material;u=i.type==t.CANVAS2D?this.canvas2dObjects:c.transparent?this.transparentObjects:this.opaqueObjects,n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(s.viewMatrix).applyMatrix4(s.projectionMatrix),u.push({object:i,geometry:i.geometry,material:i.material,z:n.z}),i.castShadow&&this.shadowObjects.push(i);break;case t.SPRITE:if(i.frustumCulled){o.center.set(0,0,0),o.radius=.7071067811865476,o.applyMatrix4(i.worldMatrix),a.multiplyMatrices(s.projectionMatrix,s.viewMatrix),r.setFromMatrix(a);var h=r.intersectsSphere(o);if(!h)break}var u=this.sprites;n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(s.viewMatrix).applyMatrix4(s.projectionMatrix),u.push({object:i,material:i.material,z:n.z});break;case t.LIGHT:i.lightType==e.AMBIENT?this.ambientLights.push(i):i.lightType==e.DIRECT?this.directLights.push(i):i.lightType==e.POINT?this.pointLights.push(i):i.lightType==e.SPOT&&this.spotLights.push(i),i.castShadow&&i.lightType!==e.AMBIENT&&this.shadowLights.push(i);break;case t.CAMERA:break;case t.SCENE:break;case t.GROUP:break;default:console.log("undefined object type")}if(t.CANVAS2D!==i.type)for(var d=i.children,l=0,p=d.length;l<p;l++)this.cacheObject(d[l])},i.prototype.sort=function(){this.opaqueObjects.sort(function(t,e){var i=t.z,n=e.z;return i-n}),this.transparentObjects.sort(function(t,e){var i=t.z,n=e.z;return n-i}),this.sprites.sort(function(t,e){var i=t.z,n=e.z;return n-i})},i.prototype.clear=function(){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.canvas2dObjects.length=0,this.shadowObjects.length=0,this.sprites.length=0,this.ambientLights.length=0,this.directLights.length=0,this.pointLights.length=0,this.spotLights.length=0,this.shadowLights.length=0},zen3d.RenderCache=i}(),function(){var t=function(e,i){t.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.width=e,this.height=i,this.viewport=new zen3d.Vector4(0,0,e,i),this.depthBuffer=!0,this.stencilBuffer=!0};zen3d.inherit(t,zen3d.EventDispatcher),t.prototype.resize=function(t,e){this.width===t&&this.height===e||this.dispose(),this.width=t,this.height=e,this.viewport.copy(0,0,t,e)},t.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},zen3d.RenderTargetBase=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this,e,i),this.texture=new zen3d.Texture2D};zen3d.inherit(t,zen3d.RenderTargetBase),zen3d.RenderTarget2D=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this,e,i),this.texture=new zen3d.TextureCube,this.activeCubeFace=0};zen3d.inherit(t,zen3d.RenderTargetBase),zen3d.RenderTargetCube=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.verticesArray=new Array,this.indicesArray=new Array,this.vertexSize=17,this.boundingBox=new zen3d.Box3,this.boundingSphere=new zen3d.Sphere,this.dirty=!0};zen3d.inherit(t,zen3d.EventDispatcher),t.prototype.computeBoundingBox=function(){this.boundingBox.setFromArray(this.verticesArray,this.vertexSize)},t.prototype.computeBoundingSphere=function(){this.boundingSphere.setFromArray(this.verticesArray,this.vertexSize)},t.prototype.getVerticesCount=function(){return this.verticesArray.length/this.vertexSize},t.prototype.getIndicesCount=function(){return this.indicesArray.length},t.prototype.dispose=function(){this.dispatchEvent({type:"dispose"}),this.dirty=!0},zen3d.Geometry=t}(),function(){var t=function(e,i,n,r){t.superClass.constructor.call(this),this.buildGeometry(e,i,n,void 0===r||r)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i,n){this.verticesArray.push(.5*-t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*e,.5*-i,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*e,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-e,.5*i,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-e,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*e,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-e,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-e,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*e,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),n?this.indicesArray.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35):this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34),this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.CubeGeometry=t}(),function(){var t=function(e,i,n,r){t.superClass.constructor.call(this),this.buildGeometry(e,i,n||1,r||1)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i,n){for(var r=i+1,a=n+1,o=this.verticesArray,s=this.indicesArray,h=0,u=0,c=0;c<a;c++)for(var d=0;d<r;d++){var l=(d/i-.5)*t,p=(c/n-.5)*e;if(o[h++]=l,o[h++]=0,o[h++]=p,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=0,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=d/i*1,o[h++]=1*(1-c/n),o[h++]=d/i*1,o[h++]=1*(1-c/n),d!=i&&c!=n){base=d+c*r;var f=1;s[u++]=base*f,s[u++]=(base+r)*f,s[u++]=(base+r+1)*f,s[u++]=base*f,s[u++]=(base+r+1)*f,s[u++]=(base+1)*f}}this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.PlaneGeometry=t}(),function(){var t=function(e,i,n,r){t.superClass.constructor.call(this),this.buildGeometry(e,i||20,n||20,void 0===r||r)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i,n){var r=0,a=0,o=0,s=17,h=s-9,u=this.verticesArray,c=this.indicesArray,d=0,l=0,p=0,f=0,_=0,v=0;for(a=0;a<=i;++a){d=l;var m=Math.PI*a/i,g=-t*Math.cos(m),E=t*Math.sin(m);for(r=0;r<=e;++r){var T=2*Math.PI*r/e,y=E*Math.cos(T),x=E*Math.sin(T),M=1/Math.sqrt(y*y+x*x+g*g),z=Math.sqrt(x*x+y*y);if(_=0,v=z>.007?y/z:0,p=-g,f=x,r==e?(u[l++]=u[d],u[l++]=u[d+1],u[l++]=u[d+2],u[l++]=y*M,u[l++]=p*M,u[l++]=f*M,u[l++]=z>.007?-x/z:1,u[l++]=_,u[l++]=v,u[l+0]=1,u[l+1]=1,u[l+2]=1,u[l+3]=1):(u[l++]=y,u[l++]=p,u[l++]=f,u[l++]=y*M,u[l++]=p*M,u[l++]=f*M,u[l++]=z>.007?-x/z:1,u[l++]=_,u[l++]=v,u[l]=1,u[l+1]=1,u[l+2]=1,u[l+3]=1),r>0&&a>0){var w=(e+1)*a+r,b=(e+1)*a+r-1,A=(e+1)*(a-1)+r-1,S=(e+1)*(a-1)+r;a==i?(u[l-9]=u[d],u[l-8]=u[d+1],u[l-7]=u[d+2],n?(c[o++]=w,c[o++]=A,c[o++]=S):(c[o++]=w,c[o++]=S,c[o++]=A)):1==a?n?(c[o++]=w,c[o++]=b,c[o++]=A):(c[o++]=w,c[o++]=A,c[o++]=b):n?(c[o++]=w,c[o++]=A,c[o++]=S,c[o++]=w,c[o++]=b,c[o++]=A):(c[o++]=w,c[o++]=S,c[o++]=A,c[o++]=w,c[o++]=A,c[o++]=b)}l+=h}}var s=17,h=s-2,l=13;for(a=0;a<=i;++a)for(r=0;r<=e;++r)u[l++]=r/e,u[l++]=a/i,l+=h;this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.SphereGeometry=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.textureType="",this.border=0,this.pixelFormat=zen3d.WEBGL_PIXEL_FORMAT.RGBA,this.pixelType=zen3d.WEBGL_PIXEL_TYPE.UNSIGNED_BYTE,this.magFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR_MIPMAP_LINEAR,this.wrapS=zen3d.WEBGL_TEXTURE_WRAP.CLAMP_TO_EDGE,this.wrapT=zen3d.WEBGL_TEXTURE_WRAP.CLAMP_TO_EDGE,this.generateMipmaps=!0,this.version=0};zen3d.inherit(t,zen3d.EventDispatcher),t.prototype.dispose=function(){this.dispatchEvent({type:"dispose"}),this.version=0},zen3d.TextureBase=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.textureType=zen3d.WEBGL_TEXTURE_TYPE.TEXTURE_2D,this.image=null,this.mipmaps=[]};zen3d.inherit(t,zen3d.TextureBase),t.fromImage=function(e){var i=new t;return i.image=e,i.version++,i},t.fromSrc=function(e){var i=new t,n=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);return zen3d.requireImage(e,function(t){i.pixelFormat=n?zen3d.WEBGL_PIXEL_FORMAT.RGB:zen3d.WEBGL_PIXEL_FORMAT.RGBA,i.image=t,i.version++}),i},zen3d.Texture2D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.textureType=zen3d.WEBGL_TEXTURE_TYPE.TEXTURE_CUBE_MAP,this.images=[]};zen3d.inherit(t,zen3d.TextureBase),t.fromImage=function(e){for(var i=new t,n=i.images,r=0;r<6;r++)n[r]=e[r];return i.version++,i},t.fromSrc=function(e){function i(t){return t&&(a.push(t),h++),h>=6?void n():void zen3d.requireImage(e[h],i)}function n(){r.pixelFormat=s?zen3d.WEBGL_PIXEL_FORMAT.RGB:zen3d.WEBGL_PIXEL_FORMAT.RGBA,r.version++}var r=new t,a=r.images,o=e[0],s=o.search(/\.(jpg|jpeg)$/)>0||0===o.search(/^data\:image\/jpeg/),h=0;return i(),r},zen3d.TextureCube=t}(),function(){var t=function(){this.type="",this.color=new zen3d.Color3(16777215),this.map=null,this.opacity=1,this.transparent=!1,this.premultipliedAlpha=!1,this.normalMap=null,this.envMap=null,this.envMapIntensity=1,this.blending=zen3d.BLEND_TYPE.NORMAL,this.depthTest=!0,this.side=zen3d.DRAW_SIDE.FRONT};zen3d.Material=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.BASIC};zen3d.inherit(t,zen3d.Material),zen3d.BasicMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LAMBERT};zen3d.inherit(t,zen3d.Material),zen3d.LambertMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PHONG,this.specular=30,this.specularColor=new zen3d.Color3(16777215)};zen3d.inherit(t,zen3d.Material),zen3d.PhongMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CUBE,this.cubeMap=null};zen3d.inherit(t,zen3d.Material),zen3d.CubeMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.POINT,this.size=1,this.sizeAttenuation=!0};zen3d.inherit(t,zen3d.Material),zen3d.PointsMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.SPRITE,this.rotation=0,this.fog=!1};zen3d.inherit(t,zen3d.Material),zen3d.SpriteMaterial=t}(),function(){var t=function(){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1);var t=this.euler=new zen3d.Euler,e=this.quaternion=new zen3d.Quaternion;t.onChange(function(){e.setFromEuler(t,!1)}),e.onChange(function(){t.setFromQuaternion(e,void 0,!1)}),
this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0};Object.defineProperties(t.prototype,{rotation:{get:function(){return this.euler},set:function(t){var e=this.euler;e.copyFrom(t),this.quaternion.setFromEuler(t)}}}),t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);e!==-1&&this.children.splice(e,1),t.parent=null},t.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},t.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],a=r.getObjectByProperty(t,e);if(void 0!==a)return a}},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrix()},t.prototype.getWorldDirection=function(){var t=new zen3d.Vector3,e=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(t,e,i),r.set(0,0,1).applyQuaternion(e),r}}(),t.prototype.raycast=function(){},zen3d.Object3D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE,this.fog=null};zen3d.inherit(t,zen3d.Object3D),zen3d.Scene=t}(),function(){var t=function(t,e,i){this.fogType=zen3d.FOG_TYPE.NORMAL,this.color=new zen3d.Color3(void 0!==t?t:0),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3};zen3d.Fog=t}(),function(){var t=function(t,e){this.fogType=zen3d.FOG_TYPE.EXP2,this.color=new zen3d.Color3(void 0!==t?t:0),this.density=void 0!==e?e:25e-5};zen3d.FogExp2=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(t,zen3d.Object3D),zen3d.Group=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=new zen3d.Color3(16777215),this.intensity=1};zen3d.inherit(t,zen3d.Object3D),zen3d.Light=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(t,zen3d.Light),zen3d.AmbientLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.shadow=new zen3d.DirectionalLightShadow};zen3d.inherit(t,zen3d.Light),zen3d.DirectionalLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2,this.distance=200,this.shadow=new zen3d.PointLightShadow};zen3d.inherit(t,zen3d.Light),zen3d.PointLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.SPOT,this.decay=2,this.distance=200,this.penumbra=0,this.angle=Math.PI/6,this.shadow=new zen3d.SpotLightShadow};zen3d.inherit(t,zen3d.Light),zen3d.SpotLight=t}(),function(){var t=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget2D(1024,1024);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=t,this.windowSize=500,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};t.prototype.update=function(t){this._updateCamera(t),this._updateMatrix()},t.prototype._updateCamera=function(t){var e=this.camera,i=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),i.set(i.x+e.position.x,i.y+e.position.y,i.z+e.position.z),e.setLookAt(i,this._up),e.updateMatrix(),e.viewMatrix.getInverse(e.worldMatrix);var n=this.windowSize/2;e.setOrtho(-n,n,-n,n,1,1e3)},t.prototype._updateMatrix=function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},zen3d.DirectionalLightShadow=t}(),function(){var t=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget2D(1024,1024);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=t,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};t.prototype.update=function(t){this._updateCamera(t),this._updateMatrix()},t.prototype._updateCamera=function(t){var e=this.camera,i=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),i.set(i.x+e.position.x,i.y+e.position.y,i.z+e.position.z),e.setLookAt(i,this._up),e.updateMatrix(),e.viewMatrix.getInverse(e.worldMatrix),e.setPerspective(2*t.angle,1,1,1e3)},t.prototype._updateMatrix=function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},zen3d.SpotLightShadow=t}(),function(){var t=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTargetCube(512,512);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=t,this._targets=[new zen3d.Vector3(1,0,0),new zen3d.Vector3((-1),0,0),new zen3d.Vector3(0,1,0),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,(-1))],this._ups=[new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,(-1)),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,(-1),0)],this._lookTarget=new zen3d.Vector3};t.prototype.update=function(t,e){this._updateCamera(t,e),this._updateMatrix()},t.prototype._updateCamera=function(t,e){var i=this.camera,n=this._lookTarget,r=this._targets,a=this._ups;i.position.setFromMatrixPosition(t.worldMatrix),n.set(r[e].x+i.position.x,r[e].y+i.position.y,r[e].z+i.position.z),i.setLookAt(n,a[e]),i.updateMatrix(),i.viewMatrix.getInverse(i.worldMatrix),i.setPerspective(.5*Math.PI,1,1,1e3)},t.prototype._updateMatrix=function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},zen3d.PointLightShadow=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(t,zen3d.Object3D),t.prototype.setLookAt=function(t,e){var i=this.position,n=new zen3d.Vector3;i.subtract(t,n),n.normalize();var r=new zen3d.Vector3;r.crossVectors(e,n),r.normalize();var a=new zen3d.Vector3;a.crossVectors(n,r),this.quaternion.setFromRotationMatrix(zen3d.helpMatrix.set(r.x,a.x,n.x,0,r.y,a.y,n.y,0,r.z,a.z,n.z,0,0,0,0,1))},t.prototype.setOrtho=function(t,e,i,n,r,a){this.projectionMatrix.set(2/(e-t),0,0,-(e+t)/(e-t),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1)},t.prototype.setPerspective=function(t,e,i,n){this.projectionMatrix.set(1/(e*Math.tan(t/2)),0,0,0,0,1/Math.tan(t/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},t.prototype.getWorldDirection=function(){var t=new zen3d.Vector3,e=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(t,e,i),r.set(0,0,-1).applyQuaternion(e),r}}(),zen3d.Camera=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this),this.geometry=e,this.material=i,this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(t,zen3d.Object3D),t.prototype.raycast=function(){function t(t,e,i,n,r,a,s){return zen3d.Triangle.barycoordFromPoint(t,e,i,n,o),r.multiplyScalar(o.x),a.multiplyScalar(o.y),s.multiplyScalar(o.z),r.add(a).add(s),r.clone()}function e(t,e,i,n,r,a,o){var s;t.material;if(s=i.intersectTriangle(a,r,n,!0,o),null===s)return null;f.copy(o),f.applyMatrix4(t.worldMatrix);var h=e.ray.origin.distanceTo(f);return h<e.near||h>e.far?null:{distance:h,point:f.clone(),object:t}}var i=new zen3d.Sphere,n=new zen3d.Box3,r=new zen3d.Matrix4,a=new zen3d.Ray,o=new zen3d.Vector3,s=new zen3d.Vector3,h=new zen3d.Vector3,u=new zen3d.Vector3,c=new zen3d.Vector2,d=new zen3d.Vector2,l=new zen3d.Vector2,p=new zen3d.Vector3,f=new zen3d.Vector3;return function(o,f){var _=this.geometry,v=this.worldMatrix;if(i.copy(_.boundingSphere),i.applyMatrix4(v),o.ray.intersectsSphere(i)&&(n.copy(_.boundingBox),n.applyMatrix4(v),o.ray.intersectsBox(n))){r.getInverse(v),a.copy(o.ray).applyMatrix4(r);for(var m,g,E,T=_.indicesArray,y=_.verticesArray,x=0;x<T.length;x+=3){m=T[x],g=T[x+1],E=T[x+2],s.fromArray(y,m*_.vertexSize),h.fromArray(y,g*_.vertexSize),u.fromArray(y,E*_.vertexSize);var M=e(this,o,a,s,h,u,p);M&&(c.fromArray(y,m*_.vertexSize+13),d.fromArray(y,g*_.vertexSize+13),l.fromArray(y,E*_.vertexSize+13),M.uv=t(p,s,h,u,c,d,l),M.face=[m,g,E],M.faceIndex=m,f.push(M))}}}}(),zen3d.Mesh=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this),this.geometry=e,this.material=i,this.type=zen3d.OBJECT_TYPE.POINT};zen3d.inherit(t,zen3d.Object3D),zen3d.Points=t}(),function(){var t=new zen3d.Geometry;t.verticesArray=[-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1],t.indicesArray=[0,1,2,0,2,3],t.vertexSize=4;var e=function(i){e.superClass.constructor.call(this),this.geometry=t,this.material=void 0!==i?i:new zen3d.SpriteMaterial,this.type=zen3d.OBJECT_TYPE.SPRITE};zen3d.inherit(e,zen3d.Object3D),e.geometry=t,zen3d.Sprite=e}(),function(){var t=function(){this.texturePath="./"};t.prototype.load=function(t,e){this.texturePath=this.extractUrlBase(t),zen3d.requireHttp(t,function(t){var i=this.parse(t);e(i)}.bind(this),function(){console.log("load assimp2json error!")},{parse:!0})},t.prototype.parse=function(t){var e=this.parseList(t.meshes,this.parseMesh),i=this.parseList(t.materials,this.parseMaterial);return this.parseObject(t,t.rootnode,e,i)},t.prototype.parseList=function(t,e){for(var i=new Array(t.length),n=0;n<t.length;++n)i[n]=e.call(this,t[n]);return i},t.prototype.parseMaterial=function(t){var e=new zen3d.PhongMaterial,i=null,n=null,r=t.properties;for(var a in t.properties)if(r=t.properties[a],"$tex.file"===r.key){if(1==r.semantic){var o=this.texturePath+r.value;o=o.replace(/.\\/g,""),i=new zen3d.Texture2D.fromSrc(o),i.wrapS=i.wrapT=zen3d.WEBGL_TEXTURE_WRAP.REPEAT}else if(2==r.semantic);else if(5==r.semantic);else if(6==r.semantic){var o=this.texturePath+r.value;o=o.replace(/.\\/g,""),n=new zen3d.Texture2D.fromSrc(o),i.wrapS=i.wrapT=zen3d.WEBGL_TEXTURE_WRAP.REPEAT}}else"?mat.name"===r.key||"$clr.diffuse"===r.key||"$clr.specular"===r.key||"$clr.emissive"===r.key||("$mat.opacity"===r.key?(e.transparent=r.value<1,e.opacity=r.value):"$mat.shadingm"===r.key?1===r.value:"$mat.shininess"===r.key&&(e.specular=r.value));return e.map=i,e.normalMap=n,e},t.prototype.parseMesh=function(t){for(var e=new zen3d.Geometry,i=t.faces,n=t.vertices,r=t.normals,a=t.texturecoords[0],o=n.length/3,s=e.verticesArray,h=0;h<o;h++)s.push(n[3*h+0]),s.push(n[3*h+1]),s.push(n[3*h+2]),s.push(r[3*h+0]),s.push(r[3*h+1]),s.push(r[3*h+2]),s.push(0),s.push(0),s.push(0),s.push(1),s.push(1),s.push(1),s.push(1),a?(s.push(a[2*h+0]),s.push(1-a[2*h+1])):(s.push(0),s.push(0)),s.push(0),s.push(0);for(var u=e.indicesArray,h=0;h<i.length;h++)u.push(i[h][0]),u.push(i[h][1]),u.push(i[h][2]);return e},t.prototype.parseObject=function(t,e,i,n){var r=new zen3d.Group;r.name=e.name||"",r.matrix.fromArray(e.transformation).transpose(),r.matrix.decompose(r.position,r.quaternion,r.scale);for(var a,o=0;e.meshes&&o<e.meshes.length;++o){var s=e.meshes[o];a=new zen3d.Mesh(i[s],n[t.meshes[s].materialindex]),a.frustumCulled=!1,r.add(a)}for(var o=0;e.children&&o<e.children.length;++o)r.add(this.parseObject(t,e.children[o],i,n));return r},t.prototype.extractUrlBase=function(t){var e=t.split("/");return e.pop(),(e.length<1?".":e.join("/"))+"/"},zen3d.AssimpJsonLoader=t}(),function(){var t=function(t,e){this.camera=t,this.lookAtPoint=e,this.up=new zen3d.Vector3(0,1,0),this.distance=100,this._panAngle=0,this._panRad=0,this.minPanAngle=-(1/0),this.maxPanAngle=1/0,this._tiltAngle=0,this._tiltRad=0,this.minTileAngle=-90,this.maxTileAngle=90};Object.defineProperties(t.prototype,{panAngle:{get:function(){return this._panAngle},set:function(t){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,t)),this._panRad=this._panAngle*Math.PI/180}},tiltAngle:{get:function(){return this._tiltAngle},set:function(t){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,t)),this._tiltRad=this._tiltAngle*Math.PI/180}}}),t.prototype.update=function(){var t=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),e=this.distance*Math.sin(this._tiltRad),i=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),n=this.camera,r=this.lookAtPoint;n.position.set(t+r.x,e+r.y,i+r.z),n.setLookAt(r,this.up)},zen3d.HoverController=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CANVAS2D,this.geometry=new zen3d.Geometry,this.geometry.vertexSize=5,this.material=new zen3d.Canvas2DMaterial,this.width=void 0!==e?e:0,this.height=void 0!==i?i:0,this.sprites=[],this.drawArray=[],this.isScreenCanvas=!0,this.frustumCulled=!1,this.orthoCamera=new zen3d.Camera,this.orthoCamera.setOrtho(-this.width/2,this.width/2,-this.height/2,this.height/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix)};zen3d.inherit(t,zen3d.Object3D),t.prototype.add=function(t){this.children.push(t)},t.prototype.remove=function(t){var e=this.children.indexOf(t);e!==-1&&this.children.splice(e,1)},t.prototype.updateSprites=function(){for(var t=this.geometry,e=t.verticesArray,i=t.indicesArray,n=0,r=0,a=this.sprites,o=0;o<a.length;o++){var s,h,u=a[o],c=0,d=0,l=u.width,p=u.height,f=u.worldMatrix.elements,_=f[0],v=f[1],m=f[3],g=f[4],E=f[6]-this.width/2,T=this.height/2-f[7]-p;s=c,h=d,e[n++]=_*s+m*h+E,e[n++]=v*s+g*h+T,e[n++]=0,e[n++]=0,e[n++]=1,s=c+l,h=d,e[n++]=_*s+m*h+E,e[n++]=v*s+g*h+T,e[n++]=0,e[n++]=1,e[n++]=1,s=c+l,h=d+p,e[n++]=_*s+m*h+E,e[n++]=v*s+g*h+T,e[n++]=0,e[n++]=1,e[n++]=0,s=c,h=d+p,e[n++]=_*s+m*h+E,e[n++]=v*s+g*h+T,e[n++]=0,e[n++]=0,e[n++]=0;var y=n/5-4;i[r++]=y+0,i[r++]=y+1,i[r++]=y+2,i[r++]=y+2,i[r++]=y+3,i[r++]=y+0}e.length=n,i.length=r,t.dirty=!0,this.drawArray=[];for(var x,o=0;o<a.length;o++){var u=a[o];x!==u.texture?(this.drawArray.push({texture:u.texture,count:1}),x=u.texture):this.drawArray[this.drawArray.length-1].count++}},t.prototype.updateMatrix=function(){t.superClass.updateMatrix.call(this),this.sprites=[];for(var e=this.children,i=0,n=e.length;i<n;i++)this.cacheSprites(e[i]);for(var r=this.sprites,i=0,n=r.length;i<n;i++)r[i].updateMatrix();this.updateSprites()},t.prototype.cacheSprites=function(t){var e=this.sprites;e.push(t);for(var i=0,n=t.children.length;i<n;i++)this.cacheSprites(t.children[i])},zen3d.Canvas2D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CANVAS2D,this.depthTest=!1};zen3d.inherit(t,zen3d.Material),zen3d.Canvas2DMaterial=t}(),function(){var t=function(){this.width=0,this.height=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.anchorX=0,this.anchorY=0,this.matrix=new zen3d.Matrix3,this.worldMatrix=new zen3d.Matrix3,this.children=new Array,this.parent=null,this.boundingBox=new zen3d.Box2};t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);e!==-1&&this.children.splice(e,1),t.parent=null},t.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},t.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],a=r.getObjectByProperty(t,e);if(void 0!==a)return a}},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.anchorX*this.width,this.anchorY*this.height);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrix()},t.prototype.computeBoundingBox=function(){this.boundingBox.set(this.x,this.y,this.x+this.width,this.y+this.height)},zen3d.Object2D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.texture=null};zen3d.inherit(t,zen3d.Object2D),zen3d.Sprite2D=t}(),function(){var t=function(e){function i(t){t.length>0?this.vrDisplay=t[0]:console.warn("HMD not available")}t.superClass.constructor.call(this,e),this.vrDisplay=void 0,navigator.getVRDisplays?navigator.getVRDisplays().then(i.bind(this)).catch(function(){console.warn("RendererVR: Unable to get VR Displays")}):console.warn("getVRDisplays not exist in navigator"),this.frameData=null,"VRFrameData"in window?this.frameData=new window.VRFrameData:console.warn("VRFrameData not exist")};zen3d.inherit(t,zen3d.Renderer);var e=new zen3d.Matrix4;t.prototype.render=function(i,n,r,a){var o=this.vrDisplay,s=this.frameData,h=n.cameraL,u=n.cameraR;if(o){o.depthNear=n.near,o.depthFar=n.far,o.getFrameData(s),h.projectionMatrix.elements=s.leftProjectionMatrix,e.elements=s.leftViewMatrix,e.inverse().decompose(h.position,h.quaternion,h.scale),h.position.add(n.position),h.updateMatrix(),u.projectionMatrix.elements=s.leftProjectionMatrix,e.elements=s.rightViewMatrix,e.inverse().decompose(u.position,u.quaternion,u.scale),u.position.add(n.position),u.updateMatrix(),this.setViewport(0,0,this.width/2,this.height),t.superClass.render.call(this,i,h,r,a);var c=this.autoClear;this.autoClear=!1,this.setViewport(this.width/2,0,this.width/2,this.height),t.superClass.render.call(this,i,u,r,!1),this.autoClear=c,o.submitFrame()}},zen3d.RendererVR=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.cameraL=new zen3d.Camera,this.cameraR=new zen3d.Camera,this.near=1,this.far=1e3};zen3d.inherit(t,zen3d.Object3D),zen3d.CameraVR=t}();