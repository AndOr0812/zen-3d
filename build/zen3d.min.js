// github.com/shawn0326/zen-3d
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.zen3d={})}(this,function(t){"use strict";function e(t){return 0==(t&t-1)&&0!==t}function i(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function n(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function r(t){var e={};for(var i in t){var n=t[i];Array.isArray(n)?e[i]=n.slice():e[i]=n}return e}function a(){this.eventMap={}}function s(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function o(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function u(t,e){this.origin=void 0!==t?t:new o,this.direction=void 0!==e?e:new o}function h(t,e,i,n){this.ray=new u(t,e),this.near=i||0,this.far=n||1/0}function c(t,e){return t.distance-e.distance}function l(t,e,i,n){if(t.raycast(e,i),!0===n)for(var r=t.children,a=0,s=r.length;a<s;a++)l(r[a],e,i,!0)}function d(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||d.DefaultOrder}function p(t,e){this.x=t||0,this.y=e||0}function f(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1}function _(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}function m(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1}function v(t,e){this.min=void 0!==t?t:new p(1/0,1/0),this.max=void 0!==e?e:new p(-1/0,-1/0)}function g(t,e){this.min=void 0!==t?t:new o(1/0,1/0,1/0),this.max=void 0!==e?e:new o(-1/0,-1/0,-1/0)}function M(t,e){this.center=void 0!==t?t:new o,this.radius=void 0!==e?e:0}function x(t,e){this.normal=void 0!==t?t:new o(1,0,0),this.constant=void 0!==e?e:0}function E(t,e,i,n,r,a){this.planes=[void 0!==t?t:new x,void 0!==e?e:new x,void 0!==i?i:new x,void 0!==n?n:new x,void 0!==r?r:new x,void 0!==a?a:new x]}function y(t,e,i){return this.r=0,this.g=0,this.b=0,void 0===e&&void 0===i?this.setHex(t):this.setRGB(t,e,i)}function T(t,e,i){this.a=void 0!==t?t:new o,this.b=void 0!==e?e:new o,this.c=void 0!==i?i:new o}function S(t,e){this.posPoints=void 0,this.ctrlPoints=void 0,this.segCount=0,this.set(t,e)}function b(t,e,i){this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==i?i:0}function w(){a.call(this),this.uuid=Le(),this.textureType="",this.border=0,this.format=Ve.RGBA,this.internalformat=null,this.type=je.UNSIGNED_BYTE,this.magFilter=Xe.LINEAR,this.minFilter=Xe.LINEAR_MIPMAP_LINEAR,this.wrapS=We.CLAMP_TO_EDGE,this.wrapT=We.CLAMP_TO_EDGE,this.anisotropy=1,this.generateMipmaps=!0,this.encoding=Ke.LINEAR,this.flipY=!0,this.version=0}function A(){this.crossOrigin=void 0,this.path=void 0}function N(){this.path=void 0,this.responseType=void 0,this.withCredentials=void 0,this.mimeType=void 0,this.requestHeader=void 0}function L(){}function C(){w.call(this),this.textureType=He.TEXTURE_2D,this.image=null,this.mipmaps=[],this.offset=new p,this.repeat=new p(1,1),this.center=new p,this.rotation=0,this.matrix=new _,this.matrixAutoUpdate=!0}function R(){w.call(this),this.textureType=He.TEXTURE_CUBE_MAP,this.images=[],this.flipY=!1}function P(){this.uuid=Le(),this.name="",this.type="",this.position=new o,this.scale=new o(1,1,1),this.euler=new d,this.quaternion=new m;var t=this.euler,e=this.quaternion;t.onChange(function(){e.setFromEuler(t,!1)}),e.onChange(function(){t.setFromQuaternion(e,void 0,!1)}),this.matrix=new s,this.worldMatrix=new s,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1,this.shadowType=Ze.PCF_SOFT,this.frustumCulled=!0,this.visible=!0,this.renderOrder=0,this.userData={}}function F(){P.call(this),this.type="bone",this.offsetMatrix=new s}function O(t){t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.boneTexture=void 0}function U(t,e,i,n,r){if(n>=.5)for(var a=0;a!==r;++a)t[e+a]=t[i+a]}function I(t,e,i,n){m.slerpFlat(t,e,t,e,t,i,n)}function D(t,e,i,n,r){for(var a=1-n,s=0;s!==r;++s){var o=e+s;t[o]=t[o]*a+t[i+s]*n}}function z(t,e,i,n){this.target=null,this.property="",this.parseBinding(t,e),this.valueSize=n;var r,a=Float64Array;switch(i){case"quaternion":r=I;break;case"string":case"bool":a=Array,r=U;break;default:r=D}this.buffer=new a(2*n),this._mixBufferFunction=r,this.cumulativeWeight=0,this.referenceCount=0,this.useCount=0}function B(){this._clips={},this._bindings={},this._activeClips={}}function G(t,e,i,n,r){this.target=t,this.propertyPath=e,this.name=this.target.uuid+"."+e,this.times=i,this.values=n,this.valueSize=n.length/i.length,this.interpolant=void 0===r||r}function k(t,e,i,n,r){G.call(this,t,e,i,n,r)}function H(t,e,i,n,r){G.call(this,t,e,i,n,r)}function V(t){this.name=t||"",this.tracks=[],this.loop=!0,this.startFrame=0,this.endFrame=0,this.frame=0}function j(t,e,i,n,r){G.call(this,t,e,i,n,r)}function X(t,e,i,n,r){G.call(this,t,e,i,n,r)}function W(t,e,i,n,r){G.call(this,t,e,i,n,r)}function Y(t,e,i,n,r){G.call(this,t,e,i,n,r)}function q(t,e,i){this.uuid=Le(),this.array=t,this.size=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Z(){a.call(this),this.uuid=Le(),this.attributes={},this.index=null,this.boundingBox=new g,this.boundingSphere=new M,this.groups=[]}function K(t,e,i,n,r,a){Z.call(this),this.buildGeometry(t,e,i,n,r,a)}function Q(t,e,i,n,r,a,s,o){Z.call(this),this.buildGeometry(t,e,i,n,r,a,s,o)}function J(t,e,i,n){q.call(this,t,e,i),this.meshPerAttribute=n||1}function $(){Z.call(this),this.maxInstancedCount=void 0}function tt(t,e){this.uuid=Le(),this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function et(t,e,i){tt.call(this,t,e),this.meshPerAttribute=i||1}function it(t,e,i,n){this.uuid=Le(),this.data=t,this.size=e,this.offset=i,this.normalized=!0===n}function nt(t,e,i,n){Z.call(this),this.buildGeometry(t,e,i,n)}function rt(t,e,i,n,r,a,s){Z.call(this),this.buildGeometry(t,e,i,n,r,a,s)}function at(){this.type="",this.opacity=1,this.transparent=!1,this.blending=Ie.NORMAL,this.blendSrc=ze.SRC_ALPHA,this.blendDst=ze.ONE_MINUS_SRC_ALPHA,this.blendEquation=De.ADD,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultipliedAlpha=!1,this.vertexColors=!1,this.diffuse=new y(16777215),this.diffuseMap=null,this.normalMap=null,this.aoMap=null,this.aoMapIntensity=1,this.bumpMap=null,this.bumpScale=1,this.envMap=null,this.envMapIntensity=1,this.envMapCombine=Qe.MULTIPLY,this.emissive=new y(0),this.emissiveMap=null,this.emissiveIntensity=1,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.alphaTest=0,this.side=Ge.FRONT,this.shading=ke.SMOOTH_SHADING,this.acceptLight=!1,this.drawMode=Je.TRIANGLES}function st(){at.call(this),this.type=Oe.BASIC}function ot(){at.call(this),this.type=Oe.LAMBERT,this.acceptLight=!0}function ut(){at.call(this),this.type=Oe.PHONG,this.shininess=30,this.specular=new y(6710886),this.specularMap=null,this.acceptLight=!0}function ht(){at.call(this),this.type=Oe.PBR,this.roughness=.5,this.metalness=.5,this.roughnessMap=null,this.metalnessMap=null,this.acceptLight=!0}function ct(){at.call(this),this.type=Oe.POINT,this.size=1,this.sizeAttenuation=!0,this.drawMode=Je.POINTS}function lt(){at.call(this),this.type=Oe.LINE,this.lineWidth=1,this.drawMode=Je.LINES}function dt(){at.call(this),this.type=Oe.LINE_LOOP,this.lineWidth=1,this.drawMode=Je.LINE_LOOP}function pt(){at.call(this),this.type=Oe.LINE_DASHED,this.lineWidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.drawMode=Je.LINE_STRIP}function ft(t){at.call(this),this.type=Oe.SHADER,this.vertexShader=t.vertexShader||"",this.fragmentShader=t.fragmentShader||"",this.defines={},Object.assign(this.defines,t.defines),this.uniforms=r(t.uniforms)}function _t(){at.call(this),this.type=Oe.DEPTH,this.packToRGBA=!1}function mt(){at.call(this),this.type=Oe.DISTANCE}function vt(t){function e(e){if(n[e])return n[e];var r=null;for(var a in i)if(r=t.getExtension(i[a]+e))break;return n[e]=r,r}var i=["","WEBKIT_","MOZ_"],n={};e("OES_standard_derivatives"),e("GL_OES_standard_derivatives"),e("WEBGL_depth_texture"),e("OES_element_index_uint"),e("OES_texture_half_float");var r=e("EXT_texture_filter_anisotropic");return{version:parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),maxPrecision:function(t,e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}(t,"highp"),maxTextures:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxVertexUniformVectors:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),floatTextures:!!e("OES_texture_float"),shaderTextureLOD:e("EXT_shader_texture_lod"),angleInstancedArraysExt:e("ANGLE_instanced_arrays"),drawBuffersExt:e("WEBGL_draw_buffers"),anisotropyExt:r,maxAnisotropy:null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,getExtension:e}}function gt(t,e,i,n){var r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var s=0;s<n;s++)t.texImage2D(i+s,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return a}function Mt(t,e){this.gl=t,this.capabilities=e,this.states={},this.currentBlending=null,this.currentBlendEquation=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendEquationAlpha=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipliedAlpha=null,this.currentCullFace=null,this.currentViewport=new f,this.currentColorMask=null,this.currentClearColor=new f,this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBuffers={},this.emptyTextures={},this.emptyTextures[t.TEXTURE_2D]=gt(t,t.TEXTURE_2D,t.TEXTURE_2D,1),this.emptyTextures[t.TEXTURE_CUBE_MAP]=gt(t,t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.currentFlipSided=!1,this.currentDepthMask=!0,this.currentLineWidth=null,this.currentProgram=null,this.currentStencilMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilClear=null,this.currentRenderTarget=null}function xt(){this.properties={}}function Et(t){return t.wrapS!==We.CLAMP_TO_EDGE||t.wrapT!==We.CLAMP_TO_EDGE||t.minFilter!==Xe.NEAREST&&t.minFilter!==Xe.LINEAR}function yt(t){return t===Xe.NEAREST||t===Xe.NEAREST_MIPMAP_LINEAR||t===Xe.NEAREST_MIPMAP_NEAREST?Xe.NEAREST:Xe.LINEAR}function Tt(t){return e(t.width)&&e(t.height)}function St(t){if(Re&&(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.width=i(t.width),e.height=i(t.height),e.getContext("2d").drawImage(t,0,0,e.width,e.height),console.warn("image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}function bt(t,e){if(t.width>e||t.height>e){if(!Re)return console.warn("image is too big ("+t.width+"x"+t.height+"). max size is "+e+"x"+e,t),t;var i=e/Math.max(t.width,t.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return n.width=Math.floor(t.width*i),n.height=Math.floor(t.height*i),n.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height),console.warn("image is too big ("+t.width+"x"+t.height+"). Resized to "+n.width+"x"+n.height,t),n}return t}function wt(t,e){var i=t.wrapS,n=t.wrapT,r=t.magFilter,a=t.minFilter,s=t.anisotropy;return e||(i=We.CLAMP_TO_EDGE,n=We.CLAMP_TO_EDGE,t.wrapS===We.CLAMP_TO_EDGE&&t.wrapT===We.CLAMP_TO_EDGE||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to zen3d.TEXTURE_WRAP.CLAMP_TO_EDGE.",t),r=yt(t.magFilter),a=yt(t.minFilter),(t.minFilter!==Xe.NEAREST&&t.minFilter!==Xe.LINEAR||t.magFilter!==Xe.NEAREST&&t.magFilter!==Xe.LINEAR)&&console.warn("Texture is not power of two. Texture.minFilter and Texture.magFilter should be set to zen3d.TEXTURE_FILTER.NEAREST or zen3d.TEXTURE_FILTER.LINEAR.",t)),[i,n,r,a,s]}function At(t,e,i,n){this.gl=t,this.state=e,this.properties=i,this.capabilities=n,this.samplers={}}function Nt(t,e,i,n){var r=i.array,a=i.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,s=t.createBuffer();t.bindBuffer(n,s),t.bufferData(n,r,a);var o=t.FLOAT;r instanceof Float32Array?o=t.FLOAT:r instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=t.UNSIGNED_SHORT:r instanceof Int16Array?o=t.SHORT:r instanceof Uint32Array?o=t.UNSIGNED_INT:r instanceof Int32Array?o=t.INT:r instanceof Int8Array?o=t.BYTE:r instanceof Uint8Array&&(o=t.UNSIGNED_BYTE),e.buffer=s,e.type=o,e.bytesPerElement=r.BYTES_PER_ELEMENT,e.version=i.version}function Lt(t,e,i,n){var r=i.array,a=i.updateRange;t.bindBuffer(n,e),!1===i.dynamic?t.bufferData(n,r,t.STATIC_DRAW):-1===a.count?t.bufferSubData(n,0,r):0===a.count?console.error("updateBuffer: dynamic BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(n,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}function Ct(t,e,i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r=e.get(i);void 0===r.buffer?Nt(t,r,i,n):r.version<i.version&&(Lt(t,r.buffer,i,n),r.version=i.version)}function Rt(t,e,i){i.isInterleavedBufferAttribute&&(i=i.data);var n=e.get(i);n.buffer&&t.deleteBuffer(n.buffer),buffers.delete(i)}function Pt(t,e,i,n){this.gl=t,this.state=e,this.properties=i,this.capabilities=n}function Ft(t,e,i){this.gl=t,this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getUniformLocation(e,this.name),this.setValue=void 0,this.set=void 0,this._generateSetValue()}function Ot(t,e,i){this.gl=t,this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getAttribLocation(e,this.name),this.count=0,this.initCount(t),this.format=t.FLOAT,this.initFormat(t)}function Ut(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}function It(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||console.warn("shader not compiled!",t.getShaderInfoLog(n),Ut(i)),n}function Dt(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||console.warn("program not linked!",t.getProgramInfoLog(n)),n}function zt(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;r++){var a=t.getActiveUniform(e,r),s=a.name,o=new Ft(t,e,a);i[s]=o}return i}function Bt(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var a=t.getActiveAttrib(e,r),s=a.name,o=new Ot(t,e,a);i[s]=o}return i}function Gt(t,e,i){this.uuid=Le(),this.vshaderSource=e,this.fshaderSource=i;var n=It(t,t.VERTEX_SHADER,this.vshaderSource),r=It(t,t.FRAGMENT_SHADER,this.fshaderSource);this.id=Dt(t,n,r),this.uniforms=zt(t,this.id),this.attributes=Bt(t,this.id),t.deleteShader(n),t.deleteShader(r)}function kt(t,e){var i="";for(var n in t)i+=t[n]+"_";if(void 0!==e.defines)for(var r in e.defines)i+=r+"_"+e.defines[r]+"_";return i}function Ht(t,e){var i;return t?t.encoding&&(i=t.encoding):i=Ke.LINEAR,i===Ke.LINEAR&&e&&(i=Ke.GAMMA),i}function Vt(t){switch(t){case Ke.LINEAR:return["Linear","( value )"];case Ke.SRGB:return["sRGB","( value )"];case Ke.RGBE:return["RGBE","( value )"];case Ke.RGBM7:return["RGBM","( value, 7.0 )"];case Ke.RGBM16:return["RGBM","( value, 16.0 )"];case Ke.RGBD:return["RGBD","( value, 256.0 )"];case Ke.GAMMA:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:console.error("unsupported encoding: "+t)}}function jt(t,e){var i=Vt(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Xt(t,e){var i=Vt(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Wt(t){var e=[];for(var i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}function Yt(t,e,i){var n=["precision "+e.precision+" float;","precision "+e.precision+" int;","precision "+e.precision+" sampler2D;","#define SHADER_NAME "+e.materialType,i,e.useRoughnessMap?"#define USE_ROUGHNESSMAP":"",e.useMetalnessMap?"#define USE_METALNESSMAP":"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0?"#define USE_NORMAL":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useNormalMap?"#define USE_NORMAL_MAP":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useBumpMap?"#define USE_BUMPMAP":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useSpecularMap?"#define USE_SPECULARMAP":"",e.useEmissiveMap?"#define USE_EMISSIVEMAP":"",e.useShadow?"#define USE_SHADOW":"",e.flatShading?"#define FLAT_SHADED":"",e.materialType==Oe.LAMBERT?"#define USE_LAMBERT":"",e.materialType==Oe.PHONG?"#define USE_PHONG":"",e.materialType==Oe.PBR?"#define USE_PBR":"",e.flipSided?"#define FLIP_SIDED":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.useAOMap?"#define USE_AOMAP":"",e.useVertexColors?"#define USE_VCOLOR":"",e.useSkinning?"#define USE_SKINNING":"",e.bonesNum>0?"#define MAX_BONES "+e.bonesNum:"",e.useVertexTexture?"#define BONE_TEXTURE":""].join("\n"),r=[e.version>1?"":"#extension GL_OES_standard_derivatives : enable",e.useShaderTextureLOD&&e.version<2?"#extension GL_EXT_shader_texture_lod : enable":"","precision "+e.precision+" float;","precision "+e.precision+" int;","precision "+e.precision+" sampler2D;","#define SHADER_NAME "+e.materialType,"#define PI 3.14159265359","#define EPSILON 1e-6","float pow2( const in float x ) { return x*x; }","#define LOG2 1.442695","#define RECIPROCAL_PI 0.31830988618","#define saturate(a) clamp( a, 0.0, 1.0 )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )",i,e.useRoughnessMap?"#define USE_ROUGHNESSMAP":"",e.useMetalnessMap?"#define USE_METALNESSMAP":"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0?"#define USE_NORMAL":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useNormalMap?"#define USE_NORMAL_MAP":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useBumpMap?"#define USE_BUMPMAP":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useSpecularMap?"#define USE_SPECULARMAP":"",e.useEmissiveMap?"#define USE_EMISSIVEMAP":"",e.useShadow?"#define USE_SHADOW":"",e.usePCFSoftShadow?"#define USE_PCF_SOFT_SHADOW":"",e.flatShading?"#define FLAT_SHADED":"",e.materialType==Oe.LAMBERT?"#define USE_LAMBERT":"",e.materialType==Oe.PHONG?"#define USE_PHONG":"",e.materialType==Oe.PBR?"#define USE_PBR":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.useShaderTextureLOD?"#define TEXTURE_LOD_EXT":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.useAOMap?"#define USE_AOMAP":"",e.useVertexColors?"#define USE_VCOLOR":"",e.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",e.fog?"#define USE_FOG":"",e.fogExp2?"#define USE_EXP2_FOG":"",e.alphaTest?"#define ALPHATEST "+e.alphaTest:"",e.useEnvMap?"#define "+e.envMapCombine:"","#define GAMMA_FACTOR "+e.gammaFactor,e.diffuseMapEncoding||e.envMapEncoding||e.emissiveMapEncoding||e.outputEncoding?ei.encodings_pars_frag:"",e.diffuseMapEncoding?jt("mapTexelToLinear",e.diffuseMapEncoding):"",e.envMapEncoding?jt("envMapTexelToLinear",e.envMapEncoding):"",e.emissiveMapEncoding?jt("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.outputEncoding?Xt("linearToOutputTexel",e.outputEncoding):"",e.packDepthToRGBA?"#define DEPTH_PACKING_RGBA":""].join("\n"),a=ii[e.materialType+"_vert"]||e.vertexShader||ii.basic_vert,s=ii[e.materialType+"_frag"]||e.fragmentShader||ii.basic_frag,o=[n,a].join("\n"),u=[r,s].join("\n");if(o=ri(o),u=ri(u),o=qt(o,e),u=qt(u,e),o=Zt(o,e),u=Zt(u,e),o=Kt(o),u=Kt(u),e.version>1){u=u.replace("#extension GL_EXT_draw_buffers : require","");for(var h=0,c=[];u.indexOf("gl_FragData["+h+"]")>-1;)u=u.replace("gl_FragData["+h+"]","pc_fragData"+h),c.push("layout(location = "+h+") out vec4 pc_fragData"+h+";"),h++;u=u.replace("#define whiteCompliment(a) ( 1.0 - saturate( a ) )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n"+c.join("\n")+"\n"),o=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+o,u=["#version 300 es\n","#define varying in",u.indexOf("layout")>-1?"":"out highp vec4 pc_fragColor;","#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+u}return new Gt(t,o,u)}function qt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.directLightNum).replace(/NUM_SPOT_LIGHTS/g,e.spotLightNum).replace(/NUM_POINT_LIGHTS/g,e.pointLightNum)}function Zt(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes)}function Kt(t){var e=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return t.replace(e,function(t,e,i,n){for(var r="",a=parseInt(e);a<parseInt(i);a++)r+=n.replace(/\[ i \]/g,"[ "+a+" ]");return r})}function Qt(t,e,i,n,r,a,s){var o={};o.materialType=i.type;var u=t.capabilities;o.version=u.version,o.precision=u.maxPrecision,o.useShaderTextureLOD=!!u.shaderTextureLOD||u.version>1,o.useDiffuseMap=!!i.diffuseMap,o.useNormalMap=!!i.normalMap,o.useBumpMap=!!i.bumpMap,o.useSpecularMap=!!i.specularMap,o.useEnvMap=!!i.envMap,o.envMapCombine=i.envMapCombine,o.useEmissiveMap=!!i.emissiveMap,o.useRoughnessMap=!!i.roughnessMap,o.useMetalnessMap=!!i.metalnessMap,o.useAOMap=!!i.aoMap,o.ambientLightNum=r?r.ambientsNum:0,o.directLightNum=r?r.directsNum:0,o.pointLightNum=r?r.pointsNum:0,o.spotLightNum=r?r.spotsNum:0,o.useShadow=n.receiveShadow,o.usePCFSoftShadow=n.shadowType===Ze.PCF_SOFT;var h=t.state.currentRenderTarget;o.gammaFactor=e.gammaFactor,o.outputEncoding=Ht(h.texture||null,e.gammaOutput),o.diffuseMapEncoding=Ht(i.diffuseMap,e.gammaInput),o.envMapEncoding=Ht(i.envMap,e.gammaInput),o.emissiveMapEncoding=Ht(i.emissiveMap,e.gammaInput),o.alphaTest=i.alphaTest,o.premultipliedAlpha=i.premultipliedAlpha,o.useVertexColors=i.vertexColors,o.numClippingPlanes=s?s.length:0,o.flatShading=i.shading===ke.FLAT_SHADING,o.fog=!!a,o.fogExp2=!!a&&a.fogType===Ue.EXP2,o.sizeAttenuation=i.sizeAttenuation,o.doubleSided=i.side===Ge.DOUBLE,o.flipSided=i.side===Ge.BACK,o.packDepthToRGBA=i.packToRGBA;var c=n.type===Pe.SKINNED_MESH&&n.skeleton,l=u.maxVertexUniformVectors,d=u.maxVertexTextures>0&&u.floatTextures||2===u.version,p=0;return d?p=1024:16*(p=n.skeleton?n.skeleton.bones.length:0)>l&&(console.warn("Program: too many bones ("+p+"), current cpu only support "+Math.floor(l/16)+" bones!!"),p=Math.floor(l/16)),o.useSkinning=c,o.bonesNum=p,o.useVertexTexture=d,i.type===Oe.SHADER&&(o.vertexShader=i.vertexShader,o.fragmentShader=i.fragmentShader),o}function Jt(t,e,i,n,r){var a,s=t.gl,o=Qt(t,e,i=i||n.material,n,r&&i.acceptLight?r.lights:null,r?r.fog:null,r?r.clippingPlanes:null),u=kt(o,i),h=ni;if(h[u])a=h[u];else{var c="";void 0!==i.defines&&(c=Wt(i.defines)),a=Yt(s,o,c),h[u]=a}return a}function $t(t){return t.material}function te(t){return!0}function ee(){}function ie(t){this.gl=t;var e=new xt;this.properties=e;var i=new vt(t);this.capabilities=i;var n=new Mt(t,i);n.enable(t.STENCIL_TEST),n.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),n.setCullFace(Be.BACK),n.setFlipSided(!1),n.clearColor(0,0,0,0),this.state=n,this.texture=new At(t,n,e,i),this.geometry=new Pt(t,n,e,i),this._usedTextureUnits=0,this._currentGeometryProgram=""}function ne(){P.call(this),this.type=Pe.CAMERA,this.viewMatrix=new s,this.projectionMatrix=new s,this.frustum=new E,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.rect=new f(0,0,1,1),this.frustumCulled=!0}function re(t,e){a.call(this),this.uuid=Le(),this.width=t,this.height=e}function ae(t,e){re.call(this,t,e),this.texture=new R,this.activeCubeFace=0}function se(t){this.camera=new ne,this.targets=[new o(1,0,0),new o(-1,0,0),new o(0,1,0),new o(0,-1,0),new o(0,0,1),new o(0,0,-1)],this.ups=[new o(0,-1,0),new o(0,-1,0),new o(0,0,1),new o(0,0,-1),new o(0,-1,0),new o(0,-1,0)],this.camera.setPerspective(.5*Math.PI,1,1,1e3),this.position=new o,this.lookTarget=new o,this.renderTarget=t||new ae(512,512),this.renderTexture=this.renderTarget.texture,this.renderTexture.minFilter=Xe.LINEAR_MIPMAP_LINEAR}function oe(){this.depthMaterial=new _t,this.depthMaterial.packToRGBA=!0,this.distanceMaterial=new mt,this.oldClearColor=new f}function ue(t){if(void 0!==di[t.uuid])return di[t.uuid];var e;switch(t.lightType){case Fe.DIRECT:e={direction:new Float32Array(3),color:new Float32Array([0,0,0,1]),shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Float32Array(2)};break;case Fe.POINT:e={position:new Float32Array(3),color:new Float32Array([0,0,0,1]),distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Float32Array(2),shadowCameraNear:1,shadowCameraFar:1e3};break;case Fe.SPOT:e={position:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array([0,0,0,1]),distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Float32Array(2)}}return di[t.uuid]=e,e}function he(){this.ambient=new Float32Array([0,0,0,1]),this.directional=[],this.directionalShadowMap=[],this.directionalShadowMatrix=[],this.point=[],this.pointShadowMap=[],this.pointShadowMatrix=[],this.spot=[],this.spotShadowMap=[],this.spotShadowMatrix=[],this.shadows=[],this.ambientsNum=0,this.directsNum=0,this.pointsNum=0,this.spotsNum=0,this.shadowsNum=0,this.totalNum=0}function ce(){function t(t,o,u,h,c){var l=e[i];void 0===l?(l={object:t,geometry:o,material:u,z:h,renderOrder:t.renderOrder,group:c},e[i]=l):(l.object=t,l.geometry=o,l.material=u,l.z=h,l.renderOrder=t.renderOrder,l.group=c),u.transparent?(a[s]=l,s++):(n[r]=l,r++),i++}var e=[],i=0,n=[],r=0,a=[],s=0;return{opaque:n,transparent:a,startCount:function(){i=0,r=0,s=0},add:function(e,i){if(!e.frustumCulled||!i.frustumCulled||(fi.copy(e.geometry.boundingSphere).applyMatrix4(e.worldMatrix),i.frustum.intersectsSphere(fi)))if(pi.setFromMatrixPosition(e.worldMatrix),pi.applyMatrix4(i.viewMatrix).applyMatrix4(i.projectionMatrix),Array.isArray(e.material))for(var n=e.geometry.groups,r=0;r<n.length;r++){var a=n[r],s=e.material[a.materialIndex];s&&t(e,e.geometry,s,pi.z,a)}else t(e,e.geometry,e.material,pi.z)},endCount:function(){n.length=r,a.length=s},sort:function(){n.sort(_i),a.sort(mi)}}}function le(){P.call(this),this.type=Pe.SCENE,this.overrideMaterial=null,this.fog=null,this.clippingPlanes=[],this.lights=new he,this._renderLists={}}function de(t,e){P.call(this),this.geometry=t,this.material=e,this.type=Pe.MESH}function pe(t){var e=new le,i=this.camera=new ne;i.frustumCulled=!1,i.position.set(0,1,0),i.lookAt(new o(0,0,0),new o(0,0,-1)),i.setOrtho(-1,1,-1,1,.1,2),e.add(i);var n=new nt(2,2,1,1),r=this.material=new ft(t);this.uniforms=r.uniforms;var a=new de(n,r);a.frustumCulled=!1,e.add(a),e.updateMatrix(),this.renderList=e.updateRenderList(i),this.renderConfig={}}function fe(t){re.call(this,t.width,t.height),this.view=t}function _e(){this._entities={},this.enableCounter=!1}function me(t,e){var i={antialias:!0,alpha:!1,stencil:!0},n=t.getContext("webgl2",e||i)||t.getContext("webgl",e||i);this.glCore=new ie(n),console.info("ForwardRenderer use WebGL Version: "+this.glCore.capabilities.version),this.backRenderTarget=new fe(t),this.performance=new _e,this.shadowMapPass=new oe,this.shadowAutoUpdate=!0,this.shadowNeedsUpdate=!1,this.matrixAutoUpdate=!0,this.lightsAutoupdate=!0,this.autoClear=!0}function ve(t,e){re.call(this,t,e),this._textures={},this.texture=new C,this.depthBuffer=!0,this.stencilBuffer=!0}function ge(){P.call(this),this.type=Pe.GROUP}function Me(){P.call(this),this.type=Pe.LIGHT,this.lightType="",this.color=new y(16777215),this.intensity=1}function xe(){Me.call(this),this.lightType=Fe.AMBIENT}function Ee(){this.camera=new ne,this.matrix=new s,this.bias=3e-4,this.radius=2,this.cameraNear=1,this.cameraFar=500,this.mapSize=new p(512,512),this.renderTarget=null,this.map=null}function ye(){Ee.call(this),this.camera.frustumCulled=!1,this.renderTarget=new ve(this.mapSize.x,this.mapSize.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=Xe.LINEAR,this.map=t,this.windowSize=500,this._lookTarget=new o,this._up=new o(0,1,0)}function Te(){Me.call(this),this.lightType=Fe.DIRECT,this.shadow=new ye}function Se(){Ee.call(this),this.renderTarget=new ae(this.mapSize.x,this.mapSize.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=Xe.LINEAR,this.map=t,this._targets=[new o(1,0,0),new o(-1,0,0),new o(0,1,0),new o(0,-1,0),new o(0,0,1),new o(0,0,-1)],this._ups=[new o(0,-1,0),new o(0,-1,0),new o(0,0,1),new o(0,0,-1),new o(0,-1,0),new o(0,-1,0)],this._lookTarget=new o}function be(){Me.call(this),this.lightType=Fe.POINT,this.decay=1,this.distance=200,this.shadow=new Se}function we(){Ee.call(this),this.renderTarget=new ve(this.mapSize.x,this.mapSize.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=Xe.LINEAR,this.map=t,this._lookTarget=new o,this._up=new o(0,1,0)}function Ae(){Me.call(this),this.lightType=Fe.SPOT,this.decay=1,this.distance=200,this.penumbra=0,this.angle=Math.PI/6,this.shadow=new we}function Ne(t,e){de.call(this,t,e),this.type=Pe.SKINNED_MESH,this.skeleton=void 0,this.bindMode="attached",this.bindMatrix=new s,this.bindMatrixInverse=new s}var Le=function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,i[r]=e[19===r?3&t|8:t]);return i.join("")}}(),Ce=function(){if(!window.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")}(),Re=!!document,Pe={MESH:"mesh",SKINNED_MESH:"skinned_mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group",CANVAS2D:"canvas2d"},Fe={AMBIENT:"ambient",DIRECT:"direct",POINT:"point",SPOT:"spot"},Oe={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",PBR:"pbr",POINT:"point",LINE:"line",LINE_LOOP:"lineloop",LINE_DASHED:"linedashed",CANVAS2D:"canvas2d",SHADER:"shader",DEPTH:"depth",DISTANCE:"distance"},Ue={NORMAL:"normal",EXP2:"exp2"},Ie={NONE:"none",NORMAL:"normal",ADD:"add",CUSTOM:"custom"},De={ADD:32774,SUBTRACT:32778,REVERSE_SUBTRACT:32779},ze={ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775},Be={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"},Ge={FRONT:"front",BACK:"back",DOUBLE:"double"},ke={SMOOTH_SHADING:"smooth_shading",FLAT_SHADING:"flat_shading"},He={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067},Ve={DEPTH_COMPONENT:6402,DEPTH_STENCIL:34041,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,RGBA16F:34842,RGBA32F:34836,DEPTH_COMPONENT24:33190,DEPTH_COMPONENT32F:36012,DEPTH24_STENCIL8:35056,DEPTH32F_STENCIL8:36013},je={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:36193,HALF_FLOAT2:5131,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FLOAT_32_UNSIGNED_INT_24_8_REV:36269},Xe={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},We={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648},Ye={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,BYTE:65535,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126},qe={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FLOAT:5126,BYTE:65535,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ze={HARD:"hard",PCF_SOFT:"pcf_soft"},Ke={LINEAR:"linear",SRGB:"sRGB",RGBE:"RGBE",RGBM7:"RGBM7",RGBM16:"RGBM16",RGBD:"RGBD",GAMMA:"Gamma"},Qe={MULTIPLY:"ENVMAP_BLENDING_MULTIPLY",MIX:"ENVMAP_BLENDING_MIX",ADD:"ENVMAP_BLENDING_ADD"},Je={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},$e={COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:577040,COLOR_ATTACHMENT11:577041,COLOR_ATTACHMENT12:577042,COLOR_ATTACHMENT13:577043,COLOR_ATTACHMENT14:577044,COLOR_ATTACHMENT15:577045,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306},ti={DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868};Object.assign(a.prototype,{addEventListener:function(t,e,i){var n=this.eventMap[t];n||(n=this.eventMap[t]=[]),n.push({listener:e,thisObject:i||this})},removeEventListener:function(t,e,i){var n=this.eventMap[t];if(n)for(var r=0,a=n.length;r<a;r++){var s=n[r];if(s.listener==e&&s.thisObject==(i||this)){n.splice(r,1);break}}},dispatchEvent:function(t){t.target=this,this.notifyListener(t)},notifyListener:function(t){var e=this.eventMap[t.type];if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];r.listener.call(r.thisObject,t)}}}),Object.assign(s.prototype,{identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},set:function(t,e,i,n,r,a,s,o,u,h,c,l,d,p,f,_){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=n,m[1]=r,m[5]=a,m[9]=s,m[13]=o,m[2]=u,m[6]=h,m[10]=c,m[14]=l,m[3]=d,m[7]=p,m[11]=f,m[15]=_,this},copy:function(t){return this.elements.set(t.elements),this},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[4],o=i[8],u=i[12],h=i[1],c=i[5],l=i[9],d=i[13],p=i[2],f=i[6],_=i[10],m=i[14],v=i[3],g=i[7],M=i[11],x=i[15],E=n[0],y=n[4],T=n[8],S=n[12],b=n[1],w=n[5],A=n[9],N=n[13],L=n[2],C=n[6],R=n[10],P=n[14],F=n[3],O=n[7],U=n[11],I=n[15];return r[0]=a*E+s*b+o*L+u*F,r[4]=a*y+s*w+o*C+u*O,r[8]=a*T+s*A+o*R+u*U,r[12]=a*S+s*N+o*P+u*I,r[1]=h*E+c*b+l*L+d*F,r[5]=h*y+c*w+l*C+d*O,r[9]=h*T+c*A+l*R+d*U,r[13]=h*S+c*N+l*P+d*I,r[2]=p*E+f*b+_*L+m*F,r[6]=p*y+f*w+_*C+m*O,r[10]=p*T+f*A+_*R+m*U,r[14]=p*S+f*N+_*P+m*I,r[3]=v*E+g*b+M*L+x*F,r[7]=v*y+g*w+M*C+x*O,r[11]=v*T+g*A+M*R+x*U,r[15]=v*S+g*N+M*P+x*I,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},inverse:function(){return this.getInverse(this)},getInverse:function(t){var e=this.elements,i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],u=i[5],h=i[6],c=i[7],l=i[8],d=i[9],p=i[10],f=i[11],_=i[12],m=i[13],v=i[14],g=i[15],M=d*v*c-m*p*c+m*h*f-u*v*f-d*h*g+u*p*g,x=_*p*c-l*v*c-_*h*f+o*v*f+l*h*g-o*p*g,E=l*m*c-_*d*c+_*u*f-o*m*f-l*u*g+o*d*g,y=_*d*h-l*m*h-_*u*p+o*m*p+l*u*v-o*d*v,T=n*M+r*x+a*E+s*y;if(0===T)return console.warn("can't invert matrix, determinant is 0"),this.identity();var S=1/T;return e[0]=M*S,e[1]=(m*p*s-d*v*s-m*a*f+r*v*f+d*a*g-r*p*g)*S,e[2]=(u*v*s-m*h*s+m*a*c-r*v*c-u*a*g+r*h*g)*S,e[3]=(d*h*s-u*p*s-d*a*c+r*p*c+u*a*f-r*h*f)*S,e[4]=x*S,e[5]=(l*v*s-_*p*s+_*a*f-n*v*f-l*a*g+n*p*g)*S,e[6]=(_*h*s-o*v*s-_*a*c+n*v*c+o*a*g-n*h*g)*S,e[7]=(o*p*s-l*h*s+l*a*c-n*p*c-o*a*f+n*h*f)*S,e[8]=E*S,e[9]=(_*d*s-l*m*s-_*r*f+n*m*f+l*r*g-n*d*g)*S,e[10]=(o*m*s-_*u*s+_*r*c-n*m*c-o*r*g+n*u*g)*S,e[11]=(l*u*s-o*d*s-l*r*c+n*d*c+o*r*f-n*u*f)*S,e[12]=y*S,e[13]=(l*m*a-_*d*a+_*r*p-n*m*p-l*r*v+n*d*v)*S,e[14]=(_*u*a-o*m*a-_*r*h+n*m*h+o*r*v-n*u*v)*S,e[15]=(o*d*a-l*u*a+l*r*h-n*d*h-o*r*p+n*u*p)*S,this},transform:function(){var t=new s;return function(e,i,n){var r=n.toMatrix4(t).elements,a=this.elements;return a[0]=r[0]*i.x,a[1]=r[1]*i.x,a[2]=r[2]*i.x,a[3]=0,a[4]=r[4]*i.y,a[5]=r[5]*i.y,a[6]=r[6]*i.y,a[7]=0,a[8]=r[8]*i.z,a[9]=r[9]*i.z,a[10]=r[10]*i.z,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}}(),makeRotationFromQuaternion:function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,a=t.w,s=i+i,o=n+n,u=r+r,h=i*s,c=i*o,l=i*u,d=n*o,p=n*u,f=r*u,_=a*s,m=a*o,v=a*u;return e[0]=1-(d+f),e[4]=c-v,e[8]=l+m,e[1]=c+v,e[5]=1-(h+f),e[9]=p-_,e[2]=l-m,e[6]=p+_,e[10]=1-(h+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAtRH:function(){var t=new o,e=new o,i=new o;return function(n,r,a){var s=this.elements;return i.subVectors(n,r),0===i.getLengthSquared()&&(i.z=1),i.normalize(),t.crossVectors(a,i),0===t.getLengthSquared()&&(1===Math.abs(a.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),t.crossVectors(a,i)),t.normalize(),e.crossVectors(i,t),s[0]=t.x,s[4]=e.x,s[8]=i.x,s[1]=t.y,s[5]=e.y,s[9]=i.y,s[2]=t.z,s[6]=e.z,s[10]=i.z,this}}(),decompose:function(){var t=new o,e=new s;return function(i,n,r){var a=this.elements,s=t.set(a[0],a[1],a[2]).getLength(),o=t.set(a[4],a[5],a[6]).getLength(),u=t.set(a[8],a[9],a[10]).getLength();this.determinant()<0&&(s=-s),i.x=a[12],i.y=a[13],i.z=a[14],e.elements.set(this.elements);var h=1/s,c=1/o,l=1/u;return e.elements[0]*=h,e.elements[1]*=h,e.elements[2]*=h,e.elements[4]*=c,e.elements[5]*=c,e.elements[6]*=c,e.elements[8]*=l,e.elements[9]*=l,e.elements[10]*=l,n.setFromRotationMatrix(e),r.x=s,r.y=o,r.z=u,this}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],s=t[5],o=t[9],u=t[13],h=t[2],c=t[6],l=t[10],d=t[14];return t[3]*(+r*o*c-n*u*c-r*s*l+i*u*l+n*s*d-i*o*d)+t[7]*(+e*o*d-e*u*l+r*a*l-n*a*d+n*u*h-r*o*h)+t[11]*(+e*u*c-e*s*d-r*a*c+i*a*d+r*s*h-i*u*h)+t[15]*(-n*s*h-e*o*c+e*s*l+n*a*c-i*a*l+i*o*h)},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),Object.assign(o.prototype,{lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},set:function(t,e,i){return this.x=t||0,this.y=e||0,this.z=i||0,this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},getLength:function(){return Math.sqrt(this.getLengthSquared())},getLengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(t){t=t||1;var e=this.getLength();if(0!=e){var i=t/e;return this.x*=i,this.y*=i,this.z*=i,this}},subtract:function(t,e){return e||(e=new o),e.set(this.x-t.x,this.y-t.y,this.z-t.z),e},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this},cross:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t._x,a=t._y,s=t._z,o=t._w,u=o*e+a*n-s*i,h=o*i+s*e-r*n,c=o*n+r*i-a*e,l=-r*e-a*i-s*n;return this.x=u*o+l*-r+h*-s-c*-a,this.y=h*o+l*-a+c*-r-u*-s,this.z=c*o+l*-s+u*-a-h*-r,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],this},applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},unproject:function(){var t;return function(e){return void 0===t&&(t=new s),t.multiplyMatrices(e.worldMatrix,t.getInverse(e.projectionMatrix)),this.applyProjection(t)}}(),applyProjection:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new o(this.x,this.y,this.z)}}),Object.assign(u.prototype,{set:function(t,e){this.origin.copy(t),this.direction.copy(e)},at:function(t,e){return(e||new o).copy(this.direction).multiplyScalar(t).add(this.origin)},intersectsSphere:function(){var t=new o;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,a=e.radius*e.radius;if(r>a)return null;var s=Math.sqrt(a-r),o=n-s,u=n+s;return o<0&&u<0?null:o<0?this.at(u,i):this.at(o,i)}}(),intersectsBox:function(t,e){var i,n,r,a,s,o,u=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,l=this.origin;return u>=0?(i=(t.min.x-l.x)*u,n=(t.max.x-l.x)*u):(i=(t.max.x-l.x)*u,n=(t.min.x-l.x)*u),h>=0?(r=(t.min.y-l.y)*h,a=(t.max.y-l.y)*h):(r=(t.max.y-l.y)*h,a=(t.min.y-l.y)*h),i>a||r>n?null:((r>i||i!==i)&&(i=r),(a<n||n!==n)&&(n=a),c>=0?(s=(t.min.z-l.z)*c,o=(t.max.z-l.z)*c):(s=(t.max.z-l.z)*c,o=(t.min.z-l.z)*c),i>o||s>n?null:((s>i||i!==i)&&(i=s),(o<n||n!==n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))},intersectTriangle:function(){var t=new o,e=new o,i=new o,n=new o;return function(r,a,s,o,u){e.subVectors(a,r),i.subVectors(s,r),n.crossVectors(e,i);var h,c=this.direction.dot(n);if(c>0){if(o)return null;h=1}else{if(!(c<0))return null;h=-1,c=-c}t.subVectors(this.origin,r);var l=h*this.direction.dot(i.crossVectors(t,i));if(l<0)return null;var d=h*this.direction.dot(e.cross(t));if(d<0)return null;if(l+d>c)return null;var p=-h*t.dot(n);return p<0?null:this.at(p/c,u)}}(),copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this}}),Object.assign(h.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){this.ray.origin.setFromMatrixPosition(e.worldMatrix),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()},intersectObject:function(t,e){var i=[];return l(t,this,i,e),i.sort(c),i},intersectObjects:function(t,e){var i=[];if(!1===Array.isArray(t))return console.warn("Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=t.length;n<r;n++)l(t[n],this,i,e);return i.sort(c),i}}),d.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],d.DefaultOrder="XYZ",Object.defineProperties(d.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),Object.assign(d.prototype,{copyFrom:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},set:function(t,e,i,n){return this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||this._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=function(t,e,i){return Math.max(e,Math.min(i,t))},r=t.elements,a=r[0],s=r[4],o=r[8],u=r[1],h=r[5],c=r[9],l=r[2],d=r[6],p=r[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(o,p),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===e?(this._y=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===e?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,p))):"XZY"===e?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("given unsupported order: "+e),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new s;return function(e,i,n){return e.toMatrix4(t),this.setFromRotationMatrix(t,i,n)}}(),onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(p.prototype,{set:function(t,e){return this.x=t||0,this.y=e||0,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},getLength:function(){return Math.sqrt(this.getLengthSquared())},getLengthSquared:function(){return this.x*this.x+this.y*this.y},normalize:function(t){t=t||1;var e=this.getLength();if(0!=e){var i=t/e;return this.x*=i,this.y*=i,this}},subtract:function(t,e){return e||(e=new p),e.set(this.x-t.x,this.y-t.y),e},copy:function(t){return this.x=t.x,this.y=t.y,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},add:function(t){return this.x+=t.x,this.y+=t.y,this},clone:function(){return new p(this.x,this.y)}}),Object.assign(f.prototype,{lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},set:function(t,e,i,n){return this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1,this},normalize:function(){return this.multiplyScalar(1/(this.getLength()||1))},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},getLengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}}),Object.assign(_.prototype,{identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},inverse:function(){return this.getInverse(this)},getInverse:function(t){var e=t.elements,i=this.elements,n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],c=e[7],l=e[8],d=l*o-u*c,p=u*h-l*s,f=c*s-o*h,_=n*d+r*p+a*f;if(0===_){return console.warn("zen3d.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()}var m=1/_;return i[0]=d*m,i[1]=(a*c-l*r)*m,i[2]=(u*r-a*o)*m,i[3]=p*m,i[4]=(l*n-a*h)*m,i[5]=(a*s-u*n)*m,i[6]=f*m,i[7]=(r*h-c*n)*m,i[8]=(o*n-r*s)*m,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},set:function(t,e,i,n,r,a,s,o,u){var h=this.elements;return h[0]=t,h[3]=e,h[6]=i,h[1]=n,h[4]=r,h[7]=a,h[2]=s,h[5]=o,h[8]=u,this},copy:function(t){return this.elements.set(t.elements),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[3],o=i[6],u=i[1],h=i[4],c=i[7],l=i[2],d=i[5],p=i[8],f=n[0],_=n[3],m=n[6],v=n[1],g=n[4],M=n[7],x=n[2],E=n[5],y=n[8];return r[0]=a*f+s*v+o*x,r[3]=a*_+s*g+o*E,r[6]=a*m+s*M+o*y,r[1]=u*f+h*v+c*x,r[4]=u*_+h*g+c*E,r[7]=u*m+h*M+c*y,r[2]=l*f+d*v+p*x,r[5]=l*_+d*g+p*E,r[8]=l*m+d*M+p*y,this},transform:function(t,e,i,n,r,a,s){var o=this.elements,u=1,h=0;if(r%360){var c=r;u=Math.cos(c),h=Math.sin(c)}return o[0]=u*i,o[3]=-h*n,o[6]=t,o[1]=h*i,o[4]=u*n,o[7]=e,o[2]=0,o[5]=0,o[8]=1,(a||s)&&(o[6]-=a*o[0]+s*o[3],o[7]-=a*o[1]+s*o[4]),this},setUvTransform:function(t,e,i,n,r,a,s){var o=Math.cos(r),u=Math.sin(r);this.set(i*o,i*u,-i*(o*a+u*s)+a+t,-n*u,n*o,-n*(-u*a+o*s)+s+e,0,0,1)},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}}),Object.defineProperties(m.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(m.prototype,{normalize:function(t){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},lerpQuaternions:function(t,e,i){var n=t._w,r=t._x,a=t._y,s=t._z,o=e._w,u=e._x,h=e._y,c=e._z,l=n*o+r*u+a*h+s*c;l<0&&(l=-l,o=-o,u=-u,h=-h,c=-c),this._w=n+i*(o-n),this._x=r+i*(u-r),this._y=a+i*(h-a),this._z=s+i*(c-s);var d=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);return this._w*=d,this._x*=d,this._y*=d,this._z*=d,this.onChangeCallback(),this},slerpQuaternions:function(t,e,i){var n=t._w,r=t._x,a=t._y,s=t._z,o=e._w,u=e._x,h=e._y,c=e._z,l=n*o+r*u+a*h+s*c;if(l<0&&(l=-l,o=-o,u=-u,h=-h,c=-c),l<.95){var d=Math.acos(l),p=1/Math.sin(d),f=Math.sin(d*(1-i))*p,_=Math.sin(d*i)*p;this._w=n*f+o*_,this._x=r*f+u*_,this._y=a*f+h*_,this._z=s*f+c*_}else{this._w=n+i*(o-n),this._x=r+i*(u-r),this._y=a+i*(h-a),this._z=s+i*(c-s);var m=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);this._w*=m,this._x*=m,this._y*=m,this._z*=m}return this.onChangeCallback(),this},set:function(t,e,i,n){return this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1,this.onChangeCallback(),this},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=void 0!==t.w?t.w:1,this.onChangeCallback(),this},setFromEuler:function(t,e){var i=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),a=Math.sin(t._x/2),s=Math.sin(t._y/2),o=Math.sin(t._z/2),u=t._order;return"XYZ"===u?(this._x=a*n*r+i*s*o,this._y=i*s*r-a*n*o,this._z=i*n*o+a*s*r,this._w=i*n*r-a*s*o):"YXZ"===u?(this._x=a*n*r+i*s*o,this._y=i*s*r-a*n*o,this._z=i*n*o-a*s*r,this._w=i*n*r+a*s*o):"ZXY"===u?(this._x=a*n*r-i*s*o,this._y=i*s*r+a*n*o,this._z=i*n*o+a*s*r,this._w=i*n*r-a*s*o):"ZYX"===u?(this._x=a*n*r-i*s*o,this._y=i*s*r+a*n*o,this._z=i*n*o-a*s*r,this._w=i*n*r+a*s*o):"YZX"===u?(this._x=a*n*r+i*s*o,this._y=i*s*r+a*n*o,this._z=i*n*o-a*s*r,this._w=i*n*r-a*s*o):"XZY"===u&&(this._x=a*n*r-i*s*o,this._y=i*s*r-a*n*o,this._z=i*n*o+a*s*r,this._w=i*n*r+a*s*o),!1!==e&&this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,n=i[0],r=i[4],a=i[8],s=i[1],o=i[5],u=i[9],h=i[2],c=i[6],l=i[10],d=n+o+l;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(c-u)*e,this._y=(a-h)*e,this._z=(s-r)*e):n>o&&n>l?(e=2*Math.sqrt(1+n-o-l),this._w=(c-u)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(a+h)/e):o>l?(e=2*Math.sqrt(1+o-n-l),this._w=(a-h)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(u+c)/e):(e=2*Math.sqrt(1+l-n-o),this._w=(s-r)/e,this._x=(a+h)/e,this._y=(u+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new o;return function(i,n){return void 0===e&&(e=new o),(t=i.dot(n)+1)<1e-6?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,n),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),multiply:function(t){return this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,a=t._w,s=e._x,o=e._y,u=e._z,h=e._w;return this._x=i*h+a*s+n*u-r*o,this._y=n*h+a*o+r*s-i*u,this._z=r*h+a*u+i*o-n*s,this._w=a*h-i*s-n*o-r*u,this.onChangeCallback(),this},toMatrix4:function(t){t||(t=new s);var e=t.elements,i=2*this._x*this._y,n=2*this._x*this._z,r=2*this._x*this._w,a=2*this._y*this._z,o=2*this._y*this._w,u=2*this._z*this._w,h=this._x*this._x,c=this._y*this._y,l=this._z*this._z,d=this._w*this._w;return e[0]=h-c-l+d,e[4]=i-u,e[8]=n+o,e[12]=0,e[1]=i+u,e[5]=-h+c-l+d,e[9]=a-r,e[13]=0,e[2]=n-o,e[6]=a+r,e[10]=-h-c+l+d,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),Object.assign(m,{slerpFlat:function(t,e,i,n,r,a,s){var o=i[n+0],u=i[n+1],h=i[n+2],c=i[n+3],l=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(c!==f||o!==l||u!==d||h!==p){var _=1-s,m=o*l+u*d+h*p+c*f,v=m>=0?1:-1,g=1-m*m;if(g>Number.EPSILON){var M=Math.sqrt(g),x=Math.atan2(M,m*v);_=Math.sin(_*x)/M,s=Math.sin(s*x)/M}var E=s*v;if(o=o*_+l*E,u=u*_+d*E,h=h*_+p*E,c=c*_+f*E,_===1-s){var y=1/Math.sqrt(o*o+u*u+h*h+c*c);o*=y,u*=y,h*=y,c*=y}}t[e]=o,t[e+1]=u,t[e+2]=h,t[e+3]=c}}),Object.assign(v.prototype,{set:function(t,e,i,n){this.min.set(t,e),this.max.set(i,n)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}}),Object.assign(g.prototype,{set:function(t,e){this.min.copy(t),this.max.copy(e)},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},setFromArray:function(t,e){for(var i=1/0,n=1/0,r=1/0,a=-1/0,s=-1/0,o=-1/0,u=void 0!==e?e:3,h=0,c=t.length;h<c;h+=u){var l=t[h],d=t[h+1],p=t[h+2];l<i&&(i=l),d<n&&(n=d),p<r&&(r=p),l>a&&(a=l),d>s&&(s=d),p>o&&(o=p)}return this.min.set(i,n,r),this.max.set(a,s,o),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},getCenter:function(t){var e=t||new o;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},applyMatrix4:function(){var t=[new o,new o,new o,new o,new o,new o,new o,new o];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}}),Object.assign(M.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromArray:function(){var t=new g,e=new o;return function(i,n){var r=void 0!==n?n:3,a=this.center;t.setFromArray(i,r).getCenter(a);for(var s=0,o=0,u=i.length;o<u;o+=r){var h=i[o],c=i[o+1],l=i[o+2];e.set(h,c,l),s=Math.max(s,a.distanceToSquared(e))}return this.radius=Math.sqrt(s),this}}(),applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},getBoundingBox:function(t){var e=t||new g;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},clone:function(){return(new M).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this}}),Object.assign(x.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},normalize:function(){var t=1/this.normal.getLength();return this.normal.multiplyScalar(t),this.constant*=t,this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},coplanarPoint:function(t){return(t||new o).copy(this.normal).multiplyScalar(-this.constant)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},applyMatrix4:function(){var t=new o,e=new _;return function(i,n){var r=n||e.setFromMatrix4(i).inverse().transpose(),a=this.coplanarPoint(t).applyMatrix4(i),s=this.normal.applyMatrix3(r).normalize();return this.constant=-a.dot(s),this}}()}),Object.assign(E.prototype,{set:function(t,e,i,n,r,a){var s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this},setFromMatrix:function(t){var e=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],u=i[5],h=i[6],c=i[7],l=i[8],d=i[9],p=i[10],f=i[11],_=i[12],m=i[13],v=i[14],g=i[15];return e[0].setComponents(s-n,c-o,f-l,g-_).normalize(),e[1].setComponents(s+n,c+o,f+l,g+_).normalize(),e[2].setComponents(s+r,c+u,f+d,g+m).normalize(),e[3].setComponents(s-r,c-u,f-d,g-m).normalize(),e[4].setComponents(s-a,c-h,f-p,g-v).normalize(),e[5].setComponents(s+a,c+h,f+p,g+v).normalize(),this},intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;r<6;r++)if(e[r].distanceToPoint(i)<n)return!1;return!0},intersectsBox:function(){var t=new o,e=new o;return function(i){for(var n=this.planes,r=0;r<6;r++){var a=n[r];t.x=a.normal.x>0?i.min.x:i.max.x,e.x=a.normal.x>0?i.max.x:i.min.x,t.y=a.normal.y>0?i.min.y:i.max.y,e.y=a.normal.y>0?i.max.y:i.min.y,t.z=a.normal.z>0?i.min.z:i.max.z,e.z=a.normal.z>0?i.max.z:i.min.z;var s=a.distanceToPoint(t),o=a.distanceToPoint(e);if(s<0&&o<0)return!1}return!0}}()}),Object.assign(y.prototype,{lerpColors:function(t,e,i){this.r=i*(e.r-t.r)+t.r,this.g=i*(e.g-t.g)+t.g,this.b=i*(e.b-t.b)+t.b,this.r=this.r,this.g=this.g,this.b=this.b},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},setHSL:function(){function t(t,e){return(t%e+e)%e}function e(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}return function(i,n,r){if(i=t(i,1),n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r)),0===n)this.r=this.g=this.b=r;else{var a=r<=.5?r*(1+n):r+n-r*n,s=2*r-a;this.r=e(s,a,i+1/3),this.g=e(s,a,i),this.b=e(s,a,i-1/3)}return this}}(),fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}}),Object.assign(T.prototype,{set:function(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}}),T.normal=function(){var t=new o;return function(e,i,n,r){var a=r||new o;a.subVectors(n,i),t.subVectors(e,i),a.cross(t);var s=a.getLengthSquared();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),T.barycoordFromPoint=function(){var t=new o,e=new o,i=new o;return function(n,r,a,s,u){t.subVectors(s,r),e.subVectors(a,r),i.subVectors(n,r);var h=t.dot(t),c=t.dot(e),l=t.dot(i),d=e.dot(e),p=e.dot(i),f=h*d-c*c,_=u||new o;if(0===f)return _.set(-2,-1,-1);var m=1/f,v=(d*l-c*p)*m,g=(h*p-c*l)*m;return _.set(1-v-g,g,v)}}(),T.containsPoint=function(){var t=new o;return function(e,i,n,r){var a=T.barycoordFromPoint(e,i,n,r,t);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),Object.assign(S.prototype,{set:function(t,e){this.posPoints=t,this.ctrlPoints=e,t.length!==e.length&&console.warn("Curve: posPoints and ctrlPoints's length not equal!"),this.segCount=t.length-1},calc:function(){var t=new p,e=new p,i=new p,n=new p;return function(r){for(var a=0;a<this.segCount;a++)if(r>=this.posPoints[a].x&&r<=this.posPoints[a+1].x){t.copy(this.posPoints[a]),i.copy(this.posPoints[a+1]),e.copy(this.ctrlPoints[a]),n.copy(this.ctrlPoints[a+1]);break}return t||t.copy(this.posPoints[this.posPoints.length-1]),e||e.copy(this.ctrlPoints[this.ctrlPoints.length-1]),i.copy(i||t),n.copy(n||e),r=(r-t.x)/(i.x-t.x),this._cubic_bezier(t.y,e.y,n.y,i.y,r)}}(),averageXSampler:function(t){t<2&&console.warn("Curve: sampler num less than 2!");for(var e=[],i=this.posPoints[0].x,n=this.posPoints[this.posPoints.length-1].x,r=(n-i)/(t-1),a=0,s=0;s<t;s++)a=s===t-1?n:i+s*r,e.push(a,this.calc(a));return e},_cubic_bezier:function(t,e,i,n,r){return t=this._mix(t,e,r),e=this._mix(e,i,r),i=this._mix(i,n,r),t=this._mix(t,e,r),e=this._mix(e,i,r),t=this._mix(t,e,r)},_mix:function(t,e,i){return t*(1-i)+e*i}}),Object.assign(b.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},clone:function(){return(new this.constructor).copy(this)},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.radius=t.getLength(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(1,Math.max(-1,t.y/this.radius)))),this}}),w.prototype=Object.assign(Object.create(a.prototype),{constructor:w,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.textureType=t.textureType,this.border=t.border,this.format=t.format,this.type=t.type,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.anisotropy=t.anisotropy,this.generateMipmaps=t.generateMipmaps,this.encoding=t.encoding,this.flipY=t.flipY,this.version=t.version,this},dispose:function(){this.dispatchEvent({type:"dispose"}),this.version=0}}),Object.assign(A.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=document.createElementNS("http://www.w3.org/1999/xhtml","img");return r.addEventListener("load",function(){e&&e(this)},!1),r.addEventListener("error",function(t){n&&n(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(r.crossOrigin=this.crossOrigin),r.src=t,r},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),Object.assign(N.prototype,{load:function(t,e,i,n){void 0===t&&(t=""),void 0!=this.path&&(t=this.path+t);var r=/^data:(.*?)(;base64)?,(.*)$/,a=t.match(r);if(a){var s=a[1],o=!!a[2],u=a[3];u=window.decodeURIComponent(u),o&&(u=window.atob(u));try{var h,c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":h=new ArrayBuffer(u.length);for(var l=new Uint8Array(h),d=0;d<u.length;d++)l[d]=u.charCodeAt(d);"blob"===c&&(h=new Blob([h],{type:s}));break;case"document":var p=new DOMParser;h=p.parseFromString(u,s);break;case"json":h=JSON.parse(u);break;default:h=u}window.setTimeout(function(){e&&e(h)},0)}catch(t){window.setTimeout(function(){n&&n(t)},0)}}else{var f=new XMLHttpRequest;f.open("GET",t,!0),f.addEventListener("load",function(t){var i=t.target.response;200===this.status?e&&e(i):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),e&&e(i)):n&&n(t)},!1),void 0!==i&&f.addEventListener("progress",function(t){i(t)},!1),void 0!==n&&f.addEventListener("error",function(t){n(t)},!1),void 0!==this.responseType&&(f.responseType=this.responseType),void 0!==this.withCredentials&&(f.withCredentials=this.withCredentials),f.overrideMimeType&&f.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var _ in this.requestHeader)f.setRequestHeader(_,this.requestHeader[_]);f.send(null)}},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),Object.assign(L.prototype,{load:function(t,e,i,n){var r=this,a=new N;a.setResponseType("arraybuffer"),a.load(t,function(t){void 0!==e&&e(r.parse(t))},i,n)},parse:function(t){function e(t,e,i,n,r,a,s,o,u){var h,c,l,d=u,p=0,f=y.width;for(l=e;l!==n;l+=i)for(c=r;c!==s;c+=a,p++)h=o[p],t[4*(c+f*l)+3]=255,t[4*(c+f*l)+2]=d[3*h+0],t[4*(c+f*l)+1]=d[3*h+1],t[4*(c+f*l)+0]=d[3*h+2];return t}function i(t,e,i,n,r,a,s,o){var u,h,c,l=0,d=y.width;for(c=e;c!==n;c+=i)for(h=r;h!==s;h+=a,l+=2)u=o[l+0]+(o[l+1]<<8),t[4*(h+d*c)+0]=(31744&u)>>7,t[4*(h+d*c)+1]=(992&u)>>2,t[4*(h+d*c)+2]=(31&u)>>3,t[4*(h+d*c)+3]=32768&u?0:255;return t}function n(t,e,i,n,r,a,s,o){var u,h,c=0,l=y.width;for(h=e;h!==n;h+=i)for(u=r;u!==s;u+=a,c+=3)t[4*(u+l*h)+3]=255,t[4*(u+l*h)+2]=o[c+0],t[4*(u+l*h)+1]=o[c+1],t[4*(u+l*h)+0]=o[c+2];return t}function r(t,e,i,n,r,a,s,o){var u,h,c=0,l=y.width;for(h=e;h!==n;h+=i)for(u=r;u!==s;u+=a,c+=4)t[4*(u+l*h)+2]=o[c+0],t[4*(u+l*h)+1]=o[c+1],t[4*(u+l*h)+0]=o[c+2],t[4*(u+l*h)+3]=o[c+3];return t}function a(t,e,i,n,r,a,s,o){var u,h,c,l=0,d=y.width;for(c=e;c!==n;c+=i)for(h=r;h!==s;h+=a,l++)u=o[l],t[4*(h+d*c)+0]=u,t[4*(h+d*c)+1]=u,t[4*(h+d*c)+2]=u,t[4*(h+d*c)+3]=255;return t}function s(t,e,i,n,r,a,s,o){var u,h,c=0,l=y.width;for(h=e;h!==n;h+=i)for(u=r;u!==s;u+=a,c+=2)t[4*(u+l*h)+0]=o[c+0],t[4*(u+l*h)+1]=o[c+0],t[4*(u+l*h)+2]=o[c+0],t[4*(u+l*h)+3]=o[c+1];return t}var o=0,u=1,h=2,c=3,l=9,d=10,p=11,f=48,_=4,m=0,v=1,g=2,M=3;t.length<19&&console.error("TGALoader.parse: Not enough data to contain header.");var x=new Uint8Array(t),E=0,y={id_length:x[E++],colormap_type:x[E++],image_type:x[E++],colormap_index:x[E++]|x[E++]<<8,colormap_length:x[E++]|x[E++]<<8,colormap_size:x[E++],origin:[x[E++]|x[E++]<<8,x[E++]|x[E++]<<8],width:x[E++]|x[E++]<<8,height:x[E++]|x[E++]<<8,pixel_size:x[E++],flags:x[E++]};!function(t){switch(t.image_type){case u:case l:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case h:case c:case d:case p:t.colormap_type&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case o:console.error("TGALoader.parse.tgaCheckHeader: No data");default:console.error('TGALoader.parse.tgaCheckHeader: Invalid type " '+t.image_type+'"')}(t.width<=0||t.height<=0)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+t.pixel_size+'"')}(y),y.id_length+E>t.length&&console.error("TGALoader.parse: No data"),E+=y.id_length;var T=!1,S=!1,b=!1;switch(y.image_type){case l:T=!0,S=!0;break;case u:S=!0;break;case d:T=!0;break;case h:break;case p:T=!0,b=!0;break;case c:b=!0}var w=document.createElement("canvas");w.width=y.width,w.height=y.height;var A=w.getContext("2d"),N=A.createImageData(y.width,y.height),L=function(t,e,i,n,r){var a,s,o,u;if(s=i.pixel_size>>3,o=i.width*i.height*s,e&&(u=r.subarray(n,n+=i.colormap_length*(i.colormap_size>>3))),t){a=new Uint8Array(o);for(var h,c,l,d=0,p=new Uint8Array(s);d<o;)if(h=r[n++],c=1+(127&h),128&h){for(l=0;l<s;++l)p[l]=r[n++];for(l=0;l<c;++l)a.set(p,d+l*s);d+=s*c}else{for(c*=s,l=0;l<c;++l)a[d+l]=r[n++];d+=c}}else a=r.subarray(n,n+=e?i.width*i.height:o);return{pixel_data:a,palettes:u}}(T,S,y,E,x);!function(t,o,u,h,c){var l,d,p,x,E,T;switch((y.flags&f)>>_){default:case g:l=0,p=1,E=o,d=0,x=1,T=u;break;case m:l=0,p=1,E=o,d=u-1,x=-1,T=-1;break;case M:l=o-1,p=-1,E=-1,d=0,x=1,T=u;break;case v:l=o-1,p=-1,E=-1,d=u-1,x=-1,T=-1}if(b)switch(y.pixel_size){case 8:a(t,d,x,T,l,p,E,h);break;case 16:s(t,d,x,T,l,p,E,h);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}else switch(y.pixel_size){case 8:e(t,d,x,T,l,p,E,h,c);break;case 16:i(t,d,x,T,l,p,E,h);break;case 24:n(t,d,x,T,l,p,E,h);break;case 32:r(t,d,x,T,l,p,E,h);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}}(N.data,y.width,y.height,L.pixel_data,L.palettes);return A.putImageData(N,0,0),w}}),C.prototype=Object.assign(Object.create(w.prototype),{constructor:C,copy:function(t){return w.prototype.copy.call(this,t),this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this},updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}}),C.fromImage=function(t){var e=new C;return e.image=t,e.version++,e},C.fromSrc=function(t){var e=new C,i=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);return(t.search(/\.(tga)$/)>0||0===t.search(/^data\:image\/tga/)?new L:new A).load(t,function(t){e.format=i?Ve.RGB:Ve.RGBA,e.image=t,e.version++,e.dispatchEvent({type:"onload"})}),e},R.prototype=Object.assign(Object.create(w.prototype),{constructor:R,copy:function(t){return w.prototype.copy.call(this,t),this.images=t.images.slice(0),this}}),R.fromImage=function(t){for(var e=new R,i=e.images,n=0;n<6;n++)i[n]=t[n];return e.version++,e},R.fromSrc=function(t){function e(n){n&&(r.push(n),u++),u>=6?i():(o?new L:new A).load(t[u],e)}function i(){n.format=s?Ve.RGB:Ve.RGBA,n.version++,n.dispatchEvent({type:"onload"})}var n=new R,r=n.images,a=t[0],s=a.search(/\.(jpg|jpeg)$/)>0||0===a.search(/^data\:image\/jpeg/),o=a.search(/\.(tga)$/)>0||0===a.search(/^data\:image\/tga/),u=0;return e(),n},Object.assign(P.prototype,{onBeforeRender:function(){},onAfterRender:function(){},add:function(t){this.children.push(t),t.parent=this},remove:function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1),t.parent=null},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(t,e);if(void 0!==r)return r}},updateMatrix:function(){var t=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrix()},getWorldDirection:function(){var t=new o,e=new m,i=new o;return function(n){var r=n||new o;return this.worldMatrix.decompose(t,e,i),r.set(0,0,1).applyQuaternion(e),r}}(),lookAt:function(){var t=new s;return function(e,i){t.lookAtRH(e,this.position,i),this.quaternion.setFromRotationMatrix(t)}}(),raycast:function(t,e){},traverse:function(t){t(this);for(var e=this.children,i=0,n=e.length;i<n;i++)e[i].traverse(t)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.type=t.type,this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.worldMatrix.copy(t.worldMatrix),this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var i=0;i<t.children.length;i++){var n=t.children[i];this.add(n.clone())}return this}}),(F.prototype=Object.create(P.prototype)).constructor=F,Object.assign(O.prototype,{updateBones:function(){var t=new s;return function(){for(var e=0;e<this.bones.length;e++){var i=this.bones[e];t.multiplyMatrices(i.worldMatrix,i.offsetMatrix),t.toArray(this.boneMatrices,16*e)}void 0!==this.boneTexture&&this.boneTexture.version++}}(),getBoneByName:function(t){for(var e=0,i=this.bones.length;e<i;e++){var n=this.bones[e];if(n.name===t)return n}}}),Object.assign(z.prototype,{parseBinding:function(t,e){if((e=e.split(".")).length>1){for(var i=t[e[0]],n=1;n<e.length-1;n++)i=i[e[n]];this.property=e[e.length-1],this.target=i}else this.property=e[0],this.target=t},accumulate:function(t){var e=this.buffer,i=this.valueSize,n=i,r=this.cumulativeWeight;if(0===r){for(var a=0;a!==i;++a)e[n+a]=e[a];r=t}else{var s=t/(r+=t);this._mixBufferFunction(e,n,0,s,i)}this.cumulativeWeight=r},apply:function(){var t=this.buffer,e=this.valueSize;this.cumulativeWeight;this.cumulativeWeight=0,this.valueSize>1?this.target[this.property].fromArray(t,e):this.target[this.property]=t[e]}}),Object.assign(B.prototype,{add:function(t){if(void 0===this._clips[t.name]){for(var e=t.tracks,i=0;i<e.length;i++){var n,r=e[i],a=r.name;this._bindings[a]?n=this._bindings[a]:(n=new z(r.target,r.propertyPath,r.valueTypeName,r.valueSize),this._bindings[a]=n),n.referenceCount++}this._clips[t.name]=t}else console.warn("AnimationMixer.add: already has clip: "+t.name)},remove:function(t){if(this._clips[t.name]){for(var e=t.tracks,i=0;i<e.length;i++){var n=e[i].name,r=this._bindings[n];r&&r.referenceCount--,r.referenceCount<=0&&delete this._bindings[n]}delete this._clips[t.name]}else console.warn("AnimationMixer.remove: has no clip: "+t.name)},play:function(t,e){if(void 0===this._activeClips[t]){this._activeClips[t]=void 0===e?1:e;var i=this._clips[t];if(i){i.frame=0;for(var n=i.tracks,r=0;r<n.length;r++){var a=n[r].name,s=this._bindings[a];s&&s.useCount++}}else console.warn("AnimationMixer.stop: clip "+t+" is not found.")}else console.warn("AnimationMixer.play: clip "+t+" is playing.")},stop:function(t){if(void 0!==this._activeClips[t]){delete this._activeClips[t];var e=this._clips[t];if(e)for(var i=e.tracks,n=0;n<i.length;n++){var r=i[n].name,a=this._bindings[r];a&&a.useCount>0&&a.useCount--}else console.warn("AnimationMixer.stop: clip "+t+" is not found.")}else console.warn("AnimationMixer.stop: clip "+t+" is not playing.")},update:function(t){for(var e in this._activeClips){var i=this._clips[e],n=this._activeClips[e];i.update(t,this._bindings,n)}for(var r in this._bindings)this._bindings[r].useCount>0&&this._bindings[r].apply()},setClipWeight:function(t,e){void 0!==this._activeClips[t]?this._activeClips[t]=e:console.warn("AnimationMixer.stop: clip "+t+" is not playing.")},getAllClipNames:function(){var t=[];for(var e in this._clips)t.push(e);return t}}),Object.assign(G.prototype,{_getLastTimeIndex:function(t){var e,i=0,n=this.times.length;for(e=0;e<n;e++)t>=this.times[e]&&(i=e);return i},getValue:function(t,e){for(var i,n,r=this._getLastTimeIndex(t),a=this.times,s=this.values,o=this.valueSize,u=a[r],h=a[r+1],c=0;c<o;c++)if(i=s[r*o+c],n=s[(r+1)*o+c],this.interpolant)if(void 0!==i&&void 0!==n){var l=(t-u)/(h-u);e[c]=i*(1-l)+n*l}else e[c]=i;else e[c]=i}}),k.prototype=Object.assign(Object.create(G.prototype),{constructor:k,valueTypeName:"bool",getValue:function(t,e){var i=this._getLastTimeIndex(t),n=this.times[i];e[0]=this.values[n]}}),H.prototype=Object.assign(Object.create(G.prototype),{constructor:H,valueTypeName:"color"}),Object.assign(V.prototype,{update:function(t,e,i){this.frame+=t,this.frame>this.endFrame&&(this.loop?this.frame=this.startFrame:this.frame=this.endFrame);for(var n=0,r=this.tracks.length;n<r;n++){var a=this.tracks[n],s=e[a.name];a.getValue(this.frame,s.buffer),s.accumulate(i)}}}),j.prototype=Object.assign(Object.create(G.prototype),{constructor:j,valueTypeName:"number"}),X.prototype=Object.assign(Object.create(G.prototype),{constructor:X,valueTypeName:"quaternion",getValue:function(t,e){var i=this._getLastTimeIndex(t),n=this.times,r=this.values,a=n[i],s=n[i+1];if(this.interpolant)if(void 0!==s){var o=(t-a)/(s-a);m.slerpFlat(e,0,r,4*i,r,4*(i+1),o)}else for(u=0;u<4;u++)e[u]=r[4*i+u];else for(var u=0;u<4;u++)e[u]=r[4*i+u]}}),W.prototype=Object.assign(Object.create(G.prototype),{constructor:W,valueTypeName:"string",getValue:function(t,e){var i=this._getLastTimeIndex(t),n=this.times[i];e[0]=this.values[n]}}),Y.prototype=Object.assign(Object.create(G.prototype),{constructor:Y,valueTypeName:"vector"}),Object.assign(q.prototype,{setArray:function(t){this.count=void 0!==t?t.length/this.size:0,this.array=t}}),Z.prototype=Object.assign(Object.create(a.prototype),{constructor:Z,addAttribute:function(t,e){this.attributes[t]=e},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){delete this.attributes[t]},setIndex:function(t){Array.isArray(t)?this.index=new q(new Uint16Array(t),1):this.index=t},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},computeBoundingBox:function(){var t=this.attributes.a_Position||this.attributes.position;if(t.isInterleavedBufferAttribute){var e=t.data;this.boundingBox.setFromArray(e.array,e.stride)}else this.boundingBox.setFromArray(t.array,t.size)},computeBoundingSphere:function(){var t=this.attributes.a_Position||this.attributes.position;if(t.isInterleavedBufferAttribute){var e=t.data;this.boundingSphere.setFromArray(e.array,e.stride)}else this.boundingSphere.setFromArray(t.array,t.size)},dispose:function(){this.dispatchEvent({type:"dispose"})}}),K.prototype=Object.assign(Object.create(Z.prototype),{constructor:K,buildGeometry:function(t,e,i,n,r,a){function s(t,e,i,n,r,a,s,_,m,v,g){var M,x,E=a/m,y=s/v,T=a/2,S=s/2,b=_/2,w=m+1,A=v+1,N=0,L=0,C=new o;for(x=0;x<A;x++){var R=x*y-S;for(M=0;M<w;M++){var P=M*E-T;C[t]=P*n,C[e]=R*r,C[i]=b,c.push(C.x,C.y,C.z),C[t]=0,C[e]=0,C[i]=_>0?1:-1,l.push(C.x,C.y,C.z),d.push(M/m),d.push(1-x/v),N+=1}}for(x=0;x<v;x++)for(M=0;M<m;M++){var F=p+M+w*x,O=p+M+w*(x+1),U=p+(M+1)+w*(x+1),I=p+(M+1)+w*x;h.push(F,O,I),h.push(O,U,I),L+=6}u.addGroup(f,L,g),f+=L,p+=N}var u=this;t=t||1,e=e||1,i=i||1,n=Math.floor(n)||1,r=Math.floor(r)||1;var h=[],c=[],l=[],d=[],p=0,f=0;s("z","y","x",-1,-1,i,e,t,a=Math.floor(a)||1,r,0),s("z","y","x",1,-1,i,e,-t,a,r,1),s("x","z","y",1,1,t,i,e,n,a,2),s("x","z","y",1,-1,t,i,-e,n,a,3),s("x","y","z",1,-1,t,e,i,n,r,4),s("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(h),this.addAttribute("a_Position",new q(new Float32Array(c),3)),this.addAttribute("a_Normal",new q(new Float32Array(l),3)),this.addAttribute("a_Uv",new q(new Float32Array(d),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),Q.prototype=Object.assign(Object.create(Z.prototype),{constructor:Q,buildGeometry:function(t,e,i,n,r,a,s,u){function h(i){var r,a,h,v=new p,x=new o,E=0,y=!0===i?t:e,T=!0===i?1:-1;for(a=m,r=1;r<=n;r++)d.push(0,g*T,0),f.push(0,T,0),_.push(.5,.5),m++;for(h=m,r=0;r<=n;r++){var S=r/n*u+s,b=Math.cos(S),w=Math.sin(S);x.x=y*w,x.y=g*T,x.z=y*b,d.push(x.x,x.y,x.z),f.push(0,T,0),v.x=.5*b+.5,v.y=.5*w*T+.5,_.push(v.x,v.y),m++}for(r=0;r<n;r++){var A=a+r,N=h+r;!0===i?l.push(N,N+1,A):l.push(N+1,N,A),E+=3}c.addGroup(M,E,!0===i?1:2),M+=E}var c=this;t=void 0!==t?t:1,e=void 0!==e?e:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,a=void 0!==a&&a,s=void 0!==s?s:0,u=void 0!==u?u:2*Math.PI;var l=[],d=[],f=[],_=[],m=0,v=[],g=i/2,M=0;!function(){var a,h,p=new o,x=new o,E=0,y=(e-t)/i;for(h=0;h<=r;h++){var T=[],S=h/r,b=S*(e-t)+t;for(a=0;a<=n;a++){var w=a/n,A=w*u+s,N=Math.sin(A),L=Math.cos(A);x.x=b*N,x.y=-S*i+g,x.z=b*L,d.push(x.x,x.y,x.z),p.set(N,y,L).normalize(),f.push(p.x,p.y,p.z),_.push(w,1-S),T.push(m++)}v.push(T)}for(a=0;a<n;a++)for(h=0;h<r;h++){var C=v[h][a],R=v[h+1][a],P=v[h+1][a+1],F=v[h][a+1];l.push(C,R,F),l.push(R,P,F),E+=6}c.addGroup(M,E,0),M+=E}(),!1===a&&(t>0&&h(!0),e>0&&h(!1)),this.setIndex(l),this.addAttribute("a_Position",new q(new Float32Array(d),3)),this.addAttribute("a_Normal",new q(new Float32Array(f),3)),this.addAttribute("a_Uv",new q(new Float32Array(_),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),J.prototype=Object.assign(Object.create(q.prototype),{constructor:J,isInstancedBufferAttribute:!0}),$.prototype=Object.assign(Object.create(Z.prototype),{constructor:$,isInstancedGeometry:!0}),Object.assign(tt.prototype,{setArray:function(t){this.count=void 0!==t?t.length/this.stride:0,this.array=t}}),et.prototype=Object.assign(Object.create(tt.prototype),{constructor:et,isInstancedInterleavedBuffer:!0}),it.prototype.isInterleavedBufferAttribute=!0,Object.defineProperties(it.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),nt.prototype=Object.assign(Object.create(Z.prototype),{constructor:nt,buildGeometry:function(t,e,i,n){var r,a,s=(t=t||1)/2,o=(e=e||1)/2,u=Math.floor(i)||1,h=Math.floor(n)||1,c=u+1,l=h+1,d=t/u,p=e/h,f=[],_=[],m=[],v=[];for(a=0;a<l;a++){var g=a*p-o;for(r=0;r<c;r++){var M=r*d-s;_.push(M,0,g),m.push(0,1,0),v.push(r/u),v.push(1-a/h)}}for(a=0;a<h;a++)for(r=0;r<u;r++){var x=r+c*a,E=r+c*(a+1),y=r+1+c*(a+1),T=r+1+c*a;f.push(x,E,T),f.push(E,y,T)}this.setIndex(f),this.addAttribute("a_Position",new q(new Float32Array(_),3)),this.addAttribute("a_Normal",new q(new Float32Array(m),3)),this.addAttribute("a_Uv",new q(new Float32Array(v),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),rt.prototype=Object.assign(Object.create(Z.prototype),{constructor:rt,buildGeometry:function(t,e,i,n,r,a,s){t=t||1,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var u,h,c=(a=void 0!==a?a:0)+(s=void 0!==s?s:Math.PI),l=0,d=[],p=new o,f=new o,_=[],m=[],v=[],g=[];for(h=0;h<=i;h++){var M=[],x=h/i;for(u=0;u<=e;u++){var E=u/e;p.x=-t*Math.cos(n+E*r)*Math.sin(a+x*s),p.y=t*Math.cos(a+x*s),p.z=t*Math.sin(n+E*r)*Math.sin(a+x*s),m.push(p.x,p.y,p.z),f.set(p.x,p.y,p.z).normalize(),v.push(f.x,f.y,f.z),g.push(E,1-x),M.push(l++)}d.push(M)}for(h=0;h<i;h++)for(u=0;u<e;u++){var y=d[h][u+1],T=d[h][u],S=d[h+1][u],b=d[h+1][u+1];(0!==h||a>0)&&_.push(y,T,b),(h!==i-1||c<Math.PI)&&_.push(T,S,b)}this.setIndex(_),this.addAttribute("a_Position",new q(new Float32Array(m),3)),this.addAttribute("a_Normal",new q(new Float32Array(v),3)),this.addAttribute("a_Uv",new q(new Float32Array(g),2)),this.computeBoundingBox(),this.computeBoundingSphere()}}),Object.assign(at.prototype,{copy:function(t){return this.type=t.type,this.opacity=t.opacity,this.transparent=t.transparent,this.premultipliedAlpha=t.premultipliedAlpha,this.vertexColors=t.vertexColors,this.diffuse.copy(t.diffuse),this.diffuseMap=t.diffuseMap,this.normalMap=t.normalMap,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.envMapCombine=t.envMapCombine,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.blending=t.blending,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.alphaTest=t.alphaTest,this.side=t.side,this.shading=t.shading,this.acceptLight=t.acceptLight,this.drawMode=t.drawMode,this},clone:function(){return(new this.constructor).copy(this)}}),(st.prototype=Object.create(at.prototype)).constructor=st,(ot.prototype=Object.create(at.prototype)).constructor=ot,ut.prototype=Object.assign(Object.create(at.prototype),{constructor:ut,copy:function(t){return at.prototype.copy.call(this,t),this.shininess=t.shininess,this.specular.copy(t.specular),this.specularMap=t.specularMap,this}}),ht.prototype=Object.assign(Object.create(at.prototype),{constructor:ht,copy:function(t){return at.prototype.copy.call(this,t),this.roughness=t.roughness,this.metalness=t.metalness,this}}),ct.prototype=Object.assign(Object.create(at.prototype),{constructor:ct,copy:function(t){return at.prototype.copy.call(this,t),this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}),lt.prototype=Object.assign(Object.create(at.prototype),{constructor:lt,copy:function(t){return at.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this}}),dt.prototype=Object.assign(Object.create(at.prototype),{constructor:dt,copy:function(t){return at.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this}}),pt.prototype=Object.assign(Object.create(at.prototype),{constructor:pt,copy:function(t){return at.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}),ft.prototype=Object.assign(Object.create(at.prototype),{constructor:ft,copy:function(t){return at.prototype.copy.call(this,t),this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this}}),_t.prototype=Object.create(at.prototype),_t.prototype.constructor=_t,mt.prototype=Object.create(at.prototype),mt.prototype.constructor=mt,Object.assign(Mt.prototype,{setBlend:function(t,e,i,n,r,a,s,o){var u=this.gl;t!==Ie.NONE?this.enable(u.BLEND):this.disable(u.BLEND),t!==Ie.CUSTOM?(t===this.currentBlending&&o===this.currentPremultipliedAlpha||(t===Ie.NORMAL&&(o?(u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA)):(u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA))),t===Ie.ADD&&(o?(u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE)):(u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE)))),this.currentBlendEquation=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendEquationAlpha=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null):(r=r||e,a=a||i,s=s||n,e===this.currentBlendEquation&&r===this.currentBlendEquationAlpha||(u.blendEquationSeparate(e,r),this.currentBlendEquation=e,this.currentBlendEquationAlpha=r),i===this.currentBlendSrc&&n===this.currentBlendDst&&a===this.currentBlendSrcAlpha&&s===this.currentBlendDstAlpha||(u.blendFuncSeparate(i,n,a,s),this.currentBlendSrc=i,this.currentBlendDst=n,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=s)),this.currentBlending=t,this.currentPremultipliedAlpha=o},setFlipSided:function(t){var e=this.gl;this.currentFlipSided!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t)},setCullFace:function(t){var e=this.gl;t!==Be.NONE?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===Be.BACK?e.cullFace(e.BACK):t===Be.FRONT?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t},viewport:function(t,e,i,n){var r=this.currentViewport;r.x===t&&r.y===e&&r.z===i&&r.w===n||(this.gl.viewport(t,e,i,n),r.set(t,e,i,n))},colorMask:function(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)},clearColor:function(t,e,i,n){var r=this.currentClearColor;r.x===t&&r.y===e&&r.z===i&&r.w===n||(this.gl.clearColor(t,e,i,n),r.set(t,e,i,n))},activeTexture:function(t){var e=this.gl;void 0===t&&(t=e.TEXTURE0+this.capabilities.maxTextures-1),this.currentTextureSlot!==t&&(e.activeTexture(t),this.currentTextureSlot=t)},bindTexture:function(t,e){var i=this.gl;null===this.currentTextureSlot&&this.activeTexture();var n=this.currentBoundTextures[this.currentTextureSlot];void 0===n&&(n={type:void 0,texture:void 0},this.currentBoundTextures[this.currentTextureSlot]=n),n.type===t&&n.texture===e||(i.bindTexture(t,e||this.emptyTextures[t]),n.type=t,n.texture=e)},bindBuffer:function(t,e){var i=this.gl;this.currentBoundBuffers[t]!==e&&(i.bindBuffer(t,e),this.currentBoundBuffers[t]=e)},enable:function(t){!0!==this.states[t]&&(this.gl.enable(t),this.states[t]=!0)},disable:function(t){!1!==this.states[t]&&(this.gl.disable(t),this.states[t]=!1)},depthMask:function(t){t!==this.currentDepthMask&&(this.gl.depthMask(t),this.currentDepthMask=t)},setLineWidth:function(t){t!==this.currentLineWidth&&(this.capabilities.version>=1&&this.gl.lineWidth(t),this.currentLineWidth=t)},setProgram:function(t){this.currentProgram!==t&&(this.gl.useProgram(t.id),this.currentProgram=t)},stencilMask:function(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)},stencilFunc:function(t,e,i){this.currentStencilFunc===t&&this.currentStencilRef===e&&this.currentStencilFuncMask===i||(this.gl.stencilFunc(t,e,i),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=i)},stencilOp:function(t,e,i){this.currentStencilFail===t&&this.currentStencilZFail===e&&this.currentStencilZPass===i||(this.gl.stencilOp(t,e,i),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=i)},clearStencil:function(t){this.currentStencilClear!==t&&(this.gl.clearStencil(t),this.currentStencilClear=t)}}),Object.assign(xt.prototype,{get:function(t){var e=t.uuid,i=this.properties[e];return void 0===i&&(i={},this.properties[e]=i),i},delete:function(t){delete this.properties[t.uuid]},clear:function(){this.properties={}}}),Object.assign(At.prototype,{setTexture2D:function(t,e){e=void 0!==e?e:0;var i=this.gl,n=this.state,r=this.capabilities,a=this.properties.get(t);if(t.image&&a.__version!==t.version){void 0===a.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),a.__webglTexture=i.createTexture()),n.activeTexture(i.TEXTURE0+e),n.bindTexture(i.TEXTURE_2D,a.__webglTexture);var s=t.image,o=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement;o&&(s=bt(s,r.maxTextureSize),Et(t)&&!1===Tt(s)&&(s=St(s)));var u=Tt(s);i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),this.setTextureParameters(t,u);var h,c=t.mipmaps,l=t.format,d=t.internalformat||t.format,p=t.type;if(1===r.version&&l!==d&&console.warn("texture format "+l+" not same as internalformat "+d+" in webgl 1.0."),o)if(c.length>0&&u){for(var f=0,_=c.length;f<_;f++)h=c[f],i.texImage2D(i.TEXTURE_2D,f,d,l,p,h);t.generateMipmaps=!1}else i.texImage2D(i.TEXTURE_2D,0,d,l,p,s);else if(c.length>0&&u){for(var f=0,_=c.length;f<_;f++)h=c[f],i.texImage2D(i.TEXTURE_2D,f,d,h.width,h.height,t.border,l,p,h.data);t.generateMipmaps=!1}else i.texImage2D(i.TEXTURE_2D,0,d,s.width,s.height,t.border,l,p,s.data);return t.generateMipmaps&&u&&i.generateMipmap(i.TEXTURE_2D),a.__version=t.version,a}return n.activeTexture(i.TEXTURE0+e),n.bindTexture(i.TEXTURE_2D,a.__webglTexture),a},setTextureCube:function(t,e){e=void 0!==e?e:0;var i=this.gl,n=this.state,r=this.capabilities,a=this.properties.get(t);if(t.version>0&&a.__version!==t.version){void 0===a.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),a.__webglTexture=i.createTexture()),n.activeTexture(i.TEXTURE0+e),n.bindTexture(i.TEXTURE_CUBE_MAP,a.__webglTexture);var s=[],o=t.format,u=t.internalformat||t.format,h=t.type;1===r.version&&o!==u&&console.warn("texture format "+o+" not same as internalformat "+u+" in webgl 1.0.");for(var c=!0,l=0;l<6;l++)(p=(d=t.images[l])instanceof HTMLImageElement||d instanceof HTMLCanvasElement)&&(d=bt(d,r.maxTextureSize),Et(t)&&!1===Tt(d)&&(d=St(d))),Tt(d)||(c=!1),s[l]=d,d.__isElement=p;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),this.setTextureParameters(t,c);for(l=0;l<6;l++){var d=s[l],p=d.__isElement;p?i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,u,o,h,d):i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,u,d.width,d.height,t.border,o,h,d.data)}return t.generateMipmaps&&c&&i.generateMipmap(i.TEXTURE_CUBE_MAP),a.__version=t.version,a}return n.activeTexture(i.TEXTURE0+e),n.bindTexture(i.TEXTURE_CUBE_MAP,a.__webglTexture),a},setTextureParameters:function(t,e){var i=this.gl,n=this.capabilities,r=t.textureType,a=wt(t,e);if(n.version>=8){var s=a.join("_");if(!this.samplers[s]){var o=i.createSampler();i.samplerParameteri(o,i.TEXTURE_WRAP_S,a[0]),i.samplerParameteri(o,i.TEXTURE_WRAP_T,a[1]),i.samplerParameteri(o,i.TEXTURE_MAG_FILTER,a[2]),i.samplerParameteri(o,i.TEXTURE_MIN_FILTER,a[3]),this.samplers[s]=o}i.bindSampler(this.state.currentTextureSlot-i.TEXTURE0,this.samplers[s])}else{i.texParameteri(r,i.TEXTURE_WRAP_S,a[0]),i.texParameteri(r,i.TEXTURE_WRAP_T,a[1]),i.texParameteri(r,i.TEXTURE_MAG_FILTER,a[2]),i.texParameteri(r,i.TEXTURE_MIN_FILTER,a[3]);var u=n.anisotropyExt;u&&i.texParameterf(r,u.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a[4],n.maxAnisotropy))}},setRenderTarget2D:function(t){var e=this.gl,i=this.state,n=this.properties.get(t);if(void 0!==n.__webglFramebuffer)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer);else{t.addEventListener("dispose",this.onRenderTargetDispose,this),n.__webglFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer);var r=[];for(var a in t._textures){var s=this.setTexture2D(t._textures[a]);e.framebufferTexture2D(e.FRAMEBUFFER,a,e.TEXTURE_2D,s.__webglTexture,0),i.bindTexture(e.TEXTURE_2D,null),(Number(a)<=36073&&Number(a)>=36064||Number(a)<=577045&&Number(a)>=577040)&&r.push(a)}if(r.length>1&&(2===this.capabilities.version?e.drawBuffers(r):this.capabilities.drawBuffersExt&&this.capabilities.drawBuffersExt.drawBuffersWEBGL(r)),t.depthBuffer&&!t._textures[$e.DEPTH_STENCIL_ATTACHMENT]&&!t._textures[$e.DEPTH_ATTACHMENT]){n.__webglDepthbuffer=e.createRenderbuffer();var o=n.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,o),t.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,o)):(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o)),e.bindRenderbuffer(e.RENDERBUFFER,null)}var u=e.checkFramebufferStatus(e.FRAMEBUFFER);u!==e.FRAMEBUFFER_COMPLETE&&(u===e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"):u===e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"):u===e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"):u===e.FRAMEBUFFER_UNSUPPORTED?console.warn("framebuffer not complete: FRAMEBUFFER_UNSUPPORTED"):console.warn("framebuffer not complete."))}},setRenderTargetCube:function(t){var e=this.gl,i=this.state,n=this.properties.get(t),r=this.properties.get(t.texture);if(void 0!==r.__webglTexture&&void 0!==n.__webglFramebuffer)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,0);else{if(t.addEventListener("dispose",this.onRenderTargetDispose,this),n.__webglFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),r=this.setTextureCube(t.texture),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,0),i.bindTexture(e.TEXTURE_CUBE_MAP,null),t.depthBuffer){n.__webglDepthbuffer=e.createRenderbuffer();var a=n.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,a),t.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,a)):(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,a)),e.bindRenderbuffer(e.RENDERBUFFER,null)}var s=e.checkFramebufferStatus(e.FRAMEBUFFER);s!==e.FRAMEBUFFER_COMPLETE&&(s===e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"):s===e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"):s===e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?console.warn("framebuffer not complete: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"):s===e.FRAMEBUFFER_UNSUPPORTED?console.warn("framebuffer not complete: FRAMEBUFFER_UNSUPPORTED"):console.warn("framebuffer not complete."))}},updateRenderTargetMipmap:function(t){var e=this.gl,i=this.state,n=t.texture;if(n.generateMipmaps&&Tt(t)&&n.minFilter!==e.NEAREST&&n.minFilter!==e.LINEAR){var r=n.textureType,a=this.properties.get(n).__webglTexture;i.bindTexture(r,a),e.generateMipmap(r),i.bindTexture(r,null)}},onTextureDispose:function(t){var e=this.gl,i=t.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onTextureDispose,this),n.__webglTexture&&e.deleteTexture(n.__webglTexture),this.properties.delete(i)},onRenderTargetDispose:function(t){var e=this.gl,i=t.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onRenderTargetDispose,this),n.__webglFramebuffer&&e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),this.properties.delete(i)},setRenderTarget:function(t){var e=this.gl,i=this.state;if(t.view)i.currentRenderTarget===t||(e.bindFramebuffer(e.FRAMEBUFFER,null),i.currentRenderTarget=t);else{var n=void 0!==t.activeCubeFace;if(i.currentRenderTarget!==t)n?this.setRenderTargetCube(t):this.setRenderTarget2D(t),i.currentRenderTarget=t;else if(n){var r=this.properties.get(t.texture);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,0)}}}}),Object.assign(Pt.prototype,{setGeometry:function(t){var e=this.gl,i=(this.state,this.properties),n=this.properties.get(t);n.created||(t.addEventListener("dispose",this.onGeometryDispose2,this),n.created=!0),null!==t.index&&Ct(e,i,t.index,e.ELEMENT_ARRAY_BUFFER);for(var r in t.attributes)Ct(e,i,t.attributes[r],e.ARRAY_BUFFER)},onGeometryDispose:function(t){var e=this.gl,i=t.target;this.properties.get(i);i.removeEventListener("dispose",this.onGeometryDispose,this),null!==i.index&&Rt(e,properties,i.index);for(var n in i.attributes)Rt(e,properties,i.attributes[n]);this.properties.delete(i)}}),Object.assign(Ft.prototype,{_generateSetValue:function(){var t=this.gl,e=this.type,i=this.location;switch(e){case Ye.FLOAT:this.size>1?this.setValue=this.set=function(e){t.uniform1fv(i,e)}:this.setValue=this.set=function(e){t.uniform1f(i,e)};break;case Ye.SAMPLER_2D:case Ye.SAMPLER_CUBE:case Ye.BOOL:case Ye.INT:this.setValue=this.set=function(e){t.uniform1i(i,e)};break;case Ye.FLOAT_VEC2:this.setValue=function(e,n){t.uniform2f(i,e,n)},this.set=function(e){t.uniform2fv(i,e)};break;case Ye.BOOL_VEC2:case Ye.INT_VEC2:this.setValue=function(e,n){t.uniform2i(i,e,n)},this.set=function(e){t.uniform2iv(i,e)};break;case Ye.FLOAT_VEC3:this.setValue=function(e,n,r){t.uniform3f(i,e,n,r)},this.set=function(e){t.uniform3fv(i,e)};break;case Ye.BOOL_VEC3:case Ye.INT_VEC3:this.setValue=function(e,n,r){t.uniform3i(i,e,n,r)},this.set=function(e){t.uniform3iv(i,e)};break;case Ye.FLOAT_VEC4:this.setValue=function(e,n,r,a){t.uniform4f(i,e,n,r,a)},this.set=function(e){t.uniform4fv(i,e)};break;case Ye.BOOL_VEC4:case Ye.INT_VEC4:this.setValue=function(e,n,r,a){t.uniform4i(i,e,n,r,a)},this.set=function(e){t.uniform4iv(i,e)};break;case Ye.FLOAT_MAT2:this.setValue=this.set=function(e){t.uniformMatrix2fv(i,!1,e)};break;case Ye.FLOAT_MAT3:this.setValue=this.set=function(e){t.uniformMatrix3fv(i,!1,e)};break;case Ye.FLOAT_MAT4:this.setValue=this.set=function(e){t.uniformMatrix4fv(i,!1,e)}}}}),Object.assign(Ot.prototype,{initCount:function(t){switch(this.type){case qe.FLOAT:case qe.BYTE:case qe.UNSIGNED_BYTE:case qe.UNSIGNED_SHORT:this.count=1;break;case qe.FLOAT_VEC2:this.count=2;break;case qe.FLOAT_VEC3:this.count=3;break;case qe.FLOAT_VEC4:this.count=4}},initFormat:function(t){switch(this.type){case qe.FLOAT:case qe.FLOAT_VEC2:case qe.FLOAT_VEC3:case qe.FLOAT_VEC4:this.format=t.FLOAT;break;case qe.UNSIGNED_BYTE:this.format=t.UNSIGNED_BYTE;break;case qe.UNSIGNED_SHORT:this.format=t.UNSIGNED_SHORT;break;case qe.BYTE:this.format=t.BYTE}}}),Gt.prototype.dispose=function(t){t.deleteProgram(this.id)};var ei={alphaTest_frag:"#ifdef ALPHATEST\n\tif ( outColor.a < ALPHATEST ) discard;\n#endif",ambientlight_pars_frag:"uniform vec4 u_AmbientLightColor;",aoMap_pars_frag:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_frag:"vec4 outColor = vec4(u_Color, u_Opacity);",begin_vert:"vec3 transformed = vec3(a_Position);\n#if defined(USE_NORMAL) || defined(USE_ENV_MAP)\n    vec3 objectNormal = vec3(a_Normal);\n#endif",bsdfs:"\nvec4 BRDF_Diffuse_Lambert(vec4 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\nvec4 F_Schlick( const in vec4 specularColor, const in float dotLH ) {\n\tfloat fresnel = pow( 1.0 - dotLH, 5.0 );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nvec4 BRDF_Specular_BlinnPhong(vec4 specularColor, vec3 N, vec3 L, vec3 V, float shininess) {\n    vec3 H = normalize(L + V);\n    float dotNH = saturate(dot(N, H));\n    float dotLH = saturate(dot(L, H));\n    vec4 F = F_Schlick(specularColor, dotLH);\n    float G = G_BlinnPhong_Implicit( );\n    float D = D_BlinnPhong(shininess, dotNH);\n    return F * G * D;\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nvec4 BRDF_Specular_GGX(vec4 specularColor, vec3 N, vec3 L, vec3 V, float roughness) {\n\tfloat alpha = pow2( roughness );\n\tvec3 H = normalize(L + V);\n\tfloat dotNL = saturate( dot(N, L) );\n\tfloat dotNV = saturate( dot(N, V) );\n\tfloat dotNH = saturate( dot(N, H) );\n\tfloat dotLH = saturate( dot(L, H) );\n\tvec4 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * G * D;\n}\nvec4 BRDF_Specular_GGX_Environment( const in vec3 N, const in vec3 V, const in vec4 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( N, V ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpMap_pars_frag:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd(vec2 uv) {\n\t\tvec2 dSTdx = dFdx( uv );\n\t\tvec2 dSTdy = dFdy( uv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, uv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clippingPlanes_frag:"#if NUM_CLIPPING_PLANES > 0\n    vec4 plane;\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_CLIPPING_PLANES; i ++ ) {\n        plane = clippingPlanes[ i ];\n        if ( dot( -v_modelPos, plane.xyz ) > plane.w ) discard;\n    }\n#endif",clippingPlanes_pars_frag:"#if NUM_CLIPPING_PLANES > 0\n    uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",color_frag:"#ifdef USE_VCOLOR\n    outColor *= v_Color;\n#endif",color_pars_frag:"#ifdef USE_VCOLOR\n    varying vec4 v_Color;\n#endif",color_pars_vert:"#ifdef USE_VCOLOR\n    attribute vec4 a_Color;\n    varying vec4 v_Color;\n#endif",color_vert:"#ifdef USE_VCOLOR\n    v_Color = a_Color;\n#endif",common_frag:"uniform mat4 u_View;\nuniform float u_Opacity;\nuniform vec3 u_Color;\nuniform vec3 u_CameraPosition;",common_vert:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\n#include <transpose>\n#include <inverse>\nuniform mat4 u_Projection;\nuniform mat4 u_View;\nuniform mat4 u_Model;\nuniform vec3 u_CameraPosition;",diffuseMap_frag:"#ifdef USE_DIFFUSE_MAP\n    vec4 texelColor = texture2D( diffuseMap, v_Uv );\n    texelColor = mapTexelToLinear( texelColor );\n    outColor *= texelColor;\n#endif",diffuseMap_pars_frag:"#ifdef USE_DIFFUSE_MAP\n    uniform sampler2D diffuseMap;\n#endif",directlight_pars_frag:"struct DirectLight\n{\n    vec3 direction;\n    vec4 color;\n    float intensity;\n    int shadow;\n    float shadowBias;\n    float shadowRadius;\n    vec2 shadowMapSize;\n};\nuniform DirectLight u_Directional[NUM_DIR_LIGHTS];",emissiveMap_frag:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D(emissiveMap, v_Uv);\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissiveMap_pars_frag:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_frag:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_frag:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",end_frag:"gl_FragColor = outColor;",envMap_frag:"#ifdef USE_ENV_MAP\n    vec3 envDir;\n    #if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n        envDir = reflect(normalize(v_worldPos - u_CameraPosition), N);\n    #else\n        envDir = v_EnvPos;\n    #endif\n    vec4 envColor = textureCube(envMap, envDir);\n    envColor = envMapTexelToLinear( envColor );\n    #ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutColor = mix(outColor, envColor * outColor, u_EnvMap_Intensity);\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutColor = mix(outColor, envColor, u_EnvMap_Intensity);\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutColor += envColor * u_EnvMap_Intensity;\n\t#endif\n#endif",envMap_pars_frag:"#ifdef USE_ENV_MAP\n    #if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n        varying vec3 v_worldPos;\n    #else\n        varying vec3 v_EnvPos;\n    #endif\n    uniform samplerCube envMap;\n    uniform float u_EnvMap_Intensity;\n#endif",envMap_pars_vert:"#ifdef USE_ENV_MAP\n    #if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n        varying vec3 v_worldPos;\n    #else\n        varying vec3 v_EnvPos;\n    #endif\n#endif",envMap_vert:"#ifdef USE_ENV_MAP\n    #if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n        v_worldPos = (u_Model * vec4(transformed, 1.0)).xyz;\n    #else\n        v_EnvPos = reflect(normalize((u_Model * vec4(transformed, 1.0)).xyz - u_CameraPosition), (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 1.0)).xyz);\n    #endif\n#endif",fog_frag:"#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    #ifdef USE_EXP2_FOG\n        float fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );\n    #else\n        float fogFactor = smoothstep( u_FogNear, u_FogFar, depth );\n    #endif\n    gl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );\n#endif",fog_pars_frag:"#ifdef USE_FOG\n    uniform vec3 u_FogColor;\n    #ifdef USE_EXP2_FOG\n        uniform float u_FogDensity;\n    #else\n        uniform float u_FogNear;\n        uniform float u_FogFar;\n    #endif\n#endif",inverse:"mat4 inverseMat4(mat4 m) {\n    float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}",light_frag:"#ifdef USE_LIGHT\n    vec4 light;\n    vec3 L;\n    vec4 totalReflect = vec4(0., 0., 0., 0.);    vec4 indirectIrradiance = vec4(0., 0., 0., 0.);    vec4 indirectRadiance = vec4(0., 0., 0., 0.);\n    #ifdef USE_PBR\n        vec4 diffuseColor = outColor.xyzw * (1.0 - metalnessFactor);\n        vec4 specularColor = mix(vec4(0.04), outColor.xyzw, metalnessFactor);\n        float roughness = clamp(roughnessFactor, 0.04, 1.0);\n    #else\n        vec4 diffuseColor = outColor.xyzw;\n        #ifdef USE_PHONG\n            vec4 specularColor = u_SpecularColor;\n            float shininess = u_Specular;\n        #endif\n    #endif\n    #ifdef USE_AMBIENT_LIGHT\n        #ifdef USE_PBR\n            indirectIrradiance += PI * diffuseColor * u_AmbientLightColor;\n        #else\n            indirectIrradiance += diffuseColor * u_AmbientLightColor;\n        #endif\n    #endif\n    #ifdef USE_PBR\n        #ifdef USE_ENV_MAP\n    \t\tvec3 envDir;\n    \t    #if defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP)\n    \t        envDir = reflect(normalize(v_worldPos - u_CameraPosition), N);\n    \t    #else\n    \t        envDir = v_EnvPos;\n    \t    #endif\n            indirectIrradiance += getLightProbeIndirectIrradiance(8, envDir);\n            indirectRadiance += getLightProbeIndirectRadiance(GGXRoughnessToBlinnExponent(roughness), 8, envDir);\n    \t#endif\n    #endif\n    #if (defined(USE_PHONG) || defined(USE_PBR))\n        vec3 V = normalize( u_CameraPosition - v_modelPos );\n    #endif\n    float dotNL;\n    vec4 irradiance;\n    vec4 reflectLight;\n    #if NUM_DIR_LIGHTS > 0\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n            L = -u_Directional[ i ].direction;\n            light = u_Directional[ i ].color * u_Directional[ i ].intensity;\n            L = normalize(L);\n            dotNL = saturate( dot(N, L) );\n            irradiance = light * dotNL;\n            #ifdef USE_SHADOW\n                irradiance *= bool( u_Directional[ i ].shadow ) ? getShadow( directionalShadowMap[ i ], vDirectionalShadowCoord[ i ], u_Directional[ i ].shadowBias, u_Directional[ i ].shadowRadius, u_Directional[ i ].shadowMapSize ) : 1.0;\n            #endif\n            #ifdef USE_PBR\n                irradiance *= PI;\n            #endif\n            reflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n            #ifdef USE_PHONG\n                reflectLight += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n            #ifdef USE_PBR\n                reflectLight += irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness) * specularStrength;\n            #endif\n            totalReflect += reflectLight;\n        }\n    #endif\n    #if NUM_POINT_LIGHTS > 0\n        vec3 worldV;\n        float dist;\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n            L = u_Point[ i ].position - v_modelPos;\n            dist = pow(clamp(1. - length(L) / u_Point[ i ].distance, 0.0, 1.0), u_Point[ i ].decay);\n            light = u_Point[ i ].color * u_Point[ i ].intensity * dist;\n            L = normalize(L);\n            dotNL = saturate( dot(N, L) );\n            irradiance = light * dotNL;\n            #ifdef USE_PBR\n                irradiance *= PI;\n            #endif\n            #ifdef USE_SHADOW\n                worldV = v_modelPos - u_Point[ i ].position;\n                irradiance *= bool( u_Point[ i ].shadow ) ? getPointShadow( pointShadowMap[ i ], worldV, u_Point[ i ].shadowBias, u_Point[ i ].shadowRadius, u_Point[ i ].shadowMapSize, u_Point[ i ].shadowCameraNear, u_Point[ i ].shadowCameraFar ) : 1.0;\n            #endif\n            reflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n            #ifdef USE_PHONG\n                reflectLight += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n            #endif\n            #ifdef USE_PBR\n                reflectLight += irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness) * specularStrength;\n            #endif\n            totalReflect += reflectLight;\n        }\n    #endif\n    #if NUM_SPOT_LIGHTS > 0\n        float lightDistance;\n        float angleCos;\n        float spotEffect;\n        float dist;\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n            L = u_Spot[ i ].position - v_modelPos;\n            lightDistance = length(L);\n            L = normalize(L);\n            angleCos = dot( L, -normalize(u_Spot[ i ].direction) );\n            if( all( bvec2(angleCos > u_Spot[ i ].coneCos, lightDistance < u_Spot[ i ].distance) ) ) {\n                spotEffect = smoothstep( u_Spot[ i ].coneCos, u_Spot[ i ].penumbraCos, angleCos );\n                dist = pow(clamp(1. - lightDistance / u_Spot[ i ].distance, 0.0, 1.0), u_Spot[ i ].decay);\n                light = u_Spot[ i ].color * u_Spot[ i ].intensity * dist * spotEffect;\n                dotNL = saturate( dot(N, L) );\n                irradiance = light * dotNL;\n                #ifdef USE_PBR\n                    irradiance *= PI;\n                #endif\n                #ifdef USE_SHADOW\n                    irradiance *= bool( u_Spot[ i ].shadow ) ? getShadow( spotShadowMap[ i ], vSpotShadowCoord[ i ], u_Spot[ i ].shadowBias, u_Spot[ i ].shadowRadius, u_Spot[ i ].shadowMapSize ) : 1.0;\n                #endif\n                reflectLight = irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n                #ifdef USE_PHONG\n                    reflectLight += irradiance * BRDF_Specular_BlinnPhong(specularColor, N, L, V, shininess) * specularStrength;\n                #endif\n                #ifdef USE_PBR\n                    reflectLight += irradiance * BRDF_Specular_GGX(specularColor, N, L, V, roughness) * specularStrength;\n                #endif\n                totalReflect += reflectLight;\n            }\n        }\n    #endif\n    vec4 indirectDiffuse = indirectIrradiance * BRDF_Diffuse_Lambert(diffuseColor);\n    vec4 indirectSpecular = vec4(0., 0., 0., 0.);\n    #if defined( USE_ENV_MAP ) && defined( USE_PBR )\n        indirectSpecular += indirectRadiance * BRDF_Specular_GGX_Environment(N, V, specularColor, roughness) * specularStrength;\n    #endif\n    #ifdef USE_AOMAP\n    \tfloat ambientOcclusion = ( texture2D( aoMap, v_Uv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n    \tindirectDiffuse *= ambientOcclusion;\n    \t#if defined( USE_ENV_MAP ) && defined( USE_PBR )\n    \t\tfloat dotNV = saturate( dot( N, V ) );\n    \t\tindirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, GGXRoughnessToBlinnExponent(roughness) );\n    \t#endif\n    #endif\n    outColor.xyz = totalReflect.xyz + indirectDiffuse.xyz + indirectSpecular.xyz;\n#endif",light_pars_frag:"#ifdef USE_AMBIENT_LIGHT\n    #include <ambientlight_pars_frag>\n#endif\n#if NUM_DIR_LIGHTS > 0\n    #include <directlight_pars_frag>\n#endif\n#if NUM_POINT_LIGHTS > 0\n    #include <pointlight_pars_frag>\n#endif\n#if NUM_SPOT_LIGHTS > 0\n    #include <spotlight_pars_frag>\n#endif\n#if defined(USE_PBR) && defined(USE_ENV_MAP)\n    vec4 getLightProbeIndirectIrradiance(const in int maxMIPLevel, const in vec3 envDir) {\n    \t#ifdef TEXTURE_LOD_EXT\n    \t\tvec4 envMapColor = textureCubeLodEXT( envMap, envDir, float( maxMIPLevel ) );\n    \t#else\n    \t\tvec4 envMapColor = textureCube( envMap, envDir, float( maxMIPLevel ) );\n    \t#endif\n        envMapColor = envMapTexelToLinear( envMapColor );\n        return PI * envMapColor * u_EnvMap_Intensity;\n    }\n    float getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n    \tfloat maxMIPLevelScalar = float( maxMIPLevel );\n    \tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n    \treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n    }\n    vec4 getLightProbeIndirectRadiance(const in float blinnShininessExponent, const in int maxMIPLevel, const in vec3 envDir) {\n        float specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n        #ifdef TEXTURE_LOD_EXT\n    \t\tvec4 envMapColor = textureCubeLodEXT( envMap, envDir, specularMIPLevel );\n    \t#else\n    \t\tvec4 envMapColor = textureCube( envMap, envDir, specularMIPLevel );\n    \t#endif\n        envMapColor = envMapTexelToLinear( envMapColor );\n        return envMapColor * u_EnvMap_Intensity;\n    }\n    float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n    \treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n    }\n#endif",normalMap_pars_frag:"#include <tbn>\n#include <tsn>\nuniform sampler2D normalMap;",normal_frag:"#ifdef USE_NORMAL\n    #ifdef DOUBLE_SIDED\n    \tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n    #else\n    \tfloat flipNormal = 1.0;\n    #endif\n    #ifdef FLAT_SHADED\n    \tvec3 fdx = vec3( dFdx( v_modelPos.x ), dFdx( v_modelPos.y ), dFdx( v_modelPos.z ) );\n    \tvec3 fdy = vec3( dFdy( v_modelPos.x ), dFdy( v_modelPos.y ), dFdy( v_modelPos.z ) );\n    \tvec3 N = normalize( cross( fdx, fdy ) );\n    #else\n        vec3 N = normalize(v_Normal) * flipNormal;\n    #endif\n    #ifdef USE_NORMAL_MAP\n        vec3 normalMapColor = texture2D(normalMap, v_Uv).rgb;\n        mat3 tspace = tsn(N, -v_modelPos, vec2(v_Uv.x, 1.0 - v_Uv.y));\n        N = normalize(tspace * (normalMapColor * 2.0 - 1.0));\n    #elif defined(USE_BUMPMAP)\n        N = perturbNormalArb(-v_modelPos, N, dHdxy_fwd(v_Uv));\n    #endif\n#endif",normal_pars_frag:"#if defined(USE_NORMAL) && !defined(FLAT_SHADED)\n    varying vec3 v_Normal;\n#endif",normal_pars_vert:"#if defined(USE_NORMAL) && !defined(FLAT_SHADED)\n    varying vec3 v_Normal;\n#endif",normal_vert:"#if defined(USE_NORMAL) && !defined(FLAT_SHADED)\n    v_Normal = (transposeMat4(inverseMat4(u_Model)) * vec4(objectNormal, 1.0)).xyz;\n    #ifdef FLIP_SIDED\n    \tv_Normal = - v_Normal;\n    #endif\n#endif",packing:"const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8;    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}",pointlight_pars_frag:"struct PointLight\n{\n    vec3 position;\n    vec4 color;\n    float intensity;\n    float distance;\n    float decay;\n    int shadow;\n    float shadowBias;\n    float shadowRadius;\n    vec2 shadowMapSize;\n    float shadowCameraNear;\n    float shadowCameraFar;\n};\nuniform PointLight u_Point[NUM_POINT_LIGHTS];",premultipliedAlpha_frag:"#ifdef USE_PREMULTIPLIED_ALPHA\n    gl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;\n#endif",pvm_vert:"gl_Position = u_Projection * u_View * u_Model * vec4(transformed, 1.0);",shadow:"float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n    return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n}\nfloat textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {\n    return step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );\n}\nfloat getShadow( sampler2D shadowMap, vec4 shadowCoord, float shadowBias, float shadowRadius, vec2 shadowMapSize ) {\n    shadowCoord.xyz /= shadowCoord.w;\n    float depth = shadowCoord.z + shadowBias;\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    bvec2 frustumTestVec = bvec2( inFrustum, depth <= 1.0 );\n    bool frustumTest = all( frustumTestVec );\n    if ( frustumTest ) {\n        #ifdef USE_PCF_SOFT_SHADOW\n            float texelSize = shadowRadius / shadowMapSize.x;\n            vec2 poissonDisk[4];\n            poissonDisk[0] = vec2(-0.94201624, -0.39906216);\n            poissonDisk[1] = vec2(0.94558609, -0.76890725);\n            poissonDisk[2] = vec2(-0.094184101, -0.92938870);\n            poissonDisk[3] = vec2(0.34495938, 0.29387760);\n            return texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[0] * texelSize, depth ) * 0.25 +\n                texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[1] * texelSize, depth ) * 0.25 +\n                texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[2] * texelSize, depth ) * 0.25 +\n                texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[3] * texelSize, depth ) * 0.25;\n        #else\n            return texture2DCompare( shadowMap, shadowCoord.xy, depth );\n        #endif\n    }\n    return 1.0;\n}\nfloat getPointShadow( samplerCube shadowMap, vec3 V, float shadowBias, float shadowRadius, vec2 shadowMapSize, float shadowCameraNear, float shadowCameraFar ) {\n    float depth = ( length( V ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );    depth += shadowBias;\n    #ifdef USE_PCF_SOFT_SHADOW\n        float texelSize = shadowRadius / shadowMapSize.x;\n        vec3 poissonDisk[4];\n        poissonDisk[0] = vec3(-1.0, 1.0, -1.0);\n        poissonDisk[1] = vec3(1.0, -1.0, -1.0);\n        poissonDisk[2] = vec3(-1.0, -1.0, -1.0);\n        poissonDisk[3] = vec3(1.0, -1.0, 1.0);\n        return textureCubeCompare( shadowMap, normalize(V) + poissonDisk[0] * texelSize, depth ) * 0.25 +\n            textureCubeCompare( shadowMap, normalize(V) + poissonDisk[1] * texelSize, depth ) * 0.25 +\n            textureCubeCompare( shadowMap, normalize(V) + poissonDisk[2] * texelSize, depth ) * 0.25 +\n            textureCubeCompare( shadowMap, normalize(V) + poissonDisk[3] * texelSize, depth ) * 0.25;\n    #else\n        return textureCubeCompare( shadowMap, normalize(V), depth);\n    #endif\n}",shadowMap_frag:"#ifdef USE_SHADOW\n#endif",shadowMap_pars_frag:"#ifdef USE_SHADOW\n    #if NUM_DIR_LIGHTS > 0\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n    #endif\n    #if NUM_POINT_LIGHTS > 0\n        uniform samplerCube pointShadowMap[ NUM_POINT_LIGHTS ];\n    #endif\n    #if NUM_SPOT_LIGHTS > 0\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n        varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n    #endif\n    #include <packing>\n    #include <shadow>\n#endif",shadowMap_pars_vert:"#ifdef USE_SHADOW\n    #if NUM_DIR_LIGHTS > 0\n        uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n    #endif\n    #if NUM_POINT_LIGHTS > 0\n    #endif\n    #if NUM_SPOT_LIGHTS > 0\n        uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n        varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n    #endif\n#endif",shadowMap_vert:"#ifdef USE_SHADOW\n    vec4 worldPosition = u_Model * vec4(transformed, 1.0);\n    #if NUM_DIR_LIGHTS > 0\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n            vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n    #if NUM_POINT_LIGHTS > 0\n    #endif\n    #if NUM_SPOT_LIGHTS > 0\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n            vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n#endif",skinning_pars_vert:"#ifdef USE_SKINNING\n    attribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n    uniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n    #ifdef BONE_TEXTURE\n        uniform sampler2D boneTexture;\n        uniform int boneTextureSize;\n        mat4 getBoneMatrix( const in float i ) {\n            float j = i * 4.0;\n            float x = mod( j, float( boneTextureSize ) );\n            float y = floor( j / float( boneTextureSize ) );\n            float dx = 1.0 / float( boneTextureSize );\n            float dy = 1.0 / float( boneTextureSize );\n            y = dy * ( y + 0.5 );\n            vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n            vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n            vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n            vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n            mat4 bone = mat4( v1, v2, v3, v4 );\n            return bone;\n        }\n    #else\n        uniform mat4 boneMatrices[MAX_BONES];\n        mat4 getBoneMatrix(const in float i) {\n            mat4 bone = boneMatrices[int(i)];\n            return bone;\n        }\n    #endif\n#endif",skinning_vert:"#ifdef USE_SKINNING\n    mat4 boneMatX = getBoneMatrix( skinIndex.x );\n    mat4 boneMatY = getBoneMatrix( skinIndex.y );\n    mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n    mat4 boneMatW = getBoneMatrix( skinIndex.w );\n    vec4 skinVertex = bindMatrix * vec4(transformed, 1.0);\n    vec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned = bindMatrixInverse * skinned;\n    transformed = skinned.xyz / skinned.w;\n    #if defined(USE_NORMAL) || defined(USE_ENV_MAP)\n        mat4 skinMatrix = mat4( 0.0 );\n        skinMatrix += skinWeight.x * boneMatX;\n        skinMatrix += skinWeight.y * boneMatY;\n        skinMatrix += skinWeight.z * boneMatZ;\n        skinMatrix += skinWeight.w * boneMatW;\n        skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n        objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n    #endif\n#endif",specularMap_frag:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, v_Uv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularMap_pars_frag:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",spotlight_pars_frag:"struct SpotLight\n{\n    vec3 position;\n    vec4 color;\n    float intensity;\n    float distance;\n    float decay;\n    float coneCos;\n    float penumbraCos;\n    vec3 direction;\n    int shadow;\n    float shadowBias;\n    float shadowRadius;\n    vec2 shadowMapSize;\n};\nuniform SpotLight u_Spot[NUM_SPOT_LIGHTS];",tbn:"mat3 tbn(vec3 N, vec3 p, vec2 uv) {\n    vec3 dp1 = dFdx(p.xyz);\n    vec3 dp2 = dFdy(p.xyz);\n    vec2 duv1 = dFdx(uv.st);\n    vec2 duv2 = dFdy(uv.st);\n    vec3 dp2perp = cross(dp2, N);\n    vec3 dp1perp = cross(N, dp1);\n    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n    float invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B)));\n    return mat3(T * invmax, B * invmax, N);\n}",transpose:"mat4 transposeMat4(mat4 inMatrix) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}",tsn:"mat3 tsn(vec3 N, vec3 V, vec2 uv) {\n    vec3 q0 = dFdx( V.xyz );\n    vec3 q1 = dFdy( V.xyz );\n    vec2 st0 = dFdx( uv.st );\n    vec2 st1 = dFdy( uv.st );\n    vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n    mat3 tsn = mat3( S, T, N );\n    return tsn;\n}",uv_pars_frag:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(USE_SPECULARMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP)\n    varying vec2 v_Uv;\n#endif\n#ifdef USE_AOMAP\n    varying vec2 v_Uv2;\n#endif",uv_pars_vert:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(USE_SPECULARMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP)\n    attribute vec2 a_Uv;\n    varying vec2 v_Uv;\n    uniform mat3 uvTransform;\n#endif\n#ifdef USE_AOMAP\n    attribute vec2 a_Uv2;\n    varying vec2 v_Uv2;\n#endif\n",uv_vert:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(USE_SPECULARMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP)\n    v_Uv = (uvTransform * vec3(a_Uv, 1)).xy;\n#endif\n#ifdef USE_AOMAP\n    v_Uv2 = a_Uv2;\n#endif",viewModelPos_pars_frag:"#if (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || defined(USE_PHONG) || defined(USE_PBR) || (NUM_CLIPPING_PLANES > 0) \n    varying vec3 v_modelPos;\n#endif",viewModelPos_pars_vert:"#if (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || defined(USE_PHONG) || defined(USE_PBR)|| (NUM_CLIPPING_PLANES > 0)\n    varying vec3 v_modelPos;\n#endif",viewModelPos_vert:"#if (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || defined(USE_PHONG) || defined(USE_PBR) || (NUM_CLIPPING_PLANES > 0)\n    v_modelPos = (u_Model * vec4(transformed, 1.0)).xyz;\n#endif"},ii={basic_frag:"#include <common_frag>\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphaTest_frag>\n    #include <envMap_frag>\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",basic_vert:"#include <common_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <envMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <envMap_vert>\n}",canvas2d_frag:"#include <common_frag>\nvarying vec2 v_Uv;\nuniform sampler2D spriteTexture;\nvoid main() {\n    #include <begin_frag>\n    outColor *= texture2D(spriteTexture, v_Uv);\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n}",canvas2d_vert:"#include <common_vert>\nattribute vec2 a_Uv;\nvarying vec2 v_Uv;\nvoid main() {\n    #include <begin_vert>\n    #include <pvm_vert>\n    v_Uv = a_Uv;\n}",depth_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <uv_pars_frag>\n#include <packing>\nvoid main() {\n    #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n        vec4 texelColor = texture2D( diffuseMap, v_Uv );\n        float alpha = texelColor.a * u_Opacity;\n        if(alpha < ALPHATEST) discard;\n    #endif\n    \n    #ifdef DEPTH_PACKING_RGBA\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #else\n        gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), u_Opacity );\n    #endif\n}",depth_vert:"#include <common_vert>\n#include <skinning_pars_vert>\n#include <uv_pars_vert>\nvoid main() {\n    #include <uv_vert>\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n}",distance_frag:"#include <common_frag>\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 v_ModelPos;\n#include <packing>\nvoid main() {\n    float dist = length( v_ModelPos - u_CameraPosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n    gl_FragColor = packDepthToRGBA(dist);\n}",distance_vert:"#include <common_vert>\nvarying vec3 v_ModelPos;\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    v_ModelPos = (u_Model * vec4(transformed, 1.0)).xyz;\n}",lambert_frag:"#include <common_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    #include <light_frag>\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",lambert_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",linedashed_frag:"#include <common_frag>\n#include <fog_pars_frag>\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\nvoid main() {\n    if ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n    #include <begin_frag>\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",linedashed_vert:"#include <common_vert>\nuniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\nvoid main() {\n    vLineDistance = scale * lineDistance;\n    vec3 transformed = vec3(a_Position);\n    #include <pvm_vert>\n}",normaldepth_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <uv_pars_frag>\n#define USE_NORMAL\n#include <packing>\n#include <normal_pars_frag>\nvoid main() {\n    #if defined(USE_DIFFUSE_MAP) && defined(ALPHATEST)\n        vec4 texelColor = texture2D( diffuseMap, v_Uv );\n        float alpha = texelColor.a * u_Opacity;\n        if(alpha < ALPHATEST) discard;\n    #endif\n    vec4 packedNormalDepth;\n    packedNormalDepth.xyz = normalize(v_Normal) * 0.5 + 0.5;\n    packedNormalDepth.w = gl_FragCoord.z;\n    gl_FragColor = packedNormalDepth;\n}",normaldepth_vert:"#include <common_vert>\n#define USE_NORMAL\n#include <skinning_pars_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\nvoid main() {\n    #include <uv_vert>\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <normal_vert>\n    #include <pvm_vert>\n}",pbr_frag:"#include <common_frag>\nuniform float u_Metalness;\n#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif\nuniform float u_Roughness;\n#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    #include <specularMap_frag>\n    float roughnessFactor = u_Roughness;\n    #ifdef USE_ROUGHNESSMAP\n    \tvec4 texelRoughness = texture2D( roughnessMap, v_Uv );\n    \troughnessFactor *= texelRoughness.g;\n    #endif\n    float metalnessFactor = u_Metalness;\n    #ifdef USE_METALNESSMAP\n    \tvec4 texelMetalness = texture2D( metalnessMap, v_Uv );\n    \tmetalnessFactor *= texelMetalness.b;\n    #endif\n    #include <light_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",pbr_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",phong_frag:"#include <common_frag>\nuniform float u_Specular;\nuniform vec4 u_SpecularColor;\n#include <specularMap_pars_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <color_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <aoMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\n#include <clippingPlanes_pars_frag>\nvoid main() {\n    #include <clippingPlanes_frag>\n    #include <begin_frag>\n    #include <color_frag>\n    #include <diffuseMap_frag>\n    #include <alphaTest_frag>\n    #include <normal_frag>\n    #include <specularMap_frag>\n    #include <light_frag>\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",phong_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <color_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <color_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",point_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #ifdef USE_DIFFUSE_MAP\n        outColor *= texture2D(diffuseMap, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));\n    #endif\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",point_vert:"#include <common_vert>\nuniform float u_PointSize;\nuniform float u_PointScale;\nvoid main() {\n    #include <begin_vert>\n    #include <pvm_vert>\n    vec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n    #ifdef USE_SIZEATTENUATION\n        gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n    #else\n        gl_PointSize = u_PointSize;\n    #endif\n}"},ni={},ri=function(t){var e=/#include +<([\w\d.]+)>/g;return t.replace(e,function(t,e){var i=ei[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return ri(i)})},ai=new o,si=new f,oi=function(){var t,e=new x;return function(i,n){(!t||t.length<4*i.length)&&(t=new Float32Array(4*i.length));for(var r=0;r<i.length;r++)e.copy(i[r]),t[4*r+0]=e.normal.x,t[4*r+1]=e.normal.y,t[4*r+2]=e.normal.z,t[4*r+3]=e.constant;return t}}(),ui=[],hi=[],ci=[];Object.assign(ie.prototype,{clear:function(t,e,i){var n=this.gl,r=0;(void 0===t||t)&&(r|=n.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=n.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=n.STENCIL_BUFFER_BIT),n.clear(r)},render:function(t,e,i){var n;n=(i=void 0===i||i)?t.updateRenderList(e):t.getRenderList(e),this.renderPass(n.opaque,e,{scene:t,getMaterial:function(e){return t.overrideMaterial||e.material}}),this.renderPass(n.transparent,e,{scene:t,getMaterial:function(e){return t.overrideMaterial||e.material}})},renderPass:function(t,e,i){i=i||{};for(var n=this.gl,r=this.state,a=i.getMaterial||$t,s=i.beforeRender||ee,o=i.afterRender||ee,u=i.ifRender||te,h=i.scene||{},c=r.currentRenderTarget,l=0,d=t.length;l<d;l++){var p=t[l];if(u(p)){var f=p.object,_=a.call(this,p),m=p.geometry,v=p.group;f.onBeforeRender(p,_),s.call(this,p,_);var g=Jt(this,e,_,f,h);r.setProgram(g),this.geometry.setGeometry(m);var M=g.uuid+"_"+m.uuid;M!==this._currentGeometryProgram&&(this.setupVertexAttributes(g,m),this._currentGeometryProgram=M);var x=g.uniforms;for(var E in x){var y=x[E];if(_.uniforms&&void 0!==_.uniforms[E])if(y.type===Ye.SAMPLER_2D){I=this.allocTexUnit();this.texture.setTexture2D(_.uniforms[E],I),y.setValue(I)}else if(y.type===Ye.SAMPLER_CUBE){I=this.allocTexUnit();this.texture.setTextureCube(_.uniforms[E],I),y.setValue(I)}else y.set(_.uniforms[E]);else switch(E){case"u_Projection":if(f.type===Pe.CANVAS2D&&f.isScreenCanvas)T=f.orthoCamera.projectionMatrix.elements;else var T=e.projectionMatrix.elements;y.setValue(T);break;case"u_View":if(f.type===Pe.CANVAS2D&&f.isScreenCanvas)S=f.orthoCamera.viewMatrix.elements;else var S=e.viewMatrix.elements;y.setValue(S);break;case"u_Model":var b=f.worldMatrix.elements;y.setValue(b);break;case"u_Color":w=_.diffuse;y.setValue(w.r,w.g,w.b);break;case"u_Opacity":y.setValue(_.opacity);break;case"diffuseMap":I=this.allocTexUnit();this.texture.setTexture2D(_.diffuseMap,I),y.setValue(I);break;case"normalMap":I=this.allocTexUnit();this.texture.setTexture2D(_.normalMap,I),y.setValue(I);break;case"bumpMap":I=this.allocTexUnit();this.texture.setTexture2D(_.bumpMap,I),y.setValue(I);break;case"bumpScale":y.setValue(_.bumpScale);break;case"envMap":I=this.allocTexUnit();this.texture.setTextureCube(_.envMap,I),y.setValue(I);break;case"cubeMap":I=this.allocTexUnit();this.texture.setTextureCube(_.cubeMap,I),y.setValue(I);break;case"u_EnvMap_Intensity":y.setValue(_.envMapIntensity);break;case"u_Specular":y.setValue(_.shininess);break;case"u_SpecularColor":w=_.specular;y.setValue(w.r,w.g,w.b,1);break;case"specularMap":I=this.allocTexUnit();this.texture.setTexture2D(_.specularMap,I),y.setValue(I);break;case"aoMap":I=this.allocTexUnit();this.texture.setTexture2D(_.aoMap,I),y.setValue(I);break;case"aoMapIntensity":y.setValue(_.aoMapIntensity);break;case"u_Roughness":y.setValue(_.roughness);break;case"roughnessMap":I=this.allocTexUnit();this.texture.setTexture2D(_.roughnessMap,I),y.setValue(I);break;case"u_Metalness":y.setValue(_.metalness);break;case"metalnessMap":I=this.allocTexUnit();this.texture.setTexture2D(_.metalnessMap,I),y.setValue(I);break;case"emissive":var w=_.emissive,A=_.emissiveIntensity;y.setValue(w.r*A,w.g*A,w.b*A);break;case"emissiveMap":I=this.allocTexUnit();this.texture.setTexture2D(_.emissiveMap,I),y.setValue(I);break;case"u_CameraPosition":ai.setFromMatrixPosition(e.worldMatrix),y.setValue(ai.x,ai.y,ai.z);break;case"u_FogColor":w=h.fog.color;y.setValue(w.r,w.g,w.b);break;case"u_FogDensity":y.setValue(h.fog.density);break;case"u_FogNear":y.setValue(h.fog.near);break;case"u_FogFar":y.setValue(h.fog.far);break;case"u_PointSize":y.setValue(_.size);break;case"u_PointScale":var N=.5*c.height;y.setValue(N);break;case"dashSize":y.setValue(_.dashSize);break;case"totalSize":y.setValue(_.dashSize+_.gapSize);break;case"scale":y.setValue(_.scale);break;case"clippingPlanes[0]":var L=oi(h.clippingPlanes||[],e);n.uniform4fv(y.location,L);break;case"uvTransform":var C;(C=_.diffuseMap||_.specularMap||_.normalMap||_.bumpMap||_.roughnessMap||_.metalnessMap||_.emissiveMap)&&(C.matrixAutoUpdate&&C.updateMatrix(),y.setValue(C.matrix.elements))}}f.type===Pe.SKINNED_MESH&&this.uploadSkeleton(x,f,g.id),_.acceptLight&&h.lights&&this.uploadLights(x,h.lights,f.receiveShadow,e);var R=f.worldMatrix.determinant()<0;this.setStates(_,R);var P=si.set(c.width,c.height,c.width,c.height).multiply(e.rect);if(P.z-=P.x,P.w-=P.y,P.x=Math.floor(P.x),P.y=Math.floor(P.y),P.z=Math.floor(P.z),P.w=Math.floor(P.w),f.type===Pe.CANVAS2D){f.isScreenCanvas&&(f.setRenderViewport(P.x,P.y,P.z,P.w),r.viewport(f.viewport.x,f.viewport.y,f.viewport.z,f.viewport.w));for(var F=0,O=0;O<f.drawArray.length;O++){var U=f.drawArray[O],I=this.allocTexUnit();this.texture.setTexture2D(U.texture,I),x.spriteTexture.setValue(I),n.drawElements(n.TRIANGLES,6*U.count,n.UNSIGNED_SHORT,2*F),F+=6*U.count,this._usedTextureUnits=0}}else r.viewport(P.x,P.y,P.z,P.w),this.draw(m,_,v);this._usedTextureUnits=0,r.enable(n.DEPTH_TEST),r.depthMask(!0),r.colorMask(!0),o(this,p),f.onAfterRender(p)}}},setStates:function(t,e){var i=this.gl,n=this.state;t.transparent?n.setBlend(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):n.setBlend(Ie.NONE),t.depthTest?n.enable(i.DEPTH_TEST):n.disable(i.DEPTH_TEST),n.depthMask(t.depthWrite),n.colorMask(t.colorWrite),n.setCullFace(t.side===Ge.DOUBLE?Be.NONE:Be.BACK);var r=t.side===Ge.BACK;e&&(r=!r),n.setFlipSided(r),void 0!==t.lineWidth&&n.setLineWidth(t.lineWidth)},draw:function(t,e,i){var n=this.gl,r=this.properties,a=null!==t.index,s=0,o=a?t.index.count:t.getAttribute("a_Position").count,u=i?i.start:0,h=i?i.count:1/0;s=Math.max(s,u),o=Math.min(o,h);var c=2===this.capabilities.version,l=this.capabilities.angleInstancedArraysExt;if(a){var d=r.get(t.index),p=d.bytesPerElement,f=d.type;t.isInstancedGeometry?t.maxInstancedCount>0&&(c?n.drawElementsInstanced(e.drawMode,o,f,s*p,t.maxInstancedCount):l?l.drawElementsInstancedANGLE(e.drawMode,o,f,s*p,t.maxInstancedCount):console.warn("no support instanced draw.")):n.drawElements(e.drawMode,o,f,s*p)}else t.isInstancedGeometry?t.maxInstancedCount>0&&(c?n.drawArraysInstanced(e.drawMode,s,o,t.maxInstancedCount):l?l.drawArraysInstancedANGLE(e.drawMode,s,o,t.maxInstancedCount):console.warn("no support instanced draw.")):n.drawArrays(e.drawMode,s,o)},uploadSkeleton:function(t,e,i){if(e.skeleton&&e.skeleton.bones.length>0){var r=e.skeleton,a=this.gl,s=this.capabilities;if(r.updateBones(),s.maxVertexTextures>0&&s.floatTextures||2===s.version){if(void 0===r.boneTexture){var o=Math.sqrt(4*r.bones.length);o=n(Math.ceil(o)),o=Math.max(4,o);var u=new Float32Array(o*o*4);u.set(r.boneMatrices);var h=new C;h.image={data:u,width:o,height:o},2===s.version&&(h.internalformat=Ve.RGBA32F,h.format=Ve.RGBA),h.type=je.FLOAT,h.magFilter=Xe.NEAREST,h.minFilter=Xe.NEAREST,h.generateMipmaps=!1,h.flipY=!1,r.boneMatrices=u,r.boneTexture=h}var c=this.allocTexUnit();this.texture.setTexture2D(r.boneTexture,c),t.boneTexture&&t.boneTexture.setValue(c),t.boneTextureSize&&t.boneTextureSize.setValue(r.boneTexture.image.width)}else{var l=a.getUniformLocation(i,"boneMatrices");a.uniformMatrix4fv(l,!1,r.boneMatrices)}t.bindMatrix.setValue(e.bindMatrix.elements),t.bindMatrixInverse.setValue(e.bindMatrixInverse.elements)}},uploadLights:function(t,e,i,n){var r=this.gl;e.ambientsNum>0&&t.u_AmbientLightColor.set(e.ambient);for(u=0;u<e.directsNum;u++){h=e.directional[u];t["u_Directional["+u+"].direction"].set(h.direction),t["u_Directional["+u+"].intensity"].setValue(1),t["u_Directional["+u+"].color"].set(h.color);c=h.shadow&&i;if(t["u_Directional["+u+"].shadow"].setValue(c?1:0),c){t["u_Directional["+u+"].shadowBias"].setValue(h.shadowBias),t["u_Directional["+u+"].shadowRadius"].setValue(h.shadowRadius),t["u_Directional["+u+"].shadowMapSize"].set(h.shadowMapSize);l=this.allocTexUnit();this.texture.setTexture2D(e.directionalShadowMap[u],l),ui[u]=l}}if(ui.length>0){var a=t["directionalShadowMap[0]"];r.uniform1iv(a.location,ui),ui.length=0;var s=t["directionalShadowMatrix[0]"];r.uniformMatrix4fv(s.location,!1,e.directionalShadowMatrix)}for(u=0;u<e.pointsNum;u++){h=e.point[u];t["u_Point["+u+"].position"].set(h.position),t["u_Point["+u+"].intensity"].setValue(1),t["u_Point["+u+"].color"].set(h.color),t["u_Point["+u+"].distance"].setValue(h.distance),t["u_Point["+u+"].decay"].setValue(h.decay);c=h.shadow&&i;if(t["u_Point["+u+"].shadow"].setValue(c?1:0),c){t["u_Point["+u+"].shadowBias"].setValue(h.shadowBias),t["u_Point["+u+"].shadowRadius"].setValue(h.shadowRadius),t["u_Point["+u+"].shadowMapSize"].set(h.shadowMapSize),t["u_Point["+u+"].shadowCameraNear"].setValue(h.shadowCameraNear),t["u_Point["+u+"].shadowCameraFar"].setValue(h.shadowCameraFar);l=this.allocTexUnit();this.texture.setTextureCube(e.pointShadowMap[u],l),hi[u]=l}}if(hi.length>0){var o=t["pointShadowMap[0]"];r.uniform1iv(o.location,hi),hi.length=0}for(var u=0;u<e.spotsNum;u++){var h=e.spot[u];t["u_Spot["+u+"].position"].set(h.position),t["u_Spot["+u+"].direction"].set(h.direction),t["u_Spot["+u+"].intensity"].setValue(1),t["u_Spot["+u+"].color"].set(h.color),t["u_Spot["+u+"].distance"].setValue(h.distance),t["u_Spot["+u+"].decay"].setValue(h.decay),t["u_Spot["+u+"].coneCos"].setValue(h.coneCos),t["u_Spot["+u+"].penumbraCos"].setValue(h.penumbraCos);var c=h.shadow&&i;if(t["u_Spot["+u+"].shadow"].setValue(c?1:0),c){t["u_Spot["+u+"].shadowBias"].setValue(h.shadowBias),t["u_Spot["+u+"].shadowRadius"].setValue(h.shadowRadius),t["u_Spot["+u+"].shadowMapSize"].set(h.shadowMapSize);var l=this.allocTexUnit();this.texture.setTexture2D(e.spotShadowMap[u],l),ci[u]=l}}if(ci.length>0){var d=t["spotShadowMap[0]"];r.uniform1iv(d.location,ci),ci.length=0;var p=t["spotShadowMatrix[0]"];r.uniformMatrix4fv(p.location,!1,e.spotShadowMatrix)}},allocTexUnit:function(){var t=this._usedTextureUnits;return t>=this.capabilities.maxTextures&&console.warn("trying to use "+t+" texture units while this GPU supports only "+this.capabilities.maxTextures),this._usedTextureUnits+=1,t},setupVertexAttributes:function(t,e){var i=this.gl,n=t.attributes,r=this.properties,a=this.capabilities.angleInstancedArraysExt,s=2===this.capabilities.version;for(var o in n){var u=n[o],h=e.getAttribute(o);if(h){var c=h.normalized,l=h.size;u.count!==l&&console.warn("WebGLCore: attribute "+o+" size not match! "+u.count+" : "+l);var d,p=(d=h.isInterleavedBufferAttribute?r.get(h.data):r.get(h)).buffer,f=d.type;u.format;var _=d.bytesPerElement;if(h.isInterleavedBufferAttribute){var m=h.data,v=m.stride,g=h.offset;i.enableVertexAttribArray(u.location),m&&m.isInstancedInterleavedBuffer&&(s?i.vertexAttribDivisor(u.location,m.meshPerAttribute):a?a.vertexAttribDivisorANGLE(u.location,m.meshPerAttribute):console.warn("vertexAttribDivisor not supported"),void 0===e.maxInstancedCount&&(e.maxInstancedCount=m.meshPerAttribute*m.count)),i.bindBuffer(i.ARRAY_BUFFER,p),i.vertexAttribPointer(u.location,u.count,f,c,_*v,_*g)}else i.enableVertexAttribArray(u.location),h&&h.isInstancedBufferAttribute&&(s?i.vertexAttribDivisor(u.location,h.meshPerAttribute):a?a.vertexAttribDivisorANGLE(u.location,h.meshPerAttribute):console.warn("vertexAttribDivisor not supported"),void 0===e.maxInstancedCount&&(e.maxInstancedCount=h.meshPerAttribute*h.count)),i.bindBuffer(i.ARRAY_BUFFER,p),i.vertexAttribPointer(u.location,u.count,f,c,0,0)}else console.warn("WebGLCore: geometry attribute "+o+" not found!")}if(e.index){var M=r.get(e.index);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,M.buffer)}}}),ne.prototype=Object.assign(Object.create(P.prototype),{constructor:ne,lookAt:function(){var t=new s;return function(e,i){t.lookAtRH(this.position,e,i),this.quaternion.setFromRotationMatrix(t)}}(),setOrtho:function(t,e,i,n,r,a){this.projectionMatrix.set(2/(e-t),0,0,-(e+t)/(e-t),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1)},setPerspective:function(t,e,i,n){this.projectionMatrix.set(1/(e*Math.tan(t/2)),0,0,0,0,1/Math.tan(t/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},getWorldDirection:function(){var t=new o,e=new m,i=new o;return function(n){var r=n||new o;return this.worldMatrix.decompose(t,e,i),r.set(0,0,-1).applyQuaternion(e),r}}(),updateMatrix:function(){var t=new s;return function(){P.prototype.updateMatrix.call(this),this.viewMatrix.getInverse(this.worldMatrix),t.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.frustum.setFromMatrix(t)}}(),copy:function(t,e){return P.prototype.copy.call(this,t,e),this.viewMatrix.copy(t.viewMatrix),this.projectionMatrix.copy(t.projectionMatrix),this}}),re.prototype=Object.assign(Object.create(a.prototype),{constructor:re,resize:function(t,e){return(this.width!==t||this.height!==e)&&(this.dispose(),this.width=t,this.height=e,!0)},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ae.prototype=Object.create(re.prototype),ae.prototype.constructor=ae,ae.prototype=Object.assign(Object.create(re.prototype),{constructor:ae,resize:function(t,e){if(re.prototype.resize.call(this,t,e)&&this._texture){this._texture.version++;for(var i=0;i<6;i++)this._texture.images[i]={data:null,width:this.width,height:this.height}}}}),Object.defineProperties(ae.prototype,{texture:{set:function(t){if(t){t.version++;for(var e=0;e<6;e++)t.images[e]={data:null,width:this.width,height:this.height}}this._texture=t},get:function(){return this._texture}}}),se.prototype.render=function(t,e){this.camera.position.copy(this.position);for(var i=0;i<6;i++)this.lookTarget.set(this.targets[i].x+this.camera.position.x,this.targets[i].y+this.camera.position.y,this.targets[i].z+this.camera.position.z),this.camera.lookAt(this.lookTarget,this.ups[i]),this.camera.updateMatrix(),this.renderTarget.activeCubeFace=i,t.texture.setRenderTarget(this.renderTarget),t.clear(!0,!0,!0),t.render(e,this.camera),t.texture.updateRenderTargetMipmap(this.renderTarget)},oe.prototype.render=function(t,e){var i=t.gl,n=t.state,r=n.states[i.STENCIL_TEST]&&!1;r&&n.disable(i.STENCIL_TEST),this.oldClearColor.copy(n.currentClearColor),n.clearColor(1,1,1,1);for(var a=e.lights.shadows,s=0;s<a.length;s++);r&&n.enable(i.STENCIL_TEST),n.clearColor(this.oldClearColor.x,this.oldClearColor.y,this.oldClearColor.z,this.oldClearColor.w)};var li=new o,di={};Object.assign(he.prototype,{startCount:function(){for(var t=0;t<3;t++)this.ambient[t]=0;this.shadows.length=0,this.ambientsNum=0,this.directsNum=0,this.pointsNum=0,this.spotsNum=0,this.shadowsNum=0,this.totalNum=0},add:function(t){t.lightType==Fe.AMBIENT?this._doAddAmbientLight(t):t.lightType==Fe.DIRECT?this._doAddDirectLight(t):t.lightType==Fe.POINT?this._doAddPointLight(t):t.lightType==Fe.SPOT&&this._doAddSpotLight(t),t.castShadow&&t.lightType!==Fe.AMBIENT&&(this.shadows.push(t),this.shadowsNum++),this.totalNum++},endCount:function(){},_doAddAmbientLight:function(t){var e=t.intensity,i=t.color;this.ambient[0]+=i.r*e,this.ambient[1]+=i.g*e,this.ambient[2]+=i.b*e,this.ambientsNum++},_doAddDirectLight:function(t){var e=t.intensity,i=t.color,n=ue(t);n.color[0]=i.r*e,n.color[1]=i.g*e,n.color[2]=i.b*e;var r=li;if(t.getWorldDirection(r),n.direction[0]=r.x,n.direction[1]=r.y,n.direction[2]=r.z,t.castShadow?(n.shadow=!0,n.shadowBias=t.shadow.bias,n.shadowRadius=t.shadow.radius,n.shadowMapSize[0]=t.shadow.mapSize.x,n.shadowMapSize[1]=t.shadow.mapSize.y):n.shadow=!1,t.castShadow){var a=16*(this.directsNum+1);if(this.directionalShadowMatrix.length<a){var s=this.directionalShadowMatrix;this.directionalShadowMatrix=new Float32Array(a),this.directionalShadowMatrix.set(s)}this.directionalShadowMatrix.set(t.shadow.matrix.elements,16*this.directsNum),this.directionalShadowMap[this.directsNum]=t.shadow.map}this.directional[this.directsNum]=n,this.directsNum++},_doAddPointLight:function(t){var e=t.intensity,i=t.color,n=t.distance,r=t.decay,a=ue(t);a.color[0]=i.r*e,a.color[1]=i.g*e,a.color[2]=i.b*e,a.distance=n,a.decay=r;var s=li.setFromMatrixPosition(t.worldMatrix);if(a.position[0]=s.x,a.position[1]=s.y,a.position[2]=s.z,t.castShadow?(a.shadow=!0,a.shadowBias=t.shadow.bias,a.shadowRadius=t.shadow.radius,a.shadowMapSize[0]=t.shadow.mapSize.x,a.shadowMapSize[1]=t.shadow.mapSize.y,a.shadowCameraNear=t.shadow.cameraNear,a.shadowCameraFar=t.shadow.cameraFar):a.shadow=!1,t.castShadow){var o=16*(this.pointsNum+1);if(this.pointShadowMatrix.length<o){var u=this.pointShadowMatrix;this.pointShadowMatrix=new Float32Array(o),this.pointShadowMatrix.set(u)}this.pointShadowMatrix.set(t.shadow.matrix.elements,16*this.pointsNum),this.pointShadowMap[this.pointsNum]=t.shadow.map}this.point[this.pointsNum]=a,this.pointsNum++},_doAddSpotLight:function(t){var e=t.intensity,i=t.color,n=t.distance,r=t.decay,a=ue(t);a.color[0]=i.r*e,a.color[1]=i.g*e,a.color[2]=i.b*e,a.distance=n,a.decay=r;var s=li.setFromMatrixPosition(t.worldMatrix);a.position[0]=s.x,a.position[1]=s.y,a.position[2]=s.z;var o=li;t.getWorldDirection(li),a.direction[0]=o.x,a.direction[1]=o.y,a.direction[2]=o.z;var u=Math.cos(t.angle),h=Math.cos(t.angle*(1-t.penumbra));if(a.coneCos=u,a.penumbraCos=h,t.castShadow?(a.shadow=!0,a.shadowBias=t.shadow.bias,a.shadowRadius=t.shadow.radius,a.shadowMapSize[0]=t.shadow.mapSize.x,a.shadowMapSize[1]=t.shadow.mapSize.y):a.shadow=!1,t.castShadow){var c=16*(this.spotsNum+1);if(this.spotShadowMatrix.length<c){var l=this.spotShadowMatrix;this.spotShadowMatrix=new Float32Array(c),this.spotShadowMatrix.set(l)}this.spotShadowMatrix.set(t.shadow.matrix.elements,16*this.spotsNum),this.spotShadowMap[this.spotsNum]=t.shadow.map}this.spot[this.spotsNum]=a,this.spotsNum++}});var pi=new o,fi=new M,_i=function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z-e.z},mi=function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:e.z-t.z};le.prototype=Object.assign(Object.create(P.prototype),{constructor:le,updateRenderList:function(t){var e=t.uuid;this._renderLists[e]||(this._renderLists[e]=new ce);var i=this._renderLists[e];return i.startCount(),this._doUpdateRenderList(this,t,i),i.endCount(),i.sort(),i},getRenderList:function(t){return this._renderLists[t.uuid]},updateLights:function(){var t=this.lights;return t.startCount(),this._doUpdateLights(this),t.endCount(),t},_doUpdateRenderList:function(t,e,i){if(t.visible&&(t.geometry&&t.material&&i.add(t,e),Pe.CANVAS2D!==t.type))for(var n=t.children,r=0,a=n.length;r<a;r++)this._doUpdateRenderList(n[r],e,i)},_doUpdateLights:function(t){if(t.visible&&(Pe.LIGHT===t.type&&this.lights.add(t),Pe.CANVAS2D!==t.type))for(var e=t.children,i=0,n=e.length;i<n;i++)this._doUpdateLights(e[i])}}),de.prototype=Object.assign(Object.create(P.prototype),{constructor:de,raycast:function(){function t(t,e,i,n,r,a,s){return T.barycoordFromPoint(t,e,i,n,h),r.multiplyScalar(h.x),a.multiplyScalar(h.y),s.multiplyScalar(h.z),r.add(a).add(s),r.clone()}function e(t,e,i,n,r,a,s){t.material;if(null===i.intersectTriangle(a,r,n,!0,s))return null;x.copy(s),x.applyMatrix4(t.worldMatrix);var o=e.ray.origin.distanceTo(x);return o<e.near||o>e.far?null:{distance:o,point:x.clone(),object:t}}var i=new M,n=new g,r=new s,a=new u,h=new o,c=new o,l=new o,d=new o,f=new p,_=new p,m=new p,v=new o,x=new o;return function(s,o){var u=this.geometry,h=this.worldMatrix;if(i.copy(u.boundingSphere),i.applyMatrix4(h),s.ray.intersectsSphere(i)&&(n.copy(u.boundingBox),n.applyMatrix4(h),s.ray.intersectsBox(n))){r.getInverse(h),a.copy(s.ray).applyMatrix4(r);for(var p,g,M,x=u.index.array,E=u.getAttribute("a_Position"),y=u.getAttribute("a_Uv"),T=0;T<x.length;T+=3){p=x[T],g=x[T+1],M=x[T+2],c.fromArray(E.array,3*p),l.fromArray(E.array,3*g),d.fromArray(E.array,3*M);var S=e(this,s,a,c,l,d,v);S&&(f.fromArray(y.array,2*p),_.fromArray(y.array,2*g),m.fromArray(y.array,2*M),S.uv=t(v,c,l,d,f,_,m),S.face=[p,g,M],S.faceIndex=p,o.push(S))}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),pe.prototype.render=function(t){t.renderPass(this.renderList.opaque,this.camera,this.renderConfig)},fe.prototype=Object.assign(Object.create(re.prototype),{constructor:fe,resize:function(t,e){this.view.width=t,this.view.height=e,this.width=t,this.height=e},dispose:function(){}}),Object.assign(_e.prototype,{getEntity:function(t){return this._entities[t]},getFps:function(){var t=this.getEntity("fps");return t&&t.averageDelta?Math.floor(1e3/t.averageDelta):0},updateFps:function(){this.enableCounter&&(this.endCounter("fps"),this.startCounter("fps",60))},getNow:function(){return window.performance?window.performance.now():(new Date).getTime()},startCounter:function(t,e){if(this.enableCounter){var i=this._entities[t];i||(i={start:0,end:0,delta:0,_cache:[],averageRange:1,averageDelta:0},this._entities[t]=i),i.start=this.getNow(),i.averageRange=e||1}},endCounter:function(t){if(this.enableCounter){var e=this._entities[t];if(e&&(e.end=this.getNow(),e.delta=e.end-e.start,e.averageRange>1)){e._cache.push(e.delta);var i=e._cache.length;if(i>=e.averageRange){i>e.averageRange&&(e._cache.shift(),i--);for(var n=0,r=0;r<i;r++)n+=e._cache[r];e.averageDelta=n/i}}}}}),me.prototype.render=function(t,e,i,n){var r=this.performance;r.updateFps(),r.startCounter("render",60),this.matrixAutoUpdate&&t.updateMatrix(),this.lightsAutoupdate&&t.updateLights(),r.startCounter("renderShadow",60),(this.shadowAutoUpdate||this.shadowNeedsUpdate)&&(this.shadowMapPass.render(this.glCore,t),this.shadowNeedsUpdate=!1),r.endCounter("renderShadow"),void 0===i&&(i=this.backRenderTarget),this.glCore.texture.setRenderTarget(i),(this.autoClear||n)&&this.glCore.clear(!0,!0,!0),r.startCounter("renderList",60),this.glCore.render(t,e),r.endCounter("renderList"),i.texture&&this.glCore.texture.updateRenderTargetMipmap(i),this.performance.endCounter("render")},ve.prototype=Object.assign(Object.create(re.prototype),{constructor:ve,attach:function(t,e){t.image&&t.image.rtt?t.image.width===this.width&&t.image.height===this.height||(t.version++,t.image.width=this.width,t.image.height=this.height):(t.version++,t.image={rtt:!0,data:null,width:this.width,height:this.height}),this._textures[e||$e.COLOR_ATTACHMENT0]=t},detach:function(t){delete this._textures[t||$e.COLOR_ATTACHMENT0]},resize:function(t,e){var i=re.prototype.resize.call(this,t,e);if(i)for(var n in this._textures){var r=this._textures[n];r&&(r.image={rtt:!0,data:null,width:this.width,height:this.height},r.version++)}return i}}),Object.defineProperties(ve.prototype,{texture:{set:function(t){t?this.attach(t,$e.COLOR_ATTACHMENT0):this.detach($e.COLOR_ATTACHMENT0)},get:function(){return this._textures[$e.COLOR_ATTACHMENT0]}}}),(ge.prototype=Object.create(P.prototype)).constructor=ge,Me.prototype=Object.assign(Object.create(P.prototype),{constructor:Me,copy:function(t){return P.prototype.copy.call(this,t),this.type=t.type,this.lightType=t.lightType,this.color.copy(t.color),this.intensity=t.intensity,this}}),(xe.prototype=Object.create(Me.prototype)).constructor=xe,Object.assign(Ee.prototype,{update:function(t,e){},copy:function(t){return this.camera.copy(t.camera),this.matrix.copy(t.matrix),this.bias=t.bias,this.radius=t.radius,this.cameraNear=t.cameraNear,this.cameraFar=t.cameraFar,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)}}),ye.prototype=Object.assign(Object.create(Ee.prototype),{constructor:ye,update:function(t){this._updateCamera(t),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},_updateCamera:function(t){var e=this.camera,i=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),i.set(i.x+e.position.x,i.y+e.position.y,i.z+e.position.z),e.lookAt(i,this._up),e.updateMatrix();var n=this.windowSize/2;e.setOrtho(-n,n,-n,n,this.cameraNear,this.cameraFar)},_updateMatrix:function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},copy:function(t){return Ee.prototype.copy.call(this,t),this.windowSize=t.windowSize,this}}),Te.prototype=Object.assign(Object.create(Me.prototype),{constructor:Te,copy:function(t){return Me.prototype.copy.call(this,t),this.shadow.copy(t.shadow),this}}),Se.prototype=Object.assign(Object.create(Ee.prototype),{constructor:Se,update:function(t,e){this._updateCamera(t,e),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},_updateCamera:function(t,e){var i=this.camera,n=this._lookTarget,r=this._targets,a=this._ups;i.position.setFromMatrixPosition(t.worldMatrix),n.set(r[e].x+i.position.x,r[e].y+i.position.y,r[e].z+i.position.z),i.lookAt(n,a[e]),i.updateMatrix(),i.setPerspective(.5*Math.PI,1,this.cameraNear,this.cameraFar)},_updateMatrix:function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)}}),be.prototype=Object.assign(Object.create(Me.prototype),{constructor:be,copy:function(t){return Me.prototype.copy.call(this,t),this.shadow.copy(t.shadow),this}}),we.prototype=Object.assign(Object.create(Ee.prototype),{constructor:we,update:function(t){this._updateCamera(t),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},_updateCamera:function(t){var e=this.camera,i=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),i.set(i.x+e.position.x,i.y+e.position.y,i.z+e.position.z),e.lookAt(i,this._up),e.updateMatrix(),e.setPerspective(2*t.angle,1,this.cameraNear,this.cameraFar)},_updateMatrix:function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)}}),Ae.prototype=Object.assign(Object.create(Me.prototype),{constructor:Ae,copy:function(t){return Me.prototype.copy.call(this,t),this.shadow.copy(t.shadow),this}}),Ne.prototype=Object.assign(Object.create(de.prototype),{constructor:Ne,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrix(),e=this.worldMatrix),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},updateMatrix:function(){de.prototype.updateMatrix.call(this),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.worldMatrix):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("zen3d.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),t.ColorKeyframeTrack=H,t.Sphere=M,t.Box3=g,t.ShaderLib=ii,t.EnvironmentMapPass=se,t.TextureCube=R,t.LineDashedMaterial=pt,t.QuaternionKeyframeTrack=X,t.Euler=d,t.Color3=y,t.WebGLState=Mt,t.BufferAttribute=q,t.Raycaster=h,t.Camera=ne,t.KeyframeClip=V,t.RenderList=ce,t.KeyframeTrack=G,t.SpotLightShadow=we,t.Vector3=o,t.InterleavedBuffer=tt,t.InterleavedBufferAttribute=it,t.SpotLight=Ae,t.DirectionalLightShadow=ye,t.Quaternion=m,t.WebGLTexture=At,t.WebGLGeometry=Pt,t.Light=Me,t.AnimationMixer=B,t.TextureBase=w,t.CubeGeometry=K,t.Ray=u,t.RenderTargetBack=fe,t.RenderTargetBase=re,t.Group=ge,t.WebGLCapabilities=vt,t.DistanceMaterial=mt,t.RenderTargetCube=ae,t.TGALoader=L,t.PointLightShadow=Se,t.Frustum=E,t.Spherical=b,t.InstancedInterleavedBuffer=et,t.PBRMaterial=ht,t.InstancedBufferAttribute=J,t.PhongMaterial=ut,t.Mesh=de,t.ImageLoader=A,t.ShaderMaterial=ft,t.DirectionalLight=Te,t.EventDispatcher=a,t.PropertyBindingMixer=z,t.PointsMaterial=ct,t.DepthMaterial=_t,t.LightShadow=Ee,t.Box2=v,t.Matrix4=s,t.BooleanKeyframeTrack=k,t.FileLoader=N,t.Fog=function(t,e,i){this.fogType=Ue.NORMAL,this.color=new y(void 0!==t?t:0),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3},t.Object3D=P,t.Skeleton=O,t.Vector2=p,t.StringKeyframeTrack=W,t.SphereGeometry=rt,t.Matrix3=_,t.Geometry=Z,t.LightCache=he,t.ShaderChunk=ei,t.ShaderPostPass=pe,t.Texture2D=C,t.SkinnedMesh=Ne,t.Triangle=T,t.Scene=le,t.Curve=S,t.BasicMaterial=st,t.Vector4=f,t.LambertMaterial=ot,t.LineLoopMaterial=dt,t.ShadowMapPass=oe,t.WebGLProgram=Gt,t.Plane=x,t.InstancedGeometry=$,t.PlaneGeometry=nt,t.VectorKeyframeTrack=Y,t.LineMaterial=lt,t.WebGLCore=ie,t.Bone=F,t.WebGLProperties=xt,t.WebGLAttribute=Ot,t.WebGLUniform=Ft,t.NumberKeyframeTrack=j,t.Renderer=me,t.PointLight=be,t.RenderTarget2D=ve,t.Material=at,t.FogExp2=function(t,e){this.fogType=Ue.EXP2,this.color=new y(void 0!==t?t:0),this.density=void 0!==e?e:25e-5},t.CylinderGeometry=Q,t.AmbientLight=xe,t.generateUUID=Le,t.isMobile=Ce,t.isWeb=Re,t.createCheckerBoardPixels=function(t,e,i){var n=new Uint8Array(t*e*4),r=[[255,255,255,255],[0,0,0,255]];i=i||5;for(var a=0,s=0;s<e;s++)for(var o=0;o<t;o++){if(0==o?a=1:o%i==0&&(a=(a+1)%2),s%i==0&&0==o){var u=r[0];r[0]=r[1],r[1]=u}n[s*(4*t)+4*o+0]=r[a][0],n[s*(4*t)+4*o+1]=r[a][1],n[s*(4*t)+4*o+2]=r[a][2],n[s*(4*t)+4*o+3]=r[a][3]}return n},t.isPowerOfTwo=e,t.nearestPowerOfTwo=i,t.nextPowerOfTwo=n,t.cloneUniforms=r,t.halton=function(t,e){for(var i=0,n=1/e,r=t;r>0;)i+=n*(r%e),r=Math.floor(r/e),n/=e;return i},t.DRAW_SIDE=Ge,t.DRAW_MODE=Je,t.WEBGL_UNIFORM_TYPE=Ye,t.BLEND_FACTOR=ze,t.BLEND_EQUATION=De,t.ATTACHMENT=$e,t.DRAW_BUFFER=ti,t.BLEND_TYPE=Ie,t.WEBGL_ATTRIBUTE_TYPE=qe,t.SHADOW_TYPE=Ze,t.LIGHT_TYPE=Fe,t.WEBGL_PIXEL_FORMAT=Ve,t.WEBGL_PIXEL_TYPE=je,t.OBJECT_TYPE=Pe,t.MATERIAL_TYPE=Oe,t.SHADING_TYPE=ke,t.WEBGL_TEXTURE_FILTER=Xe,t.WEBGL_TEXTURE_WRAP=We,t.ENVMAP_COMBINE_TYPE=Qe,t.TEXEL_ENCODING_TYPE=Ke,t.FOG_TYPE=Ue,t.CULL_FACE_TYPE=Be,t.WEBGL_TEXTURE_TYPE=He,Object.defineProperty(t,"__esModule",{value:!0})});