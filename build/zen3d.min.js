!function(t){var e=t.zen3d=t.zen3d||{},i=function(){},n=function(t,e){i.prototype=e.prototype,t.superClass=e.prototype,t.prototype=new i,t.prototype.constructor=t};e.inherit=n;var r=function(){if(!t.navigator)return!0;var e=navigator.userAgent.toLowerCase();return e.indexOf("mobile")!=-1||e.indexOf("android")!=-1};e.isMobile=r;var a=function(t,e){var i=["","WEBKIT_","MOZ_"],n=null;for(var r in i)if(n=t.getExtension(i[r]+e))break;return n};e.getExtension=a;var o=function(t){var e=t>>16&255,i=t>>8&255,n=255&t;return[e,i,n]};e.hex2RGB=o;var s=function(t,e,i){var n=new Uint8Array(t*e*4),r=[[255,255,255,255],[0,0,0,255]];i=i||5;for(var a=0,o=0;o<e;o++)for(var s=0;s<t;s++){if(0==s?a=1:s%i==0&&(a=(a+1)%2),o%i==0&&0==s){var h=r[0];r[0]=r[1],r[1]=h}n[o*(4*t)+4*s+0]=r[a][0],n[o*(4*t)+4*s+1]=r[a][1],n[o*(4*t)+4*s+2]=r[a][2],n[o*(4*t)+4*s+3]=r[a][3]}return n};e.createCheckerBoardPixels=s;var h=function(t){return 0===(t&t-1)&&0!==t};e.isPowerOf2=h;var u=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))};e.nearestPowerOf2=u;var c=function(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");e.width=u(t.width),e.height=u(t.height);var i=e.getContext("2d");return i.drawImage(t,0,0,e.width,e.height),console.warn("image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t};e.makePowerOf2=c}(window),function(){var t={MESH:"mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group"};zen3d.OBJECT_TYPE=t;var e={AMBIENT:"ambient",DIRECT:"direct",POINT:"point",SPOT:"spot"};zen3d.LIGHT_TYPE=e;var i={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",CUBE:"cube"};zen3d.MATERIAL_TYPE=i;var n={NORMAL:"normal",EXP2:"exp2"};zen3d.FOG_TYPE=n;var r={NONE:"none",NORMAL:"normal"};zen3d.BLEND_TYPE=r;var a={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"};zen3d.CULL_FACE_TYPE=a}(),function(){var t=function(e,i,n,r){this._x=e||0,this._y=i||0,this._z=n||0,this._order=r||t.DefaultOrder};t.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],t.DefaultOrder="XYZ",Object.defineProperties(t.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),t.prototype.copyFrom=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},t.prototype.set=function(t,e,i,n){return this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||this._order,this.onChangeCallback(),this},t.prototype.setFromRotationMatrix=function(t,e,i){var n=function(t,e,i){return Math.max(e,Math.min(i,t))},r=t.elements,a=r[0],o=r[4],s=r[8],h=r[1],u=r[5],c=r[9],d=r[2],l=r[6],p=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(l,u),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,p),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-d,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===e?(this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(l,p),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===e?(this._z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-d,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(l,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("given unsupported order: "+e),this._order=e,i!==!1&&this.onChangeCallback(),this},t.prototype.setFromQuaternion=function(t,e,i){var n=zen3d.helpMatrix;return t.toMatrix4(n),this.setFromRotationMatrix(n,e,i)},t.prototype.onChange=function(t){return this.onChangeCallback=t,this},t.prototype.onChangeCallback=function(){},zen3d.Euler=t}(),function(){var t=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};t.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},t.prototype.set=function(t,e,i,n,r,a,o,s,h,u,c,d,l,p,f,_){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=n,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=h,m[6]=u,m[10]=c,m[14]=d,m[3]=l,m[7]=p,m[11]=f,m[15]=_,this},t.prototype.copy=function(t){return this.elements.set(t.elements),this},t.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},t.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},t.prototype.multiplyMatrices=function(t,e){var i=t.elements,n=e.elements,r=this.elements,a=i[0],o=i[4],s=i[8],h=i[12],u=i[1],c=i[5],d=i[9],l=i[13],p=i[2],f=i[6],_=i[10],m=i[14],v=i[3],E=i[7],g=i[11],T=i[15],M=n[0],y=n[4],x=n[8],b=n[12],S=n[1],w=n[5],P=n[9],z=n[13],L=n[2],A=n[6],R=n[10],C=n[14],U=n[3],I=n[7],F=n[11],N=n[15];return r[0]=a*M+o*S+s*L+h*U,r[4]=a*y+o*w+s*A+h*I,r[8]=a*x+o*P+s*R+h*F,r[12]=a*b+o*z+s*C+h*N,r[1]=u*M+c*S+d*L+l*U,r[5]=u*y+c*w+d*A+l*I,r[9]=u*x+c*P+d*R+l*F,r[13]=u*b+c*z+d*C+l*N,r[2]=p*M+f*S+_*L+m*U,r[6]=p*y+f*w+_*A+m*I,r[10]=p*x+f*P+_*R+m*F,r[14]=p*b+f*z+_*C+m*N,r[3]=v*M+E*S+g*L+T*U,r[7]=v*y+E*w+g*A+T*I,r[11]=v*x+E*P+g*R+T*F,r[15]=v*b+E*z+g*C+T*N,this},t.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},t.prototype.inverse=function(){return this.getInverse(this)},t.prototype.getInverse=function(t){var e=this.elements,i=t.elements,n=i[0],r=i[1],a=i[2],o=i[3],s=i[4],h=i[5],u=i[6],c=i[7],d=i[8],l=i[9],p=i[10],f=i[11],_=i[12],m=i[13],v=i[14],E=i[15],g=l*v*c-m*p*c+m*u*f-h*v*f-l*u*E+h*p*E,T=_*p*c-d*v*c-_*u*f+s*v*f+d*u*E-s*p*E,M=d*m*c-_*l*c+_*h*f-s*m*f-d*h*E+s*l*E,y=_*l*u-d*m*u-_*h*p+s*m*p+d*h*v-s*l*v,x=n*g+r*T+a*M+o*y;if(0===x)return console.warn("can't invert matrix, determinant is 0"),this.identity();var b=1/x;return e[0]=g*b,e[1]=(m*p*o-l*v*o-m*a*f+r*v*f+l*a*E-r*p*E)*b,e[2]=(h*v*o-m*u*o+m*a*c-r*v*c-h*a*E+r*u*E)*b,e[3]=(l*u*o-h*p*o-l*a*c+r*p*c+h*a*f-r*u*f)*b,e[4]=T*b,e[5]=(d*v*o-_*p*o+_*a*f-n*v*f-d*a*E+n*p*E)*b,e[6]=(_*u*o-s*v*o-_*a*c+n*v*c+s*a*E-n*u*E)*b,e[7]=(s*p*o-d*u*o+d*a*c-n*p*c-s*a*f+n*u*f)*b,e[8]=M*b,e[9]=(_*l*o-d*m*o-_*r*f+n*m*f+d*r*E-n*l*E)*b,e[10]=(s*m*o-_*h*o+_*r*c-n*m*c-s*r*E+n*h*E)*b,e[11]=(d*h*o-s*l*o-d*r*c+n*l*c+s*r*f-n*h*f)*b,e[12]=y*b,e[13]=(d*m*a-_*l*a+_*r*p-n*m*p-d*r*v+n*l*v)*b,e[14]=(_*h*a-s*m*a-_*r*u+n*m*u+s*r*v-n*h*v)*b,e[15]=(s*l*a-d*h*a+d*r*u-n*l*u-s*r*p+n*h*p)*b,this},t.prototype.transform=function(t,e,i){var n=i.toMatrix4(),r=n.elements,a=this.elements;return a[0]=r[0]*e.x,a[1]=r[1]*e.y,a[2]=r[2]*e.z,a[3]=0,a[4]=r[4]*e.x,a[5]=r[5]*e.y,a[6]=r[6]*e.z,a[7]=0,a[8]=r[8]*e.x,a[9]=r[9]*e.y,a[10]=r[10]*e.z,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this},t.prototype.makeRotationFromQuaternion=function(t){var e=this.elements,i=t.x,n=t.y,r=t.z,a=t.w,o=i+i,s=n+n,h=r+r,u=i*o,c=i*s,d=i*h,l=n*s,p=n*h,f=r*h,_=a*o,m=a*s,v=a*h;return e[0]=1-(l+f),e[4]=c-v,e[8]=d+m,e[1]=c+v,e[5]=1-(u+f),e[9]=p-_,e[2]=d-m,e[6]=p+_,e[10]=1-(u+l),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this};var e,i;t.prototype.decompose=function(n,r,a){void 0===e&&(e=new zen3d.Vector3,i=new t);var o=this.elements,s=e.set(o[0],o[1],o[2]).getLength(),h=e.set(o[4],o[5],o[6]).getLength(),u=e.set(o[8],o[9],o[10]).getLength(),c=this.determinant();c<0&&(s=-s),n.x=o[12],n.y=o[13],n.z=o[14],i.elements.set(this.elements);var d=1/s,l=1/h,p=1/u;return i.elements[0]*=d,i.elements[1]*=d,i.elements[2]*=d,i.elements[4]*=l,i.elements[5]*=l,i.elements[6]*=l,i.elements[8]*=p,i.elements[9]*=p,i.elements[10]*=p,r.setFromRotationMatrix(i),a.x=s,a.y=h,a.z=u,this},t.prototype.determinant=function(){var t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],o=t[5],s=t[9],h=t[13],u=t[2],c=t[6],d=t[10],l=t[14],p=t[3],f=t[7],_=t[11],m=t[15];return p*(+r*s*c-n*h*c-r*o*d+i*h*d+n*o*l-i*s*l)+f*(+e*s*l-e*h*d+r*a*d-n*a*l+n*h*u-r*s*u)+_*(+e*h*c-e*o*l-r*a*c+i*a*l+r*o*u-i*h*u)+m*(-n*o*u-e*s*c+e*o*d+n*a*c-i*a*d+i*s*u)},t.prototype.fromArray=function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},zen3d.Matrix4=t,zen3d.helpMatrix=new t}(),function(){var t=function(t,e,i,n){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1};Object.defineProperties(t.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),t.prototype.set=function(t,e,i,n){return this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==n?n:1,this.onChangeCallback(),this},t.prototype.setFromEuler=function(t,e){var i=Math.cos(t._x/2),n=Math.cos(t._y/2),r=Math.cos(t._z/2),a=Math.sin(t._x/2),o=Math.sin(t._y/2),s=Math.sin(t._z/2),h=t._order;return"XYZ"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r-a*o*s):"YXZ"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r+a*o*s):"ZXY"===h?(this._x=a*n*r-i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r-a*o*s):"ZYX"===h?(this._x=a*n*r-i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r+a*o*s):"YZX"===h?(this._x=a*n*r+i*o*s,this._y=i*o*r+a*n*s,this._z=i*n*s-a*o*r,this._w=i*n*r-a*o*s):"XZY"===h&&(this._x=a*n*r-i*o*s,this._y=i*o*r-a*n*s,this._z=i*n*s+a*o*r,this._w=i*n*r+a*o*s),e!==!1&&this.onChangeCallback(),this},t.prototype.setFromRotationMatrix=function(t){var e,i=t.elements,n=i[0],r=i[4],a=i[8],o=i[1],s=i[5],h=i[9],u=i[2],c=i[6],d=i[10],l=n+s+d;return l>0?(e=.5/Math.sqrt(l+1),this._w=.25/e,this._x=(c-h)*e,this._y=(a-u)*e,this._z=(o-r)*e):n>s&&n>d?(e=2*Math.sqrt(1+n-s-d),this._w=(c-h)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(a+u)/e):s>d?(e=2*Math.sqrt(1+s-n-d),this._w=(a-u)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(h+c)/e):(e=2*Math.sqrt(1+d-n-s),this._w=(o-r)/e,this._x=(a+u)/e,this._y=(h+c)/e,this._z=.25*e),this.onChangeCallback(),this},t.prototype.toMatrix4=function(t){t||(t=new zen3d.Matrix4);var e=t.elements,i=2*this._x*this._y,n=2*this._x*this._z,r=2*this._x*this._w,a=2*this._y*this._z,o=2*this._y*this._w,s=2*this._z*this._w,h=this._x*this._x,u=this._y*this._y,c=this._z*this._z,d=this._w*this._w;return e[0]=h-u-c+d,e[4]=i-s,e[8]=n+o,e[12]=0,e[1]=i+s,e[5]=-h+u-c+d,e[9]=a-r,e[13]=0,e[2]=n-o,e[6]=a+r,e[10]=-h-u+c+d,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,t},t.prototype.setFromAxisAngle=function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},t.prototype.onChange=function(t){return this.onChangeCallback=t,this},t.prototype.onChangeCallback=function(){},zen3d.Quaternion=t}(),function(){var t=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};t.prototype.set=function(t,e,i){return this.x=t||0,this.y=e||0,this.z=i||0,this},t.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},t.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(t){t=t||1;var e=this.getLength();if(0!=e){var i=t/e;return this.x*=i,this.y*=i,this.z*=i,this}},t.prototype.subtract=function(e,i){return i||(i=new t),i.set(this.x-e.x,this.y-e.y,this.z-e.z),i},t.prototype.crossProduct=function(e,i){return i||(i=new t),i.x=this.y*e.z-this.z*e.y,i.y=this.z*e.x-this.x*e.z,i.z=this.x*e.y-this.y*e.x,i},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.applyQuaternion=function(t){var e=this.x,i=this.y,n=this.z,r=t._x,a=t._y,o=t._z,s=t._w,h=s*e+a*n-o*i,u=s*i+o*e-r*n,c=s*n+r*i-a*e,d=-r*e-a*i-o*n;return this.x=h*s+d*-r+u*-o-c*-a,this.y=u*s+d*-a+c*-r-h*-o,this.z=c*s+d*-o+h*-a-u*-r,this},t.prototype.applyMatrix4=function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],this},t.prototype.transformDirection=function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},t.prototype.setFromMatrixPosition=function(t){return this.setFromMatrixColumn(t,3)},t.prototype.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},t.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},zen3d.Vector3=t}(),function(){var t=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};t.prototype.set=function(t,e,i,n){return this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1,this},t.prototype.applyMatrix4=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this},zen3d.Vector4=t}(),function(){function t(t,e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var e=function(e){this.precision="highp",this.maxPrecision=t(e,this.precision),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)};zen3d.WebGLCapabilities=e}(),function(){var t=zen3d.BLEND_TYPE,e=zen3d.CULL_FACE_TYPE,i=function(t){this.gl=t,this.states={},this.currentBlending=null,this.currentPremultipliedAlpha=null,this.currentCullFace=null};i.prototype.setBlend=function(e,i){var n=this.gl;e!==t.NONE?this.enable(n.BLEND):this.disable(n.BLEND),e===this.currentBlending&&i===this.currentPremultipliedAlpha||(e===t.NORMAL&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA))),this.currentBlending=e,this.currentPremultipliedAlpha=i)},i.prototype.setCullFace=function(t){var i=this.gl;t!==e.NONE?(this.enable(i.CULL_FACE),t!==this.currentCullFace&&(t===e.BACK?i.cullFace(i.BACK):t===e.FRONT?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):this.disable(i.CULL_FACE),this.currentCullFace=t},i.prototype.enable=function(t){this.states[t]!==!0&&(this.gl.enable(t),this.states[t]=!0)},i.prototype.disable=function(t){this.states[t]!==!1&&(this.gl.disable(t),this.states[t]=!1)},zen3d.WebGLState=i}(),function(){var t=["const float PackUpscale = 256. / 255.;","const float UnpackDownscale = 255. / 256.;","const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );","const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );","const float ShiftRight8 = 1. / 256.;","vec4 packDepthToRGBA( const in float v ) {","vec4 r = vec4( fract( v * PackFactors ), v );","r.yzw -= r.xyz * ShiftRight8;","return r * PackUpscale;","}","float unpackRGBAToDepth( const in vec4 v ) {","return dot( v, UnpackFactors );","}"].join("\n"),e="mat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \n",i="mat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \n",n=["mat3 tsn(vec3 N, vec3 V, vec2 uv) {","vec3 q0 = dFdx( V.xyz );","vec3 q1 = dFdy( V.xyz );","vec2 st0 = dFdx( uv.st );","vec2 st1 = dFdy( uv.st );","vec3 S = normalize( q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","mat3 tsn = mat3( S, T, N );","return tsn;","}"].join("\n"),r="mat3 tbn(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p.xyz); \nvec3 dp2 = dFdy(p.xyz); \nvec2 duv1 = dFdx(uv.st); \nvec2 duv2 = dFdy(uv.st); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \n",a=["attribute vec3 a_Position;","attribute vec3 a_Normal;",e,i,"uniform mat4 u_Projection;","uniform mat4 u_View;","uniform mat4 u_Model;","uniform vec3 u_CameraPosition;"].join("\n"),o=["uniform mat4 u_View;","uniform float u_Opacity;","uniform vec3 u_Color;","uniform vec3 u_CameraPosition;"].join("\n"),s=["vec4 outColor = vec4(u_Color, u_Opacity);"].join("\n"),h=["gl_FragColor = outColor;"].join("\n"),u=["gl_Position = u_Projection * u_View * u_Model * vec4(a_Position, 1.0);"].join("\n"),c=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","attribute vec2 a_Uv;","varying vec2 v_Uv;","#endif"].join("\n"),d=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","v_Uv = a_Uv;","#endif"].join("\n"),l=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","varying vec2 v_Uv;","#endif"].join("\n"),p=["#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif"].join("\n"),f=["#ifdef USE_NORMAL","v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(a_Normal, 1.0)).xyz;","#endif"].join("\n"),_=["#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif"].join("\n"),m=["#ifdef USE_NORMAL","vec3 N;","#ifdef USE_NORMAL_MAP","vec3 normalMapColor = texture2D(normalMap, v_Uv).rgb;","mat3 tspace = tsn(normalize(v_Normal), -v_ViewModelPos, vec2(v_Uv.x, 1.0 - v_Uv.y));","N = normalize(tspace * (normalMapColor * 2.0 - 1.0));","#else","N = normalize(v_Normal);","#endif","#endif"].join("\n"),v=["#ifdef USE_DIFFUSE_MAP","uniform sampler2D texture;","#endif"].join("\n"),E=["#ifdef USE_DIFFUSE_MAP","outColor *= texture2D(texture, v_Uv);","#endif"].join("\n"),g=[n,r,"uniform sampler2D normalMap;"].join("\n"),T=["#ifdef USE_ENV_MAP","varying vec3 v_EnvPos;","#endif"].join("\n"),M=["#ifdef USE_ENV_MAP","v_EnvPos = reflect(normalize((u_Model * vec4(a_Position, 1.0)).xyz - u_CameraPosition), (transpose(inverse(u_Model)) * vec4(a_Normal, 1.0)).xyz);","#endif"].join("\n"),y=["#ifdef USE_ENV_MAP","varying vec3 v_EnvPos;","uniform samplerCube envMap;","uniform float u_EnvMap_Intensity;","#endif"].join("\n"),x=["#ifdef USE_ENV_MAP","vec4 envColor = textureCube(envMap, v_EnvPos);","outColor += envColor * u_EnvMap_Intensity;","#endif"].join("\n"),b=["#ifdef USE_SHADOW","#ifdef USE_DIRECT_LIGHT","uniform mat4 directionalShadowMatrix[ USE_DIRECT_LIGHT ];","varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];","#endif","#ifdef USE_POINT_LIGHT","#endif","#ifdef USE_SPOT_LIGHT","uniform mat4 spotShadowMatrix[ USE_SPOT_LIGHT ];","varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];","#endif","#endif"].join("\n"),S=["#ifdef USE_SHADOW","vec4 worldPosition = u_Model * vec4(a_Position, 1.0);","#ifdef USE_DIRECT_LIGHT","for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {","vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_LIGHT","#endif","#ifdef USE_SPOT_LIGHT","for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {","vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;","}","#endif","#endif"].join("\n"),w=["#ifdef USE_SHADOW",t,"#ifdef USE_DIRECT_LIGHT","uniform sampler2D directionalShadowMap[ USE_DIRECT_LIGHT ];","varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];","#endif","#ifdef USE_POINT_LIGHT","uniform samplerCube pointShadowMap[ USE_POINT_LIGHT ];","#endif","#ifdef USE_SPOT_LIGHT","uniform sampler2D spotShadowMap[ USE_SPOT_LIGHT ];","varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];","#endif","float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {","return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );","}","float textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {","return step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );","}","float getShadow( sampler2D shadowMap, vec4 shadowCoord ) {","shadowCoord.xyz /= shadowCoord.w;","shadowCoord.z += 0.0003;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","return texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );","}","return 1.0;","}","float getPointShadow( samplerCube shadowMap, vec3 V ) {","return textureCubeCompare( shadowMap, normalize(V), length(V) / 1000.);","}","float getShadowMask() {","float shadow = 1.0;","#ifdef USE_DIRECT_LIGHT","for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {","shadow *= bool( u_Directional[i].shadow ) ? getShadow( directionalShadowMap[ i ], vDirectionalShadowCoord[ i ] ) : 1.0;","}","#endif","#ifdef USE_POINT_LIGHT","for ( int i = 0; i < USE_POINT_LIGHT; i ++ ) {","vec3 worldV = (vec4(v_ViewModelPos, 1.) * u_View - vec4(u_Point[i].position, 1.) * u_View).xyz;","shadow *= bool( u_Point[i].shadow ) ? getPointShadow( pointShadowMap[ i ], worldV ) : 1.0;","}","#endif","#ifdef USE_SPOT_LIGHT","for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {","shadow *= bool( u_Spot[i].shadow ) ? getShadow( spotShadowMap[ i ], vSpotShadowCoord[ i ] ) : 1.0;","}","#endif","return shadow;","}","#endif"].join("\n"),P=["#ifdef USE_SHADOW","outColor *= getShadowMask();","#endif"].join("\n"),z=["struct AmbientLight","{","vec4 color;","float intensity;","};","uniform AmbientLight u_Ambient[USE_AMBIENT_LIGHT];"].join("\n"),L=["struct DirectLight","{","vec3 direction;","vec4 color;","float intensity;","int shadow;","};","uniform DirectLight u_Directional[USE_DIRECT_LIGHT];"].join("\n"),A=["struct PointLight","{","vec3 position;","vec4 color;","float intensity;","float distance;","float decay;","int shadow;","};","uniform PointLight u_Point[USE_POINT_LIGHT];"].join("\n"),R=["struct SpotLight","{","vec3 position;","vec4 color;","float intensity;","float distance;","float decay;","float coneCos;","float penumbraCos;","vec3 direction;","int shadow;","};","uniform SpotLight u_Spot[USE_SPOT_LIGHT];"].join("\n"),C=["#ifdef USE_AMBIENT_LIGHT",z,"#endif","#ifdef USE_DIRECT_LIGHT",L,"#endif","#ifdef USE_POINT_LIGHT",A,"#endif","#ifdef USE_SPOT_LIGHT",R,"#endif"].join("\n"),U=["#ifdef USE_LIGHT","vec4 light;","vec3 L;","vec4 reflectLight = vec4(0., 0., 0., 0.);","vec4 diffuseColor = outColor.xyzw;","#ifdef USE_AMBIENT_LIGHT","for(int i = 0; i < USE_AMBIENT_LIGHT; i++) {","reflectLight += diffuseColor * u_Ambient[i].color * u_Ambient[i].intensity;","}","#endif","#if defined(USE_PHONG) && ( defined(USE_DIRECT_LIGHT) || defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) )","vec3 V = normalize( (u_View * vec4(u_CameraPosition, 1.)).xyz - v_ViewModelPos);","#endif","#ifdef USE_DIRECT_LIGHT","for(int i = 0; i < USE_DIRECT_LIGHT; i++) {","L = -u_Directional[i].direction;","light = u_Directional[i].color * u_Directional[i].intensity;","L = normalize(L);","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONG","RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","#endif","#ifdef USE_POINT_LIGHT","for(int i = 0; i < USE_POINT_LIGHT; i++) {","L = u_Point[i].position - v_ViewModelPos;","float dist = pow(clamp(1. - length(L) / u_Point[i].distance, 0.0, 1.0), u_Point[i].decay);","light = u_Point[i].color * u_Point[i].intensity * dist;","L = normalize(L);","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONG","RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","#endif","#ifdef USE_SPOT_LIGHT","for(int i = 0; i < USE_SPOT_LIGHT; i++) {","L = u_Spot[i].position - v_ViewModelPos;","float lightDistance = length(L);","L = normalize(L);","float angleCos = dot( L, -normalize(u_Spot[i].direction) );","if( all( bvec2(angleCos > u_Spot[i].coneCos, lightDistance < u_Spot[i].distance) ) ) {","float spotEffect = smoothstep( u_Spot[i].coneCos, u_Spot[i].penumbraCos, angleCos );","float dist = pow(clamp(1. - lightDistance / u_Spot[i].distance, 0.0, 1.0), u_Spot[i].decay);","light = u_Spot[i].color * u_Spot[i].intensity * dist * spotEffect;","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONG","RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","}","#endif","outColor = reflectLight.xyzw;","#endif"].join("\n"),I=["void RE_Lambert(vec4 k, vec4 light, vec3 N, vec3 L, inout vec4 reflectLight) {","float dotNL = max(dot(N, L), 0.);","reflectLight += k * light * dotNL;","}"].join("\n"),F=["void RE_Phong(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 R = max(dot(2.0 * N, L), 0.) * N - L;","reflectLight += k * light * pow(max(dot(V, R), 0.), n_s);","}"].join("\n"),N=["void RE_BlinnPhong(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 H = normalize(L + V);","reflectLight += k * light * pow(max(dot(N, H), 0.), n_s);","}"].join("\n"),O=["#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )","varying vec3 v_ViewModelPos;","#endif"].join("\n"),D=["#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )","v_ViewModelPos = (u_View * u_Model * vec4(a_Position, 1.0)).xyz;","#endif"].join("\n"),G=["#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )","varying vec3 v_ViewModelPos;","#endif"].join("\n"),B=["#ifdef USE_PREMULTIPLIED_ALPHA","gl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;","#endif"].join("\n"),H=["#ifdef USE_FOG","uniform vec3 u_FogColor;","#ifdef USE_EXP2_FOG","uniform float u_FogDensity;","#else","uniform float u_FogNear;","uniform float u_FogFar;","#endif","#endif"].join("\n"),j=["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef USE_EXP2_FOG","float fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );","#else","float fogFactor = smoothstep( u_FogNear, u_FogFar, depth );","#endif","gl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );","#endif"].join("\n"),k={basicVertex:[a,c,T,"void main() {",u,d,M,"}"].join("\n"),basicFragment:[o,l,v,y,H,"void main() {",s,E,x,h,B,j,"}"].join("\n"),lambertVertex:[a,p,c,O,T,b,"void main() {",u,f,d,D,M,S,"}"].join("\n"),lambertFragment:[o,l,v,g,C,_,G,I,y,w,H,"void main() {",s,E,m,U,x,P,h,B,j,"}"].join("\n"),phongVertex:[a,p,c,O,T,b,"void main() {",u,f,d,D,M,S,"}"].join("\n"),phongFragment:[o,"uniform float u_Specular;","uniform vec4 u_SpecularColor;",l,v,g,C,_,G,I,F,N,y,w,H,"void main() {",s,E,m,U,x,P,h,B,j,"}"].join("\n"),cubeVertex:[a,"varying vec3 v_ModelPos;","void main() {",u,"v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;","}"].join("\n"),cubeFragment:[o,"uniform samplerCube cubeMap;","varying vec3 v_ModelPos;","void main() {",s,"outColor *= textureCube(cubeMap, v_ModelPos);",h,"}"].join("\n"),depthVertex:[a,"varying vec3 v_ModelPos;","void main() {",u,"v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;","}"].join("\n"),depthFragment:[o,"uniform vec3 lightPos;","varying vec3 v_ModelPos;",t,"void main() {","gl_FragColor = packDepthToRGBA(length(v_ModelPos - lightPos) / 1000.);","}"].join("\n")};zen3d.ShaderLib=k}(),function(){function t(t,e,i){var n=t.createShader(e);t.shaderSource(n,i),t.compileShader(n);var r=t.getShaderParameter(n,t.COMPILE_STATUS);return r||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(n))),n}function e(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),n}function i(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;r++){var a=t.getActiveUniform(e,r),o=a.name,s=a.type;i[o]={type:s,size:a.size,location:t.getUniformLocation(e,o)}}return i}function n(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var a=t.getActiveAttrib(e,r),o=a.name,s=a.type;i[o]={type:s,size:1,location:t.getAttribLocation(e,o)}}return i}function r(t){var e="";for(var i in t)e+=t[i]+"_";return e}function a(t,e){var i=e.materialType==h.BASIC,n=e.materialType==h.CUBE,r=zen3d.ShaderLib.vertexBase,a=zen3d.ShaderLib.fragmentBase;switch(e.materialType){case h.BASIC:r=zen3d.ShaderLib.basicVertex,a=zen3d.ShaderLib.basicFragment;break;case h.LAMBERT:r=zen3d.ShaderLib.lambertVertex,a=zen3d.ShaderLib.lambertFragment;break;case h.PHONG:r=zen3d.ShaderLib.phongVertex,a=zen3d.ShaderLib.phongFragment;break;case h.CUBE:r=zen3d.ShaderLib.cubeVertex,a=zen3d.ShaderLib.cubeFragment}var o,u;i?(o=[e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":""].join("\n"),u=[e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",e.fog?"#define USE_FOG":"",e.fogExp2?"#define USE_EXP2_FOG":""].join("\n")):n?(o=[""].join("\n"),u=[""].join("\n")):(o=[e.pointLightNum>0?"#define USE_POINT_LIGHT "+e.pointLightNum:"",e.spotLightNum>0?"#define USE_SPOT_LIGHT "+e.spotLightNum:"",e.directLightNum>0?"#define USE_DIRECT_LIGHT "+e.directLightNum:"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0?"#define USE_NORMAL":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useNormalMap?"#define USE_NORMAL_MAP":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.useShadow?"#define USE_SHADOW":"",e.materialType==h.LAMBERT?"#define USE_LAMBERT":"",e.materialType==h.PHONG?"#define USE_PHONG":""].join("\n"),u=[e.pointLightNum>0?"#define USE_POINT_LIGHT "+e.pointLightNum:"",e.spotLightNum>0?"#define USE_SPOT_LIGHT "+e.spotLightNum:"",e.directLightNum>0?"#define USE_DIRECT_LIGHT "+e.directLightNum:"",e.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+e.ambientLightNum:"",e.pointLightNum>0||e.directLightNum>0||e.ambientLightNum>0||e.spotLightNum>0?"#define USE_LIGHT":"",e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0?"#define USE_NORMAL":"",(e.pointLightNum>0||e.directLightNum>0||e.spotLightNum>0)&&e.useNormalMap?"#define USE_NORMAL_MAP":"",e.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",e.useEnvMap?"#define USE_ENV_MAP":"",e.useShadow?"#define USE_SHADOW":"",e.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",e.fog?"#define USE_FOG":"",e.fogExp2?"#define USE_EXP2_FOG":"",e.materialType==h.LAMBERT?"#define USE_LAMBERT":"",e.materialType==h.PHONG?"#define USE_PHONG":""].join("\n"));
var c=["precision "+e.precision+" float;","precision "+e.precision+" int;",o,r].join("\n"),d=["#extension GL_OES_standard_derivatives : enable","precision "+e.precision+" float;","precision "+e.precision+" int;",u,"#define LOG2 1.442695","#define saturate(a) clamp( a, 0.0, 1.0 )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )",a].join("\n");return new s(t,c,d)}var o={},s=function(r,a,o){this.vshaderSource=a,this.fshaderSource=o,this.vertexShader=t(r,r.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=t(r,r.FRAGMENT_SHADER,this.fshaderSource),this.id=e(r,this.vertexShader,this.fragmentShader),this.uniforms=i(r,this.id),this.attributes=n(r,this.id)},h=zen3d.MATERIAL_TYPE,u=function(t,e,i,n,s){var h,u=i.material,c=n[0],d=n[1],l=n[2],p=n[3],f=e.capabilities.maxPrecision,_={precision:f,useDiffuseMap:!!u.map,useNormalMap:!!u.normalMap,useEnvMap:!!u.envMap,useDiffuseColor:!u.map,ambientLightNum:c,directLightNum:d,pointLightNum:l,spotLightNum:p,materialType:u.type,useShadow:i.receiveShadow,premultipliedAlpha:u.premultipliedAlpha,fog:!!s,fogExp2:!!s&&s.fogType===zen3d.FOG_TYPE.EXP2},m=r(_),v=o;return v[m]?h=v[m]:(h=a(t,_),v[m]=h),h},c=function(t,e){var i,n=o,r="depth",a=e.capabilities.maxPrecision;if(n[r])i=n[r];else{var h=["precision "+a+" float;","precision "+a+" int;",zen3d.ShaderLib.depthVertex].join("\n"),u=["#extension GL_OES_standard_derivatives : enable","precision "+a+" float;","precision "+a+" int;",zen3d.ShaderLib.depthFragment].join("\n");i=new s(t,h,u),n[r]=i}return i};zen3d.getProgram=u,zen3d.getDepthProgram=c}(),function(){var t=zen3d.MATERIAL_TYPE,e=zen3d.CULL_FACE_TYPE,i=zen3d.BLEND_TYPE,n=function(t){this.view=t;var i=this.gl=t.getContext("webgl",{antialias:!0,alpha:!1,stencil:!0});this.width=t.clientWidth,this.height=t.clientHeight;var n=new zen3d.WebGLState(i);n.enable(i.STENCIL_TEST),n.enable(i.DEPTH_TEST),n.setCullFace(e.FRONT),this.state=n,this.cache=new zen3d.RenderCache,this.camera=null,this.fog=null;zen3d.getExtension(i,"OES_standard_derivatives"),zen3d.getExtension(i,"GL_OES_standard_derivatives");this.capabilities=new zen3d.WebGLCapabilities(i),this._usedTextureUnits=0};n.prototype.render=function(t,e){t.updateMatrix(),e.viewMatrix.getInverse(e.worldMatrix),this.camera=e,this.fog=t.fog,this.cache.cache(t,e),this.cache.sort(),this.renderShadow(),this.flush(),this.cache.clear()},n.prototype.renderShadow=function(){var t=this.cache.shadowObjects;if(0!=t.length)for(var e=this.gl,n=this.cache.shadowLights,a=0;a<n.length;a++){var o=n[a];o.shadow.isInit||o.shadow.init(e);var s=o.shadow,h=s.camera,u=s.renderTarget,c=o.lightType==zen3d.LIGHT_TYPE.POINT,d=c?6:1;this.setRenderTarget(u);for(var l=0;l<d;l++){c?(s.update(o,l),u.bindTextureCube(s.map,l)):s.update(o),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);for(var p=0,f=t.length;p<f;p++){var _=t[p],m=(_.material,this._uploadGeometry(_.geometry)),v=zen3d.getDepthProgram(e,this);e.useProgram(v.id);var E=v.attributes.a_Position.location;e.vertexAttribPointer(E,3,e.FLOAT,!1,68,0),e.enableVertexAttribArray(E);var g=v.uniforms;for(var T in g){var E=g[T].location;switch(T){case"u_Projection":var M=h.projectionMatrix.elements;e.uniformMatrix4fv(E,!1,M);break;case"u_View":var y=h.viewMatrix.elements;e.uniformMatrix4fv(E,!1,y);break;case"u_Model":var x=_.worldMatrix.elements;e.uniformMatrix4fv(E,!1,x);break;case"lightPos":r.setFromMatrixPosition(o.worldMatrix),e.uniform3f(E,r.x,r.y,r.z)}}this.state.setBlend(i.NONE),e.drawElements(e.TRIANGLES,m,e.UNSIGNED_SHORT,0)}}this.clearRenderTarget()}},n.prototype.flush=function(){this.flushList(this.cache.opaqueObjects),this.flushList(this.cache.transparentObjects)};var r=new zen3d.Vector3;n.prototype.flushList=function(e){for(var n=this.camera,a=this.gl,o=this.cache.ambientLights,s=this.cache.directLights,h=this.cache.pointLights,u=this.cache.spotLights,c=o.length,d=s.length,l=h.length,p=u.length,f=0,_=e.length;f<_;f++){var m=e[f],v=m.object,E=m.material,g=this._uploadGeometry(m.geometry),T=zen3d.getProgram(a,this,v,[c,d,l,p],this.fog);a.useProgram(T.id);var M=T.attributes;for(var y in M){var x=M[y].location;switch(y){case"a_Position":a.vertexAttribPointer(x,3,a.FLOAT,!1,68,0);break;case"a_Normal":a.vertexAttribPointer(x,3,a.FLOAT,!1,68,12);break;case"a_Uv":a.vertexAttribPointer(x,2,a.FLOAT,!1,68,52);break;default:console.warn("attribute "+y+" not found!")}a.enableVertexAttribArray(x)}var b=T.uniforms;for(var y in b){var x=b[y].location;switch(y){case"u_Projection":var S=n.projectionMatrix.elements;a.uniformMatrix4fv(x,!1,S);break;case"u_View":var w=n.viewMatrix.elements;a.uniformMatrix4fv(x,!1,w);break;case"u_Model":var P=v.worldMatrix.elements;a.uniformMatrix4fv(x,!1,P);break;case"u_Color":var z=zen3d.hex2RGB(E.color);a.uniform3f(x,z[0]/255,z[1]/255,z[2]/255);break;case"u_Opacity":a.uniform1f(x,E.opacity);break;case"texture":var L=this.allocTexUnit();this.setTexture2D(E.map,L),a.uniform1i(x,L);break;case"normalMap":var L=this.allocTexUnit();this.setTexture2D(E.normalMap,L),a.uniform1i(x,L);break;case"envMap":var L=this.allocTexUnit();this.setTextureCube(E.envMap,L),a.uniform1i(x,L);break;case"cubeMap":var L=this.allocTexUnit();this.setTextureCube(E.cubeMap,L),a.uniform1i(x,L);break;case"u_EnvMap_Intensity":a.uniform1f(x,E.envMapIntensity);break;case"u_Specular":var A=E.specular;a.uniform1f(x,A);break;case"u_SpecularColor":var z=zen3d.hex2RGB(E.specularColor);a.uniform4f(x,z[0]/255,z[1]/255,z[2]/255,1);break;case"u_CameraPosition":r.setFromMatrixPosition(n.worldMatrix),a.uniform3f(x,r.x,r.y,r.z);break;case"u_FogColor":var z=zen3d.hex2RGB(this.fog.color);a.uniform3f(x,z[0]/255,z[1]/255,z[2]/255);break;case"u_FogDensity":var R=this.fog.density;a.uniform1f(x,R);break;case"u_FogNear":var C=this.fog.near;a.uniform1f(x,C);break;case"u_FogFar":var U=this.fog.far;a.uniform1f(x,U)}}var I=E.type==t.BASIC,F=E.type==t.CUBE;if(!I&&!F){for(var N=0;N<c;N++){var O=o[N],D=O.intensity,z=zen3d.hex2RGB(O.color),G=b["u_Ambient["+N+"].intensity"].location,B=b["u_Ambient["+N+"].color"].location;a.uniform4f(B,z[0]/255,z[1]/255,z[2]/255,1),a.uniform1f(G,D)}for(var N=0;N<d;N++){var O=s[N],D=O.intensity;O.getWorldDirection(r),r.transformDirection(n.viewMatrix);var z=zen3d.hex2RGB(O.color),H=b["u_Directional["+N+"].direction"].location,j=b["u_Directional["+N+"].intensity"].location,k=b["u_Directional["+N+"].color"].location;a.uniform3f(H,r.x,r.y,r.z),a.uniform1f(j,D),a.uniform4f(k,z[0]/255,z[1]/255,z[2]/255,1);var V=b["u_Directional["+N+"].shadow"].location;if(a.uniform1i(V,O.castShadow?1:0),O.castShadow&&v.receiveShadow&&O.shadow.isInit){var X=b["directionalShadowMatrix["+N+"]"].location;a.uniformMatrix4fv(X,!1,O.shadow.matrix.elements);var Y=b["directionalShadowMap["+N+"]"].location,L=this.allocTexUnit();this.setTexture2D(O.shadow.map,L),a.uniform1i(Y,L)}}for(var N=0;N<l;N++){var O=h[N];r.setFromMatrixPosition(O.worldMatrix).applyMatrix4(n.viewMatrix);var D=O.intensity,z=zen3d.hex2RGB(O.color),q=O.distance,W=O.decay,Z=b["u_Point["+N+"].position"].location;a.uniform3f(Z,r.x,r.y,r.z);var Q=b["u_Point["+N+"].intensity"].location;a.uniform1f(Q,D);var J=b["u_Point["+N+"].color"].location;a.uniform4f(J,z[0]/255,z[1]/255,z[2]/255,1);var $=b["u_Point["+N+"].distance"].location;a.uniform1f($,q);var K=b["u_Point["+N+"].decay"].location;a.uniform1f(K,W);var tt=b["u_Point["+N+"].shadow"].location;if(a.uniform1i(tt,O.castShadow?1:0),O.castShadow&&v.receiveShadow&&O.shadow.isInit){var et=b["pointShadowMap["+N+"]"].location,L=this.allocTexUnit();this.setTextureCube(O.shadow.map,L),a.uniform1i(et,L)}}for(var N=0;N<p;N++){var O=u[N];r.setFromMatrixPosition(O.worldMatrix).applyMatrix4(n.viewMatrix);var it=b["u_Spot["+N+"].position"].location;a.uniform3f(it,r.x,r.y,r.z);var D=O.intensity,z=zen3d.hex2RGB(O.color),q=O.distance,W=O.decay;O.getWorldDirection(r),r.transformDirection(n.viewMatrix);var nt=b["u_Spot["+N+"].direction"].location;a.uniform3f(nt,r.x,r.y,r.z);var rt=b["u_Spot["+N+"].intensity"].location;a.uniform1f(rt,D);var at=b["u_Spot["+N+"].color"].location;a.uniform4f(at,z[0]/255,z[1]/255,z[2]/255,1);var ot=b["u_Spot["+N+"].distance"].location;a.uniform1f(ot,q);var st=b["u_Spot["+N+"].decay"].location;a.uniform1f(st,W);var ht=Math.cos(O.angle),ut=Math.cos(O.angle*(1-O.penumbra)),ct=b["u_Spot["+N+"].coneCos"].location;a.uniform1f(ct,ht);var dt=b["u_Spot["+N+"].penumbraCos"].location;a.uniform1f(dt,ut);var lt=b["u_Spot["+N+"].shadow"].location;if(a.uniform1i(lt,O.castShadow?1:0),O.castShadow&&v.receiveShadow&&O.shadow.isInit){var pt=b["spotShadowMatrix["+N+"]"].location;a.uniformMatrix4fv(pt,!1,O.shadow.matrix.elements);var ft=b["spotShadowMap["+N+"]"].location,L=this.allocTexUnit();this.setTexture2D(O.shadow.map,L),a.uniform1i(ft,L)}}}E.transparent?this.state.setBlend(i.NORMAL,E.premultipliedAlpha):this.state.setBlend(i.NONE),a.drawElements(a.TRIANGLES,g,a.UNSIGNED_SHORT,0),this._usedTextureUnits=0}},n.prototype._uploadGeometry=function(t){return t.bind(this)},n.prototype.setRenderTarget=function(t){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t.frameBuffer),e.viewport(0,0,t.width,t.height)},n.prototype.clearRenderTarget=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.width,this.height)},n.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)},n.prototype.allocTexUnit=function(){var t=this._usedTextureUnits;return t>=this.capabilities.maxTextures&&console.warn("trying to use "+t+" texture units while this GPU supports only "+capabilities.maxTextures),this._usedTextureUnits+=1,t},n.prototype.setTexture2D=function(t,e){var i=this.gl;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t.glTexture)},n.prototype.setTextureCube=function(t,e){var i=this.gl;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_CUBE_MAP,t.glTexture)},zen3d.Renderer=n}(),function(){var t=zen3d.OBJECT_TYPE,e=zen3d.LIGHT_TYPE,i=function(){this.opaqueObjects=new Array,this.transparentObjects=new Array,this.shadowObjects=new Array,this.ambientLights=new Array,this.directLights=new Array,this.pointLights=new Array,this.spotLights=new Array,this.shadowLights=new Array},n=new zen3d.Vector3;i.prototype.cache=function(i,r){switch(i.type){case t.MESH:var a=i.material;if(a.checkMapInit()){var o;o=a.transparent?this.transparentObjects:this.opaqueObjects,n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(r.viewMatrix).applyMatrix4(r.projectionMatrix),o.push({object:i,geometry:i.geometry,material:i.material,z:n.z}),i.castShadow&&this.shadowObjects.push(i)}break;case t.LIGHT:i.lightType==e.AMBIENT?this.ambientLights.push(i):i.lightType==e.DIRECT?this.directLights.push(i):i.lightType==e.POINT?this.pointLights.push(i):i.lightType==e.SPOT&&this.spotLights.push(i),i.castShadow&&i.lightType!==e.AMBIENT&&this.shadowLights.push(i);break;case t.CAMERA:break;case t.SCENE:break;case t.GROUP:break;default:console.log("undefined object type")}for(var s=i.children,h=0,u=s.length;h<u;h++)this.cache(s[h],r)},i.prototype.sort=function(){this.opaqueObjects.sort(function(t,e){var i=t.z,n=e.z;return i-n}),this.transparentObjects.sort(function(t,e){var i=t.z,n=e.z;return n-i})},i.prototype.clear=function(){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.shadowObjects.length=0,this.ambientLights.length=0,this.directLights.length=0,this.pointLights.length=0,this.spotLights.length=0,this.shadowLights.length=0},zen3d.RenderCache=i}(),function(){var t=function(t,e,i){this.gl=t,this.width=e,this.height=i,this.frameBuffer=t.createFramebuffer(),this.renderBuffer=null};t.prototype.bind=function(){var t=this.gl;return t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this},t.prototype.unbind=function(){var t=this.gl;return t.bindFramebuffer(t.FRAMEBUFFER,null),this},t.prototype.attachRenderBuffer=function(t){var e=this.gl,i=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,i),"depth"==t?(e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height)):"stencil"==t?(e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,this.width,this.height)):(e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height)),this.renderBuffer=i,this},t.prototype.bindTexture2D=function(t){var e=this.gl;return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.glTexture,0),this},t.prototype.bindTextureCube=function(t,e){var i=this.gl;return i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,t.faces[e],t.glTexture,0),this},t.prototype.resize=function(t,e){},t.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),this.renderBuffer&&t.deleteRenderbuffer(this.renderBuffer)},zen3d.RenderTarget=t}(),function(){var t=function(t,e){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1);var i=this.euler=new zen3d.Euler,n=this.quaternion=new zen3d.Quaternion;i.onChange(function(){n.setFromEuler(i,!1)}),n.onChange(function(){i.setFromQuaternion(n,void 0,!1)}),this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1};Object.defineProperties(t.prototype,{rotation:{get:function(){return this.euler},set:function(t){var e=this.euler;e.copyFrom(t),this.quaternion.setFromEuler(t)}}}),t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);e!==-1&&this.children.splice(e,1),t.parent=null},t.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},t.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],a=r.getObjectByProperty(t,e);if(void 0!==a)return a}},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrix()},t.prototype.getWorldDirection=function(){var t=new zen3d.Vector3,e=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(t,e,i),r.set(0,0,1).applyQuaternion(e),r}}(),zen3d.Object3D=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE,this.fog=null};zen3d.inherit(t,zen3d.Object3D),zen3d.Scene=t}(),function(){var t=function(t,e,i){this.fogType=zen3d.FOG_TYPE.NORMAL,this.color=t,this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3};zen3d.Fog=t}(),function(){var t=function(t,e){this.fogType=zen3d.FOG_TYPE.EXP2,this.color=t,this.density=void 0!==e?e:25e-5};zen3d.FogExp2=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(t,zen3d.Object3D),zen3d.Group=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=16777215,this.intensity=1};zen3d.inherit(t,zen3d.Object3D),zen3d.Light=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(t,zen3d.Light),zen3d.AmbientLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.shadow=new zen3d.DirectionalLightShadow};zen3d.inherit(t,zen3d.Light),zen3d.DirectionalLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2,this.distance=200,this.shadow=new zen3d.PointLightShadow};zen3d.inherit(t,zen3d.Light),zen3d.PointLight=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.SPOT,this.decay=2,this.distance=200,this.penumbra=0,this.angle=Math.PI/6,this.shadow=new zen3d.SpotLightShadow};zen3d.inherit(t,zen3d.Light),zen3d.SpotLight=t}(),function(){var t=function(){this.camera=null,this.matrix=null,this.renderTarget=null,this.map=null,this.windowSize=500,this.isInit=!1,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};t.prototype.init=function(t){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget(t,1024,1024),this.map=zen3d.Texture2D.createRenderTexture(t,1024,1024),this.renderTarget.bind().attachRenderBuffer("depth").bindTexture2D(this.map).unbind(),this.isInit=!0},t.prototype.update=function(t){this._updateCamera(t),this._updateMatrix()},t.prototype._updateCamera=function(t){var e=this.camera,i=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),i.set(i.x+e.position.x,i.y+e.position.y,i.z+e.position.z),e.setLookAt(i,this._up),e.updateMatrix(),e.viewMatrix.getInverse(e.worldMatrix);var n=this.windowSize/2;e.setOrtho(-n,n,-n,n,1,1e3)},t.prototype._updateMatrix=function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},zen3d.DirectionalLightShadow=t}(),function(){var t=function(){this.camera=null,this.matrix=null,this.renderTarget=null,this.map=null,this.isInit=!1,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};t.prototype.init=function(t){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget(t,1024,1024),this.map=zen3d.Texture2D.createRenderTexture(t,1024,1024),this.renderTarget.bind().attachRenderBuffer("depth").bindTexture2D(this.map).unbind(),this.isInit=!0},t.prototype.update=function(t){this._updateCamera(t),this._updateMatrix()},t.prototype._updateCamera=function(t){var e=this.camera,i=this._lookTarget;t.getWorldDirection(this._lookTarget),e.position.setFromMatrixPosition(t.worldMatrix),i.set(i.x+e.position.x,i.y+e.position.y,i.z+e.position.z),e.setLookAt(i,this._up),e.updateMatrix(),e.viewMatrix.getInverse(e.worldMatrix),e.setPerspective(2*t.angle,1,1,1e3)},t.prototype._updateMatrix=function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},zen3d.SpotLightShadow=t}(),function(){var t=function(){this.camera=null,this.matrix=null,this.renderTarget=null,this.map=null,this.isInit=!1,this._targets=[new zen3d.Vector3(1,0,0),new zen3d.Vector3((-1),0,0),new zen3d.Vector3(0,1,0),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,(-1))],this._ups=[new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,(-1)),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,(-1),0)],this._lookTarget=new zen3d.Vector3};t.prototype.init=function(t){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget(t,512,512),this.map=zen3d.TextureCube.createRenderTexture(t,512,512),this.renderTarget.bind().attachRenderBuffer("depth").unbind(),this.isInit=!0},t.prototype.update=function(t,e){this._updateCamera(t,e),this._updateMatrix()},t.prototype._updateCamera=function(t,e){var i=this.camera,n=this._lookTarget,r=this._targets,a=this._ups;i.position.setFromMatrixPosition(t.worldMatrix),n.set(r[e].x+i.position.x,r[e].y+i.position.y,r[e].z+i.position.z),i.setLookAt(n,a[e]),i.updateMatrix(),i.viewMatrix.getInverse(i.worldMatrix),i.setPerspective(.5*Math.PI,1,1,1e3)},t.prototype._updateMatrix=function(){var t=this.matrix,e=this.camera;t.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),t.multiply(e.projectionMatrix),t.multiply(e.viewMatrix)},zen3d.PointLightShadow=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(t,zen3d.Object3D),t.prototype.setLookAt=function(t,e){var i=this.position,n=new zen3d.Vector3;i.subtract(t,n),n.normalize();var r=new zen3d.Vector3;e.crossProduct(n,r),r.normalize();var a=new zen3d.Vector3;n.crossProduct(r,a),this.quaternion.setFromRotationMatrix(zen3d.helpMatrix.set(r.x,a.x,n.x,0,r.y,a.y,n.y,0,r.z,a.z,n.z,0,0,0,0,1))},t.prototype.setOrtho=function(t,e,i,n,r,a){this.projectionMatrix.set(2/(e-t),0,0,-(e+t)/(e-t),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1)},t.prototype.setPerspective=function(t,e,i,n){this.projectionMatrix.set(1/(e*Math.tan(t/2)),0,0,0,0,1/Math.tan(t/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},t.prototype.getWorldDirection=function(){var t=new zen3d.Vector3,e=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(t,e,i),r.set(0,0,-1).applyQuaternion(e),r}}(),zen3d.Camera=t}(),function(){var t=function(){this.verticesArray=new Array,this.indicesArray=new Array,this.verticesBuffer=null,this.indicesBuffer=null,this.drawLen=0,this.vertexCount=0,this.vertexSize=17,this.dirty=!0};t.prototype.bind=function(t){if(this.dirty)this.upload(t),this.dirty=!1;else{var e=t.gl;e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}return this.drawLen},t.prototype.upload=function(t){var e=t.gl;this.verticesBuffer&&this.indicesBuffer||(this.verticesBuffer=e.createBuffer(),this.indicesBuffer=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);var i=new Float32Array(this.verticesArray);e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);var n=new Uint16Array(this.indicesArray);e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW),this.drawLen=this.indicesArray.length,this.vertexCount=this.verticesArray.length/this.vertexSize},zen3d.Geometry=t}(),function(){var t=function(e,i,n,r){t.superClass.constructor.call(this),this.buildGeometry(e,i,n,void 0==r||r)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i,n){this.verticesArray.push(.5*-t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-e,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-e,.5*i,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*-e,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*-e,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*e,.5*-i,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*t,.5*e,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*-e,.5*i,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*-e,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*t,.5*e,.5*i,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*t,.5*e,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*e,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-t,.5*-e,.5*-i,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-t,.5*-e,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*-e,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-t,.5*e,.5*i,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-t,.5*e,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),n?this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34):this.indicesArray.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35)},zen3d.CubeGeometry=t}(),function(){var t=function(e,i,n,r){t.superClass.constructor.call(this),this.buildGeometry(e,i,n||1,r||1)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i,n){for(var r=i+1,a=n+1,o=this.verticesArray,s=this.indicesArray,h=0,u=0,c=0;c<a;c++)for(var d=0;d<r;d++){var l=(d/i-.5)*t,p=(c/n-.5)*e;if(o[h++]=l,o[h++]=0,o[h++]=p,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=0,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=d/i*1,o[h++]=1*(1-c/n),o[h++]=d/i*1,o[h++]=1*(1-c/n),d!=i&&c!=n){base=d+c*r;var f=1;s[u++]=base*f,s[u++]=(base+r+1)*f,s[u++]=(base+r)*f,s[u++]=base*f,s[u++]=(base+1)*f,s[u++]=(base+r+1)*f}}},zen3d.PlaneGeometry=t}(),function(){var t=function(e,i,n){t.superClass.constructor.call(this),this.buildGeometry(e,i||20,n||20)};zen3d.inherit(t,zen3d.Geometry),t.prototype.buildGeometry=function(t,e,i){var n=!0,r=0,a=0,o=0,s=17,h=s-9,u=this.verticesArray,c=this.indicesArray,d=0,l=0,p=0,f=0,_=0,m=0;for(a=0;a<=i;++a){d=l;var v=Math.PI*a/i,E=-t*Math.cos(v),g=t*Math.sin(v);for(r=0;r<=e;++r){var T=2*Math.PI*r/e,M=g*Math.cos(T),y=g*Math.sin(T),x=1/Math.sqrt(M*M+y*y+E*E),b=Math.sqrt(y*y+M*M);if(_=0,m=b>.007?M/b:0,p=-E,f=y,r==e?(u[l++]=u[d],u[l++]=u[d+1],u[l++]=u[d+2],u[l++]=M*x,u[l++]=p*x,u[l++]=f*x,u[l++]=b>.007?-y/b:1,u[l++]=_,u[l++]=m,u[l+0]=1,u[l+1]=1,u[l+2]=1,u[l+3]=1):(u[l++]=M,u[l++]=p,u[l++]=f,u[l++]=M*x,u[l++]=p*x,u[l++]=f*x,u[l++]=b>.007?-y/b:1,u[l++]=_,u[l++]=m,u[l]=1,u[l+1]=1,u[l+2]=1,u[l+3]=1),r>0&&a>0){var S=(e+1)*a+r,w=(e+1)*a+r-1,P=(e+1)*(a-1)+r-1,z=(e+1)*(a-1)+r;a==i?(u[l-9]=u[d],u[l-8]=u[d+1],u[l-7]=u[d+2],n?(c[o++]=S,c[o++]=z,c[o++]=P):(c[o++]=S,c[o++]=P,c[o++]=z)):1==a?n?(c[o++]=S,c[o++]=P,c[o++]=w):(c[o++]=S,c[o++]=w,c[o++]=P):n?(c[o++]=S,c[o++]=z,c[o++]=P,c[o++]=S,c[o++]=P,c[o++]=w):(c[o++]=S,c[o++]=P,c[o++]=z,c[o++]=S,c[o++]=w,c[o++]=P)}l+=h}}var s=17,h=s-2,l=13;for(a=0;a<=i;++a)for(r=0;r<=e;++r)u[l++]=r/e,u[l++]=a/i,l+=h},zen3d.SphereGeometry=t}(),function(){var t=function(t,e){this.gl=t,this.width=0,this.height=0,this.border=0,this.dataFormat=t.RGBA,this.dataType=t.UNSIGNED_BYTE,this.magFilter=t.LINEAR,this.minFilter=t.LINEAR_MIPMAP_LINEAR,this.wrapS=t.CLAMP_TO_EDGE,this.wrapT=t.CLAMP_TO_EDGE,this.glTexture=t.createTexture(),this.isRenderable=!1,this.generateMipMaps=!0,this.hasMipMaps=!1};t.prototype.bind=function(){},t.prototype.texParam=function(){},t.prototype._filterFallback=function(t,e){return e===t.NEAREST||e===t.NEAREST_MIPMAP_LINEAR||e===t.NEAREST_MIPMAP_NEAREST?t.NEAREST:t.LINEAR},t.prototype.texImage=function(){},t.prototype.generateMipMaps=function(){},t.prototype.destory=function(){var t=this.gl;t.deleteTexture(this.glTexture)},zen3d.TextureBase=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this,e,i)};zen3d.inherit(t,zen3d.TextureBase),t.prototype.bind=function(){var t=this.gl;return t.bindTexture(t.TEXTURE_2D,this.glTexture),this},t.prototype.texParam=function(){var t=this.gl;this.hasMipMaps?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._filterFallback(t,this.magFilter)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._filterFallback(t,this.minFilter)));var e=zen3d.isPowerOf2(this.width)&&zen3d.isPowerOf2(this.height);return e?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),this},t.prototype.texImage=function(t,e,i){var n,r,a=this.gl,o=null==t,s=void 0!==e&&void 0!==i;s?(n=e,r=i):(!this.generateMipMaps||zen3d.isPowerOf2(t.width)&&zen3d.isPowerOf2(t.height)||(t=zen3d.makePowerOf2(t)),n=t.width,r=t.height);var h=zen3d.isPowerOf2(n)&&zen3d.isPowerOf2(r);return s?a.texImage2D(a.TEXTURE_2D,0,this.dataFormat,n,r,this.border,this.dataFormat,this.dataType,t):a.texImage2D(a.TEXTURE_2D,0,this.dataFormat,this.dataFormat,this.dataType,t),!o&&this.generateMipMaps&&h?this.generateMipMap():this.hasMipMaps=!1,this.width=n,this.height=r,this.isRenderable=!0,this},t.prototype.generateMipMap=function(){var t=this.gl;return t.generateMipmap(t.TEXTURE_2D),this.hasMipMaps=!0,this},t.fromRes=function(e,i,n,r){var a=new t(e);return a.bind().texImage(i,n,r).texParam(),a},t.fromSrc=function(e,i){var n=new t(e),r=new Image;return r.src=i,r.onload=function(){n.bind().texImage(r).texParam()},n},t.createRenderTexture=function(e,i,n){var r=new t(e);return r.bind().texImage(null,i,n).texParam(),r},zen3d.Texture2D=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this,e,i);var e=this.gl;this.faces=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z]};zen3d.inherit(t,zen3d.TextureBase),t.prototype.bind=function(){var t=this.gl;return t.bindTexture(t.TEXTURE_CUBE_MAP,this.glTexture),this},t.prototype.texParam=function(){var t=this.gl;this.hasMipMaps?(t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,this.minFilter)):(t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,this._filterFallback(t,this.magFilter)),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,this._filterFallback(t,this.minFilter)));var e=zen3d.isPowerOf2(this.width)&&zen3d.isPowerOf2(this.height);return e?(t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this.wrapT)):(t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),this},t.prototype.texImage=function(t,e,i){var n,r,a=this.gl,o=this.faces,s=t[0],h=null==s,u=void 0!==e&&void 0!==i;u?(n=e,r=i):(n=s.width,r=s.height);for(var c=zen3d.isPowerOf2(n)&&zen3d.isPowerOf2(r),d=0;d<6;d++)u?a.texImage2D(o[d],0,this.dataFormat,n,r,this.border,this.dataFormat,this.dataType,t[d]):a.texImage2D(o[d],0,this.dataFormat,this.dataFormat,this.dataType,t[d]);return!h&&this.generateMipMaps&&c?this.generateMipMap():this.hasMipMaps=!1,this.width=n,this.height=r,this.isRenderable=!0,this},t.prototype.generateMipMap=function(){var t=this.gl;return t.generateMipmap(t.TEXTURE_CUBE_MAP),this.hasMipMaps=!0,this},t.fromRes=function(e,i,n,r){var a=new t(e);return a.bind().texImage(i,n,r).texParam(),a},t.fromSrc=function(e,i){function n(){if(o>=6)return void r();var t=new Image;t.src=i[o],t.onload=n,s.push(t),o++}function r(){a.bind().texImage(s).texParam()}var a=new t(e),o=0,s=[];return n(),a},t.createRenderTexture=function(e,i,n){var r=new t(e);return r.bind().texImage([null,null,null,null,null,null],i,n).texParam(),r},zen3d.TextureCube=t}(),function(){var t=function(){this.type="",this.color=16777215,this.map=null,this.opacity=1,this.transparent=!1,this.premultipliedAlpha=!1,this.normalMap=null,this.envMap=null,this.envMapIntensity=1};t.prototype.checkMapInit=function(){return(!this.map||this.map.isRenderable)&&(!this.normalMap||this.normalMap.isRenderable)&&(!this.envMap||this.envMap.isRenderable)&&(!this.cubeMap||this.cubeMap.isRenderable)},zen3d.Material=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.BASIC};zen3d.inherit(t,zen3d.Material),zen3d.BasicMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LAMBERT};zen3d.inherit(t,zen3d.Material),zen3d.LambertMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PHONG,this.specular=30,this.specularColor=16777215};zen3d.inherit(t,zen3d.Material),zen3d.PhongMaterial=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CUBE,this.cubeMap=null};zen3d.inherit(t,zen3d.Material),zen3d.CubeMaterial=t}(),function(){var t=function(e,i){t.superClass.constructor.call(this),this.geometry=e,this.material=i,
this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(t,zen3d.Object3D),zen3d.Mesh=t}(),function(){var t=function(t){this.gl=t,this.texturePath="."};t.prototype.load=function(t,e){this.texturePath=this.extractUrlBase(t);var i=new XMLHttpRequest;i.onreadystatechange=function(t){if(4==t.target.readyState){var i=JSON.parse(t.target.response),n=this._parse(i);e(n)}}.bind(this),i.open("GET",t,!0),i.send()},t.prototype.parse=function(t){for(var e,i=new zen3d.Group,n=t.meshes,r=0;r<n.length;r++){e=n[r];var a=e.faces,o=e.vertices,s=e.normals,h=e.texturecoords[r],u=o.length/3,c=new zen3d.Geometry;c.verticesCount=u;for(var d=c.verticesArray,l=0;l<u;l++)d.push(o[3*l+0]),d.push(o[3*l+1]),d.push(o[3*l+2]),d.push(s[3*l+0]),d.push(s[3*l+1]),d.push(s[3*l+2]),d.push(0),d.push(0),d.push(0),d.push(1),d.push(1),d.push(1),d.push(1),h?(d.push(h[2*l+0]),d.push(1-h[2*l+1])):(d.push(0),d.push(0)),d.push(0),d.push(0);for(var p=c.indicesArray,l=0;l<a.length;l++)p.push(a[l][2]),p.push(a[l][1]),p.push(a[l][0]);var f=null,_=t.materials[r].properties;for(var m in _)1==_[m].semantic&&(f=new zen3d.Texture2D.fromSrc(this.gl,"./resources/models/assimp/jeep/jeep1.jpg"));var v=new zen3d.PhongMaterial;v.map=f;var e=new zen3d.Mesh(c,v);e.castShadow=!0,i.add(e)}return i},t.prototype._parse=function(t){var e=this.parseList(t.meshes,this.parseMesh),i=this.parseList(t.materials,this.parseMaterial);return this.parseObject(t,t.rootnode,e,i)},t.prototype.parseList=function(t,e){for(var i=new Array(t.length),n=0;n<t.length;++n)i[n]=e.call(this,t[n]);return i},t.prototype.parseMaterial=function(t){var e=new zen3d.PhongMaterial,i=null,n=null,r=t.properties;for(var a in t.properties)if(r=t.properties[a],"$tex.file"===r.key){if(1==r.semantic){var o=this.texturePath+"/"+r.value;o=o.replace(/\\/g,"/"),i=new zen3d.Texture2D.fromSrc(this.gl,o),i.wrapS=i.wrapT=this.gl.REPEAT}else if(2==r.semantic);else if(5==r.semantic);else if(6==r.semantic){var o=this.texturePath+"/"+r.value;o=o.replace(/\\/g,"/"),n=new zen3d.Texture2D.fromSrc(this.gl,o),n.wrapS=n.wrapT=this.gl.REPEAT}}else"?mat.name"===r.key||"$clr.diffuse"===r.key||"$clr.specular"===r.key||"$clr.emissive"===r.key||("$mat.opacity"===r.key?(e.transparent=r.value<1,e.opacity=r.value):"$mat.shadingm"===r.key?1===r.value:"$mat.shininess"===r.key&&(e.specular=r.value));return e.map=i,e.normalMap=n,e},t.prototype.parseMesh=function(t){for(var e=new zen3d.Geometry,i=t.faces,n=t.vertices,r=t.normals,a=t.texturecoords[0],o=n.length/3,s=e.verticesArray,h=0;h<o;h++)s.push(n[3*h+0]),s.push(n[3*h+1]),s.push(n[3*h+2]),s.push(r[3*h+0]),s.push(r[3*h+1]),s.push(r[3*h+2]),s.push(0),s.push(0),s.push(0),s.push(1),s.push(1),s.push(1),s.push(1),a?(s.push(a[2*h+0]),s.push(1-a[2*h+1])):(s.push(0),s.push(0)),s.push(0),s.push(0);for(var u=e.indicesArray,h=0;h<i.length;h++)u.push(i[h][2]),u.push(i[h][1]),u.push(i[h][0]);return e},t.prototype.parseObject=function(t,e,i,n){var r=new zen3d.Group;r.name=e.name||"",r.matrix.fromArray(e.transformation).transpose(),r.matrix.decompose(r.position,r.quaternion,r.scale);for(var a=0;e.meshes&&a<e.meshes.length;++a){var o=e.meshes[a];r.add(new zen3d.Mesh(i[o],n[t.meshes[o].materialindex]))}for(var a=0;e.children&&a<e.children.length;++a)r.add(this.parseObject(t,e.children[a],i,n));return r},t.prototype.extractUrlBase=function(t){var e=t.split("/");return e.pop(),(e.length<1?".":e.join("/"))+"/"},zen3d.AssimpJsonLoader=t}(),function(){var t=function(t,e){this.camera=t,this.lookAtPoint=e,this.up=new zen3d.Vector3(0,1,0),this.distance=100,this._panAngle=0,this._panRad=0,this.minPanAngle=-(1/0),this.maxPanAngle=1/0,this._tiltAngle=0,this._tiltRad=0,this.minTileAngle=-90,this.maxTileAngle=90};Object.defineProperties(t.prototype,{panAngle:{get:function(){return this._panAngle},set:function(t){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,t)),this._panRad=this._panAngle*Math.PI/180}},tiltAngle:{get:function(){return this._tiltAngle},set:function(t){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,t)),this._tiltRad=this._tiltAngle*Math.PI/180}}}),t.prototype.update=function(){var t=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),e=this.distance*Math.sin(this._tiltRad),i=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),n=this.camera,r=this.lookAtPoint;n.position.set(t+r.x,e+r.y,i+r.z),n.setLookAt(r,this.up)},zen3d.HoverController=t}();