!function(e){var t=e.zen3d=e.zen3d||{},i=function(){},n=function(e,t){i.prototype=t.prototype,e.superClass=t.prototype,e.prototype=new i,e.prototype.constructor=e};t.inherit=n;var r=function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19===r?3&e|8:e]);return i.join("")}};t.generateUUID=r();var o=function(){if(!e.navigator)return!0;var t=navigator.userAgent.toLowerCase();return t.indexOf("mobile")!=-1||t.indexOf("android")!=-1};t.isMobile=o();var a=function(){return!!document};t.isWeb=a();var s=function(e,t){var i=["","WEBKIT_","MOZ_"],n=null;for(var r in i)if(n=e.getExtension(i[r]+t))break;return n};t.getExtension=s;var h=function(e){var t=e>>16&255,i=e>>8&255,n=255&e;return[t,i,n]};t.hex2RGB=h;var u=function(e,t,i){var n=new Uint8Array(e*t*4),r=[[255,255,255,255],[0,0,0,255]];i=i||5;for(var o=0,a=0;a<t;a++)for(var s=0;s<e;s++){if(0==s?o=1:s%i==0&&(o=(o+1)%2),a%i==0&&0==s){var h=r[0];r[0]=r[1],r[1]=h}n[a*(4*e)+4*s+0]=r[o][0],n[a*(4*e)+4*s+1]=r[o][1],n[a*(4*e)+4*s+2]=r[o][2],n[a*(4*e)+4*s+3]=r[o][3]}return n};t.createCheckerBoardPixels=u;var c=function(e){return 0===(e&e-1)&&0!==e};t.isPowerOfTwo=c;var d=function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))};t.nearestPowerOfTwo=d;var p=function(e,t,i){var n=new Image;n.onload=function(){t(n)},n.src=e};t.requireImage=p;var l=function(e,t,i,n){var r=new XMLHttpRequest;r.onreadystatechange=function(e){if(4==e.target.readyState){var i=e.target.response;n&&n.parse&&(i=JSON.parse(i)),t(i)}},n&&"POST"===n.method?(r.open("POST",e,!0),r.send(n.data)):(r.open("GET",e,!0),r.send())};t.requireHttp=l}(window),function(){var e={MESH:"mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group",POINT:"point"};zen3d.OBJECT_TYPE=e;var t={AMBIENT:"ambient",DIRECT:"direct",POINT:"point",SPOT:"spot"};zen3d.LIGHT_TYPE=t;var i={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",CUBE:"cube",POINT:"point"};zen3d.MATERIAL_TYPE=i;var n={NORMAL:"normal",EXP2:"exp2"};zen3d.FOG_TYPE=n;var r={NONE:"none",NORMAL:"normal",ADD:"add"};zen3d.BLEND_TYPE=r;var o={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"};zen3d.CULL_FACE_TYPE=o;var a={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067};zen3d.WEBGL_TEXTURE_TYPE=a;var s={DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410};zen3d.WEBGL_PIXEL_FORMAT=s;var h={UNSIGNED_BYTE:5121,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635};zen3d.WEBGL_PIXEL_TYPE=h;var u={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};zen3d.WEBGL_TEXTURE_FILTER=u;var c={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648};zen3d.WEBGL_TEXTURE_WRAP=c}(),function(){var e=function(t,i,n,r){this._x=t||0,this._y=i||0,this._z=n||0,this._order=r||e.DefaultOrder};e.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.DefaultOrder="XYZ",Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),e.prototype.copyFrom=function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},e.prototype.set=function(e,t,i,n){return this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||this._order,this.onChangeCallback(),this},e.prototype.setFromRotationMatrix=function(e,t,i){var n=function(e,t,i){return Math.max(t,Math.min(i,e))},r=e.elements,o=r[0],a=r[4],s=r[8],h=r[1],u=r[5],c=r[9],d=r[2],p=r[6],l=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,l),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,l),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-d,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-d,l),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(h,o))):"ZYX"===t?(this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(p,l),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-a,u))):"YZX"===t?(this._z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(s,l))):"XZY"===t?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(p,u),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,l),this._y=0)):console.warn("given unsupported order: "+t),this._order=t,i!==!1&&this.onChangeCallback(),this},e.prototype.setFromQuaternion=function(e,t,i){var n=zen3d.helpMatrix;return e.toMatrix4(n),this.setFromRotationMatrix(n,t,i)},e.prototype.onChange=function(e){return this.onChangeCallback=e,this},e.prototype.onChangeCallback=function(){},zen3d.Euler=e}(),function(){var e=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};e.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},e.prototype.set=function(e,t,i,n,r,o,a,s,h,u,c,d,p,l,f,_){var m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=n,m[1]=r,m[5]=o,m[9]=a,m[13]=s,m[2]=h,m[6]=u,m[10]=c,m[14]=d,m[3]=p,m[7]=l,m[11]=f,m[15]=_,this},e.prototype.copy=function(e){return this.elements.set(e.elements),this},e.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},e.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},e.prototype.multiplyMatrices=function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],a=i[4],s=i[8],h=i[12],u=i[1],c=i[5],d=i[9],p=i[13],l=i[2],f=i[6],_=i[10],m=i[14],E=i[3],v=i[7],T=i[11],g=i[15],x=n[0],y=n[4],M=n[8],z=n[12],b=n[1],w=n[5],S=n[9],P=n[13],L=n[2],A=n[6],R=n[10],C=n[14],U=n[3],F=n[7],N=n[11],I=n[15];return r[0]=o*x+a*b+s*L+h*U,r[4]=o*y+a*w+s*A+h*F,r[8]=o*M+a*S+s*R+h*N,r[12]=o*z+a*P+s*C+h*I,r[1]=u*x+c*b+d*L+p*U,r[5]=u*y+c*w+d*A+p*F,r[9]=u*M+c*S+d*R+p*N,r[13]=u*z+c*P+d*C+p*I,r[2]=l*x+f*b+_*L+m*U,r[6]=l*y+f*w+_*A+m*F,r[10]=l*M+f*S+_*R+m*N,r[14]=l*z+f*P+_*C+m*I,r[3]=E*x+v*b+T*L+g*U,r[7]=E*y+v*w+T*A+g*F,r[11]=E*M+v*S+T*R+g*N,r[15]=E*z+v*P+T*C+g*I,this},e.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.prototype.inverse=function(){return this.getInverse(this)},e.prototype.getInverse=function(e){var t=this.elements,i=e.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],h=i[5],u=i[6],c=i[7],d=i[8],p=i[9],l=i[10],f=i[11],_=i[12],m=i[13],E=i[14],v=i[15],T=p*E*c-m*l*c+m*u*f-h*E*f-p*u*v+h*l*v,g=_*l*c-d*E*c-_*u*f+s*E*f+d*u*v-s*l*v,x=d*m*c-_*p*c+_*h*f-s*m*f-d*h*v+s*p*v,y=_*p*u-d*m*u-_*h*l+s*m*l+d*h*E-s*p*E,M=n*T+r*g+o*x+a*y;if(0===M)return console.warn("can't invert matrix, determinant is 0"),this.identity();var z=1/M;return t[0]=T*z,t[1]=(m*l*a-p*E*a-m*o*f+r*E*f+p*o*v-r*l*v)*z,t[2]=(h*E*a-m*u*a+m*o*c-r*E*c-h*o*v+r*u*v)*z,t[3]=(p*u*a-h*l*a-p*o*c+r*l*c+h*o*f-r*u*f)*z,t[4]=g*z,t[5]=(d*E*a-_*l*a+_*o*f-n*E*f-d*o*v+n*l*v)*z,t[6]=(_*u*a-s*E*a-_*o*c+n*E*c+s*o*v-n*u*v)*z,t[7]=(s*l*a-d*u*a+d*o*c-n*l*c-s*o*f+n*u*f)*z,t[8]=x*z,t[9]=(_*p*a-d*m*a-_*r*f+n*m*f+d*r*v-n*p*v)*z,t[10]=(s*m*a-_*h*a+_*r*c-n*m*c-s*r*v+n*h*v)*z,t[11]=(d*h*a-s*p*a-d*r*c+n*p*c+s*r*f-n*h*f)*z,t[12]=y*z,t[13]=(d*m*o-_*p*o+_*r*l-n*m*l-d*r*E+n*p*E)*z,t[14]=(_*h*o-s*m*o-_*r*u+n*m*u+s*r*E-n*h*E)*z,t[15]=(s*p*o-d*h*o+d*r*u-n*p*u-s*r*l+n*h*l)*z,this},e.prototype.transform=function(e,t,i){var n=i.toMatrix4(),r=n.elements,o=this.elements;return o[0]=r[0]*t.x,o[1]=r[1]*t.y,o[2]=r[2]*t.z,o[3]=0,o[4]=r[4]*t.x,o[5]=r[5]*t.y,o[6]=r[6]*t.z,o[7]=0,o[8]=r[8]*t.x,o[9]=r[9]*t.y,o[10]=r[10]*t.z,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this},e.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,a=i+i,s=n+n,h=r+r,u=i*a,c=i*s,d=i*h,p=n*s,l=n*h,f=r*h,_=o*a,m=o*s,E=o*h;return t[0]=1-(p+f),t[4]=c-E,t[8]=d+m,t[1]=c+E,t[5]=1-(u+f),t[9]=l-_,t[2]=d-m,t[6]=l+_,t[10]=1-(u+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this};var t,i;e.prototype.decompose=function(n,r,o){void 0===t&&(t=new zen3d.Vector3,i=new e);var a=this.elements,s=t.set(a[0],a[1],a[2]).getLength(),h=t.set(a[4],a[5],a[6]).getLength(),u=t.set(a[8],a[9],a[10]).getLength(),c=this.determinant();c<0&&(s=-s),n.x=a[12],n.y=a[13],n.z=a[14],i.elements.set(this.elements);var d=1/s,p=1/h,l=1/u;return i.elements[0]*=d,i.elements[1]*=d,i.elements[2]*=d,i.elements[4]*=p,i.elements[5]*=p,i.elements[6]*=p,i.elements[8]*=l,i.elements[9]*=l,i.elements[10]*=l,r.setFromRotationMatrix(i),o.x=s,o.y=h,o.z=u,this},e.prototype.determinant=function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],a=e[5],s=e[9],h=e[13],u=e[2],c=e[6],d=e[10],p=e[14],l=e[3],f=e[7],_=e[11],m=e[15];return l*(+r*s*c-n*h*c-r*a*d+i*h*d+n*a*p-i*s*p)+f*(+t*s*p-t*h*d+r*o*d-n*o*p+n*h*u-r*s*u)+_*(+t*h*c-t*a*p-r*o*c+i*o*p+r*a*u-i*h*u)+m*(-n*a*u-t*s*c+t*a*d+n*o*c-i*o*d+i*s*u)},e.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},e.prototype.getMaxScaleOnAxis=function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))},zen3d.Matrix4=e,zen3d.helpMatrix=new e}(),function(){var e=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1};Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),e.prototype.set=function(e,t,i,n){return this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1,this.onChangeCallback(),this},e.prototype.setFromEuler=function(e,t){var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),a=Math.sin(e._y/2),s=Math.sin(e._z/2),h=e._order;return"XYZ"===h?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"YXZ"===h?(this._x=o*n*r+i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"ZXY"===h?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r-o*a*s):"ZYX"===h?(this._x=o*n*r-i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r+o*a*s):"YZX"===h?(this._x=o*n*r+i*a*s,this._y=i*a*r+o*n*s,this._z=i*n*s-o*a*r,this._w=i*n*r-o*a*s):"XZY"===h&&(this._x=o*n*r-i*a*s,this._y=i*a*r-o*n*s,this._z=i*n*s+o*a*r,this._w=i*n*r+o*a*s),t!==!1&&this.onChangeCallback(),this},e.prototype.setFromRotationMatrix=function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],h=i[9],u=i[2],c=i[6],d=i[10],p=n+s+d;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(c-h)*t,this._y=(o-u)*t,this._z=(a-r)*t):n>s&&n>d?(t=2*Math.sqrt(1+n-s-d),this._w=(c-h)/t,this._x=.25*t,this._y=(r+a)/t,this._z=(o+u)/t):s>d?(t=2*Math.sqrt(1+s-n-d),this._w=(o-u)/t,this._x=(r+a)/t,this._y=.25*t,this._z=(h+c)/t):(t=2*Math.sqrt(1+d-n-s),this._w=(a-r)/t,this._x=(o+u)/t,this._y=(h+c)/t,this._z=.25*t),this.onChangeCallback(),this},e.prototype.toMatrix4=function(e){e||(e=new zen3d.Matrix4);var t=e.elements,i=2*this._x*this._y,n=2*this._x*this._z,r=2*this._x*this._w,o=2*this._y*this._z,a=2*this._y*this._w,s=2*this._z*this._w,h=this._x*this._x,u=this._y*this._y,c=this._z*this._z,d=this._w*this._w;return t[0]=h-u-c+d,t[4]=i-s,t[8]=n+a,t[12]=0,t[1]=i+s,t[5]=-h+u-c+d,t[9]=o-r,t[13]=0,t[2]=n-a,t[6]=o+r,t[10]=-h-u+c+d,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,e},e.prototype.setFromAxisAngle=function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},e.prototype.onChange=function(e){return this.onChangeCallback=e,this},e.prototype.onChangeCallback=function(){},zen3d.Quaternion=e}(),function(){var e=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};e.prototype.set=function(e,t,i){return this.x=e||0,this.y=t||0,this.z=i||0,this},e.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},e.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},e.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},e.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(e){e=e||1;var t=this.getLength();if(0!=t){var i=e/t;return this.x*=i,this.y*=i,this.z*=i,this}},e.prototype.subtract=function(t,i){return i||(i=new e),i.set(this.x-t.x,this.y-t.y,this.z-t.z),i},e.prototype.crossProduct=function(t,i){return i||(i=new e),i.x=this.y*t.z-this.z*t.y,i.y=this.z*t.x-this.x*t.z,i.z=this.x*t.y-this.y*t.x,i},e.prototype.dotProduct=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.prototype.applyQuaternion=function(e){var t=this.x,i=this.y,n=this.z,r=e._x,o=e._y,a=e._z,s=e._w,h=s*t+o*n-a*i,u=s*i+a*t-r*n,c=s*n+r*i-o*t,d=-r*t-o*i-a*n;return this.x=h*s+d*-r+u*-a-c*-o,this.y=u*s+d*-o+c*-r-h*-a,this.z=c*s+d*-a+h*-o-u*-r,this},e.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},e.prototype.transformDirection=function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()},e.prototype.setFromMatrixPosition=function(e){return this.setFromMatrixColumn(e,3)},e.prototype.setFromMatrixColumn=function(e,t){return this.fromArray(e.elements,4*t)},e.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},e.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.distanceToSquared=function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},e.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},zen3d.Vector3=e}(),function(){var e=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};e.prototype.set=function(e,t,i,n){return this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1,this},e.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},e.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},zen3d.Vector4=e}(),function(){var e=function(e,t){this.min=void 0!==e?e:new zen3d.Vector3((+(1/0)),(+(1/0)),(+(1/0))),this.max=void 0!==t?t:new zen3d.Vector3((-(1/0)),(-(1/0)),(-(1/0)))};e.prototype.set=function(e,t){this.min.copy(e),this.max.copy(t)},e.prototype.setFromPoints=function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},e.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},e.prototype.expandByPoint=function(e){return this.min.min(e),this.max.max(e),this},e.prototype.setFromArray=function(e,t){for(var i=+(1/0),n=+(1/0),r=+(1/0),o=-(1/0),a=-(1/0),s=-(1/0),h=void 0!==t?t:3,u=0,c=e.length;u<c;u+=h){var d=e[u],p=e[u+1],l=e[u+2];d<i&&(i=d),p<n&&(n=p),l<r&&(r=l),d>o&&(o=d),p>a&&(a=p),l>s&&(s=l)}return this.min.set(i,n,r),this.max.set(o,a,s),this},e.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},e.prototype.getCenter=function(e){var t=e||new zen3d.Vector3;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},e.prototype.applyMatrix4=function(){var e=[new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),e.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},zen3d.Box3=e}(),function(){var e=function(e,t){this.center=void 0!==e?e:new zen3d.Vector3,this.radius=void 0!==t?t:0};e.prototype.setFromArray=function(){var e=new zen3d.Box3,t=new zen3d.Vector3;return function(i,n){var r=void 0!==n?n:3,o=this.center;e.setFromArray(i,r).getCenter(o);for(var a=0,s=0,h=i.length;s<h;s+=r){var u=i[s],c=i[s+1],d=i[s+2];t.set(u,c,d),a=Math.max(a,o.distanceToSquared(t))}return this.radius=Math.sqrt(a),this}}(),e.prototype.applyMatrix4=function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},e.prototype.copy=function(e){return this.center.copy(e.center),this.radius=e.radius,this},zen3d.Sphere=e}(),function(){var e=function(e,t){this.normal=void 0!==e?e:new zen3d.Vector3(1,0,0),this.constant=void 0!==t?t:0};e.prototype.set=function(e,t){return this.normal.copy(e),this.constant=t,this},e.prototype.setComponents=function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},e.prototype.normalize=function(){var e=1/this.normal.getLength();return this.normal.multiplyScalar(e),this.constant*=e,this},e.prototype.distanceToPoint=function(e){return this.normal.dotProduct(e)+this.constant},zen3d.Plane=e}(),function(){var e=function(e,t,i,n,r,o){this.planes=[void 0!==e?e:new zen3d.Plane,void 0!==t?t:new zen3d.Plane,void 0!==i?i:new zen3d.Plane,void 0!==n?n:new zen3d.Plane,void 0!==r?r:new zen3d.Plane,void 0!==o?o:new zen3d.Plane]};e.prototype.set=function(e,t,i,n,r,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},e.prototype.setFromMatrix=function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],h=i[5],u=i[6],c=i[7],d=i[8],p=i[9],l=i[10],f=i[11],_=i[12],m=i[13],E=i[14],v=i[15];return t[0].setComponents(a-n,c-s,f-d,v-_).normalize(),t[1].setComponents(a+n,c+s,f+d,v+_).normalize(),t[2].setComponents(a+r,c+h,f+p,v+m).normalize(),t[3].setComponents(a-r,c-h,f-p,v-m).normalize(),t[4].setComponents(a-o,c-u,f-l,v-E).normalize(),t[5].setComponents(a+o,c+u,f+l,v+E).normalize(),this},e.prototype.intersectsSphere=function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;r<6;r++){var o=t[r].distanceToPoint(i);if(o<n)return!1}return!0},e.prototype.intersectsBox=function(){var e=new zen3d.Vector3,t=new zen3d.Vector3;return function(i){for(var n=this.planes,r=0;r<6;r++){var o=n[r];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var a=o.distanceToPoint(e),s=o.distanceToPoint(t);if(a<0&&s<0)return!1}return!0}}(),zen3d.Frustum=e}(),function(){var e=function(){this.eventMap={}};e.prototype.addEventListener=function(e,t,i){var n=this.eventMap[e];n||(n=this.eventMap[e]=[]),n.push({listener:t,thisObject:i||this})},e.prototype.removeEventListener=function(e,t,i){var n=this.eventMap[e];if(n)for(var r=0,o=n.length;r<o;r++){var a=n[r];if(a.listener==t&&a.thisObject==(i||this)){n.splice(r,1);break}}},e.prototype.dispatchEvent=function(e){e.target=this,this.notifyListener(e)},e.prototype.notifyListener=function(e){var t=this.eventMap[e.type];if(t)for(var i=0,n=t.length;i<n;i++){var r=t[i];r.listener.call(r.thisObject,e)}},zen3d.EventDispatcher=e}(),function(){function e(e,t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var t=function(t){this.precision="highp",this.maxPrecision=e(t,this.precision),this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxCubemapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE)};zen3d.WebGLCapabilities=t}(),function(){function e(e,t,i,n){var r=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var a=0;a<n;a++)e.texImage2D(i+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return o}var t=zen3d.BLEND_TYPE,i=zen3d.CULL_FACE_TYPE,n=function(t,i){this.gl=t,this.capabilities=i,this.states={},this.currentBlending=null,this.currentPremultipliedAlpha=null,this.currentCullFace=null,this.currentViewport=new zen3d.Vector4,this.currentClearColor=new zen3d.Vector4,this.currentTextureSlot=null,this.currentBoundTextures={},this.emptyTextures={},this.emptyTextures[t.TEXTURE_2D]=e(t,t.TEXTURE_2D,t.TEXTURE_2D,1),this.emptyTextures[t.TEXTURE_CUBE_MAP]=e(t,t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6)};n.prototype.setBlend=function(e,i){var n=this.gl;e!==t.NONE?this.enable(n.BLEND):this.disable(n.BLEND),e===this.currentBlending&&i===this.currentPremultipliedAlpha||(e===t.NORMAL&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA))),e===t.ADD&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE,n.ONE,n.ONE)):(n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE))),this.currentBlending=e,this.currentPremultipliedAlpha=i)},n.prototype.setCullFace=function(e){var t=this.gl;e!==i.NONE?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===i.BACK?t.cullFace(t.BACK):e===i.FRONT?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e},n.prototype.viewport=function(e,t,i,n){var r=this.currentViewport;if(r.x!==e||r.y!==t||r.z!==i||r.w!==n){var o=this.gl;o.viewport(e,t,i,n),r.set(e,t,i,n)}},n.prototype.clearColor=function(e,t,i,n){var r=this.currentClearColor;if(r.x!==e||r.y!==t||r.z!==i||r.w!==n){var o=this.gl;o.clearColor(e,t,i,n),r.set(e,t,i,n)}},n.prototype.activeTexture=function(e){var t=this.gl;void 0===e&&(e=t.TEXTURE0+this.capabilities.maxTextures-1),this.currentTextureSlot!==e&&(t.activeTexture(e),this.currentTextureSlot=e)},n.prototype.bindTexture=function(e,t){var i=this.gl;null===this.currentTextureSlot&&this.activeTexture();var n=this.currentBoundTextures[this.currentTextureSlot];void 0===n&&(n={type:void 0,texture:void 0},this.currentBoundTextures[this.currentTextureSlot]=n),n.type===e&&n.texture===t||(i.bindTexture(e,t||this.emptyTextures[e]),n.type=e,n.texture=t)},n.prototype.enable=function(e){this.states[e]!==!0&&(this.gl.enable(e),this.states[e]=!0)},n.prototype.disable=function(e){this.states[e]!==!1&&(this.gl.disable(e),this.states[e]=!1)},zen3d.WebGLState=n}(),function(){var e=function(){this.properties={}};e.prototype.get=function(e){var t=e.uuid,i=this.properties[t];return void 0===i&&(i={},this.properties[t]=i),i},e.prototype.delete=function(e){delete this.properties[e.uuid]},e.prototype.clear=function(){this.properties={}},zen3d.WebGLProperties=e}(),function(){function e(e){return e.wrapS!==o.CLAMP_TO_EDGE||e.wrapT!==o.CLAMP_TO_EDGE||e.minFilter!==r.NEAREST&&e.minFilter!==r.LINEAR}function t(e){return e===r.NEAREST||e===r.NEAREST_MIPMAP_LINEAR||e===r.NEAREST_MIPMAP_NEAREST?r.NEAREST:r.LINEAR}function i(e){return s(e.width)&&s(e.height)}function n(e,t){if(e.width>t||e.height>t){if(!a)return console.warn("image is too big ("+e.width+"x"+e.height+"). max size is "+t+"x"+t,e),e;var i=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(e.width*i),n.height=Math.floor(e.height*i);var r=n.getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}var r=zen3d.WEBGL_TEXTURE_FILTER,o=zen3d.WEBGL_TEXTURE_WRAP,a=zen3d.isWeb,s=zen3d.isPowerOfTwo,h=(zen3d.nearestPowerOfTwo,function(e,t,i,n){this.gl=e,this.state=t,this.properties=i,this.capabilities=n});h.prototype.setTexture2D=function(t,r){var o=this.gl,a=this.state,s=this.properties.get(t);if(t.version>0&&s.__version!==t.version){void 0===s.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),s.__webglTexture=o.createTexture()),a.activeTexture(o.TEXTURE0+r),a.bindTexture(o.TEXTURE_2D,s.__webglTexture);var h=n(t.image,this.capabilities.maxTextureSize);e(t)&&i(h)===!1&&(h=makePowerOfTwo(h));var u=i(h);this.setTextureParameters(t,u);var c,d=t.mipmaps,p=t.pixelFormat,l=t.pixelType;if(d.length>0&&u){for(var f=0,_=d.length;f<_;f++)c=d[f],o.texImage2D(o.TEXTURE_2D,f,p,p,l,c);t.generateMipmaps=!1}else o.texImage2D(o.TEXTURE_2D,0,p,p,l,h);return t.generateMipmaps&&u&&o.generateMipmap(o.TEXTURE_2D),void(s.__version=t.version)}a.activeTexture(o.TEXTURE0+r),a.bindTexture(o.TEXTURE_2D,s.__webglTexture)},h.prototype.setTextureCube=function(e,t){var r=this.gl,o=this.state,a=this.properties.get(e);if(e.version>0&&a.__version!==e.version){void 0===a.__webglTexture&&(e.addEventListener("dispose",this.onTextureDispose,this),a.__webglTexture=r.createTexture()),o.activeTexture(r.TEXTURE0+t),o.bindTexture(r.TEXTURE_CUBE_MAP,a.__webglTexture);for(var s=[],h=0;h<6;h++)s[h]=n(e.images[h],this.capabilities.maxCubemapSize);var u=s[0],c=i(u);this.setTextureParameters(e,c);for(var d=e.pixelFormat,p=e.pixelType,h=0;h<6;h++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,d,d,p,s[h]);return e.generateMipmaps&&c&&r.generateMipmap(r.TEXTURE_CUBE_MAP),void(a.__version=e.version)}o.activeTexture(r.TEXTURE0+t),o.bindTexture(r.TEXTURE_CUBE_MAP,a.__webglTexture)},h.prototype.setTextureParameters=function(e,i){var n=this.gl,r=e.textureType;i?(n.texParameteri(r,n.TEXTURE_WRAP_S,e.wrapS),n.texParameteri(r,n.TEXTURE_WRAP_T,e.wrapT),n.texParameteri(r,n.TEXTURE_MAG_FILTER,e.magFilter),n.texParameteri(r,n.TEXTURE_MIN_FILTER,e.minFilter)):(n.texParameteri(r,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(r,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.wrapS===n.CLAMP_TO_EDGE&&e.wrapT===n.CLAMP_TO_EDGE||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to zen3d.TEXTURE_WRAP.CLAMP_TO_EDGE.",e),n.texParameteri(r,n.TEXTURE_MAG_FILTER,t(e.magFilter)),n.texParameteri(r,n.TEXTURE_MIN_FILTER,t(e.minFilter)),(e.minFilter!==n.NEAREST&&e.minFilter!==n.LINEAR||e.magFilter!==n.NEAREST&&e.magFilter!==n.LINEAR)&&console.warn("Texture is not power of two. Texture.minFilter and Texture.magFilter should be set to zen3d.TEXTURE_FILTER.NEAREST or zen3d.TEXTURE_FILTER.LINEAR.",e))},h.prototype.setRenderTarget2D=function(e){var t=this.gl,n=this.state,r=this.properties.get(e),o=this.properties.get(e.texture);if(void 0!==o.__webglTexture&&void 0!==r.__webglFramebuffer)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer);else{e.addEventListener("dispose",this.onRenderTargetDispose,this),o.__webglTexture=t.createTexture(),r.__webglFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),n.bindTexture(t.TEXTURE_2D,o.__webglTexture);var a=i(e);this.setTextureParameters(e.texture,a);var s=e.texture.pixelFormat,h=e.texture.pixelType;if(t.texImage2D(t.TEXTURE_2D,0,s,e.width,e.height,0,s,h,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o.__webglTexture,0),e.texture.generateMipmaps&&a&&t.generateMipmap(t.TEXTURE_2D),n.bindTexture(t.TEXTURE_2D,null),e.depthBuffer){r.__webglDepthbuffer=t.createRenderbuffer();var u=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,u),e.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,u)):(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,u)),t.bindRenderbuffer(t.RENDERBUFFER,null)}}},h.prototype.setRenderTargetCube=function(e){var t=this.gl,n=this.state,r=this.properties.get(e),o=this.properties.get(e.texture);if(void 0!==o.__webglTexture&&void 0!==r.__webglFramebuffer)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,o.__webglTexture,0);else{e.addEventListener("dispose",this.onRenderTargetDispose,this),o.__webglTexture=t.createTexture(),r.__webglFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture);var a=i(e);this.setTextureParameters(e.texture,a);for(var s=e.texture.pixelFormat,h=e.texture.pixelType,u=0;u<6;u++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,s,e.width,e.height,0,s,h,null);if(t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,o.__webglTexture,0),e.texture.generateMipmaps&&a&&t.generateMipmap(t.TEXTURE_CUBE_MAP),n.bindTexture(t.TEXTURE_CUBE_MAP,null),e.depthBuffer){r.__webglDepthbuffer=t.createRenderbuffer();var c=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,c),e.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,c)):(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,c)),t.bindRenderbuffer(t.RENDERBUFFER,null)}}},h.prototype.updateRenderTargetMipmap=function(e){var t=this.gl,n=this.state,r=e.texture;if(r.generateMipmaps&&i(e)&&r.minFilter!==t.NEAREST&&r.minFilter!==t.LINEAR){var o=r.textureType,a=this.properties.get(r).__webglTexture;n.bindTexture(o,a),t.generateMipmap(o),n.bindTexture(o,null)}},h.prototype.onTextureDispose=function(e){var t=this.gl,i=e.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onTextureDispose,this),n.__webglTexture&&t.deleteTexture(n.__webglTexture),this.properties.delete(i)},h.prototype.onRenderTargetDispose=function(e){var t=this.gl,i=e.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onRenderTargetDispose,this),n.__webglTexture&&t.deleteTexture(textureProperties.__webglTexture),n.__webglFramebuffer&&t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),this.properties.delete(i)},zen3d.WebGLTexture=h}(),function(){var e=["const float PackUpscale = 256. / 255.;","const float UnpackDownscale = 255. / 256.;","const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );","const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );","const float ShiftRight8 = 1. / 256.;","vec4 packDepthToRGBA( const in float v ) {","vec4 r = vec4( fract( v * PackFactors ), v );","r.yzw -= r.xyz * ShiftRight8;","return r * PackUpscale;","}","float unpackRGBAToDepth( const in vec4 v ) {","return dot( v, UnpackFactors );","}"].join("\n"),t="mat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \n",i="mat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \n",n=["mat3 tsn(vec3 N, vec3 V, vec2 uv) {","vec3 q0 = dFdx( V.xyz );","vec3 q1 = dFdy( V.xyz );","vec2 st0 = dFdx( uv.st );","vec2 st1 = dFdy( uv.st );","vec3 S = normalize( q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","mat3 tsn = mat3( S, T, N );","return tsn;","}"].join("\n"),r="mat3 tbn(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p.xyz); \nvec3 dp2 = dFdy(p.xyz); \nvec2 duv1 = dFdx(uv.st); \nvec2 duv2 = dFdy(uv.st); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \n",o=["attribute vec3 a_Position;","attribute vec3 a_Normal;",t,i,"uniform mat4 u_Projection;","uniform mat4 u_View;","uniform mat4 u_Model;","uniform vec3 u_CameraPosition;"].join("\n"),a=["uniform mat4 u_View;","uniform float u_Opacity;","uniform vec3 u_Color;","uniform vec3 u_CameraPosition;"].join("\n"),s=["vec4 outColor = vec4(u_Color, u_Opacity);"].join("\n"),h=["gl_FragColor = outColor;"].join("\n"),u=["gl_Position = u_Projection * u_View * u_Model * vec4(a_Position, 1.0);"].join("\n"),c=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","attribute vec2 a_Uv;","varying vec2 v_Uv;","#endif"].join("\n"),d=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","v_Uv = a_Uv;","#endif"].join("\n"),p=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","varying vec2 v_Uv;","#endif"].join("\n"),l=["#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif"].join("\n"),f=["#ifdef USE_NORMAL","v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(a_Normal, 1.0)).xyz;","#endif"].join("\n"),_=["#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif"].join("\n"),m=["#ifdef USE_NORMAL","vec3 N;","#ifdef USE_NORMAL_MAP","vec3 normalMapColor = texture2D(normalMap, v_Uv).rgb;","mat3 tspace = tsn(normalize(v_Normal), -v_ViewModelPos, vec2(v_Uv.x, 1.0 - v_Uv.y));","N = normalize(tspace * (normalMapColor * 2.0 - 1.0));","#else","N = normalize(v_Normal);","#endif","#endif"].join("\n"),E=["#ifdef USE_DIFFUSE_MAP","uniform sampler2D texture;","#endif"].join("\n"),v=["#ifdef USE_DIFFUSE_MAP","outColor *= texture2D(texture, v_Uv);","#endif"].join("\n"),T=[n,r,"uniform sampler2D normalMap;"].join("\n"),g=["#ifdef USE_ENV_MAP","varying vec3 v_EnvPos;","#endif"].join("\n"),x=["#ifdef USE_ENV_MAP","v_EnvPos = reflect(normalize((u_Model * vec4(a_Position, 1.0)).xyz - u_CameraPosition), (transpose(inverse(u_Model)) * vec4(a_Normal, 1.0)).xyz);","#endif"].join("\n"),y=["#ifdef USE_ENV_MAP","varying vec3 v_EnvPos;","uniform samplerCube envMap;","uniform float u_EnvMap_Intensity;","#endif"].join("\n"),M=["#ifdef USE_ENV_MAP","vec4 envColor = textureCube(envMap, v_EnvPos);","outColor += envColor * u_EnvMap_Intensity;","#endif"].join("\n"),z=["#ifdef USE_SHADOW","#ifdef USE_DIRECT_LIGHT","uniform mat4 directionalShadowMatrix[ USE_DIRECT_LIGHT ];","varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];","#endif","#ifdef USE_POINT_LIGHT","#endif","#ifdef USE_SPOT_LIGHT","uniform mat4 spotShadowMatrix[ USE_SPOT_LIGHT ];","varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];","#endif","#endif"].join("\n"),b=["#ifdef USE_SHADOW","vec4 worldPosition = u_Model * vec4(a_Position, 1.0);","#ifdef USE_DIRECT_LIGHT","for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {","vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;","}","#endif","#ifdef USE_POINT_LIGHT","#endif","#ifdef USE_SPOT_LIGHT","for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {","vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;","}","#endif","#endif"].join("\n"),w=["#ifdef USE_SHADOW",e,"#ifdef USE_DIRECT_LIGHT","uniform sampler2D directionalShadowMap[ USE_DIRECT_LIGHT ];","varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];","#endif","#ifdef USE_POINT_LIGHT","uniform samplerCube pointShadowMap[ USE_POINT_LIGHT ];","#endif","#ifdef USE_SPOT_LIGHT","uniform sampler2D spotShadowMap[ USE_SPOT_LIGHT ];","varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];","#endif","float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {","return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );","}","float textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {","return step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );","}","float getShadow( sampler2D shadowMap, vec4 shadowCoord ) {","shadowCoord.xyz /= shadowCoord.w;","shadowCoord.z += 0.0003;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","return texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );","}","return 1.0;","}","float getPointShadow( samplerCube shadowMap, vec3 V ) {","return textureCubeCompare( shadowMap, normalize(V), length(V) / 1000.);","}","float getShadowMask() {","float shadow = 1.0;","#ifdef USE_DIRECT_LIGHT","for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {","shadow *= bool( u_Directional[i].shadow ) ? getShadow( directionalShadowMap[ i ], vDirectionalShadowCoord[ i ] ) : 1.0;","}","#endif","#ifdef USE_POINT_LIGHT","for ( int i = 0; i < USE_POINT_LIGHT; i ++ ) {","vec3 worldV = (vec4(v_ViewModelPos, 1.) * u_View - vec4(u_Point[i].position, 1.) * u_View).xyz;","shadow *= bool( u_Point[i].shadow ) ? getPointShadow( pointShadowMap[ i ], worldV ) : 1.0;","}","#endif","#ifdef USE_SPOT_LIGHT","for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {","shadow *= bool( u_Spot[i].shadow ) ? getShadow( spotShadowMap[ i ], vSpotShadowCoord[ i ] ) : 1.0;","}","#endif","return shadow;","}","#endif"].join("\n"),S=["#ifdef USE_SHADOW","outColor *= getShadowMask();","#endif"].join("\n"),P=["struct AmbientLight","{","vec4 color;","float intensity;","};","uniform AmbientLight u_Ambient[USE_AMBIENT_LIGHT];"].join("\n"),L=["struct DirectLight","{","vec3 direction;","vec4 color;","float intensity;","int shadow;","};","uniform DirectLight u_Directional[USE_DIRECT_LIGHT];"].join("\n"),A=["struct PointLight","{","vec3 position;","vec4 color;","float intensity;","float distance;","float decay;","int shadow;","};","uniform PointLight u_Point[USE_POINT_LIGHT];"].join("\n"),R=["struct SpotLight","{","vec3 position;","vec4 color;","float intensity;","float distance;","float decay;","float coneCos;","float penumbraCos;","vec3 direction;","int shadow;","};","uniform SpotLight u_Spot[USE_SPOT_LIGHT];"].join("\n"),C=["#ifdef USE_AMBIENT_LIGHT",P,"#endif","#ifdef USE_DIRECT_LIGHT",L,"#endif","#ifdef USE_POINT_LIGHT",A,"#endif","#ifdef USE_SPOT_LIGHT",R,"#endif"].join("\n"),U=["#ifdef USE_LIGHT","vec4 light;","vec3 L;","vec4 reflectLight = vec4(0., 0., 0., 0.);","vec4 diffuseColor = outColor.xyzw;","#ifdef USE_AMBIENT_LIGHT","for(int i = 0; i < USE_AMBIENT_LIGHT; i++) {","reflectLight += diffuseColor * u_Ambient[i].color * u_Ambient[i].intensity;","}","#endif","#if defined(USE_PHONG) && ( defined(USE_DIRECT_LIGHT) || defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) )","vec3 V = normalize( (u_View * vec4(u_CameraPosition, 1.)).xyz - v_ViewModelPos);","#endif","#ifdef USE_DIRECT_LIGHT","for(int i = 0; i < USE_DIRECT_LIGHT; i++) {","L = -u_Directional[i].direction;","light = u_Directional[i].color * u_Directional[i].intensity;","L = normalize(L);","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONG","RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","#endif","#ifdef USE_POINT_LIGHT","for(int i = 0; i < USE_POINT_LIGHT; i++) {","L = u_Point[i].position - v_ViewModelPos;","float dist = pow(clamp(1. - length(L) / u_Point[i].distance, 0.0, 1.0), u_Point[i].decay);","light = u_Point[i].color * u_Point[i].intensity * dist;","L = normalize(L);","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONG","RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","#endif","#ifdef USE_SPOT_LIGHT","for(int i = 0; i < USE_SPOT_LIGHT; i++) {","L = u_Spot[i].position - v_ViewModelPos;","float lightDistance = length(L);","L = normalize(L);","float angleCos = dot( L, -normalize(u_Spot[i].direction) );","if( all( bvec2(angleCos > u_Spot[i].coneCos, lightDistance < u_Spot[i].distance) ) ) {","float spotEffect = smoothstep( u_Spot[i].coneCos, u_Spot[i].penumbraCos, angleCos );","float dist = pow(clamp(1. - lightDistance / u_Spot[i].distance, 0.0, 1.0), u_Spot[i].decay);","light = u_Spot[i].color * u_Spot[i].intensity * dist * spotEffect;","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONG","RE_BlinnPhong(u_SpecularColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","}","#endif","outColor = reflectLight.xyzw;","#endif"].join("\n"),F=["void RE_Lambert(vec4 k, vec4 light, vec3 N, vec3 L, inout vec4 reflectLight) {","float dotNL = max(dot(N, L), 0.);","reflectLight += k * light * dotNL;","}"].join("\n"),N=["void RE_Phong(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 R = max(dot(2.0 * N, L), 0.) * N - L;","reflectLight += k * light * pow(max(dot(V, R), 0.), n_s);","}"].join("\n"),I=["void RE_BlinnPhong(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 H = normalize(L + V);","reflectLight += k * light * pow(max(dot(N, H), 0.), n_s);","}"].join("\n"),O=["#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )","varying vec3 v_ViewModelPos;","#endif"].join("\n"),D=["#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )","v_ViewModelPos = (u_View * u_Model * vec4(a_Position, 1.0)).xyz;","#endif"].join("\n"),B=["#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )","varying vec3 v_ViewModelPos;","#endif"].join("\n"),G=["#ifdef USE_PREMULTIPLIED_ALPHA","gl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;","#endif"].join("\n"),H=["#ifdef USE_FOG","uniform vec3 u_FogColor;","#ifdef USE_EXP2_FOG","uniform float u_FogDensity;","#else","uniform float u_FogNear;","uniform float u_FogFar;","#endif","#endif"].join("\n"),V=["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef USE_EXP2_FOG","float fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );","#else","float fogFactor = smoothstep( u_FogNear, u_FogFar, depth );","#endif","gl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );","#endif"].join("\n"),j={
basicVertex:[o,c,g,"void main() {",u,d,x,"}"].join("\n"),basicFragment:[a,p,E,y,H,"void main() {",s,v,M,h,G,V,"}"].join("\n"),lambertVertex:[o,l,c,O,g,z,"void main() {",u,f,d,D,x,b,"}"].join("\n"),lambertFragment:[a,p,E,T,C,_,B,F,y,w,H,"void main() {",s,v,m,U,M,S,h,G,V,"}"].join("\n"),phongVertex:[o,l,c,O,g,z,"void main() {",u,f,d,D,x,b,"}"].join("\n"),phongFragment:[a,"uniform float u_Specular;","uniform vec4 u_SpecularColor;",p,E,T,C,_,B,F,N,I,y,w,H,"void main() {",s,v,m,U,M,S,h,G,V,"}"].join("\n"),cubeVertex:[o,"varying vec3 v_ModelPos;","void main() {",u,"v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;","}"].join("\n"),cubeFragment:[a,"uniform samplerCube cubeMap;","varying vec3 v_ModelPos;","void main() {",s,"outColor *= textureCube(cubeMap, v_ModelPos);",h,"}"].join("\n"),depthVertex:[o,"varying vec3 v_ModelPos;","void main() {",u,"v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;","}"].join("\n"),depthFragment:[a,"uniform vec3 lightPos;","varying vec3 v_ModelPos;",e,"void main() {","gl_FragColor = packDepthToRGBA(length(v_ModelPos - lightPos) / 1000.);","}"].join("\n"),pointsVertex:[o,"uniform float u_PointSize;","uniform float u_PointScale;","void main() {",u,"vec4 mvPosition = u_View * u_Model * vec4(a_Position, 1.0);","#ifdef USE_SIZEATTENUATION","gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );","#else","gl_PointSize = u_PointSize;","#endif","}"].join("\n"),pointsFragment:[a,E,H,"void main() {",s,"#ifdef USE_DIFFUSE_MAP","outColor *= texture2D(texture, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));","#endif",h,G,V,"}"].join("\n")};zen3d.ShaderLib=j}(),function(){function e(e,t,i){var n=e.createShader(t);e.shaderSource(n,i),e.compileShader(n);var r=e.getShaderParameter(n,e.COMPILE_STATUS);return r||(console.log("shader not compiled!"),console.log(e.getShaderInfoLog(n))),n}function t(e,t,i){var n=e.createProgram();return e.attachShader(n,t),e.attachShader(n,i),e.linkProgram(n),n}function i(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<n;r++){var o=e.getActiveUniform(t,r),a=o.name,s=o.type;i[a]={type:s,size:o.size,location:e.getUniformLocation(t,a)}}return i}function n(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var o=e.getActiveAttrib(t,r),a=o.name,s=o.type;i[a]={type:s,size:1,location:e.getAttribLocation(t,a)}}return i}function r(e){var t="";for(var i in e)t+=e[i]+"_";return t}function o(e,t){var i=t.materialType==h.BASIC,n=t.materialType==h.CUBE,r=zen3d.ShaderLib.vertexBase,o=zen3d.ShaderLib.fragmentBase;switch(t.materialType){case h.BASIC:r=zen3d.ShaderLib.basicVertex,o=zen3d.ShaderLib.basicFragment;break;case h.LAMBERT:r=zen3d.ShaderLib.lambertVertex,o=zen3d.ShaderLib.lambertFragment;break;case h.PHONG:r=zen3d.ShaderLib.phongVertex,o=zen3d.ShaderLib.phongFragment;break;case h.CUBE:r=zen3d.ShaderLib.cubeVertex,o=zen3d.ShaderLib.cubeFragment;break;case h.POINT:r=zen3d.ShaderLib.pointsVertex,o=zen3d.ShaderLib.pointsFragment}var a,u;i?(a=[t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":""].join("\n"),u=[t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":"",t.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",t.fog?"#define USE_FOG":"",t.fogExp2?"#define USE_EXP2_FOG":""].join("\n")):n?(a=[""].join("\n"),u=[""].join("\n")):(a=[t.pointLightNum>0?"#define USE_POINT_LIGHT "+t.pointLightNum:"",t.spotLightNum>0?"#define USE_SPOT_LIGHT "+t.spotLightNum:"",t.directLightNum>0?"#define USE_DIRECT_LIGHT "+t.directLightNum:"",t.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+t.ambientLightNum:"",t.pointLightNum>0||t.directLightNum>0||t.ambientLightNum>0||t.spotLightNum>0?"#define USE_LIGHT":"",t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0?"#define USE_NORMAL":"",(t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useNormalMap?"#define USE_NORMAL_MAP":"",t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":"",t.useShadow?"#define USE_SHADOW":"",t.materialType==h.LAMBERT?"#define USE_LAMBERT":"",t.materialType==h.PHONG?"#define USE_PHONG":"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":""].join("\n"),u=[t.pointLightNum>0?"#define USE_POINT_LIGHT "+t.pointLightNum:"",t.spotLightNum>0?"#define USE_SPOT_LIGHT "+t.spotLightNum:"",t.directLightNum>0?"#define USE_DIRECT_LIGHT "+t.directLightNum:"",t.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+t.ambientLightNum:"",t.pointLightNum>0||t.directLightNum>0||t.ambientLightNum>0||t.spotLightNum>0?"#define USE_LIGHT":"",t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0?"#define USE_NORMAL":"",(t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useNormalMap?"#define USE_NORMAL_MAP":"",t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":"",t.useShadow?"#define USE_SHADOW":"",t.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"",t.fog?"#define USE_FOG":"",t.fogExp2?"#define USE_EXP2_FOG":"",t.materialType==h.LAMBERT?"#define USE_LAMBERT":"",t.materialType==h.PHONG?"#define USE_PHONG":""].join("\n"));var c=["precision "+t.precision+" float;","precision "+t.precision+" int;",a,r].join("\n"),d=["#extension GL_OES_standard_derivatives : enable","precision "+t.precision+" float;","precision "+t.precision+" int;",u,"#define LOG2 1.442695","#define saturate(a) clamp( a, 0.0, 1.0 )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )",o].join("\n");return new s(e,c,d)}var a={},s=function(r,o,a){this.vshaderSource=o,this.fshaderSource=a,this.vertexShader=e(r,r.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=e(r,r.FRAGMENT_SHADER,this.fshaderSource),this.id=t(r,this.vertexShader,this.fragmentShader),this.uniforms=i(r,this.id),this.attributes=n(r,this.id)},h=zen3d.MATERIAL_TYPE,u=function(e,t,i,n,s){var h,u=i.material,c=n[0],d=n[1],p=n[2],l=n[3],f=t.capabilities.maxPrecision,_={precision:f,useDiffuseMap:!!u.map,useNormalMap:!!u.normalMap,useEnvMap:!!u.envMap,useDiffuseColor:!u.map,ambientLightNum:c,directLightNum:d,pointLightNum:p,spotLightNum:l,materialType:u.type,useShadow:i.receiveShadow,premultipliedAlpha:u.premultipliedAlpha,fog:!!s,fogExp2:!!s&&s.fogType===zen3d.FOG_TYPE.EXP2,sizeAttenuation:u.sizeAttenuation},m=r(_),E=a;return E[m]?h=E[m]:(h=o(e,_),E[m]=h),h},c=function(e,t){var i,n=a,r="depth",o=t.capabilities.maxPrecision;if(n[r])i=n[r];else{var h=["precision "+o+" float;","precision "+o+" int;",zen3d.ShaderLib.depthVertex].join("\n"),u=["#extension GL_OES_standard_derivatives : enable","precision "+o+" float;","precision "+o+" int;",zen3d.ShaderLib.depthFragment].join("\n");i=new s(e,h,u),n[r]=i}return i};zen3d.getProgram=u,zen3d.getDepthProgram=c}(),function(){var e=zen3d.MATERIAL_TYPE,t=zen3d.CULL_FACE_TYPE,i=zen3d.BLEND_TYPE,n=function(e){this.view=e;var i=this.gl=e.getContext("webgl",{antialias:!0,alpha:!1,stencil:!0});this.width=e.width,this.height=e.height,this.autoClear=!0;var n=new zen3d.WebGLProperties;this.properties=n;var r=new zen3d.WebGLCapabilities(i);this.capabilities=r;var o=new zen3d.WebGLState(i,r);o.enable(i.STENCIL_TEST),o.enable(i.DEPTH_TEST),o.setCullFace(t.FRONT),o.viewport(0,0,this.width,this.height),o.clearColor(0,0,0,0),this.state=o,this.texture=new zen3d.WebGLTexture(i,o,n,r),this.cache=new zen3d.RenderCache;zen3d.getExtension(i,"OES_standard_derivatives"),zen3d.getExtension(i,"GL_OES_standard_derivatives");this._usedTextureUnits=0,this._currentRenderTarget=null};n.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.state.viewport(0,0,e,t)},n.prototype.render=function(e,t,i,n){e.updateMatrix(),t.viewMatrix.getInverse(t.worldMatrix),this.cache.cacheScene(e,t),this.cache.sort(),this.renderShadow(),void 0===i&&(i=null),this.setRenderTarget(i),(this.autoClear||n)&&(this.state.clearColor(0,0,0,0),this.clear(!0,!0,!0)),this.renderList(this.cache.opaqueObjects),this.renderList(this.cache.transparentObjects),this.cache.clear(),i&&this.texture.updateRenderTargetMipmap(i)},n.prototype.renderShadow=function(){var e=this.cache.shadowObjects;if(0!=e.length)for(var t=this.gl,n=this.cache.shadowLights,o=0;o<n.length;o++)for(var a=n[o],s=a.shadow,h=s.camera,u=s.renderTarget,c=a.lightType==zen3d.LIGHT_TYPE.POINT,d=c?6:1,p=0;p<d;p++){c?(s.update(a,p),u.activeCubeFace=p):s.update(a),this.setRenderTarget(u),this.state.clearColor(1,1,1,1),this.clear(!0,!0);for(var l=0,f=e.length;l<f;l++){var _=e[l],m=(_.material,this._uploadGeometry(_.geometry)),E=zen3d.getDepthProgram(t,this);t.useProgram(E.id);var v=E.attributes.a_Position.location;t.vertexAttribPointer(v,3,t.FLOAT,!1,68,0),t.enableVertexAttribArray(v);var T=E.uniforms;for(var g in T){var v=T[g].location;switch(g){case"u_Projection":var x=h.projectionMatrix.elements;t.uniformMatrix4fv(v,!1,x);break;case"u_View":var y=h.viewMatrix.elements;t.uniformMatrix4fv(v,!1,y);break;case"u_Model":var M=_.worldMatrix.elements;t.uniformMatrix4fv(v,!1,M);break;case"lightPos":r.setFromMatrixPosition(a.worldMatrix),t.uniform3f(v,r.x,r.y,r.z)}}this.state.setBlend(i.NONE),this.state.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,m,t.UNSIGNED_SHORT,0)}}};var r=new zen3d.Vector3;n.prototype.renderList=function(t){for(var n=this.cache.camera,o=this.cache.fog,a=this.gl,s=this.cache.ambientLights,h=this.cache.directLights,u=this.cache.pointLights,c=this.cache.spotLights,d=s.length,p=h.length,l=u.length,f=c.length,_=0,m=t.length;_<m;_++){var E=t[_],v=E.object,T=E.material,g=E.geometry,x=this._uploadGeometry(g),y=zen3d.getProgram(a,this,v,[d,p,l,f],o);a.useProgram(y.id);var M=y.attributes;for(var z in M){var b=M[z].location;switch(z){case"a_Position":a.vertexAttribPointer(b,3,a.FLOAT,!1,4*g.vertexSize,0);break;case"a_Normal":a.vertexAttribPointer(b,3,a.FLOAT,!1,4*g.vertexSize,12);break;case"a_Uv":a.vertexAttribPointer(b,2,a.FLOAT,!1,4*g.vertexSize,52);break;default:console.warn("attribute "+z+" not found!")}a.enableVertexAttribArray(b)}var w=y.uniforms;for(var z in w){var b=w[z].location;switch(z){case"u_Projection":var S=n.projectionMatrix.elements;a.uniformMatrix4fv(b,!1,S);break;case"u_View":var P=n.viewMatrix.elements;a.uniformMatrix4fv(b,!1,P);break;case"u_Model":var L=v.worldMatrix.elements;a.uniformMatrix4fv(b,!1,L);break;case"u_Color":var A=zen3d.hex2RGB(T.color);a.uniform3f(b,A[0]/255,A[1]/255,A[2]/255);break;case"u_Opacity":a.uniform1f(b,T.opacity);break;case"texture":var R=this.allocTexUnit();this.texture.setTexture2D(T.map,R),a.uniform1i(b,R);break;case"normalMap":var R=this.allocTexUnit();this.texture.setTexture2D(T.normalMap,R),a.uniform1i(b,R);break;case"envMap":var R=this.allocTexUnit();this.texture.setTextureCube(T.envMap,R),a.uniform1i(b,R);break;case"cubeMap":var R=this.allocTexUnit();this.texture.setTextureCube(T.cubeMap,R),a.uniform1i(b,R);break;case"u_EnvMap_Intensity":a.uniform1f(b,T.envMapIntensity);break;case"u_Specular":var C=T.specular;a.uniform1f(b,C);break;case"u_SpecularColor":var A=zen3d.hex2RGB(T.specularColor);a.uniform4f(b,A[0]/255,A[1]/255,A[2]/255,1);break;case"u_CameraPosition":r.setFromMatrixPosition(n.worldMatrix),a.uniform3f(b,r.x,r.y,r.z);break;case"u_FogColor":var A=zen3d.hex2RGB(o.color);a.uniform3f(b,A[0]/255,A[1]/255,A[2]/255);break;case"u_FogDensity":var U=o.density;a.uniform1f(b,U);break;case"u_FogNear":var F=o.near;a.uniform1f(b,F);break;case"u_FogFar":var N=o.far;a.uniform1f(b,N);break;case"u_PointSize":var I=T.size;a.uniform1f(b,I);break;case"u_PointScale":var O=.5*this.height;a.uniform1f(b,O)}}var D=T.type==e.BASIC,B=T.type==e.CUBE,G=T.type===e.POINT;if(!D&&!B&&!G){for(var H=0;H<d;H++){var V=s[H],j=V.intensity,A=zen3d.hex2RGB(V.color),X=w["u_Ambient["+H+"].intensity"].location,k=w["u_Ambient["+H+"].color"].location;a.uniform4f(k,A[0]/255,A[1]/255,A[2]/255,1),a.uniform1f(X,j)}for(var H=0;H<p;H++){var V=h[H],j=V.intensity;V.getWorldDirection(r),r.transformDirection(n.viewMatrix);var A=zen3d.hex2RGB(V.color),Y=w["u_Directional["+H+"].direction"].location,W=w["u_Directional["+H+"].intensity"].location,q=w["u_Directional["+H+"].color"].location;a.uniform3f(Y,r.x,r.y,r.z),a.uniform1f(W,j),a.uniform4f(q,A[0]/255,A[1]/255,A[2]/255,1);var Z=w["u_Directional["+H+"].shadow"].location;if(a.uniform1i(Z,V.castShadow?1:0),V.castShadow&&v.receiveShadow){var J=w["directionalShadowMatrix["+H+"]"].location;a.uniformMatrix4fv(J,!1,V.shadow.matrix.elements);var Q=w["directionalShadowMap["+H+"]"].location,R=this.allocTexUnit();this.texture.setTexture2D(V.shadow.map,R),a.uniform1i(Q,R)}}for(var H=0;H<l;H++){var V=u[H];r.setFromMatrixPosition(V.worldMatrix).applyMatrix4(n.viewMatrix);var j=V.intensity,A=zen3d.hex2RGB(V.color),$=V.distance,K=V.decay,ee=w["u_Point["+H+"].position"].location;a.uniform3f(ee,r.x,r.y,r.z);var te=w["u_Point["+H+"].intensity"].location;a.uniform1f(te,j);var ie=w["u_Point["+H+"].color"].location;a.uniform4f(ie,A[0]/255,A[1]/255,A[2]/255,1);var ne=w["u_Point["+H+"].distance"].location;a.uniform1f(ne,$);var re=w["u_Point["+H+"].decay"].location;a.uniform1f(re,K);var oe=w["u_Point["+H+"].shadow"].location;if(a.uniform1i(oe,V.castShadow?1:0),V.castShadow&&v.receiveShadow){var ae=w["pointShadowMap["+H+"]"].location,R=this.allocTexUnit();this.texture.setTextureCube(V.shadow.map,R),a.uniform1i(ae,R)}}for(var H=0;H<f;H++){var V=c[H];r.setFromMatrixPosition(V.worldMatrix).applyMatrix4(n.viewMatrix);var se=w["u_Spot["+H+"].position"].location;a.uniform3f(se,r.x,r.y,r.z);var j=V.intensity,A=zen3d.hex2RGB(V.color),$=V.distance,K=V.decay;V.getWorldDirection(r),r.transformDirection(n.viewMatrix);var he=w["u_Spot["+H+"].direction"].location;a.uniform3f(he,r.x,r.y,r.z);var ue=w["u_Spot["+H+"].intensity"].location;a.uniform1f(ue,j);var ce=w["u_Spot["+H+"].color"].location;a.uniform4f(ce,A[0]/255,A[1]/255,A[2]/255,1);var de=w["u_Spot["+H+"].distance"].location;a.uniform1f(de,$);var pe=w["u_Spot["+H+"].decay"].location;a.uniform1f(pe,K);var le=Math.cos(V.angle),fe=Math.cos(V.angle*(1-V.penumbra)),_e=w["u_Spot["+H+"].coneCos"].location;a.uniform1f(_e,le);var me=w["u_Spot["+H+"].penumbraCos"].location;a.uniform1f(me,fe);var Ee=w["u_Spot["+H+"].shadow"].location;if(a.uniform1i(Ee,V.castShadow?1:0),V.castShadow&&v.receiveShadow){var ve=w["spotShadowMatrix["+H+"]"].location;a.uniformMatrix4fv(ve,!1,V.shadow.matrix.elements);var Te=w["spotShadowMap["+H+"]"].location,R=this.allocTexUnit();this.texture.setTexture2D(V.shadow.map,R),a.uniform1i(Te,R)}}}T.transparent?this.state.setBlend(T.blending,T.premultipliedAlpha):this.state.setBlend(i.NONE),T.depthTest?this.state.enable(a.DEPTH_TEST):this.state.disable(a.DEPTH_TEST),v.type===zen3d.OBJECT_TYPE.POINT?a.drawArrays(a.POINTS,0,g.vertexCount):a.drawElements(a.TRIANGLES,x,a.UNSIGNED_SHORT,0),this._usedTextureUnits=0}},n.prototype._uploadGeometry=function(e){return e.bind(this)},n.prototype.setRenderTarget=function(e){var t=this.gl;if(!e)return void(this._currentRenderTarget===e||(t.bindFramebuffer(t.FRAMEBUFFER,null),this._currentRenderTarget=null,this.state.viewport(0,0,this.width,this.height)));var i=void 0!==e.activeCubeFace;if(this._currentRenderTarget!==e)i?this.texture.setRenderTargetCube(e):this.texture.setRenderTarget2D(e),this._currentRenderTarget=e;else if(i){var n=this.properties.get(e.texture);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,0)}this.state.viewport(0,0,e.width,e.height)},n.prototype.clear=function(e,t,i){var n=this.gl,r=0;(void 0===e||e)&&(r|=n.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=n.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=n.STENCIL_BUFFER_BIT),n.clear(r)},n.prototype.allocTexUnit=function(){var e=this._usedTextureUnits;return e>=this.capabilities.maxTextures&&console.warn("trying to use "+e+" texture units while this GPU supports only "+capabilities.maxTextures),this._usedTextureUnits+=1,e},zen3d.Renderer=n}(),function(){var e=zen3d.OBJECT_TYPE,t=zen3d.LIGHT_TYPE,i=function(){this.opaqueObjects=new Array,this.transparentObjects=new Array,this.shadowObjects=new Array,this.ambientLights=new Array,this.directLights=new Array,this.pointLights=new Array,this.spotLights=new Array,this.shadowLights=new Array,this.camera=null,this.fog=null},n=new zen3d.Vector3,r=new zen3d.Frustum,o=new zen3d.Matrix4,a=new zen3d.Sphere;i.prototype.cacheScene=function(e,t){this.camera=t,this.fog=e.fog,this.cacheObject(e)},i.prototype.cacheObject=function(i){var s=this.camera;switch(i.type){case e.POINT:case e.MESH:if(i.frustumCulled){a.copy(i.geometry.boundingSphere).applyMatrix4(i.worldMatrix),o.multiplyMatrices(s.projectionMatrix,s.viewMatrix),r.setFromMatrix(o);var h=r.intersectsSphere(a);if(!h)break}var u,c=i.material;u=c.transparent?this.transparentObjects:this.opaqueObjects,n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(s.viewMatrix).applyMatrix4(s.projectionMatrix),u.push({object:i,geometry:i.geometry,material:i.material,z:n.z}),i.castShadow&&this.shadowObjects.push(i);break;case e.LIGHT:i.lightType==t.AMBIENT?this.ambientLights.push(i):i.lightType==t.DIRECT?this.directLights.push(i):i.lightType==t.POINT?this.pointLights.push(i):i.lightType==t.SPOT&&this.spotLights.push(i),i.castShadow&&i.lightType!==t.AMBIENT&&this.shadowLights.push(i);break;case e.CAMERA:break;case e.SCENE:break;case e.GROUP:break;default:console.log("undefined object type")}for(var d=i.children,p=0,l=d.length;p<l;p++)this.cacheObject(d[p])},i.prototype.sort=function(){this.opaqueObjects.sort(function(e,t){var i=e.z,n=t.z;return i-n}),this.transparentObjects.sort(function(e,t){var i=e.z,n=t.z;return n-i})},i.prototype.clear=function(){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.shadowObjects.length=0,this.ambientLights.length=0,this.directLights.length=0,this.pointLights.length=0,this.spotLights.length=0,this.shadowLights.length=0},zen3d.RenderCache=i}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.width=t,this.height=i,this.viewport=new zen3d.Vector4(0,0,t,i),this.depthBuffer=!0,this.stencilBuffer=!0};zen3d.inherit(e,zen3d.EventDispatcher),e.prototype.resize=function(e,t){this.width===e&&this.height===t||this.dispose(),this.width=e,this.height=t,this.viewport.copy(0,0,e,t)},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},zen3d.RenderTargetBase=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.texture=new zen3d.Texture2D};zen3d.inherit(e,zen3d.RenderTargetBase),e.prototype.resize=function(e,t){},zen3d.RenderTarget2D=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.texture=new zen3d.TextureCube,this.activeCubeFace=0};zen3d.inherit(e,zen3d.RenderTargetBase),e.prototype.resize=function(e,t){},zen3d.RenderTargetCube=e}(),function(){var e=function(e,t){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1);var i=this.euler=new zen3d.Euler,n=this.quaternion=new zen3d.Quaternion;i.onChange(function(){n.setFromEuler(i,!1)}),n.onChange(function(){i.setFromQuaternion(n,void 0,!1)}),this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0};Object.defineProperties(e.prototype,{rotation:{get:function(){return this.euler},set:function(e){var t=this.euler;t.copyFrom(e),this.quaternion.setFromEuler(e)}}}),e.prototype.add=function(e){this.children.push(e),e.parent=this},e.prototype.remove=function(e){var t=this.children.indexOf(e);t!==-1&&this.children.splice(t,1),e.parent=null},e.prototype.getObjectByName=function(e){return this.getObjectByProperty("name",e)},e.prototype.getObjectByProperty=function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],o=r.getObjectByProperty(e,t);if(void 0!==o)return o}},e.prototype.updateMatrix=function(){var e=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(e),this.parent){var t=this.parent.worldMatrix;this.worldMatrix.premultiply(t)}for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrix()},e.prototype.getWorldDirection=function(){var e=new zen3d.Vector3,t=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(e,t,i),r.set(0,0,1).applyQuaternion(t),r}}(),zen3d.Object3D=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE,this.fog=null};zen3d.inherit(e,zen3d.Object3D),zen3d.Scene=e}(),function(){var e=function(e,t,i){this.fogType=zen3d.FOG_TYPE.NORMAL,this.color=e,this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3};zen3d.Fog=e}(),function(){var e=function(e,t){this.fogType=zen3d.FOG_TYPE.EXP2,this.color=e,this.density=void 0!==t?t:25e-5};zen3d.FogExp2=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(e,zen3d.Object3D),zen3d.Group=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=16777215,this.intensity=1};zen3d.inherit(e,zen3d.Object3D),zen3d.Light=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(e,zen3d.Light),zen3d.AmbientLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.shadow=new zen3d.DirectionalLightShadow};zen3d.inherit(e,zen3d.Light),zen3d.DirectionalLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2,this.distance=200,this.shadow=new zen3d.PointLightShadow};zen3d.inherit(e,zen3d.Light),zen3d.PointLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.SPOT,this.decay=2,this.distance=200,this.penumbra=0,this.angle=Math.PI/6,this.shadow=new zen3d.SpotLightShadow};zen3d.inherit(e,zen3d.Light),zen3d.SpotLight=e}(),function(){var e=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget2D(1024,1024);var e=this.renderTarget.texture;e.generateMipmaps=!1,e.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=e,this.windowSize=500,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};e.prototype.update=function(e){this._updateCamera(e),this._updateMatrix()},e.prototype._updateCamera=function(e){var t=this.camera,i=this._lookTarget;e.getWorldDirection(this._lookTarget),t.position.setFromMatrixPosition(e.worldMatrix),i.set(i.x+t.position.x,i.y+t.position.y,i.z+t.position.z),t.setLookAt(i,this._up),t.updateMatrix(),t.viewMatrix.getInverse(t.worldMatrix);var n=this.windowSize/2;t.setOrtho(-n,n,-n,n,1,1e3)},e.prototype._updateMatrix=function(){var e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)},zen3d.DirectionalLightShadow=e}(),function(){var e=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTarget2D(1024,1024);var e=this.renderTarget.texture;e.generateMipmaps=!1,e.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=e,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};e.prototype.update=function(e){this._updateCamera(e),this._updateMatrix()},e.prototype._updateCamera=function(e){var t=this.camera,i=this._lookTarget;e.getWorldDirection(this._lookTarget),t.position.setFromMatrixPosition(e.worldMatrix),i.set(i.x+t.position.x,i.y+t.position.y,i.z+t.position.z),t.setLookAt(i,this._up),t.updateMatrix(),t.viewMatrix.getInverse(t.worldMatrix),t.setPerspective(2*e.angle,1,1,1e3)},e.prototype._updateMatrix=function(){var e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)},zen3d.SpotLightShadow=e}(),function(){var e=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4,this.renderTarget=new zen3d.RenderTargetCube(512,512);var e=this.renderTarget.texture;e.generateMipmaps=!1,e.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=e,this._targets=[new zen3d.Vector3(1,0,0),new zen3d.Vector3((-1),0,0),new zen3d.Vector3(0,1,0),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,(-1))],this._ups=[new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,(-1)),new zen3d.Vector3(0,(-1),0),new zen3d.Vector3(0,(-1),0)],this._lookTarget=new zen3d.Vector3};e.prototype.update=function(e,t){this._updateCamera(e,t),this._updateMatrix()},e.prototype._updateCamera=function(e,t){var i=this.camera,n=this._lookTarget,r=this._targets,o=this._ups;i.position.setFromMatrixPosition(e.worldMatrix),n.set(r[t].x+i.position.x,r[t].y+i.position.y,r[t].z+i.position.z),i.setLookAt(n,o[t]),i.updateMatrix(),i.viewMatrix.getInverse(i.worldMatrix),i.setPerspective(.5*Math.PI,1,1,1e3)},e.prototype._updateMatrix=function(){var e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)},zen3d.PointLightShadow=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(e,zen3d.Object3D),e.prototype.setLookAt=function(e,t){var i=this.position,n=new zen3d.Vector3;i.subtract(e,n),n.normalize();var r=new zen3d.Vector3;t.crossProduct(n,r),r.normalize();var o=new zen3d.Vector3;n.crossProduct(r,o),this.quaternion.setFromRotationMatrix(zen3d.helpMatrix.set(r.x,o.x,n.x,0,r.y,o.y,n.y,0,r.z,o.z,n.z,0,0,0,0,1))},e.prototype.setOrtho=function(e,t,i,n,r,o){this.projectionMatrix.set(2/(t-e),0,0,-(t+e)/(t-e),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(o-r),-(o+r)/(o-r),0,0,0,1)},e.prototype.setPerspective=function(e,t,i,n){this.projectionMatrix.set(1/(t*Math.tan(e/2)),0,0,0,0,1/Math.tan(e/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},e.prototype.getWorldDirection=function(){var e=new zen3d.Vector3,t=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),r}}(),zen3d.Camera=e}(),function(){var e=function(){this.verticesArray=new Array,this.indicesArray=new Array,this.verticesBuffer=null,this.indicesBuffer=null,this.drawLen=0,this.vertexCount=0,this.vertexSize=17,this.boundingBox=new zen3d.Box3,this.boundingSphere=new zen3d.Sphere,this.dirty=!0};e.prototype.bind=function(e){if(this.dirty)this.upload(e),this.dirty=!1;else{var t=e.gl;t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer),this.indicesArray.length>0&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}return this.drawLen},e.prototype.upload=function(e){var t=e.gl;this.verticesBuffer||(this.verticesBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer);var i=new Float32Array(this.verticesArray);if(t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),this.indicesArray.length>0){this.indicesBuffer||(this.indicesBuffer=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);var n=new Uint16Array(this.indicesArray);t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}this.drawLen=this.indicesArray.length,this.vertexCount=this.verticesArray.length/this.vertexSize},e.prototype.computeBoundingBox=function(){this.boundingBox.setFromArray(this.verticesArray,this.vertexSize)},e.prototype.computeBoundingSphere=function(){this.boundingSphere.setFromArray(this.verticesArray,this.vertexSize)},zen3d.Geometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i,n,void 0==r||r)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){this.verticesArray.push(.5*-e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*t,.5*-i,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*t,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*-t,.5*i,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*-t,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*t,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*-t,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*-t,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*t,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),n?this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34):this.indicesArray.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35),this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.CubeGeometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i,n||1,r||1)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){for(var r=i+1,o=n+1,a=this.verticesArray,s=this.indicesArray,h=0,u=0,c=0;c<o;c++)for(var d=0;d<r;d++){var p=(d/i-.5)*e,l=(c/n-.5)*t;if(a[h++]=p,a[h++]=0,a[h++]=l,a[h++]=0,a[h++]=1,a[h++]=0,a[h++]=1,a[h++]=0,a[h++]=0,a[h++]=1,a[h++]=1,a[h++]=1,a[h++]=1,a[h++]=d/i*1,a[h++]=1*(1-c/n),a[h++]=d/i*1,a[h++]=1*(1-c/n),d!=i&&c!=n){base=d+c*r;var f=1;s[u++]=base*f,s[u++]=(base+r+1)*f,s[u++]=(base+r)*f,s[u++]=base*f,s[u++]=(base+1)*f,s[u++]=(base+r+1)*f}}this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.PlaneGeometry=e}(),function(){var e=function(t,i,n){e.superClass.constructor.call(this),this.buildGeometry(t,i||20,n||20)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i){var n=!0,r=0,o=0,a=0,s=17,h=s-9,u=this.verticesArray,c=this.indicesArray,d=0,p=0,l=0,f=0,_=0,m=0;for(o=0;o<=i;++o){d=p;var E=Math.PI*o/i,v=-e*Math.cos(E),T=e*Math.sin(E);for(r=0;r<=t;++r){var g=2*Math.PI*r/t,x=T*Math.cos(g),y=T*Math.sin(g),M=1/Math.sqrt(x*x+y*y+v*v),z=Math.sqrt(y*y+x*x);if(_=0,m=z>.007?x/z:0,l=-v,f=y,r==t?(u[p++]=u[d],u[p++]=u[d+1],u[p++]=u[d+2],u[p++]=x*M,u[p++]=l*M,u[p++]=f*M,u[p++]=z>.007?-y/z:1,u[p++]=_,u[p++]=m,u[p+0]=1,u[p+1]=1,u[p+2]=1,u[p+3]=1):(u[p++]=x,u[p++]=l,u[p++]=f,u[p++]=x*M,u[p++]=l*M,u[p++]=f*M,u[p++]=z>.007?-y/z:1,u[p++]=_,u[p++]=m,u[p]=1,u[p+1]=1,u[p+2]=1,u[p+3]=1),r>0&&o>0){var b=(t+1)*o+r,w=(t+1)*o+r-1,S=(t+1)*(o-1)+r-1,P=(t+1)*(o-1)+r;o==i?(u[p-9]=u[d],u[p-8]=u[d+1],u[p-7]=u[d+2],n?(c[a++]=b,c[a++]=P,c[a++]=S):(c[a++]=b,c[a++]=S,c[a++]=P)):1==o?n?(c[a++]=b,c[a++]=S,c[a++]=w):(c[a++]=b,c[a++]=w,c[a++]=S):n?(c[a++]=b,c[a++]=P,c[a++]=S,c[a++]=b,c[a++]=S,c[a++]=w):(c[a++]=b,c[a++]=S,c[a++]=P,c[a++]=b,c[a++]=w,c[a++]=S)}p+=h}}var s=17,h=s-2,p=13;for(o=0;o<=i;++o)for(r=0;r<=t;++r)u[p++]=r/t,u[p++]=o/i,p+=h;this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.SphereGeometry=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.textureType="",this.border=0,this.pixelFormat=zen3d.WEBGL_PIXEL_FORMAT.RGBA,this.pixelType=zen3d.WEBGL_PIXEL_TYPE.UNSIGNED_BYTE,this.magFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR_MIPMAP_LINEAR,
this.wrapS=zen3d.WEBGL_TEXTURE_WRAP.CLAMP_TO_EDGE,this.wrapT=zen3d.WEBGL_TEXTURE_WRAP.CLAMP_TO_EDGE,this.generateMipmaps=!0,this.version=0};zen3d.inherit(e,zen3d.EventDispatcher),e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"}),this.version=0},zen3d.TextureBase=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.textureType=zen3d.WEBGL_TEXTURE_TYPE.TEXTURE_2D,this.image=null,this.mipmaps=[]};zen3d.inherit(e,zen3d.TextureBase),e.fromImage=function(t){var i=new e;return i.image=t,i.version++,i},e.fromSrc=function(t){var i=new e,n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);return zen3d.requireImage(t,function(e){i.pixelFormat=n?zen3d.WEBGL_PIXEL_FORMAT.RGB:zen3d.WEBGL_PIXEL_FORMAT.RGBA,i.image=e,i.version++}),i},zen3d.Texture2D=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.textureType=zen3d.WEBGL_TEXTURE_TYPE.TEXTURE_CUBE_MAP,this.images=[]};zen3d.inherit(e,zen3d.TextureBase),e.fromImage=function(t){for(var i=new e,n=i.images,r=0;r<6;r++)n[r]=t[r];return i.version++,i},e.fromSrc=function(t){function i(e){return e&&(o.push(e),h++),h>=6?void n():void zen3d.requireImage(t[h],i)}function n(){r.pixelFormat=s?zen3d.WEBGL_PIXEL_FORMAT.RGB:zen3d.WEBGL_PIXEL_FORMAT.RGBA,r.version++}var r=new e,o=r.images,a=t[0],s=a.search(/\.(jpg|jpeg)$/)>0||0===a.search(/^data\:image\/jpeg/),h=0;return i(),r},zen3d.TextureCube=e}(),function(){var e=function(){this.type="",this.color=16777215,this.map=null,this.opacity=1,this.transparent=!1,this.premultipliedAlpha=!1,this.normalMap=null,this.envMap=null,this.envMapIntensity=1,this.blending=zen3d.BLEND_TYPE.NORMAL,this.depthTest=!0};zen3d.Material=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.BASIC};zen3d.inherit(e,zen3d.Material),zen3d.BasicMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LAMBERT};zen3d.inherit(e,zen3d.Material),zen3d.LambertMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PHONG,this.specular=30,this.specularColor=16777215};zen3d.inherit(e,zen3d.Material),zen3d.PhongMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CUBE,this.cubeMap=null};zen3d.inherit(e,zen3d.Material),zen3d.CubeMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.POINT,this.size=1,this.sizeAttenuation=!0};zen3d.inherit(e,zen3d.Material),zen3d.PointsMaterial=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.geometry=t,this.material=i,this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(e,zen3d.Object3D),zen3d.Mesh=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.geometry=t,this.material=i,this.type=zen3d.OBJECT_TYPE.POINT};zen3d.inherit(e,zen3d.Object3D),zen3d.Points=e}(),function(){var e=function(){this.texturePath="./"};e.prototype.load=function(e,t){this.texturePath=this.extractUrlBase(e),zen3d.requireHttp(e,function(e){var i=this.parse(e);t(i)}.bind(this),function(){console.log("load assimp2json error!")},{parse:!0})},e.prototype.parse=function(e){var t=this.parseList(e.meshes,this.parseMesh),i=this.parseList(e.materials,this.parseMaterial);return this.parseObject(e,e.rootnode,t,i)},e.prototype.parseList=function(e,t){for(var i=new Array(e.length),n=0;n<e.length;++n)i[n]=t.call(this,e[n]);return i},e.prototype.parseMaterial=function(e){var t=new zen3d.PhongMaterial,i=null,n=null,r=e.properties;for(var o in e.properties)if(r=e.properties[o],"$tex.file"===r.key){if(1==r.semantic){var a=this.texturePath+r.value;a=a.replace(/.\\/g,""),i=new zen3d.Texture2D.fromSrc(a),i.wrapS=i.wrapT=zen3d.WEBGL_TEXTURE_WRAP.REPEAT}else if(2==r.semantic);else if(5==r.semantic);else if(6==r.semantic){var a=this.texturePath+r.value;a=a.replace(/.\\/g,""),n=new zen3d.Texture2D.fromSrc(a),i.wrapS=i.wrapT=zen3d.WEBGL_TEXTURE_WRAP.REPEAT}}else"?mat.name"===r.key||"$clr.diffuse"===r.key||"$clr.specular"===r.key||"$clr.emissive"===r.key||("$mat.opacity"===r.key?(t.transparent=r.value<1,t.opacity=r.value):"$mat.shadingm"===r.key?1===r.value:"$mat.shininess"===r.key&&(t.specular=r.value));return t.map=i,t.normalMap=n,t},e.prototype.parseMesh=function(e){for(var t=new zen3d.Geometry,i=e.faces,n=e.vertices,r=e.normals,o=e.texturecoords[0],a=n.length/3,s=t.verticesArray,h=0;h<a;h++)s.push(n[3*h+0]),s.push(n[3*h+1]),s.push(n[3*h+2]),s.push(r[3*h+0]),s.push(r[3*h+1]),s.push(r[3*h+2]),s.push(0),s.push(0),s.push(0),s.push(1),s.push(1),s.push(1),s.push(1),o?(s.push(o[2*h+0]),s.push(1-o[2*h+1])):(s.push(0),s.push(0)),s.push(0),s.push(0);for(var u=t.indicesArray,h=0;h<i.length;h++)u.push(i[h][2]),u.push(i[h][1]),u.push(i[h][0]);return t},e.prototype.parseObject=function(e,t,i,n){var r=new zen3d.Group;r.name=t.name||"",r.matrix.fromArray(t.transformation).transpose(),r.matrix.decompose(r.position,r.quaternion,r.scale);for(var o,a=0;t.meshes&&a<t.meshes.length;++a){var s=t.meshes[a];o=new zen3d.Mesh(i[s],n[e.meshes[s].materialindex]),o.frustumCulled=!1,r.add(o)}for(var a=0;t.children&&a<t.children.length;++a)r.add(this.parseObject(e,t.children[a],i,n));return r},e.prototype.extractUrlBase=function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},zen3d.AssimpJsonLoader=e}(),function(){var e=function(e,t){this.camera=e,this.lookAtPoint=t,this.up=new zen3d.Vector3(0,1,0),this.distance=100,this._panAngle=0,this._panRad=0,this.minPanAngle=-(1/0),this.maxPanAngle=1/0,this._tiltAngle=0,this._tiltRad=0,this.minTileAngle=-90,this.maxTileAngle=90};Object.defineProperties(e.prototype,{panAngle:{get:function(){return this._panAngle},set:function(e){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,e)),this._panRad=this._panAngle*Math.PI/180}},tiltAngle:{get:function(){return this._tiltAngle},set:function(e){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,e)),this._tiltRad=this._tiltAngle*Math.PI/180}}}),e.prototype.update=function(){var e=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),t=this.distance*Math.sin(this._tiltRad),i=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),n=this.camera,r=this.lookAtPoint;n.position.set(e+r.x,t+r.y,i+r.z),n.setLookAt(r,this.up)},zen3d.HoverController=e}();