!function(e){var t=e.zen3d=e.zen3d||{},i=function(){},n=function(e,t){i.prototype=t.prototype,e.superClass=t.prototype,e.prototype=new i,e.prototype.constructor=e};t.inherit=n;var r=function(){if(!e.navigator)return!0;var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("mobile")||-1!=t.indexOf("android")};t.isMobile=r;var a=function(e,t){var i=["","WEBKIT_","MOZ_"],n=null;for(var r in i)if(n=e.getExtension(i[r]+t))break;return n};t.getExtension=a;var o=function(e){var t=e>>16&255,i=e>>8&255,n=255&e;return[t,i,n]};t.hex2RGB=o;var s=function(e,t,i){var n=new Uint8Array(e*t*4),r=[[255,255,255,255],[0,0,0,255]];i=i||5;for(var a=0,o=0;t>o;o++)for(var s=0;e>s;s++){if(0==s?a=1:s%i==0&&(a=(a+1)%2),o%i==0&&0==s){var h=r[0];r[0]=r[1],r[1]=h}n[o*(4*e)+4*s+0]=r[a][0],n[o*(4*e)+4*s+1]=r[a][1],n[o*(4*e)+4*s+2]=r[a][2],n[o*(4*e)+4*s+3]=r[a][3]}return n};t.createCheckerBoardPixels=s}(window),function(){var e={MESH:"mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group"};zen3d.OBJECT_TYPE=e;var t={AMBIENT:"ambient",DIRECT:"direct",POINT:"point"};zen3d.LIGHT_TYPE=t;var i={BASIC:"basic",LAMBERT:"lambert",PHONE:"phone",CUBE:"cube"};zen3d.MATERIAL_TYPE=i}(),function(){var e=function(t,i,n,r){this.x=t||0,this.y=i||0,this.z=n||0,this.order=r||e.DefaultOrder};e.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.DefaultOrder="XYZ",e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.order=e.order,this},e.prototype.set=function(e,t,i){return this.x=e||0,this.y=t||0,this.z=i||0,this.order=order||this.order,this},zen3d.Euler=e}(),function(){var e=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};e.prototype.identify=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},e.prototype.set=function(e,t,i,n,r,a,o,s,h,u,c,d,f,l,p,E){var v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=n,v[1]=r,v[5]=a,v[9]=o,v[13]=s,v[2]=h,v[6]=u,v[10]=c,v[14]=d,v[3]=f,v[7]=l,v[11]=p,v[15]=E,this},e.prototype.copy=function(e){return this.elements.set(e.elements),this},e.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},e.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},e.prototype.multiplyMatrices=function(e,t){var i=e.elements,n=t.elements,r=this.elements,a=i[0],o=i[4],s=i[8],h=i[12],u=i[1],c=i[5],d=i[9],f=i[13],l=i[2],p=i[6],E=i[10],v=i[14],m=i[3],_=i[7],T=i[11],y=i[15],b=n[0],M=n[4],g=n[8],x=n[12],L=n[1],z=n[5],A=n[9],R=n[13],P=n[2],U=n[6],S=n[10],N=n[14],I=n[3],C=n[7],F=n[11],w=n[15];return r[0]=a*b+o*L+s*P+h*I,r[4]=a*M+o*z+s*U+h*C,r[8]=a*g+o*A+s*S+h*F,r[12]=a*x+o*R+s*N+h*w,r[1]=u*b+c*L+d*P+f*I,r[5]=u*M+c*z+d*U+f*C,r[9]=u*g+c*A+d*S+f*F,r[13]=u*x+c*R+d*N+f*w,r[2]=l*b+p*L+E*P+v*I,r[6]=l*M+p*z+E*U+v*C,r[10]=l*g+p*A+E*S+v*F,r[14]=l*x+p*R+E*N+v*w,r[3]=m*b+_*L+T*P+y*I,r[7]=m*M+_*z+T*U+y*C,r[11]=m*g+_*A+T*S+y*F,r[15]=m*x+_*R+T*N+y*w,this},e.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.prototype.inverse=function(){return this.getInverse(this)},e.prototype.getInverse=function(e){var t=this.elements,i=e.elements,n=i[0],r=i[1],a=i[2],o=i[3],s=i[4],h=i[5],u=i[6],c=i[7],d=i[8],f=i[9],l=i[10],p=i[11],E=i[12],v=i[13],m=i[14],_=i[15],T=f*m*c-v*l*c+v*u*p-h*m*p-f*u*_+h*l*_,y=E*l*c-d*m*c-E*u*p+s*m*p+d*u*_-s*l*_,b=d*v*c-E*f*c+E*h*p-s*v*p-d*h*_+s*f*_,M=E*f*u-d*v*u-E*h*l+s*v*l+d*h*m-s*f*m,g=n*T+r*y+a*b+o*M;if(0===g)return console.warn("can't invert matrix, determinant is 0"),this.identity();var x=1/g;return t[0]=T*x,t[1]=(v*l*o-f*m*o-v*a*p+r*m*p+f*a*_-r*l*_)*x,t[2]=(h*m*o-v*u*o+v*a*c-r*m*c-h*a*_+r*u*_)*x,t[3]=(f*u*o-h*l*o-f*a*c+r*l*c+h*a*p-r*u*p)*x,t[4]=y*x,t[5]=(d*m*o-E*l*o+E*a*p-n*m*p-d*a*_+n*l*_)*x,t[6]=(E*u*o-s*m*o-E*a*c+n*m*c+s*a*_-n*u*_)*x,t[7]=(s*l*o-d*u*o+d*a*c-n*l*c-s*a*p+n*u*p)*x,t[8]=b*x,t[9]=(E*f*o-d*v*o-E*r*p+n*v*p+d*r*_-n*f*_)*x,t[10]=(s*v*o-E*h*o+E*r*c-n*v*c-s*r*_+n*h*_)*x,t[11]=(d*h*o-s*f*o-d*r*c+n*f*c+s*r*p-n*h*p)*x,t[12]=M*x,t[13]=(d*v*a-E*f*a+E*r*l-n*v*l-d*r*m+n*f*m)*x,t[14]=(E*h*a-s*v*a-E*r*u+n*v*u+s*r*m-n*h*m)*x,t[15]=(s*f*a-d*h*a+d*r*u-n*f*u-s*r*l+n*h*l)*x,this},e.prototype.transform=function(e,t,i){var n=i.toMatrix4(),r=n.elements,a=this.elements;return a[0]=r[0]*t.x,a[1]=r[1]*t.y,a[2]=r[2]*t.z,a[3]=0,a[4]=r[4]*t.x,a[5]=r[5]*t.y,a[6]=r[6]*t.z,a[7]=0,a[8]=r[8]*t.x,a[9]=r[9]*t.y,a[10]=r[10]*t.z,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this},zen3d.Matrix4=e}(),function(){var e=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};e.prototype.set=function(e,t,i,n){return this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1,this},e.prototype.setFromEuler=function(e){var t=Math.cos(e.x/2),i=Math.cos(e.y/2),n=Math.cos(e.z/2),r=Math.sin(e.x/2),a=Math.sin(e.y/2),o=Math.sin(e.z/2),s=e.order;return"XYZ"===s?(this.x=r*i*n+t*a*o,this.y=t*a*n-r*i*o,this.z=t*i*o+r*a*n,this.w=t*i*n-r*a*o):"YXZ"===s?(this.x=r*i*n+t*a*o,this.y=t*a*n-r*i*o,this.z=t*i*o-r*a*n,this.w=t*i*n+r*a*o):"ZXY"===s?(this.x=r*i*n-t*a*o,this.y=t*a*n+r*i*o,this.z=t*i*o+r*a*n,this.w=t*i*n-r*a*o):"ZYX"===s?(this.x=r*i*n-t*a*o,this.y=t*a*n+r*i*o,this.z=t*i*o-r*a*n,this.w=t*i*n+r*a*o):"YZX"===s?(this.x=r*i*n+t*a*o,this.y=t*a*n+r*i*o,this.z=t*i*o-r*a*n,this.w=t*i*n-r*a*o):"XZY"===s&&(this.x=r*i*n-t*a*o,this.y=t*a*n-r*i*o,this.z=t*i*o+r*a*n,this.w=t*i*n+r*a*o),this},e.prototype.toMatrix4=function(e){e||(e=new zen3d.Matrix4);var t=e.elements,i=2*this.x*this.y,n=2*this.x*this.z,r=2*this.x*this.w,a=2*this.y*this.z,o=2*this.y*this.w,s=2*this.z*this.w,h=this.x*this.x,u=this.y*this.y,c=this.z*this.z,d=this.w*this.w;return t[0]=h-u-c+d,t[4]=i-s,t[8]=n+o,t[12]=0,t[1]=i+s,t[5]=-h+u-c+d,t[9]=a-r,t[13]=0,t[2]=n-o,t[6]=a+r,t[10]=-h-u+c+d,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,e},zen3d.Quaternion=e}(),function(){var e=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};e.prototype.set=function(e,t,i){return this.x=e||0,this.y=t||0,this.z=i||0,this},e.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},e.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(e){e=e||1;var t=this.getLength();if(0!=t){var i=e/t;return this.x*=i,this.y*=i,void(this.z*=i)}},e.prototype.subtract=function(t,i){return i||(i=new e),i.set(this.x-t.x,this.y-t.y,this.z-t.z),i},e.prototype.crossProduct=function(t,i){return i||(i=new e),i.x=this.y*t.z-this.z*t.y,i.y=this.z*t.x-this.x*t.z,i.z=this.x*t.y-this.y*t.x,i},e.prototype.dotProduct=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.prototype.applyQuaternion=function(e){var t=this.x,i=this.y,n=this.z,r=e.x,a=e.y,o=e.z,s=e.w,h=s*t+a*n-o*i,u=s*i+o*t-r*n,c=s*n+r*i-a*t,d=-r*t-a*i-o*n;return this.x=h*s+d*-r+u*-o-c*-a,this.y=u*s+d*-a+c*-r-h*-o,this.z=c*s+d*-o+h*-a-u*-r,this},zen3d.Vector3=e}(),function(){var e=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};e.prototype.set=function(e,t,i,n){return this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1,this},e.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,n=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*r,this},zen3d.Vector4=e}(),function(){var e="mat4 transpose(mat4 inMatrix) { \nvec4 i0 = inMatrix[0]; \nvec4 i1 = inMatrix[1]; \nvec4 i2 = inMatrix[2]; \nvec4 i3 = inMatrix[3]; \nmat4 outMatrix = mat4( \nvec4(i0.x, i1.x, i2.x, i3.x), \nvec4(i0.y, i1.y, i2.y, i3.y), \nvec4(i0.z, i1.z, i2.z, i3.z), \nvec4(i0.w, i1.w, i2.w, i3.w) \n); \nreturn outMatrix; \n} \n",t="mat4 inverse(mat4 m) { \nfloat \na00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], \na10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], \na20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], \na30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], \nb00 = a00 * a11 - a01 * a10, \nb01 = a00 * a12 - a02 * a10, \nb02 = a00 * a13 - a03 * a10, \nb03 = a01 * a12 - a02 * a11, \nb04 = a01 * a13 - a03 * a11, \nb05 = a02 * a13 - a03 * a12, \nb06 = a20 * a31 - a21 * a30, \nb07 = a20 * a32 - a22 * a30, \nb08 = a20 * a33 - a23 * a30, \nb09 = a21 * a32 - a22 * a31, \nb10 = a21 * a33 - a23 * a31, \nb11 = a22 * a33 - a23 * a32, \ndet = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06; \nreturn mat4( \na11 * b11 - a12 * b10 + a13 * b09, \na02 * b10 - a01 * b11 - a03 * b09, \na31 * b05 - a32 * b04 + a33 * b03, \na22 * b04 - a21 * b05 - a23 * b03, \na12 * b08 - a10 * b11 - a13 * b07, \na00 * b11 - a02 * b08 + a03 * b07, \na32 * b02 - a30 * b05 - a33 * b01, \na20 * b05 - a22 * b02 + a23 * b01, \na10 * b10 - a11 * b08 + a13 * b06, \na01 * b08 - a00 * b10 - a03 * b06, \na30 * b04 - a31 * b02 + a33 * b00, \na21 * b02 - a20 * b04 - a23 * b00, \na11 * b07 - a10 * b09 - a12 * b06, \na00 * b09 - a01 * b07 + a02 * b06, \na31 * b01 - a30 * b03 - a32 * b00, \na20 * b03 - a21 * b01 + a22 * b00) / det; \n} \n",i=["mat3 tsn(vec3 N, vec3 p, vec2 uv) {","vec3 q0 = dFdx( p.xyz );","vec3 q1 = dFdy( p.xyz );","vec2 st0 = dFdx( uv.st );","vec2 st1 = dFdy( uv.st );","vec3 S = normalize( q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","mat3 tsn = mat3( S, T, N );","return tsn;","}"].join("\n"),n="mat3 tbn(vec3 N, vec3 p, vec2 uv) { \nvec3 dp1 = dFdx(p.xyz); \nvec3 dp2 = dFdy(p.xyz); \nvec2 duv1 = dFdx(uv.st); \nvec2 duv2 = dFdy(uv.st); \nvec3 dp2perp = cross(dp2, N); \nvec3 dp1perp = cross(N, dp1); \nvec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \nvec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \nfloat invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B))); \nreturn mat3(T * invmax, B * invmax, N); \n} \n",r=["attribute vec3 a_Position;","attribute vec3 a_Normal;",e,t,"uniform mat4 u_Projection;","uniform mat4 u_View;","uniform mat4 u_Model;","uniform vec3 u_CameraPosition;"].join("\n"),a=["uniform mat4 u_View;","uniform float u_Opacity;","uniform vec3 u_Color;","uniform vec3 u_CameraPosition;"].join("\n"),o=["vec4 outColor = vec4(u_Color, u_Opacity);"].join("\n"),s=["gl_FragColor = outColor;"].join("\n"),h=["gl_Position = u_Projection * u_View * u_Model * vec4(a_Position, 1.0);"].join("\n"),u=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","attribute vec2 a_Uv;","varying vec2 v_Uv;","#endif"].join("\n"),c=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","v_Uv = a_Uv;","#endif"].join("\n"),d=["#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP)","varying vec2 v_Uv;","#endif"].join("\n"),f=["#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif"].join("\n"),l=["#ifdef USE_NORMAL","v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(a_Normal, 1.0)).xyz;","#endif"].join("\n"),p=["#ifdef USE_NORMAL","varying vec3 v_Normal;","#endif"].join("\n"),E=["#ifdef USE_NORMAL","vec3 N;","#ifdef USE_NORMAL_MAP","vec3 normalMapColor = texture2D(normalMap, v_Uv).rgb;","mat3 tspace = tsn(normalize(v_Normal), v_ViewModelPos, v_Uv);","N = normalize(tspace * (normalMapColor * 2.0 - 1.0));","#else","N = normalize(v_Normal);","#endif","#endif"].join("\n"),v=["#ifdef USE_DIFFUSE_MAP","uniform sampler2D texture;","#endif"].join("\n"),m=["#ifdef USE_DIFFUSE_MAP","outColor *= texture2D(texture, v_Uv);","#endif"].join("\n"),_=[i,n,"uniform sampler2D normalMap;"].join("\n"),T=["#ifdef USE_ENV_MAP","varying vec3 v_EnvPos;","#endif"].join("\n"),y=["#ifdef USE_ENV_MAP","v_EnvPos = reflect(normalize((u_Model * vec4(a_Position, 1.0)).xyz - u_CameraPosition), (transpose(inverse(u_Model)) * vec4(a_Normal, 1.0)).xyz);","#endif"].join("\n"),b=["#ifdef USE_ENV_MAP","varying vec3 v_EnvPos;","uniform samplerCube envMap;","uniform float u_EnvMap_Intensity;","#endif"].join("\n"),M=["#ifdef USE_ENV_MAP","vec4 envColor = textureCube(envMap, v_EnvPos);","outColor += envColor * u_EnvMap_Intensity;","#endif"].join("\n"),g=["struct AmbientLight","{","vec4 color;","float intensity;","};","uniform AmbientLight u_Ambient[USE_AMBIENT_LIGHT];"].join("\n"),x=["struct DirectLight","{","vec3 direction;","vec4 color;","float intensity;","};","uniform DirectLight u_Directional[USE_DIRECT_LIGHT];"].join("\n"),L=["struct PointLight","{","vec3 position;","vec4 color;","float intensity;","};","uniform PointLight u_Point[USE_POINT_LIGHT];"].join("\n"),z=["#ifdef USE_AMBIENT_LIGHT",g,"#endif","#ifdef USE_DIRECT_LIGHT",x,"#endif","#ifdef USE_POINT_LIGHT",L,"#endif"].join("\n"),A=["#ifdef USE_LIGHT","vec4 light;","vec3 L;","vec4 reflectLight = vec4(0., 0., 0., 0.);","vec4 diffuseColor = outColor.xyzw;","#ifdef USE_AMBIENT_LIGHT","for(int i = 0; i < USE_AMBIENT_LIGHT; i++) {","reflectLight += diffuseColor * u_Ambient[i].color * u_Ambient[i].intensity;","}","#endif","#if defined(USE_PHONE) && ( defined(USE_DIRECT_LIGHT) || defined(USE_POINT_LIGHT) )","vec3 V = normalize( (u_View * vec4(u_CameraPosition, 1.)).xyz - v_ViewModelPos);","#endif","#ifdef USE_DIRECT_LIGHT","for(int i = 0; i < USE_DIRECT_LIGHT; i++) {","L = -u_Directional[i].direction;","light = u_Directional[i].color * u_Directional[i].intensity;","L = normalize(L);","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONE","RE_BlinnPhone(diffuseColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","#endif","#ifdef USE_POINT_LIGHT","for(int i = 0; i < USE_POINT_LIGHT; i++) {","L = u_Point[i].position - v_ViewModelPos;","float dist = max(1. - length(L) * .005, 0.0);","light = u_Point[i].color * u_Point[i].intensity * dist;","L = normalize(L);","RE_Lambert(diffuseColor, light, N, L, reflectLight);","#ifdef USE_PHONE","RE_BlinnPhone(diffuseColor, light, N, normalize(L), V, u_Specular, reflectLight);","#endif","}","#endif","outColor = reflectLight.xyzw;","#endif"].join("\n"),R=["void RE_Lambert(vec4 k, vec4 light, vec3 N, vec3 L, inout vec4 reflectLight) {","float dotNL = max(dot(N, L), 0.);","reflectLight += k * light * dotNL;","}"].join("\n"),P=["void RE_Phone(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 R = max(dot(2.0 * N, L), 0.) * N - L;","reflectLight += k * light * pow(max(dot(V, R), 0.), n_s);","}"].join("\n"),U=["void RE_BlinnPhone(vec4 k, vec4 light, vec3 N, vec3 L, vec3 V, float n_s, inout vec4 reflectLight) {","vec3 H = normalize(L + V);","reflectLight += k * light * pow(max(dot(N, H), 0.), n_s);","}"].join("\n"),S=["#if defined(USE_POINT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONE) && defined(USE_DIRECT_LIGHT) )","varying vec3 v_ViewModelPos;","#endif"].join("\n"),N=["#if defined(USE_POINT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONE) && defined(USE_DIRECT_LIGHT) )","v_ViewModelPos = (u_View * u_Model * vec4(a_Position, 1.0)).xyz;","#endif"].join("\n"),I=["#if defined(USE_POINT_LIGHT) || defined(USE_NORMAL_MAP) || ( defined(USE_PHONE) && defined(USE_DIRECT_LIGHT) )","varying vec3 v_ViewModelPos;","#endif"].join("\n"),C={basicVertex:[r,u,T,"void main() {",h,c,y,"}"].join("\n"),basicFragment:[a,d,v,b,"void main() {",o,m,M,s,"}"].join("\n"),lambertVertex:[r,f,u,S,T,"void main() {",h,l,c,N,y,"}"].join("\n"),lambertFragment:[a,d,v,_,z,p,I,R,b,"void main() {",o,m,E,A,M,s,"}"].join("\n"),phoneVertex:[r,f,u,S,T,"void main() {",h,l,c,N,y,"}"].join("\n"),phoneFragment:[a,"uniform float u_Specular;",d,v,_,z,p,I,R,P,U,b,"void main() {",o,m,E,A,M,s,"}"].join("\n"),cubeVertex:[r,"varying vec3 v_ModelPos;","void main() {",h,"v_ModelPos = (u_Model * vec4(a_Position, 1.0)).xyz;","}"].join("\n"),cubeFragment:[a,"uniform samplerCube cubeMap;","varying vec3 v_ModelPos;","void main() {",o,"outColor *= textureCube(cubeMap, v_ModelPos);",s,"}"].join("\n")};zen3d.ShaderLib=C}(),function(){function e(e,t,i){var n=e.createShader(t);e.shaderSource(n,i),e.compileShader(n);var r=e.getShaderParameter(n,e.COMPILE_STATUS);return r||(console.log("shader not compiled!"),console.log(e.getShaderInfoLog(n))),n}function t(e,t,i){var n=e.createProgram();return e.attachShader(n,t),e.attachShader(n,i),e.linkProgram(n),n}function i(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;n>r;r++){var a=e.getActiveUniform(t,r),o=a.name,s=a.type;i[o]={type:s,size:a.size,location:e.getUniformLocation(t,o)}}return i}function n(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;n>r;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=a.type;i[o]={type:s,size:1,location:e.getAttribLocation(t,o)}}return i}function r(e,t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}function a(e){var t="";for(var i in e)t+=e[i]+"_";return t}function o(e,t){var i=t.materialType==u.BASIC,n=t.materialType==u.CUBE,r=zen3d.ShaderLib.vertexBase,a=zen3d.ShaderLib.fragmentBase;switch(t.materialType){case u.BASIC:r=zen3d.ShaderLib.basicVertex,a=zen3d.ShaderLib.basicFragment;break;case u.LAMBERT:r=zen3d.ShaderLib.lambertVertex,a=zen3d.ShaderLib.lambertFragment;break;case u.PHONE:r=zen3d.ShaderLib.phoneVertex,a=zen3d.ShaderLib.phoneFragment;break;case u.CUBE:r=zen3d.ShaderLib.cubeVertex,a=zen3d.ShaderLib.cubeFragment}var o,s;i?(o=[t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":""].join("\n"),s=[t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":""].join("\n")):n?(o=[""].join("\n"),s=[""].join("\n")):(o=[t.pointLightNum>0?"#define USE_POINT_LIGHT "+t.pointLightNum:"",t.directLightNum>0?"#define USE_DIRECT_LIGHT "+t.directLightNum:"",t.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+t.ambientLightNum:"",t.pointLightNum>0||t.directLightNum>0||t.ambientLightNum>0?"#define USE_LIGHT":"",t.pointLightNum>0||t.directLightNum>0?"#define USE_NORMAL":"",(t.pointLightNum>0||t.directLightNum>0)&&t.useNormalMap?"#define USE_NORMAL_MAP":"",t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":"",t.materialType==u.LAMBERT?"#define USE_LAMBERT":"",t.materialType==u.PHONE?"#define USE_PHONE":""].join("\n"),s=[t.pointLightNum>0?"#define USE_POINT_LIGHT "+t.pointLightNum:"",t.directLightNum>0?"#define USE_DIRECT_LIGHT "+t.directLightNum:"",t.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+t.ambientLightNum:"",t.pointLightNum>0||t.directLightNum>0||t.ambientLightNum>0?"#define USE_LIGHT":"",t.pointLightNum>0||t.directLightNum>0?"#define USE_NORMAL":"",(t.pointLightNum>0||t.directLightNum>0)&&t.useNormalMap?"#define USE_NORMAL_MAP":"",t.useDiffuseMap?"#define USE_DIFFUSE_MAP":"",t.useEnvMap?"#define USE_ENV_MAP":"",t.materialType==u.LAMBERT?"#define USE_LAMBERT":"",t.materialType==u.PHONE?"#define USE_PHONE":""].join("\n"));var c=["precision "+t.precision+" float;","precision "+t.precision+" int;",o,r].join("\n"),d=["#extension GL_OES_standard_derivatives : enable","precision "+t.precision+" float;","precision "+t.precision+" int;",s,a].join("\n");return new h(e,c,d)}var s={},h=function(r,a,o){this.vshaderSource=a,this.fshaderSource=o,this.vertexShader=e(r,r.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=e(r,r.FRAGMENT_SHADER,this.fshaderSource),this.id=t(r,this.vertexShader,this.fragmentShader),this.uniforms=i(r,this.id),this.attributes=n(r,this.id)},u=zen3d.MATERIAL_TYPE,c=function(e,t,i){var n,h=i[0],u=i[1],c=i[2],d={precision:r(e,"highp"),useDiffuseMap:!!t.map,useNormalMap:!!t.normalMap,useEnvMap:!!t.envMap,useDiffuseColor:!t.map,ambientLightNum:h,directLightNum:u,pointLightNum:c,materialType:t.type},f=a(d),l=s;return l[f]?n=l[f]:(n=o(e,d),l[f]=n),n};zen3d.getProgram=c}(),function(){var e=zen3d.MATERIAL_TYPE,t=function(e){this.view=e;var t=this.gl=e.getContext("webgl",{antialias:!0,stencil:!0});this.width=e.clientWidth,this.height=e.clientHeight,this.vertices=new Float32Array(4e4),this.vertexBuffer=t.createBuffer(),this.indices=new Uint16Array(12e3),this.indexBuffer=t.createBuffer(),t.enable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CW),this.cache=new zen3d.RenderCache,this.camera=null;zen3d.getExtension(t,"OES_standard_derivatives"),zen3d.getExtension(t,"GL_OES_standard_derivatives")};t.prototype.render=function(e,t){this.camera=t,e.updateMatrix(),this.cache.cache(e),this.cache.sort(),this.flush(),this.cache.clear()},t.prototype.flush=function(){this.flushList(this.cache.opaqueObjects),this.flushList(this.cache.transparentObjects)},t.prototype.flushList=function(t){for(var i=this.camera,n=this.vertices,r=this.indices,a=this.cache.ambientLights,o=this.cache.directLights,s=this.cache.pointLights,h=a.length,u=o.length,c=s.length,d=0,f=t.length;f>d;d++){for(var l=t[d],p=l.geometry,E=l.material,v=(this.lights,0),m=0,_=0,T=p.verticesArray,y=T.length;y>_;_++)n[v++]=T[_];for(var b=0,M=p.indicesArray,g=M.length;g>b;b++)r[m++]=M[b];var x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,this.vertexBuffer),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var L=n.subarray(0,v);x.bufferData(x.ARRAY_BUFFER,L,x.STREAM_DRAW);var z=r.subarray(0,m);x.bufferData(x.ELEMENT_ARRAY_BUFFER,z,x.STATIC_DRAW);var A=zen3d.getProgram(x,E,[h,u,c]);x.useProgram(A.id);var R=A.attributes;for(var P in R){var U=R[P].location;switch(P){case"a_Position":x.vertexAttribPointer(U,3,x.FLOAT,!1,68,0);break;case"a_Normal":x.vertexAttribPointer(U,3,x.FLOAT,!1,68,12);break;case"a_Uv":x.vertexAttribPointer(U,2,x.FLOAT,!1,68,52);break;default:console.warn("attribute "+P+" not found!")}x.enableVertexAttribArray(U)}var S=A.uniforms;for(var P in S){var U=S[P].location;switch(P){case"u_Projection":var N=i.projectionMatrix.elements;x.uniformMatrix4fv(U,!1,N);break;case"u_View":var I=i.viewMatrix.elements;x.uniformMatrix4fv(U,!1,I);break;case"u_Model":var C=l.worldMatrix.elements;x.uniformMatrix4fv(U,!1,C);break;case"u_Color":var F=zen3d.hex2RGB(E.color);x.uniform3f(U,F[0]/255,F[1]/255,F[2]/255);break;case"u_Opacity":x.uniform1f(U,E.opacity);break;case"texture":x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,E.map.glTexture),x.uniform1i(U,0);break;case"normalMap":x.activeTexture(x.TEXTURE1),x.bindTexture(x.TEXTURE_2D,E.normalMap.glTexture),x.uniform1i(U,1);break;case"envMap":x.activeTexture(x.TEXTURE2),x.bindTexture(x.TEXTURE_CUBE_MAP,E.envMap.glTexture),x.uniform1i(U,2);break;case"cubeMap":x.activeTexture(x.TEXTURE0),x.bindTexture(x.TEXTURE_CUBE_MAP,E.cubeMap.glTexture),x.uniform1i(U,0);break;case"u_EnvMap_Intensity":x.uniform1f(U,E.envMapIntensity);break;case"u_Specular":var w=E.specular;x.uniform1f(U,w);break;case"u_CameraPosition":var B=i.position;x.uniform3f(U,B.x,B.y,B.z)}}var O=E.type==e.BASIC,D=E.type==e.CUBE,H=new zen3d.Matrix4,G=new zen3d.Vector4;if(!O&&!D){for(var b=0;h>b;b++){var j=a[b],V=j.intensity,F=zen3d.hex2RGB(j.color),X=S["u_Ambient["+b+"].intensity"].location,Y=S["u_Ambient["+b+"].color"].location;x.uniform4f(Y,F[0]/255,F[1]/255,F[2]/255,1),x.uniform1f(X,V)}for(var b=0;u>b;b++){var j=o[b],V=j.intensity,k=j.direction,q=H.copy(i.viewMatrix).inverse().transpose();G.set(k.x,k.y,k.z,1).applyMatrix4(q);var F=zen3d.hex2RGB(j.color),Z=S["u_Directional["+b+"].direction"].location,W=S["u_Directional["+b+"].intensity"].location,J=S["u_Directional["+b+"].color"].location;x.uniform3f(Z,G.x,G.y,G.z),x.uniform1f(W,V),x.uniform4f(J,F[0]/255,F[1]/255,F[2]/255,1)}for(var b=0;c>b;b++){var j=s[b],B=j.position,I=i.viewMatrix;G.set(B.x,B.y,B.z,1).applyMatrix4(I);var V=j.intensity,F=zen3d.hex2RGB(j.color),Q=S["u_Point["+b+"].position"].location;x.uniform3f(Q,G.x,G.y,G.z);var K=S["u_Point["+b+"].intensity"].location;x.uniform1f(K,V);var $=S["u_Point["+b+"].color"].location;x.uniform4f($,F[0]/255,F[1]/255,F[2]/255,1)}}E.transparent?(x.enable(x.BLEND),x.blendFunc(x.ONE,x.ONE_MINUS_SRC_ALPHA)):x.disable(x.BLEND),x.drawElements(x.TRIANGLES,m,x.UNSIGNED_SHORT,0)}},zen3d.Renderer=t}(),function(){var e=zen3d.OBJECT_TYPE,t=zen3d.LIGHT_TYPE,i=function(){this.opaqueObjects=new Array,this.transparentObjects=new Array,this.ambientLights=new Array,this.directLights=new Array,this.pointLights=new Array};i.prototype.cache=function(i){switch(i.type){case e.MESH:var n=i.material;n.checkMapInit()&&(n.transparent?this.transparentObjects.push(i):this.opaqueObjects.push(i));break;case e.LIGHT:i.lightType==t.AMBIENT?this.ambientLights.push(i):i.lightType==t.DIRECT?this.directLights.push(i):i.lightType==t.POINT&&this.pointLights.push(i);break;case e.CAMERA:break;case e.SCENE:break;case e.GROUP:break;default:console.log("undefined object type")}for(var r=i.children,a=0,o=r.length;o>a;a++)this.cache(r[a])},i.prototype.sort=function(){this.opaqueObjects.sort(function(e,t){var i=e.position.z,n=t.position.z;return i-n}),this.transparentObjects.sort(function(e,t){var i=e.position.z,n=t.position.z;return n-i})},i.prototype.clear=function(){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.ambientLights.length=0,this.directLights.length=0,this.pointLights.length=0},zen3d.RenderCache=i}(),function(){var e=function(e,t,i){this.gl=e,this.width=t,this.height=i,this.frameBuffer=e.createFramebuffer(),this.renderBuffer=null};e.prototype.bind=function(){var e=this.gl;return e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),this},e.prototype.unbind=function(){var e=this.gl;return e.bindFramebuffer(e.FRAMEBUFFER,null),this},e.prototype.attachRenderBuffer=function(e){var t=this.gl,i=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,i),"depth"==e?(t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height)):"stencil"==e?(t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,this.width,this.height)):(t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height)),this.renderBuffer=i,this},e.prototype.bindTexture2D=function(e){var t=this.gl;return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.glTexture,0),this},e.prototype.bindTextureCube=function(e,t){var i=this.gl;return i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,e.faces[t],e.glTexture,0),this},e.prototype.resize=function(e,t){},e.prototype.destroy=function(){var e=this.gl;e.deleteFramebuffer(this.frameBuffer),this.renderBuffer&&e.deleteRenderbuffer(this.renderBuffer)},zen3d.RenderTarget=e}(),function(){var e=function(e,t){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1),this.euler=new zen3d.Euler,this.quaternion=new zen3d.Quaternion,this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null};Object.defineProperties(e.prototype,{rotation:{get:function(){return this.euler},set:function(e){var t=this.euler;t.copyFrom(e),this.quaternion.setFromEuler(e)}}}),e.prototype.add=function(e){this.children.push(e),e.parent=this},e.prototype.remove=function(e){var t=this.children.indexOf(e);-1!==t&&this.children.splice(t,1),e.parent=null},e.prototype.updateMatrix=function(){var e=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(e),this.parent){var t=this.parent.worldMatrix;this.worldMatrix.premultiply(t)}for(var i=this.children,n=0,r=i.length;r>n;n++)i[n].updateMatrix()},zen3d.Object3D=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE};zen3d.inherit(e,zen3d.Object3D),zen3d.Scene=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(e,zen3d.Object3D),zen3d.Group=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=16777215,this.intensity=1};zen3d.inherit(e,zen3d.Object3D),zen3d.Light=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(e,zen3d.Light),zen3d.AmbientLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.direction=new zen3d.Vector3};zen3d.inherit(e,zen3d.Light),zen3d.DirectionalLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2};zen3d.inherit(e,zen3d.Light),zen3d.PointLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(e,zen3d.Object3D),e.prototype.setLookAt=function(e,t){var i=this.position,n=new zen3d.Vector3;i.subtract(e,n),n.normalize();var r=new zen3d.Vector3;t.crossProduct(n,r),r.normalize();var a=new zen3d.Vector3;n.crossProduct(r,a),this.viewMatrix.set(r.x,r.y,r.z,-r.dotProduct(i),a.x,a.y,a.z,-a.dotProduct(i),n.x,n.y,n.z,-n.dotProduct(i),0,0,0,1)},e.prototype.setOrtho=function(e,t,i,n,r,a){this.projectionMatrix.set(2/(t-e),0,0,-(t+e)/(t-e),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1)},e.prototype.setPerspective=function(e,t,i,n){this.projectionMatrix.set(1/(t*Math.tan(e/2)),0,0,0,0,1/Math.tan(e/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},zen3d.Camera=e}(),function(){var e=function(){this.verticesArray=new Array,this.indicesArray=new Array,this.verticesCount=0};zen3d.Geometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i,n,void 0==r?!0:r)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){this.verticesArray.push(.5*-e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*t,.5*-i,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*t,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*-t,.5*i,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*-t,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*t,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*-t,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*-t,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*t,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),n?this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34):this.indicesArray.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35),this.verticesCount=36},zen3d.CubeGeometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i,n||1,r||1)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){for(var r=i+1,a=n+1,o=this.verticesArray,s=this.indicesArray,h=0,u=0,c=0;a>c;c++)for(var d=0;r>d;d++){var f=(d/i-.5)*e,l=(c/n-.5)*t;if(o[h++]=f,o[h++]=0,o[h++]=l,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=1,o[h++]=0,o[h++]=0,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=1,o[h++]=d/i*1,o[h++]=1*(1-c/n),
o[h++]=d/i*1,o[h++]=1*(1-c/n),d!=i&&c!=n){base=d+c*r;var p=1;s[u++]=base*p,s[u++]=(base+r+1)*p,s[u++]=(base+r)*p,s[u++]=base*p,s[u++]=(base+1)*p,s[u++]=(base+r+1)*p}}this.verticesCount=r*a},zen3d.PlaneGeometry=e}(),function(){var e=function(t,i,n){e.superClass.constructor.call(this),this.buildGeometry(t,i||20,n||20)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i){var n=!0,r=0,a=0,o=0,s=17,h=s-9,u=this.verticesArray,c=this.indicesArray,d=0,f=0,l=0,p=0,E=0,v=0;for(a=0;i>=a;++a){d=f;var m=Math.PI*a/i,_=-e*Math.cos(m),T=e*Math.sin(m);for(r=0;t>=r;++r){var y=2*Math.PI*r/t,b=T*Math.cos(y),M=T*Math.sin(y),g=1/Math.sqrt(b*b+M*M+_*_),x=Math.sqrt(M*M+b*b);if(E=0,v=x>.007?b/x:0,l=-_,p=M,r==t?(u[f++]=u[d],u[f++]=u[d+1],u[f++]=u[d+2],u[f++]=b*g,u[f++]=l*g,u[f++]=p*g,u[f++]=x>.007?-M/x:1,u[f++]=E,u[f++]=v,u[f+0]=1,u[f+1]=1,u[f+2]=1,u[f+3]=1):(u[f++]=b,u[f++]=l,u[f++]=p,u[f++]=b*g,u[f++]=l*g,u[f++]=p*g,u[f++]=x>.007?-M/x:1,u[f++]=E,u[f++]=v,u[f]=1,u[f+1]=1,u[f+2]=1,u[f+3]=1),r>0&&a>0){var L=(t+1)*a+r,z=(t+1)*a+r-1,A=(t+1)*(a-1)+r-1,R=(t+1)*(a-1)+r;a==i?(u[f-9]=u[d],u[f-8]=u[d+1],u[f-7]=u[d+2],n?(c[o++]=L,c[o++]=R,c[o++]=A):(c[o++]=L,c[o++]=A,c[o++]=R)):1==a?n?(c[o++]=L,c[o++]=A,c[o++]=z):(c[o++]=L,c[o++]=z,c[o++]=A):n?(c[o++]=L,c[o++]=R,c[o++]=A,c[o++]=L,c[o++]=A,c[o++]=z):(c[o++]=L,c[o++]=A,c[o++]=R,c[o++]=L,c[o++]=z,c[o++]=A)}f+=h}}var s=17,h=s-2,f=13;for(a=0;i>=a;++a)for(r=0;t>=r;++r)u[f++]=r/t,u[f++]=a/i,f+=h;this.verticesCount=(i+1)*(t+1)},zen3d.SphereGeometry=e}(),function(){var e=function(e,t){this.gl=e,this.width=0,this.height=0,this.border=0,this.dataFormat=e.RGBA,this.dataType=e.UNSIGNED_BYTE,this.magFilter=e.LINEAR,this.minFilter=e.LINEAR,this.wrapS=e.CLAMP_TO_EDGE,this.wrapT=e.CLAMP_TO_EDGE,this.glTexture=e.createTexture(),this.isRenderable=!1};e.prototype.bind=function(){},e.prototype.texParam=function(){},e.prototype.texImage=function(){},e.prototype.destory=function(){var e=this.gl;e.deleteTexture(this.glTexture)},zen3d.TextureBase=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i)};zen3d.inherit(e,zen3d.TextureBase),e.prototype.bind=function(){var e=this.gl;return e.bindTexture(e.TEXTURE_2D,this.glTexture),this},e.prototype.texParam=function(){var e=this.gl;return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.magFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.wrapT),this},e.prototype.texImage=function(e,t,i){var n=this.gl;return void 0!==t&&void 0!==i?(n.texImage2D(n.TEXTURE_2D,0,this.dataFormat,t,i,this.border,this.dataFormat,this.dataType,e),this.width=t,this.height=i):(n.texImage2D(n.TEXTURE_2D,0,this.dataFormat,this.dataFormat,this.dataType,e),this.width=e.width,this.height=e.height),this.isRenderable=!0,this},e.fromRes=function(t,i,n,r){var a=new e(t);return a.bind().texParam().texImage(i,n,r),a},e.fromSrc=function(t,i){var n=new e(t),r=new Image;return r.src=i,r.onload=function(){n.bind().texParam().texImage(r)},n},e.createRenderTexture=function(t,i,n){var r=new e(t);return r.bind().texParam().texImage(null,i,n),r},zen3d.Texture2D=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i);var t=this.gl;this.faces=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z]};zen3d.inherit(e,zen3d.TextureBase),e.prototype.bind=function(){var e=this.gl;return e.bindTexture(e.TEXTURE_CUBE_MAP,this.glTexture),this},e.prototype.texParam=function(){var e=this.gl;return e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this.magFilter),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this.minFilter),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this.wrapT),this},e.prototype.texImage=function(e,t,i){for(var n=this.gl,r=this.faces,a=0;6>a;a++)void 0!==t&&void 0!==i?n.texImage2D(r[a],0,this.dataFormat,t,i,this.border,this.dataFormat,this.dataType,e[a]):n.texImage2D(r[a],0,this.dataFormat,this.dataFormat,this.dataType,e[a]);return void 0!==t&&void 0!==i?(this.width=t,this.height=i):(this.width=e[0].width,this.height=e[0].height),this.isRenderable=!0,this},e.fromRes=function(t,i,n,r){var a=new e(t);return a.bind().texParam().texImage(i,n,r),a},e.fromSrc=function(t,i){function n(){if(o>=6)return void r();var e=new Image;e.src=i[o],e.onload=n,s.push(e),o++}function r(){a.bind().texParam().texImage(s)}var a=new e(t),o=0,s=[];return n(),a},e.createRenderTexture=function(t,i,n){var r=new e(t);return r.bind().texParam().texImage([null,null,null,null,null,null],i,n),r},zen3d.TextureCube=e}(),function(){var e=function(){this.type="",this.color=16777215,this.map=null,this.opacity=1,this.transparent=!1,this.normalMap=null,this.envMap=null,this.envMapIntensity=1};e.prototype.checkMapInit=function(){return(!this.map||this.map.isRenderable)&&(!this.normalMap||this.normalMap.isRenderable)&&(!this.envMap||this.envMap.isRenderable)},zen3d.Material=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.BASIC};zen3d.inherit(e,zen3d.Material),zen3d.BasicMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LAMBERT};zen3d.inherit(e,zen3d.Material),zen3d.LambertMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PHONE,this.specular=10};zen3d.inherit(e,zen3d.Material),zen3d.PhoneMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CUBE,this.cubeMap=null};zen3d.inherit(e,zen3d.Material),zen3d.CubeMaterial=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.geometry=t,this.material=i,this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(e,zen3d.Object3D),zen3d.Mesh=e}();