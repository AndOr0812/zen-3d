!function(e){var t=e.zen3d=e.zen3d||{},i=function(){},n=function(e,t){i.prototype=t.prototype,e.superClass=t.prototype,e.prototype=new i,e.prototype.constructor=e};t.inherit=n;t.generateUUID=function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?i[r]="-":14===r?i[r]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,i[r]=t[19===r?3&e|8:e]);return i.join("")}}();t.isMobile=function(){if(!e.navigator)return!0;var t=navigator.userAgent.toLowerCase();return t.indexOf("mobile")!=-1||t.indexOf("android")!=-1}();t.isWeb=function(){return!!document}();var r=function(e,t,i){var n=new Uint8Array(e*t*4),r=[[255,255,255,255],[0,0,0,255]];i=i||5;for(var a=0,s=0;s<t;s++)for(var o=0;o<e;o++){if(0==o?a=1:o%i==0&&(a=(a+1)%2),s%i==0&&0==o){var u=r[0];r[0]=r[1],r[1]=u}n[s*(4*e)+4*o+0]=r[a][0],n[s*(4*e)+4*o+1]=r[a][1],n[s*(4*e)+4*o+2]=r[a][2],n[s*(4*e)+4*o+3]=r[a][3]}return n};t.createCheckerBoardPixels=r;var a=function(e){return 0==(e&e-1)&&0!==e};t.isPowerOfTwo=a;var s=function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))};t.nearestPowerOfTwo=s;var o=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e};t.nextPowerOfTwo=o}(window),function(){var e={MESH:"mesh",SKINNED_MESH:"skinned_mesh",LIGHT:"light",CAMERA:"camera",SCENE:"scene",GROUP:"group",POINT:"point",LINE:"line",LINE_LOOP:"line_loop",LINE_SEGMENTS:"line_segments",CANVAS2D:"canvas2d",SPRITE:"sprite",PARTICLE:"particle"};zen3d.OBJECT_TYPE=e;var t={AMBIENT:"ambient",DIRECT:"direct",POINT:"point",SPOT:"spot"};zen3d.LIGHT_TYPE=t;var i={BASIC:"basic",LAMBERT:"lambert",PHONG:"phong",CUBE:"cube",POINT:"point",LINE_BASIC:"linebasic",LINE_DASHED:"linedashed",CANVAS2D:"canvas2d",SPRITE:"sprite",SHADER:"shader",DEPTH:"depth",PARTICLE:"particle"};zen3d.MATERIAL_TYPE=i;var n={NORMAL:"normal",EXP2:"exp2"};zen3d.FOG_TYPE=n;var r={NONE:"none",NORMAL:"normal",ADD:"add"};zen3d.BLEND_TYPE=r;var a={NONE:"none",FRONT:"front",BACK:"back",FRONT_AND_BACK:"front_and_back"};zen3d.CULL_FACE_TYPE=a;var s={FRONT:"front",BACK:"back",DOUBLE:"double"};zen3d.DRAW_SIDE=s;var o={SMOOTH_SHADING:"smooth_shading",FLAT_SHADING:"flat_shading"};zen3d.SHADING_TYPE=o;var u={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067};zen3d.WEBGL_TEXTURE_TYPE=u;var h={DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410};zen3d.WEBGL_PIXEL_FORMAT=h;var c={UNSIGNED_BYTE:5121,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FLOAT:5126};zen3d.WEBGL_PIXEL_TYPE=c;var l={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};zen3d.WEBGL_TEXTURE_FILTER=l;var d={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648};zen3d.WEBGL_TEXTURE_WRAP=d;var p={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,BYTE:65535,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126};zen3d.WEBGL_UNIFORM_TYPE=p;var f={FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FLOAT:5126,BYTE:65535,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};zen3d.WEBGL_ATTRIBUTE_TYPE=f;var _={STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048};zen3d.WEBGL_BUFFER_USAGE=_;var v={HARD:"hard",PCF_SOFT:"pcf_soft"};zen3d.SHADOW_TYPE=v;var m={LINEAR:"linear",SRGB:"sRGB",RGBE:"RGBE",RGBM7:"RGBM7",RGBM16:"RGBM16",RGBD:"RGBD",GAMMA:"Gamma"};zen3d.TEXEL_ENCODING_TYPE=m}(),function(){var e=function(t,i,n,r){this._x=t||0,this._y=i||0,this._z=n||0,this._order=r||e.DefaultOrder};e.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.DefaultOrder="XYZ",Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),e.prototype.copyFrom=function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},e.prototype.set=function(e,t,i,n){return this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||this._order,this.onChangeCallback(),this},e.prototype.setFromRotationMatrix=function(e,t,i){var n=function(e,t,i){return Math.max(t,Math.min(i,e))},r=e.elements,a=r[0],s=r[4],o=r[8],u=r[1],h=r[5],c=r[9],l=r[2],d=r[6],p=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,h),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(o,p),this._z=Math.atan2(u,h)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-l,p),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===t?(this._y=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===t?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,p))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("given unsupported order: "+t),this._order=t,i!==!1&&this.onChangeCallback(),this},e.prototype.setFromQuaternion=function(e,t,i){var n=zen3d.helpMatrix;return e.toMatrix4(n),this.setFromRotationMatrix(n,t,i)},e.prototype.onChange=function(e){return this.onChangeCallback=e,this},e.prototype.onChangeCallback=function(){},zen3d.Euler=e}(),function(){var e=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])};e.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},e.prototype.set=function(e,t,i,n,r,a,s,o,u){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=n,h[4]=r,h[7]=a,h[2]=s,h[5]=o,h[8]=u,this},e.prototype.copy=function(e){return this.elements.set(e.elements),this},e.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},e.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},e.prototype.multiplyMatrices=function(e,t){var i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[3],o=i[6],u=i[1],h=i[4],c=i[7],l=i[2],d=i[5],p=i[8],f=n[0],_=n[3],v=n[6],m=n[1],g=n[4],y=n[7],T=n[2],E=n[5],x=n[8];return r[0]=a*f+s*m+o*T,r[3]=a*_+s*g+o*E,r[6]=a*v+s*y+o*x,r[1]=u*f+h*m+c*T,r[4]=u*_+h*g+c*E,r[7]=u*v+h*y+c*x,r[2]=l*f+d*m+p*T,r[5]=l*_+d*g+p*E,r[8]=l*v+d*y+p*x,this},e.prototype.transform=function(e,t,i,n,r,a,s){var o=this.elements,u=1,h=0;if(r%360){var c=r;u=Math.cos(c),h=Math.sin(c)}return o[0]=u*i,o[3]=-h*n,o[6]=e,o[1]=h*i,o[4]=u*n,o[7]=t,o[2]=0,o[5]=0,o[8]=1,(a||s)&&(o[6]-=a*o[0]+s*o[3],o[7]-=a*o[1]+s*o[4]),this},zen3d.Matrix3=e}(),function(){var e=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};e.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},e.prototype.set=function(e,t,i,n,r,a,s,o,u,h,c,l,d,p,f,_){var v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=n,v[1]=r,v[5]=a,v[9]=s,v[13]=o,v[2]=u,v[6]=h,v[10]=c,v[14]=l,v[3]=d,v[7]=p,v[11]=f,v[15]=_,this},e.prototype.copy=function(e){return this.elements.set(e.elements),this},e.prototype.makeTranslation=function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},e.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},e.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},e.prototype.multiplyMatrices=function(e,t){var i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[4],o=i[8],u=i[12],h=i[1],c=i[5],l=i[9],d=i[13],p=i[2],f=i[6],_=i[10],v=i[14],m=i[3],g=i[7],y=i[11],T=i[15],E=n[0],x=n[4],M=n[8],z=n[12],w=n[1],b=n[5],S=n[9],A=n[13],L=n[2],P=n[6],C=n[10],R=n[14],N=n[3],F=n[7],D=n[11],I=n[15];return r[0]=a*E+s*w+o*L+u*N,r[4]=a*x+s*b+o*P+u*F,r[8]=a*M+s*S+o*C+u*D,r[12]=a*z+s*A+o*R+u*I,r[1]=h*E+c*w+l*L+d*N,r[5]=h*x+c*b+l*P+d*F,r[9]=h*M+c*S+l*C+d*D,r[13]=h*z+c*A+l*R+d*I,r[2]=p*E+f*w+_*L+v*N,r[6]=p*x+f*b+_*P+v*F,r[10]=p*M+f*S+_*C+v*D,r[14]=p*z+f*A+_*R+v*I,r[3]=m*E+g*w+y*L+T*N,r[7]=m*x+g*b+y*P+T*F,r[11]=m*M+g*S+y*C+T*D,r[15]=m*z+g*A+y*R+T*I,this},e.prototype.transpose=function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},e.prototype.inverse=function(){return this.getInverse(this)},e.prototype.getInverse=function(e){var t=this.elements,i=e.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],u=i[5],h=i[6],c=i[7],l=i[8],d=i[9],p=i[10],f=i[11],_=i[12],v=i[13],m=i[14],g=i[15],y=d*m*c-v*p*c+v*h*f-u*m*f-d*h*g+u*p*g,T=_*p*c-l*m*c-_*h*f+o*m*f+l*h*g-o*p*g,E=l*v*c-_*d*c+_*u*f-o*v*f-l*u*g+o*d*g,x=_*d*h-l*v*h-_*u*p+o*v*p+l*u*m-o*d*m,M=n*y+r*T+a*E+s*x;if(0===M)return console.warn("can't invert matrix, determinant is 0"),this.identity();var z=1/M;return t[0]=y*z,t[1]=(v*p*s-d*m*s-v*a*f+r*m*f+d*a*g-r*p*g)*z,t[2]=(u*m*s-v*h*s+v*a*c-r*m*c-u*a*g+r*h*g)*z,t[3]=(d*h*s-u*p*s-d*a*c+r*p*c+u*a*f-r*h*f)*z,t[4]=T*z,t[5]=(l*m*s-_*p*s+_*a*f-n*m*f-l*a*g+n*p*g)*z,t[6]=(_*h*s-o*m*s-_*a*c+n*m*c+o*a*g-n*h*g)*z,t[7]=(o*p*s-l*h*s+l*a*c-n*p*c-o*a*f+n*h*f)*z,t[8]=E*z,t[9]=(_*d*s-l*v*s-_*r*f+n*v*f+l*r*g-n*d*g)*z,t[10]=(o*v*s-_*u*s+_*r*c-n*v*c-o*r*g+n*u*g)*z,t[11]=(l*u*s-o*d*s-l*r*c+n*d*c+o*r*f-n*u*f)*z,t[12]=x*z,t[13]=(l*v*a-_*d*a+_*r*p-n*v*p-l*r*m+n*d*m)*z,t[14]=(_*u*a-o*v*a-_*r*h+n*v*h+o*r*m-n*u*m)*z,t[15]=(o*d*a-l*u*a+l*r*h-n*d*h-o*r*p+n*u*p)*z,this},e.prototype.transform=function(e,t,i){var n=i.toMatrix4(),r=n.elements,a=this.elements;return a[0]=r[0]*t.x,a[1]=r[1]*t.y,a[2]=r[2]*t.z,a[3]=0,a[4]=r[4]*t.x,a[5]=r[5]*t.y,a[6]=r[6]*t.z,a[7]=0,a[8]=r[8]*t.x,a[9]=r[9]*t.y,a[10]=r[10]*t.z,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this},e.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,a=e.w,s=i+i,o=n+n,u=r+r,h=i*s,c=i*o,l=i*u,d=n*o,p=n*u,f=r*u,_=a*s,v=a*o,m=a*u;return t[0]=1-(d+f),t[4]=c-m,t[8]=l+v,t[1]=c+m,t[5]=1-(h+f),t[9]=p-_,t[2]=l-v,t[6]=p+_,t[10]=1-(h+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this};var t,i;e.prototype.decompose=function(n,r,a){void 0===t&&(t=new zen3d.Vector3,i=new e);var s=this.elements,o=t.set(s[0],s[1],s[2]).getLength(),u=t.set(s[4],s[5],s[6]).getLength(),h=t.set(s[8],s[9],s[10]).getLength();this.determinant()<0&&(o=-o),n.x=s[12],n.y=s[13],n.z=s[14],i.elements.set(this.elements);var c=1/o,l=1/u,d=1/h;return i.elements[0]*=c,i.elements[1]*=c,i.elements[2]*=c,i.elements[4]*=l,i.elements[5]*=l,i.elements[6]*=l,i.elements[8]*=d,i.elements[9]*=d,i.elements[10]*=d,r.setFromRotationMatrix(i),a.x=o,a.y=u,a.z=h,this},e.prototype.determinant=function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],a=e[1],s=e[5],o=e[9],u=e[13],h=e[2],c=e[6],l=e[10],d=e[14];return e[3]*(+r*o*c-n*u*c-r*s*l+i*u*l+n*s*d-i*o*d)+e[7]*(+t*o*d-t*u*l+r*a*l-n*a*d+n*u*h-r*o*h)+e[11]*(+t*u*c-t*s*d-r*a*c+i*a*d+r*s*h-i*u*h)+e[15]*(-n*s*h-t*o*c+t*s*l+n*a*c-i*a*l+i*o*h)},e.prototype.fromArray=function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},e.prototype.getMaxScaleOnAxis=function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))},e.prototype.toArray=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},zen3d.Matrix4=e,zen3d.helpMatrix=new e}(),function(){var e=function(e,t){this.x=e||0,this.y=t||0};e.prototype.lerpVectors=function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},e.prototype.set=function(e,t){return this.x=e||0,this.y=t||0,this},e.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},e.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},e.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},e.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(e){e=e||1;var t=this.getLength();if(0!=t){var i=e/t;return this.x*=i,this.y*=i,this}},e.prototype.subtract=function(t,i){return i||(i=new e),i.set(this.x-t.x,this.y-t.y),i},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},e.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},e.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this},e.prototype.distanceToSquared=function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},e.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},e.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.clone=function(){return new e(this.x,this.y)},zen3d.Vector2=e}(),function(){var e=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};e.prototype.lerpVectors=function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},e.prototype.set=function(e,t,i){return this.x=e||0,this.y=t||0,this.z=i||0,this},e.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},e.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},e.prototype.getLength=function(){return Math.sqrt(this.getLengthSquared())},e.prototype.getLengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.prototype.normalize=function(e){e=e||1;var t=this.getLength();if(0!=t){var i=e/t;return this.x*=i,this.y*=i,this.z*=i,this}},e.prototype.subtract=function(t,i){return i||(i=new e),i.set(this.x-t.x,this.y-t.y,this.z-t.z),i},e.prototype.crossVectors=function(e,t){var i=e.x,n=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this},e.prototype.cross=function(e){var t=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-i*e.x,this},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.prototype.applyQuaternion=function(e){var t=this.x,i=this.y,n=this.z,r=e._x,a=e._y,s=e._z,o=e._w,u=o*t+a*n-s*i,h=o*i+s*t-r*n,c=o*n+r*i-a*t,l=-r*t-a*i-s*n;return this.x=u*o+l*-r+h*-s-c*-a,this.y=h*o+l*-a+c*-r-u*-s,this.z=c*o+l*-s+u*-a-h*-r,this},e.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},e.prototype.transformDirection=function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()},e.prototype.setFromMatrixPosition=function(e){return this.setFromMatrixColumn(e,3)},e.prototype.setFromMatrixColumn=function(e,t){return this.fromArray(e.elements,4*t)},e.prototype.fromArray=function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},e.prototype.addVectors=function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},e.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this.z+=e,this},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.distanceToSquared=function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},e.prototype.distanceTo=function(e){return Math.sqrt(this.distanceToSquared(e))},e.prototype.unproject=function(){var e;return function(t){return void 0===e&&(e=new zen3d.Matrix4),e.multiplyMatrices(t.worldMatrix,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),e.prototype.applyProjection=function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,a=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*a,this},e.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},e.prototype.clone=function(){return new e(this.x,this.y,this.z)},zen3d.Vector3=e}(),function(){var e=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1};e.prototype.lerpVectors=function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},e.prototype.set=function(e,t,i,n){return this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1,this},e.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,n=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*r,this},e.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.subVectors=function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},zen3d.Vector4=e}(),function(){var e=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1};e.prototype.normalize=function(e){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},e.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},e.prototype.lerpQuaternions=function(e,t,i){var n=e._w,r=e._x,a=e._y,s=e._z,o=t._w,u=t._x,h=t._y,c=t._z,l=n*o+r*u+a*h+s*c;l<0&&(l=-l,o=-o,u=-u,h=-h,c=-c),this._w=n+i*(o-n),this._x=r+i*(u-r),this._y=a+i*(h-a),this._z=s+i*(c-s);var d=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);return this._w*=d,this._x*=d,this._y*=d,this._z*=d,this.onChangeCallback(),this},e.prototype.slerpQuaternions=function(e,t,i){var n=e._w,r=e._x,a=e._y,s=e._z,o=t._w,u=t._x,h=t._y,c=t._z,l=n*o+r*u+a*h+s*c;if(l<0&&(l=-l,o=-o,u=-u,h=-h,c=-c),l<.95){var d=Math.acos(l),p=1/Math.sin(d),f=Math.sin(d*(1-i))*p,_=Math.sin(d*i)*p;this._w=n*f+o*_,this._x=r*f+u*_,this._y=a*f+h*_,this._z=s*f+c*_}else{this._w=n+i*(o-n),this._x=r+i*(u-r),this._y=a+i*(h-a),this._z=s+i*(c-s);var v=1/Math.sqrt(this._w*this._w+this._x*this._x+this._y*this._y+this._z*this._z);this._w*=v,this._x*=v,this._y*=v,this._z*=v}return this.onChangeCallback(),this},Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),e.prototype.set=function(e,t,i,n){return this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1,this.onChangeCallback(),this},e.prototype.copy=function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=void 0!==e.w?e.w:1,this.onChangeCallback(),this},e.prototype.setFromEuler=function(e,t){var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),a=Math.sin(e._x/2),s=Math.sin(e._y/2),o=Math.sin(e._z/2),u=e._order;return"XYZ"===u?(this._x=a*n*r+i*s*o,this._y=i*s*r-a*n*o,this._z=i*n*o+a*s*r,this._w=i*n*r-a*s*o):"YXZ"===u?(this._x=a*n*r+i*s*o,this._y=i*s*r-a*n*o,this._z=i*n*o-a*s*r,this._w=i*n*r+a*s*o):"ZXY"===u?(this._x=a*n*r-i*s*o,this._y=i*s*r+a*n*o,this._z=i*n*o+a*s*r,this._w=i*n*r-a*s*o):"ZYX"===u?(this._x=a*n*r-i*s*o,this._y=i*s*r+a*n*o,this._z=i*n*o-a*s*r,this._w=i*n*r+a*s*o):"YZX"===u?(this._x=a*n*r+i*s*o,this._y=i*s*r+a*n*o,this._z=i*n*o-a*s*r,this._w=i*n*r-a*s*o):"XZY"===u&&(this._x=a*n*r-i*s*o,this._y=i*s*r-a*n*o,this._z=i*n*o+a*s*r,this._w=i*n*r+a*s*o),t!==!1&&this.onChangeCallback(),this},e.prototype.setFromRotationMatrix=function(e){var t,i=e.elements,n=i[0],r=i[4],a=i[8],s=i[1],o=i[5],u=i[9],h=i[2],c=i[6],l=i[10],d=n+o+l;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-u)*t,this._y=(a-h)*t,this._z=(s-r)*t):n>o&&n>l?(t=2*Math.sqrt(1+n-o-l),this._w=(c-u)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(a+h)/t):o>l?(t=2*Math.sqrt(1+o-n-l),this._w=(a-h)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(u+c)/t):(t=2*Math.sqrt(1+l-n-o),this._w=(s-r)/t,this._x=(a+h)/t,this._y=(u+c)/t,this._z=.25*t),this.onChangeCallback(),this},e.prototype.setFromUnitVectors=function(){var e,t=new zen3d.Vector3;return function(i,n){return void 0===t&&(t=new zen3d.Vector3),e=i.dot(n)+1,e<1e-6?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),e.prototype.toMatrix4=function(e){e||(e=new zen3d.Matrix4);var t=e.elements,i=2*this._x*this._y,n=2*this._x*this._z,r=2*this._x*this._w,a=2*this._y*this._z,s=2*this._y*this._w,o=2*this._z*this._w,u=this._x*this._x,h=this._y*this._y,c=this._z*this._z,l=this._w*this._w;return t[0]=u-h-c+l,t[4]=i-o,t[8]=n+s,t[12]=0,t[1]=i+o,t[5]=-u+h-c+l,t[9]=a-r,t[13]=0,t[2]=n-s,t[6]=a+r,t[10]=-u-h+c+l,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,e},e.prototype.setFromAxisAngle=function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this.onChangeCallback(),this},e.prototype.onChange=function(e){return this.onChangeCallback=e,this},e.prototype.onChangeCallback=function(){},zen3d.Quaternion=e}(),function(){var e=function(e,t){this.min=void 0!==e?e:new zen3d.Vector2(+(1/0),+(1/0)),this.max=void 0!==t?t:new zen3d.Vector2(-(1/0),-(1/0))};e.prototype.set=function(e,t,i,n){this.min.set(e,t),this.max.set(i,n)},e.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},zen3d.Box2=e}(),function(){var e=function(e,t){this.min=void 0!==e?e:new zen3d.Vector3(+(1/0),+(1/0),+(1/0)),this.max=void 0!==t?t:new zen3d.Vector3(-(1/0),-(1/0),-(1/0))};e.prototype.set=function(e,t){this.min.copy(e),this.max.copy(t)},e.prototype.setFromPoints=function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},e.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},e.prototype.expandByPoint=function(e){return this.min.min(e),this.max.max(e),this},e.prototype.expandByScalar=function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},e.prototype.setFromArray=function(e,t){for(var i=+(1/0),n=+(1/0),r=+(1/0),a=-(1/0),s=-(1/0),o=-(1/0),u=void 0!==t?t:3,h=0,c=e.length;h<c;h+=u){var l=e[h],d=e[h+1],p=e[h+2];l<i&&(i=l),d<n&&(n=d),p<r&&(r=p),l>a&&(a=l),d>s&&(s=d),p>o&&(o=p)}return this.min.set(i,n,r),this.max.set(a,s,o),this},e.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},e.prototype.equals=function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},e.prototype.getCenter=function(e){var t=e||new zen3d.Vector3;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},e.prototype.applyMatrix4=function(){var e=[new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3,new zen3d.Vector3];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),e.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},zen3d.Box3=e}(),function(){var e=function(e,t){this.center=void 0!==e?e:new zen3d.Vector3,this.radius=void 0!==t?t:0};e.prototype.set=function(e,t){return this.center.copy(e),this.radius=t,this},e.prototype.setFromArray=function(){var e=new zen3d.Box3,t=new zen3d.Vector3;return function(i,n){var r=void 0!==n?n:3,a=this.center;e.setFromArray(i,r).getCenter(a);for(var s=0,o=0,u=i.length;o<u;o+=r){var h=i[o],c=i[o+1],l=i[o+2];t.set(h,c,l),s=Math.max(s,a.distanceToSquared(t))}return this.radius=Math.sqrt(s),this}}(),e.prototype.applyMatrix4=function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},e.prototype.getBoundingBox=function(e){var t=e||new zen3d.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},e.prototype.clone=function(){return(new e).copy(this)},e.prototype.copy=function(e){return this.center.copy(e.center),this.radius=e.radius,this},zen3d.Sphere=e}(),function(){var e=function(e,t){this.normal=void 0!==e?e:new zen3d.Vector3(1,0,0),this.constant=void 0!==t?t:0};e.prototype.set=function(e,t){return this.normal.copy(e),this.constant=t,this},e.prototype.setComponents=function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},e.prototype.normalize=function(){var e=1/this.normal.getLength();return this.normal.multiplyScalar(e),this.constant*=e,this},e.prototype.distanceToPoint=function(e){return this.normal.dot(e)+this.constant},zen3d.Plane=e}(),function(){var e=function(e,t,i,n,r,a){this.planes=[void 0!==e?e:new zen3d.Plane,void 0!==t?t:new zen3d.Plane,void 0!==i?i:new zen3d.Plane,void 0!==n?n:new zen3d.Plane,void 0!==r?r:new zen3d.Plane,void 0!==a?a:new zen3d.Plane]};e.prototype.set=function(e,t,i,n,r,a){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this},e.prototype.setFromMatrix=function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],u=i[5],h=i[6],c=i[7],l=i[8],d=i[9],p=i[10],f=i[11],_=i[12],v=i[13],m=i[14],g=i[15];return t[0].setComponents(s-n,c-o,f-l,g-_).normalize(),t[1].setComponents(s+n,c+o,f+l,g+_).normalize(),t[2].setComponents(s+r,c+u,f+d,g+v).normalize(),t[3].setComponents(s-r,c-u,f-d,g-v).normalize(),t[4].setComponents(s-a,c-h,f-p,g-m).normalize(),t[5].setComponents(s+a,c+h,f+p,g+m).normalize(),this},e.prototype.intersectsSphere=function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(i)<n)return!1}return!0},e.prototype.intersectsBox=function(){var e=new zen3d.Vector3,t=new zen3d.Vector3;return function(i){for(var n=this.planes,r=0;r<6;r++){var a=n[r];e.x=a.normal.x>0?i.min.x:i.max.x,t.x=a.normal.x>0?i.max.x:i.min.x,e.y=a.normal.y>0?i.min.y:i.max.y,t.y=a.normal.y>0?i.max.y:i.min.y,e.z=a.normal.z>0?i.min.z:i.max.z,t.z=a.normal.z>0?i.max.z:i.min.z;var s=a.distanceToPoint(e),o=a.distanceToPoint(t);if(s<0&&o<0)return!1}return!0}}(),zen3d.Frustum=e}(),function(){var e=function(e,t,i){return this.r=0,this.g=0,this.b=0,void 0===t&&void 0===i?this.setHex(e):this.setRGB(e,t,i)};e.prototype.lerpColors=function(e,t,i){this.r=i*(t.r-e.r)+e.r,this.g=i*(t.g-e.g)+e.g,this.b=i*(t.b-e.b)+e.b,this.r=this.r,this.g=this.g,this.b=this.b},e.prototype.copy=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.setHex=function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},e.prototype.setRGB=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},e.prototype.setHSL=function(){function e(e,t){return(e%t+t)%t}function t(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(i,n,r){if(i=e(i,1),n=Math.max(0,Math.min(1,n)),r=Math.max(0,Math.min(1,r)),0===n)this.r=this.g=this.b=r;else{var a=r<=.5?r*(1+n):r+n-r*n,s=2*r-a;this.r=t(s,a,i+1/3),this.g=t(s,a,i),this.b=t(s,a,i-1/3)}return this}}(),zen3d.Color3=e}(),function(){var e=function(e,t){this.origin=void 0!==e?e:new zen3d.Vector3,this.direction=void 0!==t?t:new zen3d.Vector3};e.prototype.set=function(e,t){this.origin.copy(e),this.direction.copy(t)},e.prototype.at=function(e,t){return(t||new zen3d.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},e.prototype.intersectsSphere=function(){var e=new zen3d.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),r=e.dot(e)-n*n,a=t.radius*t.radius;if(r>a)return null;var s=Math.sqrt(a-r),o=n-s,u=n+s;return o<0&&u<0?null:o<0?this.at(u,i):this.at(o,i)}}(),e.prototype.intersectsBox=function(e,t){var i,n,r,a,s,o,u=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,l=this.origin;return u>=0?(i=(e.min.x-l.x)*u,n=(e.max.x-l.x)*u):(i=(e.max.x-l.x)*u,n=(e.min.x-l.x)*u),h>=0?(r=(e.min.y-l.y)*h,a=(e.max.y-l.y)*h):(r=(e.max.y-l.y)*h,a=(e.min.y-l.y)*h),i>a||r>n?null:((r>i||i!==i)&&(i=r),(a<n||n!==n)&&(n=a),c>=0?(s=(e.min.z-l.z)*c,o=(e.max.z-l.z)*c):(s=(e.max.z-l.z)*c,o=(e.min.z-l.z)*c),i>o||s>n?null:((s>i||i!==i)&&(i=s),(o<n||n!==n)&&(n=o),n<0?null:this.at(i>=0?i:n,t)))},e.prototype.intersectTriangle=function(){var e=new zen3d.Vector3,t=new zen3d.Vector3,i=new zen3d.Vector3,n=new zen3d.Vector3;return function(r,a,s,o,u){t.subVectors(a,r),i.subVectors(s,r),n.crossVectors(t,i);var h,c=this.direction.dot(n);if(c>0){if(o)return null;h=1}else{if(!(c<0))return null;h=-1,c=-c}e.subVectors(this.origin,r);var l=h*this.direction.dot(i.crossVectors(e,i));if(l<0)return null;var d=h*this.direction.dot(t.cross(e));if(d<0)return null;if(l+d>c)return null;var p=-h*e.dot(n);return p<0?null:this.at(p/c,u)}}(),e.prototype.copy=function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},e.prototype.applyMatrix4=function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},zen3d.Ray=e}(),function(){function e(e,t,i){this.a=void 0!==e?e:new zen3d.Vector3,this.b=void 0!==t?t:new zen3d.Vector3,this.c=void 0!==i?i:new zen3d.Vector3}e.prototype.set=function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},e.normal=function(){var e=new zen3d.Vector3;return function(t,i,n,r){var a=r||new zen3d.Vector3;a.subVectors(n,i),e.subVectors(t,i),a.cross(e);var s=a.getLengthSquared();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),e.barycoordFromPoint=function(){var e=new zen3d.Vector3,t=new zen3d.Vector3,i=new zen3d.Vector3;return function(n,r,a,s,o){e.subVectors(s,r),t.subVectors(a,r),i.subVectors(n,r);var u=e.dot(e),h=e.dot(t),c=e.dot(i),l=t.dot(t),d=t.dot(i),p=u*l-h*h,f=o||new zen3d.Vector3;if(0===p)return f.set(-2,-1,-1);var _=1/p,v=(l*c-h*d)*_,m=(u*d-h*c)*_;return f.set(1-v-m,m,v)}}(),e.containsPoint=function(){var t=new zen3d.Vector3;return function(i,n,r,a){var s=e.barycoordFromPoint(i,n,r,a,t);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}(),zen3d.Triangle=e}(),function(){var e=function(e,t){this.posPoints=void 0,this.ctrlPoints=void 0,this.segCount=0,this.set(e,t)};e.prototype.set=function(e,t){this.posPoints=e,this.ctrlPoints=t,e.length!==t.length&&console.warn("Curve: posPoints and ctrlPoints's length not equal!"),this.segCount=e.length-1},e.prototype.calc=function(){var e=new zen3d.Vector2,t=new zen3d.Vector2,i=new zen3d.Vector2,n=new zen3d.Vector2
;return function(r){for(var a=0;a<this.segCount;a++)if(r>=this.posPoints[a].x&&r<=this.posPoints[a+1].x){e.copy(this.posPoints[a]),i.copy(this.posPoints[a+1]),t.copy(this.ctrlPoints[a]),n.copy(this.ctrlPoints[a+1]);break}return e||e.copy(this.posPoints[this.posPoints.length-1]),t||t.copy(this.ctrlPoints[this.ctrlPoints.length-1]),i.copy(i||e),n.copy(n||t),r=(r-e.x)/(i.x-e.x),this._cubic_bezier(e.y,t.y,n.y,i.y,r)}}(),e.prototype.averageXSampler=function(e){e<2&&console.warn("Curve: sampler num less than 2!");for(var t=[],i=this.posPoints[0].x,n=this.posPoints[this.posPoints.length-1].x,r=(n-i)/(e-1),a=0,s=0;s<e;s++)a=s===e-1?n:i+s*r,t.push(a,this.calc(a));return t},e.prototype._cubic_bezier=function(e,t,i,n,r){return e=this._mix(e,t,r),t=this._mix(t,i,r),i=this._mix(i,n,r),e=this._mix(e,t,r),t=this._mix(t,i,r),e=this._mix(e,t,r)},e.prototype._mix=function(e,t,i){return e*(1-i)+t*i},zen3d.Curve=e}(),function(){var e=function(){this.eventMap={}};e.prototype.addEventListener=function(e,t,i){var n=this.eventMap[e];n||(n=this.eventMap[e]=[]),n.push({listener:t,thisObject:i||this})},e.prototype.removeEventListener=function(e,t,i){var n=this.eventMap[e];if(n)for(var r=0,a=n.length;r<a;r++){var s=n[r];if(s.listener==t&&s.thisObject==(i||this)){n.splice(r,1);break}}},e.prototype.dispatchEvent=function(e){e.target=this,this.notifyListener(e)},e.prototype.notifyListener=function(e){var t=this.eventMap[e.type];if(t)for(var i=0,n=t.length;i<n;i++){var r=t[i];r.listener.call(r.thisObject,e)}},zen3d.EventDispatcher=e}(),function(){function e(e,t){return e.distance-t.distance}function t(e,i,n,r){if(e.raycast(i,n),r===!0)for(var a=e.children,s=0,o=a.length;s<o;s++)t(a[s],i,n,!0)}var i=function(e,t,i,n){this.ray=new zen3d.Ray(e,t),this.near=i||0,this.far=n||1/0};i.prototype.set=function(e,t){this.ray.set(e,t)},i.prototype.setFromCamera=function(e,t){this.ray.origin.setFromMatrixPosition(t.worldMatrix),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()},i.prototype.intersectObject=function(i,n){var r=[];return t(i,this,r,n),r.sort(e),r},i.prototype.intersectObjects=function(i,n){var r=[];if(Array.isArray(i)===!1)return console.warn("Raycaster.intersectObjects: objects is not an Array."),r;for(var a=0,s=i.length;a<s;a++)t(i[a],this,r,n);return r.sort(e),r},zen3d.Raycaster=i}(),function(){function e(e,t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var t=function(e,t){var i=["","WEBKIT_","MOZ_"],n=null;for(var r in i)if(n=e.getExtension(i[r]+t))break;return n},i=function(i){this.version=parseFloat(/^WebGL\ ([0-9])/.exec(i.getParameter(i.VERSION))[1]),this.precision="highp",this.maxPrecision=e(i,this.precision),this.maxTextures=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxCubemapSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this.floatTextures=!!t(i,"OES_texture_float"),this.anisotropyExt=t(i,"EXT_texture_filter_anisotropic"),this.maxAnisotropy=null!==this.anisotropyExt?i.getParameter(this.anisotropyExt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;t(i,"OES_standard_derivatives"),t(i,"GL_OES_standard_derivatives")};zen3d.WebGLCapabilities=i}(),function(){function e(e,t,i,n){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<n;s++)e.texImage2D(i+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return a}var t=zen3d.BLEND_TYPE,i=zen3d.CULL_FACE_TYPE,n=function(t,i){this.gl=t,this.capabilities=i,this.states={},this.currentBlending=null,this.currentPremultipliedAlpha=null,this.currentCullFace=null,this.currentViewport=new zen3d.Vector4,this.currentClearColor=new zen3d.Vector4,this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBuffers={},this.emptyTextures={},this.emptyTextures[t.TEXTURE_2D]=e(t,t.TEXTURE_2D,t.TEXTURE_2D,1),this.emptyTextures[t.TEXTURE_CUBE_MAP]=e(t,t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),this.currentFlipSided=!1,this.currentDepthMask=!0,this.currentLineWidth=null,this.currentProgram=null};n.prototype.setBlend=function(e,i){var n=this.gl;e!==t.NONE?this.enable(n.BLEND):this.disable(n.BLEND),e===this.currentBlending&&i===this.currentPremultipliedAlpha||(e===t.NORMAL&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA))),e===t.ADD&&(i?(n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE,n.ONE,n.ONE)):(n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE))),this.currentBlending=e,this.currentPremultipliedAlpha=i)},n.prototype.setFlipSided=function(e){var t=this.gl;this.currentFlipSided!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e)},n.prototype.setCullFace=function(e){var t=this.gl;e!==i.NONE?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===i.BACK?t.cullFace(t.BACK):e===i.FRONT?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e},n.prototype.viewport=function(e,t,i,n){var r=this.currentViewport;if(r.x!==e||r.y!==t||r.z!==i||r.w!==n){this.gl.viewport(e,t,i,n),r.set(e,t,i,n)}},n.prototype.clearColor=function(e,t,i,n){var r=this.currentClearColor;if(r.x!==e||r.y!==t||r.z!==i||r.w!==n){this.gl.clearColor(e,t,i,n),r.set(e,t,i,n)}},n.prototype.activeTexture=function(e){var t=this.gl;void 0===e&&(e=t.TEXTURE0+this.capabilities.maxTextures-1),this.currentTextureSlot!==e&&(t.activeTexture(e),this.currentTextureSlot=e)},n.prototype.bindTexture=function(e,t){var i=this.gl;null===this.currentTextureSlot&&this.activeTexture();var n=this.currentBoundTextures[this.currentTextureSlot];void 0===n&&(n={type:void 0,texture:void 0},this.currentBoundTextures[this.currentTextureSlot]=n),n.type===e&&n.texture===t||(i.bindTexture(e,t||this.emptyTextures[e]),n.type=e,n.texture=t)},n.prototype.bindBuffer=function(e,t){var i=this.gl;this.currentBoundBuffers[e]!==t&&(i.bindBuffer(e,t),this.currentBoundBuffers[e]=t)},n.prototype.enable=function(e){this.states[e]!==!0&&(this.gl.enable(e),this.states[e]=!0)},n.prototype.disable=function(e){this.states[e]!==!1&&(this.gl.disable(e),this.states[e]=!1)},n.prototype.depthMask=function(e){e!==this.currentDepthMask&&(this.gl.depthMask(e),this.currentDepthMask=e)},n.prototype.setLineWidth=function(e){e!==this.currentLineWidth&&(this.capabilities.version>=1&&this.gl.lineWidth(e),this.currentLineWidth=e)},n.prototype.setProgram=function(e){this.currentProgram!==e&&(this.gl.useProgram(e.id),this.currentProgram=e)},zen3d.WebGLState=n}(),function(){var e=function(){this.properties={}};e.prototype.get=function(e){var t=e.uuid,i=this.properties[t];return void 0===i&&(i={},this.properties[t]=i),i},e.prototype.delete=function(e){delete this.properties[e.uuid]},e.prototype.clear=function(){this.properties={}},zen3d.WebGLProperties=e}(),function(){function e(e){return e.wrapS!==s.CLAMP_TO_EDGE||e.wrapT!==s.CLAMP_TO_EDGE||e.minFilter!==a.NEAREST&&e.minFilter!==a.LINEAR}function t(e){return e===a.NEAREST||e===a.NEAREST_MIPMAP_LINEAR||e===a.NEAREST_MIPMAP_NEAREST?a.NEAREST:a.LINEAR}function i(e){return u(e.width)&&u(e.height)}function n(e){if(o&&(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=h(e.width),t.height=h(e.height);return t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.warn("image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function r(e,t){if(e.width>t||e.height>t){if(!o)return console.warn("image is too big ("+e.width+"x"+e.height+"). max size is "+t+"x"+t,e),e;var i=t/Math.max(e.width,e.height),n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=Math.floor(e.width*i),n.height=Math.floor(e.height*i);return n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}var a=zen3d.WEBGL_TEXTURE_FILTER,s=zen3d.WEBGL_TEXTURE_WRAP,o=zen3d.isWeb,u=zen3d.isPowerOfTwo,h=zen3d.nearestPowerOfTwo,c=function(e,t,i,n){this.gl=e,this.state=t,this.properties=i,this.capabilities=n};c.prototype.setTexture2D=function(t,a){var s=this.gl,o=this.state,u=this.properties.get(t);if(t.version>0&&u.__version!==t.version){void 0===u.__webglTexture&&(t.addEventListener("dispose",this.onTextureDispose,this),u.__webglTexture=s.createTexture()),o.activeTexture(s.TEXTURE0+a),o.bindTexture(s.TEXTURE_2D,u.__webglTexture);var h=r(t.image,this.capabilities.maxTextureSize);e(t)&&i(h)===!1&&(h=n(h));var c=i(h);this.setTextureParameters(t,c);var l,d=t.mipmaps,p=t.pixelFormat,f=t.pixelType;if(t.isDataTexture)if(d.length>0&&c){for(var _=0,v=d.length;_<v;_++)l=d[_],s.texImage2D(s.TEXTURE_2D,_,p,l.width,l.height,t.border,p,f,l.data);t.generateMipmaps=!1}else s.texImage2D(s.TEXTURE_2D,0,p,h.width,h.height,t.border,p,f,h.data);else if(d.length>0&&c){for(var _=0,v=d.length;_<v;_++)l=d[_],s.texImage2D(s.TEXTURE_2D,_,p,p,f,l);t.generateMipmaps=!1}else s.texImage2D(s.TEXTURE_2D,0,p,p,f,h);return t.generateMipmaps&&c&&s.generateMipmap(s.TEXTURE_2D),void(u.__version=t.version)}o.activeTexture(s.TEXTURE0+a),o.bindTexture(s.TEXTURE_2D,u.__webglTexture)},c.prototype.setTextureCube=function(e,t){var n=this.gl,a=this.state,s=this.properties.get(e);if(e.version>0&&s.__version!==e.version){void 0===s.__webglTexture&&(e.addEventListener("dispose",this.onTextureDispose,this),s.__webglTexture=n.createTexture()),a.activeTexture(n.TEXTURE0+t),a.bindTexture(n.TEXTURE_CUBE_MAP,s.__webglTexture);for(var o=[],u=0;u<6;u++)o[u]=r(e.images[u],this.capabilities.maxCubemapSize);var h=o[0],c=i(h);this.setTextureParameters(e,c);for(var l=e.pixelFormat,d=e.pixelType,u=0;u<6;u++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,l,l,d,o[u]);return e.generateMipmaps&&c&&n.generateMipmap(n.TEXTURE_CUBE_MAP),void(s.__version=e.version)}a.activeTexture(n.TEXTURE0+t),a.bindTexture(n.TEXTURE_CUBE_MAP,s.__webglTexture)},c.prototype.setTextureParameters=function(e,i){var n=this.gl,r=e.textureType;i?(n.texParameteri(r,n.TEXTURE_WRAP_S,e.wrapS),n.texParameteri(r,n.TEXTURE_WRAP_T,e.wrapT),n.texParameteri(r,n.TEXTURE_MAG_FILTER,e.magFilter),n.texParameteri(r,n.TEXTURE_MIN_FILTER,e.minFilter)):(n.texParameteri(r,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(r,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),e.wrapS===n.CLAMP_TO_EDGE&&e.wrapT===n.CLAMP_TO_EDGE||console.warn("Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to zen3d.TEXTURE_WRAP.CLAMP_TO_EDGE.",e),n.texParameteri(r,n.TEXTURE_MAG_FILTER,t(e.magFilter)),n.texParameteri(r,n.TEXTURE_MIN_FILTER,t(e.minFilter)),(e.minFilter!==n.NEAREST&&e.minFilter!==n.LINEAR||e.magFilter!==n.NEAREST&&e.magFilter!==n.LINEAR)&&console.warn("Texture is not power of two. Texture.minFilter and Texture.magFilter should be set to zen3d.TEXTURE_FILTER.NEAREST or zen3d.TEXTURE_FILTER.LINEAR.",e));var a=this.capabilities.anisotropyExt;a&&e.anisotropy>1&&n.texParameterf(r,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,this.capabilities.maxAnisotropy))},c.prototype.setRenderTarget2D=function(e){var t=this.gl,n=this.state,r=this.properties.get(e),a=this.properties.get(e.texture);if(void 0!==a.__webglTexture&&void 0!==r.__webglFramebuffer)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer);else{e.addEventListener("dispose",this.onRenderTargetDispose,this),a.__webglTexture=t.createTexture(),r.__webglFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),n.bindTexture(t.TEXTURE_2D,a.__webglTexture);var s=i(e);this.setTextureParameters(e.texture,s);var o=e.texture.pixelFormat,u=e.texture.pixelType;if(t.texImage2D(t.TEXTURE_2D,0,o,e.width,e.height,0,o,u,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a.__webglTexture,0),e.texture.generateMipmaps&&s&&t.generateMipmap(t.TEXTURE_2D),n.bindTexture(t.TEXTURE_2D,null),e.depthBuffer){r.__webglDepthbuffer=t.createRenderbuffer();var h=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,h),e.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,h)):(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,h)),t.bindRenderbuffer(t.RENDERBUFFER,null)}}},c.prototype.setRenderTargetCube=function(e){var t=this.gl,n=this.state,r=this.properties.get(e),a=this.properties.get(e.texture);if(void 0!==a.__webglTexture&&void 0!==r.__webglFramebuffer)t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,a.__webglTexture,0);else{e.addEventListener("dispose",this.onRenderTargetDispose,this),a.__webglTexture=t.createTexture(),r.__webglFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),n.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture);var s=i(e);this.setTextureParameters(e.texture,s);for(var o=e.texture.pixelFormat,u=e.texture.pixelType,h=0;h<6;h++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,o,e.width,e.height,0,o,u,null);if(t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,a.__webglTexture,0),e.texture.generateMipmaps&&s&&t.generateMipmap(t.TEXTURE_CUBE_MAP),n.bindTexture(t.TEXTURE_CUBE_MAP,null),e.depthBuffer){r.__webglDepthbuffer=t.createRenderbuffer();var c=r.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,c),e.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,c)):(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,c)),t.bindRenderbuffer(t.RENDERBUFFER,null)}}},c.prototype.updateRenderTargetMipmap=function(e){var t=this.gl,n=this.state,r=e.texture;if(r.generateMipmaps&&i(e)&&r.minFilter!==t.NEAREST&&r.minFilter!==t.LINEAR){var a=r.textureType,s=this.properties.get(r).__webglTexture;n.bindTexture(a,s),t.generateMipmap(a),n.bindTexture(a,null)}},c.prototype.onTextureDispose=function(e){var t=this.gl,i=e.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onTextureDispose,this),n.__webglTexture&&t.deleteTexture(n.__webglTexture),this.properties.delete(i)},c.prototype.onRenderTargetDispose=function(e){var t=this.gl,i=e.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onRenderTargetDispose,this),n.__webglTexture&&t.deleteTexture(textureProperties.__webglTexture),n.__webglFramebuffer&&t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),this.properties.delete(i)},zen3d.WebGLTexture=c}(),function(){var e=function(e,t,i,n){this.gl=e,this.state=t,this.properties=i,this.capabilities=n};e.prototype.setGeometry=function(e){var t=this.gl,i=this.state,n=this.properties.get(e);if(e.dirty){if(void 0===n.__webglVAO&&(e.addEventListener("dispose",this.onGeometryDispose,this),n.__webglVAO=t.createBuffer(),e.dirtyRange.enable=!1),i.bindBuffer(t.ARRAY_BUFFER,n.__webglVAO),e.dirtyRange.enable){var r=new Float32Array(e.verticesArray);r=r.subarray(e.dirtyRange.start,e.dirtyRange.start+e.dirtyRange.count),t.bufferSubData(t.ARRAY_BUFFER,4*e.dirtyRange.start,r),e.dirtyRange.enable=!1,e.dirtyRange.start=0,e.dirtyRange.count=0}else{var r=new Float32Array(e.verticesArray);t.bufferData(t.ARRAY_BUFFER,r,e.usageType)}if(e.indicesArray.length>0){void 0===n.__webglEAO&&(n.__webglEAO=t.createBuffer()),i.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.__webglEAO);var a=new Uint16Array(e.indicesArray);t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,e.usageType)}return void(e.dirty=!1)}i.bindBuffer(t.ARRAY_BUFFER,n.__webglVAO),e.indicesArray.length>0&&i.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.__webglEAO)},e.prototype.onGeometryDispose=function(e){var t=this.gl,i=e.target,n=this.properties.get(i);i.removeEventListener("dispose",this.onGeometryDispose,this),n.__webglVAO&&t.deleteBuffer(n.__webglVAO),n.__webglEAO&&t.deleteBuffer(n.__webglEAO),this.properties.delete(i)},zen3d.WebGLGeometry=e}(),function(){var e=zen3d.WEBGL_UNIFORM_TYPE,t=function(e,t,i){this.gl=e,this.name=i.name,this.type=i.type,this.size=i.size,this.location=e.getUniformLocation(t,this.name),this.value=void 0,this._setDefaultValue(),this.setValue=void 0,this.set=void 0,this._generateSetValue(),this.upload=void 0,this._generateUpload()};t.prototype._setDefaultValue=function(){switch(this.type){case e.FLOAT:case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.value=0;break;case e.FLOAT_VEC2:case e.BOOL_VEC2:case e.INT_VEC2:this.value=[0,0];break;case e.FLOAT_VEC3:case e.BOOL_VEC3:case e.INT_VEC3:this.value=[0,0,0];break;case e.FLOAT_VEC4:case e.BOOL_VEC4:case e.INT_VEC4:this.value=[0,0,0,0];break;case e.FLOAT_MAT2:this.value=new Float32Array([1,0,0,1]);break;case e.FLOAT_MAT3:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case e.FLOAT_MAT4:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},t.prototype._generateSetValue=function(){switch(this.type){case e.FLOAT:case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.setValue=function(e){this.value=e,this.upload()},this.set=function(e){this.value=e,this.upload()};break;case e.FLOAT_VEC2:case e.BOOL_VEC2:case e.INT_VEC2:this.setValue=function(e,t){this.value[0]=e,this.value[1]=t,this.upload()},this.set=function(e){this.value.set(e),this.upload()};break;case e.FLOAT_VEC3:case e.BOOL_VEC3:case e.INT_VEC3:this.setValue=function(e,t,i){this.value[0]=e,this.value[1]=t,this.value[2]=i,this.upload()},this.set=function(e){this.value.set(e),this.upload()};break;case e.FLOAT_VEC4:case e.BOOL_VEC4:case e.INT_VEC4:this.setValue=function(e,t,i,n){this.value[0]=e,this.value[1]=t,this.value[2]=i,this.value[3]=n,this.upload()},this.set=function(e){this.value.set(e),this.upload()};break;case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:this.setValue=function(e){this.value.set(e),this.upload()},this.set=function(e){this.value.set(e),this.upload()}}},t.prototype._generateUpload=function(){var t=this.gl,i=this.type,n=this.location;switch(i){case e.FLOAT:this.upload=function(){var e=this.value;t.uniform1f(n,e)};break;case e.FLOAT_VEC2:this.upload=function(){var e=this.value;t.uniform2f(n,e[0],e[1])};break;case e.FLOAT_VEC3:this.upload=function(){var e=this.value;t.uniform3f(n,e[0],e[1],e[2])};break;case e.FLOAT_VEC4:this.upload=function(){var e=this.value;t.uniform4f(n,e[0],e[1],e[2],e[3])};break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.upload=function(){var e=this.value;t.uniform1i(n,e)};break;case e.BOOL_VEC2:case e.INT_VEC2:this.upload=function(){var e=this.value;t.uniform2i(n,e[0],e[1])};break;case e.BOOL_VEC3:case e.INT_VEC3:this.upload=function(){var e=this.value;t.uniform3i(n,e[0],e[1],e[2])};break;case e.BOOL_VEC4:case e.INT_VEC4:this.upload=function(){var e=this.value;t.uniform4i(n,e[0],e[1],e[2],e[3])};break;case e.FLOAT_MAT2:this.upload=function(){var e=this.value;t.uniformMatrix2fv(n,!1,e)};break;case e.FLOAT_MAT3:this.upload=function(){var e=this.value;t.uniformMatrix3fv(n,!1,e)};break;case e.FLOAT_MAT4:this.upload=function(){var e=this.value;t.uniformMatrix4fv(n,!1,e)}}},zen3d.WebGLUniform=t}(),function(){var e=zen3d.WEBGL_ATTRIBUTE_TYPE,t=function(e,t,i){this.gl=e,this.name=i.name,this.type=i.type,this.size=i.size,this.location=e.getAttribLocation(t,this.name),this.count=0,this.initCount(e),this.format=e.FLOAT,this.initFormat(e)};t.prototype.initCount=function(t){switch(this.type){case e.FLOAT:case e.BYTE:case e.UNSIGNED_BYTE:case e.UNSIGNED_SHORT:this.count=1;break;case e.FLOAT_VEC2:this.count=2;break;case e.FLOAT_VEC3:this.count=3;break;case e.FLOAT_VEC4:this.count=4}},t.prototype.initFormat=function(t){switch(this.type){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:this.format=t.FLOAT;break;case e.UNSIGNED_BYTE:this.format=t.UNSIGNED_BYTE;break;case e.UNSIGNED_SHORT:this.format=t.UNSIGNED_SHORT;break;case e.BYTE:this.format=t.BYTE}},zen3d.WebGLAttribute=t}(),function(){function e(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)||(console.log("shader not compiled!"),console.log(e.getShaderInfoLog(n))),n}function t(e,t,i){var n=e.createProgram();return e.attachShader(n,t),e.attachShader(n,i),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||(console.log("program not linked!"),console.log(e.getProgramInfoLog(n))),n}function i(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<n;r++){var a=e.getActiveUniform(t,r),s=a.name,o=new zen3d.WebGLUniform(e,t,a);i[s]=o}return i}function n(e,t){for(var i={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),r=0;r<n;r++){var a=e.getActiveAttrib(t,r),s=a.name,o=new zen3d.WebGLAttribute(e,t,a);i[s]=o}return i}var r=function(r,a,s){this.vshaderSource=a,this.fshaderSource=s;var o=e(r,r.VERTEX_SHADER,this.vshaderSource),u=e(r,r.FRAGMENT_SHADER,this.fshaderSource);this.id=t(r,o,u),this.uniforms=i(r,this.id),this.attributes=n(r,this.id),r.deleteShader(o),r.deleteShader(u)};r.prototype.dispose=function(e){e.deleteProgram(this.id)},zen3d.WebGLProgram=r}(),function(){zen3d.ShaderChunk={ambientlight_pars_frag:"uniform vec4 u_AmbientLightColor;",begin_frag:"vec4 outColor = vec4(u_Color, u_Opacity);",begin_vert:"vec3 transformed = vec3(a_Position);\n#if defined(USE_NORMAL) || defined(USE_ENV_MAP)\n    vec3 objectNormal = vec3(a_Normal);\n#endif",bsdfs:"\nvec4 BRDF_Diffuse_Lambert(vec4 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\nvec4 F_Schlick( const in vec4 specularColor, const in float dotLH ) {\n\tfloat fresnel = pow( 1.0 - dotLH, 5.0 );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nvec4 BRDF_Specular_BlinnPhong(vec4 specularColor, vec3 N, vec3 L, vec3 V, float shininess) {\n    vec3 H = normalize(L + V);\n    float dotNH = saturate(dot(N, H));\n    float dotLH = saturate(dot(L, H));\n    vec4 F = F_Schlick(specularColor, dotLH);\n    float G = G_BlinnPhong_Implicit( );\n    float D = D_BlinnPhong(shininess, dotNH);\n    return F * G * D;\n}",bumpMap_pars_frag:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd(vec2 uv) {\n\t\tvec2 dSTdx = dFdx( uv );\n\t\tvec2 dSTdy = dFdy( uv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, uv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",common_frag:"uniform mat4 u_View;\nuniform float u_Opacity;\nuniform vec3 u_Color;\nuniform vec3 u_CameraPosition;",common_vert:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\n#include <transpose>\n#include <inverse>\nuniform mat4 u_Projection;\nuniform mat4 u_View;\nuniform mat4 u_Model;\nuniform vec3 u_CameraPosition;",diffuseMap_frag:"#ifdef USE_DIFFUSE_MAP\n    vec4 texelColor = texture2D( texture, v_Uv );\n    texelColor = mapTexelToLinear( texelColor );\n    outColor *= texelColor;\n#endif",diffuseMap_pars_frag:"#ifdef USE_DIFFUSE_MAP\n    uniform sampler2D texture;\n#endif",directlight_pars_frag:"struct DirectLight\n{\n    vec3 direction;\n    vec4 color;\n    float intensity;\n    int shadow;\n    float shadowBias;\n    float shadowRadius;\n    vec2 shadowMapSize;\n};\nuniform DirectLight u_Directional[USE_DIRECT_LIGHT];",emissiveMap_frag:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D(emissiveMap, v_Uv);\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissiveMap_pars_frag:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_frag:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_frag:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",end_frag:"gl_FragColor = outColor;",envMap_frag:"#ifdef USE_ENV_MAP\n    vec4 envColor = textureCube(envMap, v_EnvPos);\n    envColor = envMapTexelToLinear( envColor );\n    outColor += envColor * u_EnvMap_Intensity;\n#endif",envMap_pars_frag:"#ifdef USE_ENV_MAP\n    varying vec3 v_EnvPos;\n    uniform samplerCube envMap;\n    uniform float u_EnvMap_Intensity;\n#endif",envMap_pars_vert:"#ifdef USE_ENV_MAP\n    varying vec3 v_EnvPos;\n#endif",envMap_vert:"#ifdef USE_ENV_MAP\n    v_EnvPos = reflect(normalize((u_Model * vec4(transformed, 1.0)).xyz - u_CameraPosition), (transpose(inverse(u_Model)) * vec4(objectNormal, 1.0)).xyz);\n#endif",fog_frag:"#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    #ifdef USE_EXP2_FOG\n        float fogFactor = whiteCompliment( exp2( - u_FogDensity * u_FogDensity * depth * depth * LOG2 ) );\n    #else\n        float fogFactor = smoothstep( u_FogNear, u_FogFar, depth );\n    #endif\n    gl_FragColor.rgb = mix( gl_FragColor.rgb, u_FogColor, fogFactor );\n#endif",fog_pars_frag:"#ifdef USE_FOG\n    uniform vec3 u_FogColor;\n    #ifdef USE_EXP2_FOG\n        uniform float u_FogDensity;\n    #else\n        uniform float u_FogNear;\n        uniform float u_FogFar;\n    #endif\n#endif",inverse:"mat4 inverse(mat4 m) {\n    float\n    a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    return mat4(\n        a11 * b11 - a12 * b10 + a13 * b09,\n        a02 * b10 - a01 * b11 - a03 * b09,\n        a31 * b05 - a32 * b04 + a33 * b03,\n        a22 * b04 - a21 * b05 - a23 * b03,\n        a12 * b08 - a10 * b11 - a13 * b07,\n        a00 * b11 - a02 * b08 + a03 * b07,\n        a32 * b02 - a30 * b05 - a33 * b01,\n        a20 * b05 - a22 * b02 + a23 * b01,\n        a10 * b10 - a11 * b08 + a13 * b06,\n        a01 * b08 - a00 * b10 - a03 * b06,\n        a30 * b04 - a31 * b02 + a33 * b00,\n        a21 * b02 - a20 * b04 - a23 * b00,\n        a11 * b07 - a10 * b09 - a12 * b06,\n        a00 * b09 - a01 * b07 + a02 * b06,\n        a31 * b01 - a30 * b03 - a32 * b00,\n        a20 * b03 - a21 * b01 + a22 * b00) / det;\n}",
light_frag:"#ifdef USE_LIGHT\n    vec4 light;\n    vec3 L;\n    vec4 reflectLight = vec4(0., 0., 0., 0.);\n    vec4 totalReflect = vec4(0., 0., 0., 0.);\n    vec4 diffuseColor = outColor.xyzw;\n    #ifdef USE_AMBIENT_LIGHT\n        totalReflect += RECIPROCAL_PI * diffuseColor * u_AmbientLightColor;\n    #endif\n    #if defined(USE_PHONG) && ( defined(USE_DIRECT_LIGHT) || defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) )\n        vec3 V = normalize( (u_View * vec4(u_CameraPosition, 1.)).xyz - v_ViewModelPos);\n    #endif\n    #ifdef USE_DIRECT_LIGHT\n    for(int i = 0; i < USE_DIRECT_LIGHT; i++) {\n        L = -u_Directional[i].direction;\n        light = u_Directional[i].color * u_Directional[i].intensity;\n        L = normalize(L);\n        float dotNL = saturate( dot(N, L) );\n        vec4 irradiance = light * dotNL;\n        #ifdef USE_SHADOW\n            irradiance *= bool( u_Directional[i].shadow ) ? getShadow( directionalShadowMap[ i ], vDirectionalShadowCoord[ i ], u_Directional[i].shadowBias, u_Directional[i].shadowRadius, u_Directional[i].shadowMapSize ) : 1.0;\n        #endif\n        reflectLight += irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n        #ifdef USE_PHONG\n            reflectLight += irradiance * BRDF_Specular_BlinnPhong(u_SpecularColor, N, L, V, u_Specular) * specularStrength;\n        #endif\n        totalReflect += reflectLight;\n        reflectLight = vec4(0., 0., 0., 0.);\n    }\n    #endif\n    #ifdef USE_POINT_LIGHT\n    for(int i = 0; i < USE_POINT_LIGHT; i++) {\n        L = u_Point[i].position - v_ViewModelPos;\n        float dist = pow(clamp(1. - length(L) / u_Point[i].distance, 0.0, 1.0), u_Point[i].decay);\n        light = u_Point[i].color * u_Point[i].intensity * dist;\n        L = normalize(L);\n        float dotNL = saturate( dot(N, L) );\n        vec4 irradiance = light * dotNL;\n        #ifdef USE_SHADOW\n            vec3 worldV = (vec4(v_ViewModelPos, 1.) * u_View - vec4(u_Point[i].position, 1.) * u_View).xyz;\n            irradiance *= bool( u_Point[i].shadow ) ? getPointShadow( pointShadowMap[ i ], worldV, u_Point[i].shadowBias, u_Point[i].shadowRadius, u_Point[i].shadowMapSize ) : 1.0;\n        #endif\n        reflectLight += irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n        #ifdef USE_PHONG\n            reflectLight += irradiance * BRDF_Specular_BlinnPhong(u_SpecularColor, N, L, V, u_Specular) * specularStrength;\n        #endif\n        totalReflect += reflectLight;\n        reflectLight = vec4(0., 0., 0., 0.);\n    }\n    #endif\n    #ifdef USE_SPOT_LIGHT\n    for(int i = 0; i < USE_SPOT_LIGHT; i++) {\n        L = u_Spot[i].position - v_ViewModelPos;\n        float lightDistance = length(L);\n        L = normalize(L);\n        float angleCos = dot( L, -normalize(u_Spot[i].direction) );\n        if( all( bvec2(angleCos > u_Spot[i].coneCos, lightDistance < u_Spot[i].distance) ) ) {\n            float spotEffect = smoothstep( u_Spot[i].coneCos, u_Spot[i].penumbraCos, angleCos );\n            float dist = pow(clamp(1. - lightDistance / u_Spot[i].distance, 0.0, 1.0), u_Spot[i].decay);\n            light = u_Spot[i].color * u_Spot[i].intensity * dist * spotEffect;\n            float dotNL = saturate( dot(N, L) );\n            vec4 irradiance = light * dotNL;\n            #ifdef USE_SHADOW\n                irradiance *= bool( u_Spot[i].shadow ) ? getShadow( spotShadowMap[ i ], vSpotShadowCoord[ i ], u_Spot[i].shadowBias, u_Spot[i].shadowRadius, u_Spot[i].shadowMapSize ) : 1.0;\n            #endif\n            reflectLight += irradiance * BRDF_Diffuse_Lambert(diffuseColor);\n            #ifdef USE_PHONG\n                reflectLight += irradiance * BRDF_Specular_BlinnPhong(u_SpecularColor, N, L, V, u_Specular) * specularStrength;\n            #endif\n            totalReflect += reflectLight;\n            reflectLight = vec4(0., 0., 0., 0.);\n        }\n    }\n    #endif\n    outColor = totalReflect.xyzw;\n#endif",light_pars_frag:"#ifdef USE_AMBIENT_LIGHT\n    #include <ambientlight_pars_frag>\n#endif\n#ifdef USE_DIRECT_LIGHT\n    #include <directlight_pars_frag>\n#endif\n#ifdef USE_POINT_LIGHT\n    #include <pointlight_pars_frag>\n#endif\n#ifdef USE_SPOT_LIGHT\n    #include <spotlight_pars_frag>\n#endif",normalMap_pars_frag:"#include <tbn>\n#include <tsn>\nuniform sampler2D normalMap;",normal_frag:"#ifdef USE_NORMAL\n    #ifdef DOUBLE_SIDED\n    \tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n    #else\n    \tfloat flipNormal = 1.0;\n    #endif\n    #ifdef FLAT_SHADED\n    \tvec3 fdx = vec3( dFdx( v_ViewModelPos.x ), dFdx( v_ViewModelPos.y ), dFdx( v_ViewModelPos.z ) );\n    \tvec3 fdy = vec3( dFdy( v_ViewModelPos.x ), dFdy( v_ViewModelPos.y ), dFdy( v_ViewModelPos.z ) );\n    \tvec3 N = normalize( cross( fdx, fdy ) );\n    #else\n        vec3 N = normalize(v_Normal) * flipNormal;\n    #endif\n    #ifdef USE_NORMAL_MAP\n        vec3 normalMapColor = texture2D(normalMap, v_Uv).rgb;\n        mat3 tspace = tsn(N, -v_ViewModelPos, vec2(v_Uv.x, 1.0 - v_Uv.y));\n        N = normalize(tspace * (normalMapColor * 2.0 - 1.0));\n    #elif defined(USE_BUMPMAP)\n        N = perturbNormalArb(-v_ViewModelPos, N, dHdxy_fwd(v_Uv));\n    #endif\n#endif",normal_pars_frag:"#ifdef USE_NORMAL\n    varying vec3 v_Normal;\n#endif",normal_pars_vert:"#ifdef USE_NORMAL\n    varying vec3 v_Normal;\n#endif",normal_vert:"#ifdef USE_NORMAL\n    v_Normal = (transpose(inverse(u_View * u_Model)) * vec4(objectNormal, 1.0)).xyz;\n    #ifdef FLIP_SIDED\n    \tv_Normal = - v_Normal;\n    #endif\n#endif",packing:"const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8;    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}",pointlight_pars_frag:"struct PointLight\n{\n    vec3 position;\n    vec4 color;\n    float intensity;\n    float distance;\n    float decay;\n    int shadow;\n    float shadowBias;\n    float shadowRadius;\n    vec2 shadowMapSize;\n};\nuniform PointLight u_Point[USE_POINT_LIGHT];",premultipliedAlpha_frag:"#ifdef USE_PREMULTIPLIED_ALPHA\n    gl_FragColor.rgb = gl_FragColor.rgb * gl_FragColor.a;\n#endif",pvm_vert:"gl_Position = u_Projection * u_View * u_Model * vec4(transformed, 1.0);",shadowMap_frag:"#ifdef USE_SHADOW\n#endif",shadowMap_pars_frag:"#ifdef USE_SHADOW\n    #include <packing>\n    #ifdef USE_DIRECT_LIGHT\n        uniform sampler2D directionalShadowMap[ USE_DIRECT_LIGHT ];\n        varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];\n    #endif\n    #ifdef USE_POINT_LIGHT\n        uniform samplerCube pointShadowMap[ USE_POINT_LIGHT ];\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        uniform sampler2D spotShadowMap[ USE_SPOT_LIGHT ];\n        varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];\n    #endif\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n    }\n    float textureCubeCompare( samplerCube depths, vec3 uv, float compare ) {\n        return step( compare, unpackRGBAToDepth( textureCube( depths, uv ) ) );\n    }\n    float getShadow( sampler2D shadowMap, vec4 shadowCoord, float shadowBias, float shadowRadius, vec2 shadowMapSize ) {\n        shadowCoord.xyz /= shadowCoord.w;\n        float depth = shadowCoord.z + shadowBias;\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n        bvec2 frustumTestVec = bvec2( inFrustum, depth <= 1.0 );\n        bool frustumTest = all( frustumTestVec );\n        if ( frustumTest ) {\n            #ifdef USE_PCF_SOFT_SHADOW\n                float texelSize = shadowRadius / shadowMapSize.x;\n                vec2 poissonDisk[4];\n                poissonDisk[0] = vec2(-0.94201624, -0.39906216);\n                poissonDisk[1] = vec2(0.94558609, -0.76890725);\n                poissonDisk[2] = vec2(-0.094184101, -0.92938870);\n                poissonDisk[3] = vec2(0.34495938, 0.29387760);\n                return texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[0] * texelSize, depth ) * 0.25 +\n                    texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[1] * texelSize, depth ) * 0.25 +\n                    texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[2] * texelSize, depth ) * 0.25 +\n                    texture2DCompare( shadowMap, shadowCoord.xy + poissonDisk[3] * texelSize, depth ) * 0.25;\n            #else\n                return texture2DCompare( shadowMap, shadowCoord.xy, depth );\n            #endif\n        }\n        return 1.0;\n    }\n    float getPointShadow( samplerCube shadowMap, vec3 V, float shadowBias, float shadowRadius, vec2 shadowMapSize ) {\n        float depth = (length(V) + shadowBias) / 1000.;\n        #ifdef USE_PCF_SOFT_SHADOW\n            float texelSize = shadowRadius / shadowMapSize.x;\n            vec3 poissonDisk[4];\n    \t\tpoissonDisk[0] = vec3(-1.0, 1.0, -1.0);\n    \t\tpoissonDisk[1] = vec3(1.0, -1.0, -1.0);\n    \t\tpoissonDisk[2] = vec3(-1.0, -1.0, -1.0);\n    \t\tpoissonDisk[3] = vec3(1.0, -1.0, 1.0);\n            return textureCubeCompare( shadowMap, normalize(V) + poissonDisk[0] * texelSize, depth ) * 0.25 +\n                textureCubeCompare( shadowMap, normalize(V) + poissonDisk[1] * texelSize, depth ) * 0.25 +\n                textureCubeCompare( shadowMap, normalize(V) + poissonDisk[2] * texelSize, depth ) * 0.25 +\n                textureCubeCompare( shadowMap, normalize(V) + poissonDisk[3] * texelSize, depth ) * 0.25;\n        #else\n            return textureCubeCompare( shadowMap, normalize(V), depth);\n        #endif\n    }\n#endif",shadowMap_pars_vert:"#ifdef USE_SHADOW\n    #ifdef USE_DIRECT_LIGHT\n        uniform mat4 directionalShadowMatrix[ USE_DIRECT_LIGHT ];\n        varying vec4 vDirectionalShadowCoord[ USE_DIRECT_LIGHT ];\n    #endif\n    #ifdef USE_POINT_LIGHT\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        uniform mat4 spotShadowMatrix[ USE_SPOT_LIGHT ];\n        varying vec4 vSpotShadowCoord[ USE_SPOT_LIGHT ];\n    #endif\n#endif",shadowMap_vert:"#ifdef USE_SHADOW\n    vec4 worldPosition = u_Model * vec4(transformed, 1.0);\n    #ifdef USE_DIRECT_LIGHT\n        for ( int i = 0; i < USE_DIRECT_LIGHT; i ++ ) {\n            vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n    #ifdef USE_POINT_LIGHT\n    #endif\n    #ifdef USE_SPOT_LIGHT\n        for ( int i = 0; i < USE_SPOT_LIGHT; i ++ ) {\n            vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n        }\n    #endif\n#endif",skinning_pars_vert:"#ifdef USE_SKINNING\n    attribute vec4 skinIndex;\n\tattribute vec4 skinWeight;\n    #ifdef BONE_TEXTURE\n        uniform sampler2D boneTexture;\n        uniform int boneTextureSize;\n        mat4 getBoneMatrix( const in float i ) {\n            float j = i * 4.0;\n            float x = mod( j, float( boneTextureSize ) );\n            float y = floor( j / float( boneTextureSize ) );\n            float dx = 1.0 / float( boneTextureSize );\n            float dy = 1.0 / float( boneTextureSize );\n            y = dy * ( y + 0.5 );\n            vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n            vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n            vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n            vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n            mat4 bone = mat4( v1, v2, v3, v4 );\n            return bone;\n        }\n    #else\n        uniform mat4 boneMatrices[MAX_BONES];\n        mat4 getBoneMatrix(const in float i) {\n            mat4 bone = boneMatrices[int(i)];\n            return bone;\n        }\n    #endif\n#endif",skinning_vert:"#ifdef USE_SKINNING\n    mat4 boneMatX = getBoneMatrix( skinIndex.x );\n    mat4 boneMatY = getBoneMatrix( skinIndex.y );\n    mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n    mat4 boneMatW = getBoneMatrix( skinIndex.w );\n    vec4 skinVertex = vec4(transformed, 1.0);\n    vec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n    transformed = vec3(skinned.xyz / skinned.w);\n    #if defined(USE_NORMAL) || defined(USE_ENV_MAP)\n        mat4 skinMatrix = mat4( 0.0 );\n        skinMatrix += skinWeight.x * boneMatX;\n        skinMatrix += skinWeight.y * boneMatY;\n        skinMatrix += skinWeight.z * boneMatZ;\n        skinMatrix += skinWeight.w * boneMatW;\n        objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n    #endif\n#endif",specularMap_frag:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, v_Uv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularMap_pars_frag:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",spotlight_pars_frag:"struct SpotLight\n{\n    vec3 position;\n    vec4 color;\n    float intensity;\n    float distance;\n    float decay;\n    float coneCos;\n    float penumbraCos;\n    vec3 direction;\n    int shadow;\n    float shadowBias;\n    float shadowRadius;\n    vec2 shadowMapSize;\n};\nuniform SpotLight u_Spot[USE_SPOT_LIGHT];",tbn:"mat3 tbn(vec3 N, vec3 p, vec2 uv) {\n    vec3 dp1 = dFdx(p.xyz);\n    vec3 dp2 = dFdy(p.xyz);\n    vec2 duv1 = dFdx(uv.st);\n    vec2 duv2 = dFdy(uv.st);\n    vec3 dp2perp = cross(dp2, N);\n    vec3 dp1perp = cross(N, dp1);\n    vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n    vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n    float invmax = 1.0 / sqrt(max(dot(T,T), dot(B,B)));\n    return mat3(T * invmax, B * invmax, N);\n}",transpose:"mat4 transpose(mat4 inMatrix) {\n    vec4 i0 = inMatrix[0];\n    vec4 i1 = inMatrix[1];\n    vec4 i2 = inMatrix[2];\n    vec4 i3 = inMatrix[3];\n    mat4 outMatrix = mat4(\n        vec4(i0.x, i1.x, i2.x, i3.x),\n        vec4(i0.y, i1.y, i2.y, i3.y),\n        vec4(i0.z, i1.z, i2.z, i3.z),\n        vec4(i0.w, i1.w, i2.w, i3.w)\n    );\n    return outMatrix;\n}",tsn:"mat3 tsn(vec3 N, vec3 V, vec2 uv) {\n    vec3 q0 = dFdx( V.xyz );\n    vec3 q1 = dFdy( V.xyz );\n    vec2 st0 = dFdx( uv.st );\n    vec2 st1 = dFdy( uv.st );\n    vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n    mat3 tsn = mat3( S, T, N );\n    return tsn;\n}",uv_pars_frag:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(USE_SPECULARMAP) || defined(USE_EMISSIVEMAP)\n    varying vec2 v_Uv;\n#endif",uv_pars_vert:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(USE_SPECULARMAP) || defined(USE_EMISSIVEMAP)\n    attribute vec2 a_Uv;\n    varying vec2 v_Uv;\n#endif",uv_vert:"#if defined(USE_DIFFUSE_MAP) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(USE_SPECULARMAP) || defined(USE_EMISSIVEMAP)\n    v_Uv = a_Uv;\n#endif",viewModelPos_pars_frag:"#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )\n    varying vec3 v_ViewModelPos;\n#endif",viewModelPos_pars_vert:"#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )\n    varying vec3 v_ViewModelPos;\n#endif",viewModelPos_vert:"#if defined(USE_POINT_LIGHT) || defined(USE_SPOT_LIGHT) || defined(USE_NORMAL_MAP) || defined(USE_BUMPMAP) || defined(FLAT_SHADED) || ( defined(USE_PHONG) && defined(USE_DIRECT_LIGHT) )\n    v_ViewModelPos = (u_View * u_Model * vec4(transformed, 1.0)).xyz;\n#endif"}}(),function(){zen3d.ShaderLib={basic_frag:"#include <common_frag>\n#include <uv_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <envMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <diffuseMap_frag>\n    #include <envMap_frag>\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",basic_vert:"#include <common_vert>\n#include <uv_pars_vert>\n#include <envMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <uv_vert>\n    #include <envMap_vert>\n}",canvas2d_frag:"#include <common_frag>\nvarying vec2 v_Uv;\nuniform sampler2D spriteTexture;\nvoid main() {\n    #include <begin_frag>\n    outColor *= texture2D(spriteTexture, v_Uv);\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n}",canvas2d_vert:"#include <common_vert>\nattribute vec2 a_Uv;\nvarying vec2 v_Uv;\nvoid main() {\n    #include <begin_vert>\n    #include <pvm_vert>\n    v_Uv = a_Uv;\n}",cube_frag:"#include <common_frag>\nuniform samplerCube cubeMap;\nvarying vec3 v_ModelPos;\nvoid main() {\n    #include <begin_frag>\n    outColor *= textureCube(cubeMap, v_ModelPos);\n    #include <end_frag>\n}",cube_vert:"#include <common_vert>\nvarying vec3 v_ModelPos;\nvoid main() {\n    #include <begin_vert>\n    #include <pvm_vert>\n    v_ModelPos = (u_Model * vec4(transformed, 1.0)).xyz;\n}",depth_frag:"#include <common_frag>\nuniform vec3 lightPos;\nvarying vec3 v_ModelPos;\n#include <packing>\nvoid main() {\n    gl_FragColor = packDepthToRGBA(length(v_ModelPos - lightPos) / 1000.);\n}",depth_vert:"#include <common_vert>\nvarying vec3 v_ModelPos;\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    v_ModelPos = (u_Model * vec4(transformed, 1.0)).xyz;\n}",lambert_frag:"#include <common_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <diffuseMap_frag>\n    #include <normal_frag>\n    #include <light_frag>\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",lambert_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",linedashed_frag:"#include <common_frag>\n#include <fog_pars_frag>\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\nvoid main() {\n    if ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n    #include <begin_frag>\n    #include <end_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",linedashed_vert:"#include <common_vert>\nuniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\nvoid main() {\n    vLineDistance = scale * lineDistance;\n    vec3 transformed = vec3(a_Position);\n    #include <pvm_vert>\n}",particle_frag:"float scaleLinear(float value, vec2 valueDomain) {\n    return (value - valueDomain.x) / (valueDomain.y - valueDomain.x);\n}\nfloat scaleLinear(float value, vec2 valueDomain, vec2 valueRange) {\n    return mix(valueRange.x, valueRange.y, scaleLinear(value, valueDomain));\n}\nvarying vec4 vColor;\nvarying float lifeLeft;\nuniform sampler2D tSprite;\nvoid main() {\n    float alpha = 0.;\n    if( lifeLeft > .995 ) {\n        alpha = scaleLinear( lifeLeft, vec2(1., .995), vec2(0., 1.));\n    } else {\n        alpha = lifeLeft * .75;\n    }\n    vec4 tex = texture2D( tSprite, gl_PointCoord );\n    gl_FragColor = vec4( vColor.rgb * tex.a, alpha * tex.a );\n}",particle_vert:"const vec4 bitSh = vec4(256. * 256. * 256., 256. * 256., 256., 1.);\nconst vec4 bitMsk = vec4(0.,vec3(1./256.0));\nconst vec4 bitShifts = vec4(1.) / bitSh;\n#define FLOAT_MAX\t1.70141184e38\n#define FLOAT_MIN\t1.17549435e-38\nlowp vec4 encode_float(highp float v) {\n    highp float av = abs(v);\n    if(av < FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n    }\n    highp vec4 c = vec4(0,0,0,0);\n    highp float e = floor(log2(av));\n    highp float m = av * pow(2.0, -e) - 1.0;\n    c[1] = floor(128.0 * m);\n    m -= c[1] / 128.0;\n    c[2] = floor(32768.0 * m);\n    m -= c[2] / 32768.0;\n    c[3] = floor(8388608.0 * m);\n    highp float ebias = e + 127.0;\n    c[0] = floor(ebias / 2.0);\n    ebias -= c[0] * 2.0;\n    c[1] += floor(ebias) * 128.0;\n    c[0] += 128.0 * step(0.0, -v);\n    return c / 255.0;\n}\nvec4 pack(const in float depth)\n{\n    const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n    const vec4 bit_mask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n    vec4 res = mod(depth*bit_shift*vec4(255), vec4(256))/vec4(255);\n    res -= res.xxyz * bit_mask;\n    return res;\n}\nfloat unpack(const in vec4 rgba_depth)\n{\n    const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n    float depth = dot(rgba_depth, bit_shift);\n    return depth;\n}\nuniform float uTime;\nuniform float uScale;\nuniform sampler2D tNoise;\nuniform mat4 u_Projection;\nuniform mat4 u_View;\nuniform mat4 u_Model;\nattribute vec4 particlePositionsStartTime;\nattribute vec4 particleVelColSizeLife;\nvarying vec4 vColor;\nvarying float lifeLeft;\nvoid main() {\n    vColor = encode_float( particleVelColSizeLife.y );\n    vec4 velTurb = encode_float( particleVelColSizeLife.x );\n    vec3 velocity = vec3( velTurb.xyz );\n    float turbulence = velTurb.w;\n    vec3 newPosition;\n    float timeElapsed = uTime - particlePositionsStartTime.a;\n    lifeLeft = 1. - (timeElapsed / particleVelColSizeLife.w);\n    gl_PointSize = ( uScale * particleVelColSizeLife.z ) * lifeLeft;\n    velocity.x = ( velocity.x - .5 ) * 3.;\n    velocity.y = ( velocity.y - .5 ) * 3.;\n    velocity.z = ( velocity.z - .5 ) * 3.;\n    newPosition = particlePositionsStartTime.xyz + ( velocity * 10. ) * ( uTime - particlePositionsStartTime.a );\n    vec3 noise = texture2D( tNoise, vec2( newPosition.x * .015 + (uTime * .05), newPosition.y * .02 + (uTime * .015) )).rgb;\n    vec3 noiseVel = ( noise.rgb - .5 ) * 30.;\n    newPosition = mix(newPosition, newPosition + vec3(noiseVel * ( turbulence * 5. ) ), (timeElapsed / particleVelColSizeLife.a) );\n    if( velocity.y > 0. && velocity.y < .05 ) {\n        lifeLeft = 0.;\n    }\n    if( velocity.x < -1.45 ) {\n        lifeLeft = 0.;\n    }\n    if( timeElapsed > 0. ) {\n        gl_Position = u_Projection * u_View * u_Model * vec4( newPosition, 1.0 );\n    } else {\n        gl_Position = u_Projection * u_View * u_Model * vec4( particlePositionsStartTime.xyz, 1.0 );\n        lifeLeft = 0.;\n        gl_PointSize = 0.;\n    }\n}",phong_frag:"#include <common_frag>\nuniform float u_Specular;\nuniform vec4 u_SpecularColor;\n#include <specularMap_pars_frag>\nuniform vec3 emissive;\n#include <uv_pars_frag>\n#include <diffuseMap_pars_frag>\n#include <normalMap_pars_frag>\n#include <bumpMap_pars_frag>\n#include <light_pars_frag>\n#include <normal_pars_frag>\n#include <viewModelPos_pars_frag>\n#include <bsdfs>\n#include <envMap_pars_frag>\n#include <shadowMap_pars_frag>\n#include <fog_pars_frag>\n#include <emissiveMap_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #include <diffuseMap_frag>\n    #include <normal_frag>\n    #include <specularMap_frag>\n    #include <light_frag>\n    #include <envMap_frag>\n    #include <shadowMap_frag>\n    vec3 totalEmissiveRadiance = emissive;\n    #include <emissiveMap_frag>\n    outColor += vec4(totalEmissiveRadiance.rgb, 0.0);\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",phong_vert:"#include <common_vert>\n#include <normal_pars_vert>\n#include <uv_pars_vert>\n#include <viewModelPos_pars_vert>\n#include <envMap_pars_vert>\n#include <shadowMap_pars_vert>\n#include <skinning_pars_vert>\nvoid main() {\n    #include <begin_vert>\n    #include <skinning_vert>\n    #include <pvm_vert>\n    #include <normal_vert>\n    #include <uv_vert>\n    #include <viewModelPos_vert>\n    #include <envMap_vert>\n    #include <shadowMap_vert>\n}",point_frag:"#include <common_frag>\n#include <diffuseMap_pars_frag>\n#include <fog_pars_frag>\nvoid main() {\n    #include <begin_frag>\n    #ifdef USE_DIFFUSE_MAP\n        outColor *= texture2D(texture, vec2(gl_PointCoord.x, 1.0 - gl_PointCoord.y));\n    #endif\n    #include <end_frag>\n    #include <encodings_frag>\n    #include <premultipliedAlpha_frag>\n    #include <fog_frag>\n}",point_vert:"#include <common_vert>\nuniform float u_PointSize;\nuniform float u_PointScale;\nvoid main() {\n    #include <begin_vert>\n    #include <pvm_vert>\n    vec4 mvPosition = u_View * u_Model * vec4(transformed, 1.0);\n    #ifdef USE_SIZEATTENUATION\n        gl_PointSize = u_PointSize * ( u_PointScale / - mvPosition.z );\n    #else\n        gl_PointSize = u_PointSize;\n    #endif\n}",sprite_frag:"uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\n    vec4 texture = texture2D( map, vUV );\n    if ( texture.a < alphaTest ) discard;\n    gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n    if ( fogType > 0 ) {\n        float depth = gl_FragCoord.z / gl_FragCoord.w;\n        float fogFactor = 0.0;\n        if ( fogType == 1 ) {\n            fogFactor = smoothstep( fogNear, fogFar, depth );\n        } else {\n            \n            fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n            fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n        }\n        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n    }\n}",sprite_vert:"uniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\n    vUV = uvOffset + uv * uvScale;\n    vec2 alignedPosition = position * scale;\n    vec2 rotatedPosition;\n    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n    vec4 finalPosition;\n    finalPosition = viewMatrix * modelMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n    finalPosition.xy += rotatedPosition;\n    finalPosition = projectionMatrix * finalPosition;\n    gl_Position = finalPosition;\n}"}}(),function(){function e(e){var t="";for(var i in e)t+=e[i]+"_";return t}function t(e,t){var i;return e?e.encoding&&(i=e.encoding):i=u.LINEAR,i===u.LINEAR&&t&&(i=u.GAMMA),i}function i(e){switch(e){case u.LINEAR:return["Linear","( value )"];case u.SRGB:return["sRGB","( value )"];case u.RGBE:return["RGBE","( value )"];case u.RGBM7:return["RGBM","( value, 7.0 )"];case u.RGBM16:return["RGBM","( value, 16.0 )"];case u.RGBD:return["RGBD","( value, 256.0 )"];case u.GAMMA:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:console.error("unsupported encoding: "+e)}}function n(e,t){var n=i(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function r(e,t){var n=i(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function a(e,t,i,a){var s=zen3d.ShaderLib[t.materialType+"_vert"]||t.vertexShader||zen3d.ShaderLib.basic_vert,u=zen3d.ShaderLib[t.materialType+"_frag"]||t.fragmentShader||zen3d.ShaderLib.basic_frag;s=h(s),u=h(u);var c=[""],l=["#define LOG2 1.442695","#define RECIPROCAL_PI 0.31830988618","#define saturate(a) clamp( a, 0.0, 1.0 )","#define whiteCompliment(a) ( 1.0 - saturate( a ) )"];switch(t.materialType){case o.CUBE:case o.CANVAS2D:case o.SPRITE:case o.PARTICLE:case o.SHADER:break;case o.LAMBERT:case o.PHONG:case o.POINT:c.push(t.pointLightNum>0?"#define USE_POINT_LIGHT "+t.pointLightNum:""),c.push(t.spotLightNum>0?"#define USE_SPOT_LIGHT "+t.spotLightNum:""),c.push(t.directLightNum>0?"#define USE_DIRECT_LIGHT "+t.directLightNum:""),c.push(t.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+t.ambientLightNum:""),c.push(t.pointLightNum>0||t.directLightNum>0||t.ambientLightNum>0||t.spotLightNum>0?"#define USE_LIGHT":""),c.push(t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0?"#define USE_NORMAL":""),c.push((t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useNormalMap?"#define USE_NORMAL_MAP":""),c.push((t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useBumpMap?"#define USE_BUMPMAP":""),c.push((t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useSpecularMap?"#define USE_SPECULARMAP":""),c.push(t.useShadow?"#define USE_SHADOW":""),c.push(t.materialType==o.LAMBERT?"#define USE_LAMBERT":""),c.push(t.materialType==o.PHONG?"#define USE_PHONG":""),c.push(t.flipSided?"#define FLIP_SIDED":""),l.push(t.pointLightNum>0?"#define USE_POINT_LIGHT "+t.pointLightNum:""),l.push(t.spotLightNum>0?"#define USE_SPOT_LIGHT "+t.spotLightNum:""),l.push(t.directLightNum>0?"#define USE_DIRECT_LIGHT "+t.directLightNum:""),l.push(t.ambientLightNum>0?"#define USE_AMBIENT_LIGHT "+t.ambientLightNum:""),l.push(t.pointLightNum>0||t.directLightNum>0||t.ambientLightNum>0||t.spotLightNum>0?"#define USE_LIGHT":""),l.push(t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0?"#define USE_NORMAL":""),l.push((t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useNormalMap?"#define USE_NORMAL_MAP":""),l.push((t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useBumpMap?"#define USE_BUMPMAP":""),l.push((t.pointLightNum>0||t.directLightNum>0||t.spotLightNum>0)&&t.useSpecularMap?"#define USE_SPECULARMAP":""),l.push(t.useEmissiveMap?"#define USE_EMISSIVEMAP":""),l.push(t.useShadow?"#define USE_SHADOW":""),l.push(t.usePCFSoftShadow?"#define USE_PCF_SOFT_SHADOW":""),l.push(t.flatShading?"#define FLAT_SHADED":""),l.push(t.materialType==o.LAMBERT?"#define USE_LAMBERT":""),l.push(t.materialType==o.PHONG?"#define USE_PHONG":""),l.push(t.doubleSided?"#define DOUBLE_SIDED":"");case o.BASIC:l.push(zen3d.ShaderChunk.encodings_pars_frag),l.push("#define GAMMA_FACTOR "+t.gammaFactor),l.push(n("mapTexelToLinear",t.diffuseMapEncoding)),l.push(n("envMapTexelToLinear",t.envMapEncoding)),l.push(n("emissiveMapTexelToLinear",t.emissiveMapEncoding)),l.push(r("linearToOutputTexel",t.outputEncoding));case o.LINE_BASIC:c.push(t.useDiffuseMap?"#define USE_DIFFUSE_MAP":""),c.push(t.useEnvMap?"#define USE_ENV_MAP":""),c.push(t.sizeAttenuation?"#define USE_SIZEATTENUATION":""),l.push(t.useDiffuseMap?"#define USE_DIFFUSE_MAP":""),
l.push(t.useEnvMap?"#define USE_ENV_MAP":""),l.push(t.premultipliedAlpha?"#define USE_PREMULTIPLIED_ALPHA":"");case o.DEPTH:c.push(t.useSkinning?"#define USE_SKINNING":""),c.push(t.bonesNum>0?"#define MAX_BONES "+t.bonesNum:""),c.push(t.useVertexTexture?"#define BONE_TEXTURE":"");case o.LINE_DASHED:l.push(t.fog?"#define USE_FOG":""),l.push(t.fogExp2?"#define USE_EXP2_FOG":"")}var d=["precision "+t.precision+" float;","precision "+t.precision+" int;",c.join("\n"),s].join("\n"),p=["#extension GL_OES_standard_derivatives : enable","precision "+t.precision+" float;","precision "+t.precision+" int;",l.join("\n"),u].join("\n");return new zen3d.WebGLProgram(e,d,p)}var s={},o=zen3d.MATERIAL_TYPE,u=zen3d.TEXEL_ENCODING_TYPE,h=function(e){function t(e,t){var i=zen3d.ShaderChunk[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return h(i)}return e.replace(/#include +<([\w\d.]+)>/g,t)},c=function(i,n,r,u,h,c){var r=r||u.material,l={};l.precision=n.capabilities.maxPrecision,l.materialType=r.type;var d=n.getCurrentRenderTarget();switch(r.type){case o.BASIC:case o.LAMBERT:case o.PHONG:case o.POINT:l.gammaFactor=n.gammaFactor,l.outputEncoding=t(d?d.texture:null,n.gammaOutput),l.diffuseMapEncoding=t(r.diffuseMap,n.gammaInput),l.envMapEncoding=t(r.envMap,n.gammaInput),l.emissiveMapEncoding=t(r.emissiveMap,n.gammaInput);case o.CUBE:case o.LINE_BASIC:case o.LINE_DASHED:l.useDiffuseMap=!!r.diffuseMap,l.useNormalMap=!!r.normalMap,l.useBumpMap=!!r.bumpMap,l.useSpecularMap=!!r.specularMap,l.useEnvMap=!!r.envMap,l.useEmissiveMap=!!r.emissiveMap,l.useDiffuseColor=!r.diffuseMap,l.ambientLightNum=h.ambientsNum,l.directLightNum=h.directsNum,l.pointLightNum=h.pointsNum,l.spotLightNum=h.spotsNum,l.flatShading=r.shading===zen3d.SHADING_TYPE.FLAT_SHADING,l.useShadow=u.receiveShadow,l.usePCFSoftShadow=n.shadowType===zen3d.SHADOW_TYPE.PCF_SOFT,l.premultipliedAlpha=r.premultipliedAlpha,l.fog=!!c,l.fogExp2=!!c&&c.fogType===zen3d.FOG_TYPE.EXP2,l.sizeAttenuation=r.sizeAttenuation,l.doubleSided=r.side===zen3d.DRAW_SIDE.DOUBLE,l.flipSided=r.side===zen3d.DRAW_SIDE.BACK;case o.DEPTH:var p=u.type===zen3d.OBJECT_TYPE.SKINNED_MESH&&u.skeleton,f=n.capabilities.maxVertexUniformVectors,_=n.capabilities.maxVertexTextures>0&&n.capabilities.floatTextures,v=0;_?v=1024:16*(v=u.skeleton?u.skeleton.bones.length:0)>f&&(console.warn("Program: too many bones ("+v+"), current cpu only support "+Math.floor(f/16)+" bones!!"),v=Math.floor(f/16)),l.useSkinning=p,l.bonesNum=v,l.useVertexTexture=_;break;case o.SHADER:l.vertexShader=r.vertexShader,l.fragmentShader=r.fragmentShader;case o.CANVAS2D:case o.PARTICLE:case o.SPRITE:}var m,g=e(l),y=s;return y[g]?m=y[g]:(m=a(i,l),y[g]=m),m};zen3d.getProgram=c}(),function(){var e=(zen3d.MATERIAL_TYPE,zen3d.CULL_FACE_TYPE),t=zen3d.BLEND_TYPE,i=zen3d.DRAW_SIDE,n=zen3d.WEBGL_UNIFORM_TYPE,r=function(t){this.view=t;var i=this.gl=t.getContext("webgl",{antialias:!0,alpha:!1,stencil:!0});this.width=t.width,this.height=t.height,this.autoClear=!0,this.shadowType=zen3d.SHADOW_TYPE.PCF_SOFT,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1;var n=new zen3d.WebGLProperties;this.properties=n;var r=new zen3d.WebGLCapabilities(i);this.capabilities=r;var a=new zen3d.WebGLState(i,r);a.enable(i.STENCIL_TEST),a.enable(i.DEPTH_TEST),a.setCullFace(e.BACK),a.setFlipSided(!1),a.viewport(0,0,this.width,this.height),a.clearColor(0,0,0,0),this.state=a,this.texture=new zen3d.WebGLTexture(i,a,n,r),this.geometry=new zen3d.WebGLGeometry(i,a,n,r),this.performance=new zen3d.Performance,this.depthMaterial=new zen3d.DepthMaterial,this.cache=new zen3d.RenderCache,this._usedTextureUnits=0,this._currentRenderTarget=null,this._currentViewport=new zen3d.Vector4(0,0,this.width,this.height)};r.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.setViewport(0,0,e,t)},r.prototype.setViewport=function(e,t,i,n){this._currentViewport.set(e,t,i,n),this.state.viewport(e,t,i,n)},r.prototype.render=function(e,t,i,n){var r=this.performance;r.updateFps(),r.startCounter("render",60),r.startCounter("updateMatrix",60),e.updateMatrix(),r.endCounter("updateMatrix"),t.viewMatrix.getInverse(t.worldMatrix),r.startCounter("cacheScene",60),this.cache.cacheScene(e,t),this.cache.sort(),r.endCounter("cacheScene"),r.startCounter("renderShadow",60),this.renderShadow(),r.endCounter("renderShadow"),void 0===i&&(i=null),this.setRenderTarget(i),(this.autoClear||n)&&(this.state.clearColor(0,0,0,0),this.clear(!0,!0,!0)),r.startCounter("renderList",60),this.renderList(this.cache.opaqueObjects),this.renderList(this.cache.transparentObjects),this.renderList(this.cache.canvas2dObjects),this.renderSprites(this.cache.sprites),this.renderParticles(this.cache.particles),r.endCounter("renderList"),this.cache.clear(),i&&this.texture.updateRenderTargetMipmap(i),this.performance.endCounter("render")},r.prototype.renderShadow=function(){for(var e=this.gl,t=this.state,i=this.cache.lights.shadows,n=0;n<i.length;n++)for(var r=i[n],s=r.shadow,o=s.camera,u=s.renderTarget,h=r.lightType==zen3d.LIGHT_TYPE.POINT,c=h?6:1,l=this.cache.shadowObjects,d=0;d<c;d++)if(h?(s.update(r,d),u.activeCubeFace=d):s.update(r),this.setRenderTarget(u),t.clearColor(1,1,1,1),this.clear(!0,!0),0!=l.length)for(var p=0,f=l.length;p<f;p++){var _=l[p],v=this.depthMaterial,m=_.geometry,g=zen3d.getProgram(e,this,v,_);t.setProgram(g),this.geometry.setGeometry(m),this.setupVertexAttributes(g,m);var y=g.uniforms;for(var T in y){var E=y[T];switch(T){case"u_Projection":var x=o.projectionMatrix.elements;E.setValue(x);break;case"u_View":var M=o.viewMatrix.elements;E.setValue(M);break;case"u_Model":var z=_.worldMatrix.elements;E.setValue(z);break;case"lightPos":a.setFromMatrixPosition(r.worldMatrix),E.setValue(a.x,a.y,a.z)}}_.type===zen3d.OBJECT_TYPE.SKINNED_MESH&&this.uploadSkeleton(y,_,g.id),v.side=_.material.side,this.setStates(v),e.drawElements(e.TRIANGLES,_.geometry.getIndicesCount(),e.UNSIGNED_SHORT,0)}};var a=new zen3d.Vector3;r.prototype.renderList=function(e){for(var t=this.cache.camera,i=this.cache.fog,r=this.gl,s=this.state,o=this.cache.lights,u=0,h=e.length;u<h;u++){var c=e[u],l=c.object,d=c.material,p=c.geometry,f=zen3d.getProgram(r,this,l.material,l,o,i);s.setProgram(f),this.geometry.setGeometry(p),this.setupVertexAttributes(f,p);var _=f.uniforms;for(var v in _){var m=_[v];switch(v){case"u_Projection":if(l.type===zen3d.OBJECT_TYPE.CANVAS2D&&l.isScreenCanvas)var g=l.orthoCamera.projectionMatrix.elements;else var g=t.projectionMatrix.elements;m.setValue(g);break;case"u_View":if(l.type===zen3d.OBJECT_TYPE.CANVAS2D&&l.isScreenCanvas)var y=l.orthoCamera.viewMatrix.elements;else var y=t.viewMatrix.elements;m.setValue(y);break;case"u_Model":var T=l.worldMatrix.elements;m.setValue(T);break;case"u_Color":var E=d.diffuse;m.setValue(E.r,E.g,E.b);break;case"u_Opacity":m.setValue(d.opacity);break;case"texture":var x=this.allocTexUnit();this.texture.setTexture2D(d.diffuseMap,x),m.setValue(x);break;case"normalMap":var x=this.allocTexUnit();this.texture.setTexture2D(d.normalMap,x),m.setValue(x);break;case"bumpMap":var x=this.allocTexUnit();this.texture.setTexture2D(d.bumpMap,x),m.setValue(x);break;case"bumpScale":m.setValue(d.bumpScale);break;case"envMap":var x=this.allocTexUnit();this.texture.setTextureCube(d.envMap,x),m.setValue(x);break;case"cubeMap":var x=this.allocTexUnit();this.texture.setTextureCube(d.cubeMap,x),m.setValue(x);break;case"u_EnvMap_Intensity":m.setValue(d.envMapIntensity);break;case"u_Specular":m.setValue(d.shininess);break;case"u_SpecularColor":var E=d.specular;m.setValue(E.r,E.g,E.b,1);break;case"specularMap":var x=this.allocTexUnit();this.texture.setTexture2D(d.specularMap,x),m.setValue(x);break;case"emissive":var E=d.emissive,M=d.emissiveIntensity;m.setValue(E.r*M,E.g*M,E.b*M);break;case"emissiveMap":var x=this.allocTexUnit();this.texture.setTexture2D(d.emissiveMap,x),m.setValue(x);break;case"u_CameraPosition":a.setFromMatrixPosition(t.worldMatrix),m.setValue(a.x,a.y,a.z);break;case"u_FogColor":var E=i.color;m.setValue(E.r,E.g,E.b);break;case"u_FogDensity":m.setValue(i.density);break;case"u_FogNear":m.setValue(i.near);break;case"u_FogFar":m.setValue(i.far);break;case"u_PointSize":m.setValue(d.size);break;case"u_PointScale":var z=.5*this.height;m.setValue(z);break;case"dashSize":m.setValue(d.dashSize);break;case"totalSize":m.setValue(d.dashSize+d.gapSize);break;case"scale":m.setValue(d.scale);break;default:if(d.uniforms&&d.uniforms[v])if(m.type===n.SAMPLER_2D){var x=this.allocTexUnit();this.texture.setTexture2D(d.uniforms[v],x),m.setValue(x)}else if(m.type===n.SAMPLER_CUBE){var x=this.allocTexUnit();this.texture.setTextureCube(d.uniforms[v],x),m.setValue(x)}else m.set(d.uniforms[v])}}if(l.type===zen3d.OBJECT_TYPE.SKINNED_MESH&&this.uploadSkeleton(_,l,f.id),d.acceptLight&&this.uploadLights(_,o,l.receiveShadow,t,f.id),this.setStates(d),l.type===zen3d.OBJECT_TYPE.POINT)r.drawArrays(r.POINTS,0,p.getVerticesCount());else if(l.type===zen3d.OBJECT_TYPE.LINE)s.setLineWidth(d.lineWidth),r.drawArrays(r.LINE_STRIP,0,p.getVerticesCount());else if(l.type===zen3d.OBJECT_TYPE.LINE_LOOP)s.setLineWidth(d.lineWidth),r.drawArrays(r.LINE_LOOP,0,p.getVerticesCount());else if(l.type===zen3d.OBJECT_TYPE.LINE_SEGMENTS)s.setLineWidth(d.lineWidth),r.drawArrays(r.LINES,0,p.getVerticesCount());else if(l.type===zen3d.OBJECT_TYPE.CANVAS2D)for(var w=0,b=0;b<l.drawArray.length;b++){var S=l.drawArray[b],x=this.allocTexUnit();this.texture.setTexture2D(S.texture,x),_.spriteTexture.setValue(x),r.drawElements(r.TRIANGLES,6*S.count,r.UNSIGNED_SHORT,2*w),w+=6*S.count,this._usedTextureUnits=0}else r.drawElements(r.TRIANGLES,p.getIndicesCount(),r.UNSIGNED_SHORT,0);this._usedTextureUnits=0}};var s=new zen3d.Vector3,o=new zen3d.Quaternion,u=new zen3d.Vector3;r.prototype.renderSprites=function(e){if(0!==this.cache.sprites.length){var t=this.cache.camera,i=this.cache.fog,n=this.gl,r=this.state,a=zen3d.Sprite.geometry,h=e[0].material,c=zen3d.getProgram(n,this,h);r.setProgram(c),this.geometry.setGeometry(a),this.setupVertexAttributes(c,a);var l=c.uniforms;l.projectionMatrix.setValue(t.projectionMatrix.elements);var d=0;i?(l.fogColor.setValue(i.color.r,i.color.g,i.color.b),i.fogType===zen3d.FOG_TYPE.NORMAL?(l.fogNear.setValue(i.near),l.fogFar.setValue(i.far),l.fogType.setValue(1),d=1):i.fogType===zen3d.FOG_TYPE.EXP2&&(l.fogDensity.setValue(i.density),l.fogType.setValue(2),d=2)):(l.fogType.setValue(0),d=0);for(var p=[],f=0,_=e.length;f<_;f++){var v=e[f].object,h=v.material;l.alphaTest.setValue(0),l.viewMatrix.setValue(t.viewMatrix.elements),l.modelMatrix.setValue(v.worldMatrix.elements),v.worldMatrix.decompose(s,o,u),p[0]=u.x,p[1]=u.y;var m=0;i&&h.fog&&(m=d),l.fogType.setValue(m),h.diffuseMap,l.uvOffset.setValue(0,0),l.uvScale.setValue(1,1),l.opacity.setValue(h.opacity),l.color.setValue(h.diffuse.r,h.diffuse.g,h.diffuse.b),l.rotation.setValue(h.rotation),l.scale.setValue(p[0],p[1]),this.setStates(h);var g=this.allocTexUnit();this.texture.setTexture2D(h.diffuseMap,g),l.map.setValue(g),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),this._usedTextureUnits=0}}},r.prototype.renderParticles=function(e){if(0!==this.cache.particles.length)for(var t=this.cache.camera,i=this.gl,n=this.state,r=0,a=e.length;r<a;r++){var s=e[r].object,o=e[r].geometry,u=e[r].material,h=zen3d.getProgram(i,this,u);n.setProgram(h),this.geometry.setGeometry(o),this.setupVertexAttributes(h,o);var c=h.uniforms;c.uTime.setValue(s.time),c.uScale.setValue(1),c.u_Projection.setValue(t.projectionMatrix.elements),c.u_View.setValue(t.viewMatrix.elements),c.u_Model.setValue(s.worldMatrix.elements);var l=this.allocTexUnit();this.texture.setTexture2D(s.particleNoiseTex,l),c.tNoise.setValue(l);var l=this.allocTexUnit();this.texture.setTexture2D(s.particleSpriteTex,l),c.tSprite.setValue(l),this.setStates(u),i.drawArrays(i.POINTS,0,o.getVerticesCount()),this._usedTextureUnits=0}},r.prototype.uploadSkeleton=function(e,t,i){if(t.skeleton&&t.skeleton.bones.length>0){var n=t.skeleton,r=this.gl;if(this.capabilities.maxVertexTextures>0&&this.capabilities.floatTextures){if(void 0===n.boneTexture){var a=Math.sqrt(4*n.bones.length);a=zen3d.nextPowerOfTwo(Math.ceil(a)),a=Math.max(4,a);var s=new Float32Array(a*a*4);s.set(n.boneMatrices);var o=new zen3d.TextureData(s,a,a);n.boneMatrices=s,n.boneTexture=o,n.boneTextureSize=a}var u=this.allocTexUnit();this.texture.setTexture2D(n.boneTexture,u),e.boneTexture&&e.boneTexture.setValue(u),e.boneTextureSize&&e.boneTextureSize.setValue(n.boneTextureSize)}else{var h=r.getUniformLocation(i,"boneMatrices");r.uniformMatrix4fv(h,!1,n.boneMatrices)}}};var h=[],c=[],l=[];r.prototype.uploadLights=function(e,t,i,n,r){for(var s=this.gl,o=0,u=0,d=0,p=0;p<t.ambientsNum;p++){var f=t.ambients[p],_=f.intensity,v=f.color;o+=v.r*_,u+=v.g*_,d+=v.b*_}t.ambientsNum>0&&e.u_AmbientLightColor.setValue(o,u,d,1);for(var p=0;p<t.directsNum;p++){var f=t.directs[p],_=f.intensity;f.getWorldDirection(a),a.transformDirection(n.viewMatrix);var v=f.color,m=e["u_Directional["+p+"].direction"],g=e["u_Directional["+p+"].intensity"],y=e["u_Directional["+p+"].color"];m.setValue(a.x,a.y,a.z),g.setValue(_),y.setValue(v.r,v.g,v.b,1);if(e["u_Directional["+p+"].shadow"].setValue(f.castShadow?1:0),i){e["u_Directional["+p+"].shadowBias"].setValue(f.shadow.bias);e["u_Directional["+p+"].shadowRadius"].setValue(f.shadow.radius);e["u_Directional["+p+"].shadowMapSize"].setValue(f.shadow.mapSize.x,f.shadow.mapSize.y);e["directionalShadowMatrix["+p+"]"].setValue(f.shadow.matrix.elements);var T=this.allocTexUnit();this.texture.setTexture2D(f.shadow.map,T),h.push(T)}}if(h.length>0){var E=e["directionalShadowMap[0]"];s.uniform1iv(E.location,h),h.length=0}for(var p=0;p<t.pointsNum;p++){var f=t.points[p];a.setFromMatrixPosition(f.worldMatrix).applyMatrix4(n.viewMatrix);var _=f.intensity,v=f.color,x=f.distance,M=f.decay;e["u_Point["+p+"].position"].setValue(a.x,a.y,a.z);e["u_Point["+p+"].intensity"].setValue(_);e["u_Point["+p+"].color"].setValue(v.r,v.g,v.b,1);e["u_Point["+p+"].distance"].setValue(x);e["u_Point["+p+"].decay"].setValue(M);if(e["u_Point["+p+"].shadow"].setValue(f.castShadow?1:0),i){e["u_Point["+p+"].shadowBias"].setValue(f.shadow.bias);e["u_Point["+p+"].shadowRadius"].setValue(f.shadow.radius);e["u_Point["+p+"].shadowMapSize"].setValue(f.shadow.mapSize.x,f.shadow.mapSize.y);var T=this.allocTexUnit();this.texture.setTextureCube(f.shadow.map,T),c.push(T)}}if(c.length>0){var z=e["pointShadowMap[0]"];s.uniform1iv(z.location,c),c.length=0}for(var p=0;p<t.spotsNum;p++){var f=t.spots[p];a.setFromMatrixPosition(f.worldMatrix).applyMatrix4(n.viewMatrix);e["u_Spot["+p+"].position"].setValue(a.x,a.y,a.z);var _=f.intensity,v=f.color,x=f.distance,M=f.decay;f.getWorldDirection(a),a.transformDirection(n.viewMatrix);e["u_Spot["+p+"].direction"].setValue(a.x,a.y,a.z);e["u_Spot["+p+"].intensity"].setValue(_);e["u_Spot["+p+"].color"].setValue(v.r,v.g,v.b,1);e["u_Spot["+p+"].distance"].setValue(x);e["u_Spot["+p+"].decay"].setValue(M);var w=Math.cos(f.angle),b=Math.cos(f.angle*(1-f.penumbra));e["u_Spot["+p+"].coneCos"].setValue(w);e["u_Spot["+p+"].penumbraCos"].setValue(b);if(e["u_Spot["+p+"].shadow"].setValue(f.castShadow?1:0),i){e["u_Spot["+p+"].shadowBias"].setValue(f.shadow.bias);e["u_Spot["+p+"].shadowRadius"].setValue(f.shadow.radius);e["u_Spot["+p+"].shadowMapSize"].setValue(f.shadow.mapSize.x,f.shadow.mapSize.y);e["spotShadowMatrix["+p+"]"].setValue(f.shadow.matrix.elements);var T=this.allocTexUnit();this.texture.setTexture2D(f.shadow.map,T),l.push(T)}}if(l.length>0){var S=e["spotShadowMap[0]"];s.uniform1iv(S.location,l),l.length=0}},r.prototype.setStates=function(n){var r=this.gl,a=this.state;n.transparent?a.setBlend(n.blending,n.premultipliedAlpha):a.setBlend(t.NONE),n.depthTest?(a.enable(r.DEPTH_TEST),a.depthMask(n.depthWrite)):a.disable(r.DEPTH_TEST),a.setCullFace(n.side===i.DOUBLE?e.NONE:e.BACK),a.setFlipSided(n.side===i.BACK)},r.prototype.setRenderTarget=function(e){var t=this.gl;if(!e)return void(this._currentRenderTarget===e||(t.bindFramebuffer(t.FRAMEBUFFER,null),this._currentRenderTarget=null,this.state.viewport(this._currentViewport.x,this._currentViewport.y,this._currentViewport.z,this._currentViewport.w)));var i=void 0!==e.activeCubeFace;if(this._currentRenderTarget!==e)i?this.texture.setRenderTargetCube(e):this.texture.setRenderTarget2D(e),this._currentRenderTarget=e;else if(i){var n=this.properties.get(e.texture);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,0)}this.state.viewport(0,0,e.width,e.height)},r.prototype.getCurrentRenderTarget=function(){return this._currentRenderTarget},r.prototype.clear=function(e,t,i){var n=this.gl,r=0;(void 0===e||e)&&(r|=n.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=n.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=n.STENCIL_BUFFER_BIT),n.clear(r)},r.prototype.allocTexUnit=function(){var e=this._usedTextureUnits;return e>=this.capabilities.maxTextures&&console.warn("trying to use "+e+" texture units while this GPU supports only "+this.capabilities.maxTextures),this._usedTextureUnits+=1,e},r.prototype.setupVertexAttributes=function(e,t){var i=this.gl,n=e.attributes;for(var r in n){var a=n[r],s=t.vertexFormat[r];s?(a.count!==s.size&&console.warn("Renderer: attribute "+r+" size not match!"),i.vertexAttribPointer(a.location,a.count,a.format,s.normalized,4*s.stride,4*s.offset),i.enableVertexAttribArray(a.location)):console.warn("Renderer: attribute "+r+" not found!")}},zen3d.Renderer=r}(),function(){var e=zen3d.OBJECT_TYPE,t=zen3d.LIGHT_TYPE,i=function(){this.opaqueObjects=new Array,this.transparentObjects=new Array,this.canvas2dObjects=new Array,this.shadowObjects=new Array,this.sprites=new Array,this.particles=new Array,this.lights={ambients:[],directs:[],points:[],spots:[],shadows:[],ambientsNum:0,directsNum:0,pointsNum:0,spotsNum:0,shadowsNum:0,totalNum:0},this.camera=null,this.fog=null},n=new zen3d.Vector3,r=new zen3d.Frustum,a=new zen3d.Matrix4,s=new zen3d.Sphere;i.prototype.cacheScene=function(e,t){this.camera=t,this.fog=e.fog,this.cacheObject(e)},i.prototype.cacheObject=function(i){var o=this.camera;switch(i.type){case e.POINT:case e.LINE:case e.LINE_LOOP:case e.LINE_SEGMENTS:case e.CANVAS2D:case e.MESH:case e.SKINNED_MESH:if(i.frustumCulled){s.copy(i.geometry.boundingSphere).applyMatrix4(i.worldMatrix),a.multiplyMatrices(o.projectionMatrix,o.viewMatrix),r.setFromMatrix(a);var u=r.intersectsSphere(s);if(!u)break}var h,c=i.material;h=i.type==e.CANVAS2D?this.canvas2dObjects:c.transparent?this.transparentObjects:this.opaqueObjects,n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(o.viewMatrix).applyMatrix4(o.projectionMatrix),h.push({object:i,geometry:i.geometry,material:i.material,z:n.z}),i.castShadow&&this.shadowObjects.push(i);break;case e.SPRITE:if(i.frustumCulled){s.center.set(0,0,0),s.radius=.7071067811865476,s.applyMatrix4(i.worldMatrix),a.multiplyMatrices(o.projectionMatrix,o.viewMatrix),r.setFromMatrix(a);var u=r.intersectsSphere(s);if(!u)break}var h=this.sprites;n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(o.viewMatrix).applyMatrix4(o.projectionMatrix),h.push({object:i,material:i.material,z:n.z});break;case e.PARTICLE:var h=this.particles;n.setFromMatrixPosition(i.worldMatrix),n.applyMatrix4(o.viewMatrix).applyMatrix4(o.projectionMatrix),h.push({object:i,geometry:i.geometry,material:i.material,z:n.z});break;case e.LIGHT:var l=this.lights;i.lightType==t.AMBIENT?(l.ambients.push(i),l.ambientsNum++):i.lightType==t.DIRECT?(l.directs.push(i),l.directsNum++):i.lightType==t.POINT?(l.points.push(i),l.pointsNum++):i.lightType==t.SPOT&&(l.spots.push(i),l.spotsNum++),i.castShadow&&i.lightType!==t.AMBIENT&&(l.shadows.push(i),l.shadowsNum++),l.totalNum++;break;case e.CAMERA:break;case e.SCENE:break;case e.GROUP:break;default:console.log("undefined object type")}if(e.CANVAS2D!==i.type)for(var d=i.children,p=0,f=d.length;p<f;p++)this.cacheObject(d[p])},i.prototype.sort=function(){this.opaqueObjects.sort(function(e,t){return e.z-t.z}),this.transparentObjects.sort(function(e,t){var i=e.z;return t.z-i}),this.sprites.sort(function(e,t){var i=e.z;return t.z-i}),this.particles.sort(function(e,t){var i=e.z;return t.z-i})},i.prototype.clear=function(){this.transparentObjects.length=0,this.opaqueObjects.length=0,this.canvas2dObjects.length=0,this.shadowObjects.length=0,this.sprites.length=0,this.particles.length=0;var e=this.lights;e.ambients.length=0,e.directs.length=0,e.points.length=0,e.spots.length=0,e.shadows.length=0,e.ambientsNum=0,e.directsNum=0,e.pointsNum=0,e.spotsNum=0,e.shadowsNum=0,e.totalNum=0},zen3d.RenderCache=i}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.width=t,this.height=i,this.viewport=new zen3d.Vector4(0,0,t,i),this.depthBuffer=!0,this.stencilBuffer=!0};zen3d.inherit(e,zen3d.EventDispatcher),e.prototype.resize=function(e,t){this.width===e&&this.height===t||this.dispose(),this.width=e,this.height=t,this.viewport.copy(0,0,e,t)},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},zen3d.RenderTargetBase=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.texture=new zen3d.Texture2D};zen3d.inherit(e,zen3d.RenderTargetBase),zen3d.RenderTarget2D=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.texture=new zen3d.TextureCube,this.activeCubeFace=0};zen3d.inherit(e,zen3d.RenderTargetBase),zen3d.RenderTargetCube=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.verticesArray=new Array,this.indicesArray=new Array,this.vertexSize=17,this.vertexFormat={a_Position:{size:3,normalized:!1,stride:17,offset:0},a_Normal:{size:3,normalized:!1,stride:17,offset:3},a_Uv:{size:2,normalized:!1,stride:17,offset:13}},this.usageType=zen3d.WEBGL_BUFFER_USAGE.STATIC_DRAW,this.boundingBox=new zen3d.Box3,this.boundingSphere=new zen3d.Sphere,this.dirty=!0,this.dirtyRange={enable:!1,start:0,count:0}};zen3d.inherit(e,zen3d.EventDispatcher),e.prototype.computeBoundingBox=function(){this.boundingBox.setFromArray(this.verticesArray,this.vertexSize)},e.prototype.computeBoundingSphere=function(){this.boundingSphere.setFromArray(this.verticesArray,this.vertexSize)},e.prototype.getVerticesCount=function(){return this.verticesArray.length/this.vertexSize},e.prototype.getIndicesCount=function(){return this.indicesArray.length},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"}),this.dirty=!0},zen3d.Geometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i,n,void 0===r||r)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){this.verticesArray.push(.5*-e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,0,0,-10,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,0,0,10,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*-t,.5*i,0,0,10,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*-t,.5*i,0,-10,0,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*-t,.5*-i,0,-10,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*-t,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*t,.5*-i,10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*e,.5*t,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*-t,.5*i,10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*-t,.5*-i,10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,1,1,0,0,.5*e,.5*t,.5*i,0,10,0,1,0,0,1,1,1,1,0,1,0,0,.5*e,.5*t,.5*-i,0,10,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*t,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0,.5*-e,.5*-t,.5*-i,-10,0,0,1,0,0,1,1,1,1,1,0,0,0,.5*-e,.5*-t,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*-t,.5*i,-10,0,0,1,0,0,1,1,1,1,1,1,0,0,.5*-e,.5*t,.5*i,-10,0,0,1,0,0,1,1,1,1,0,1,0,0,.5*-e,.5*t,.5*-i,-10,0,0,1,0,0,1,1,1,1,0,0,0,0),n?this.indicesArray.push(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35):this.indicesArray.push(0,2,1,3,5,4,6,8,7,9,11,10,12,14,13,15,17,16,18,20,19,21,23,22,24,26,25,27,29,28,30,32,31,33,35,34),this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.CubeGeometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i,n||1,r||1)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){for(var r=i+1,a=n+1,s=this.verticesArray,o=this.indicesArray,u=0,h=0,c=0;c<a;c++)for(var l=0;l<r;l++){var d=(l/i-.5)*e,p=(c/n-.5)*t;if(s[u++]=d,s[u++]=0,s[u++]=p,s[u++]=0,s[u++]=1,s[u++]=0,s[u++]=1,s[u++]=0,s[u++]=0,s[u++]=1,s[u++]=1,s[u++]=1,s[u++]=1,s[u++]=l/i*1,s[u++]=1*(1-c/n),s[u++]=l/i*1,s[u++]=1*(1-c/n),l!=i&&c!=n){base=l+c*r;o[h++]=1*base,o[h++]=1*(base+r),o[h++]=1*(base+r+1),o[h++]=1*base,o[h++]=1*(base+r+1),o[h++]=1*(base+1)}}this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.PlaneGeometry=e}(),function(){var e=function(t,i,n,r){e.superClass.constructor.call(this),this.buildGeometry(t,i||20,n||20,void 0===r||r)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n){var r=0,a=0,s=0,o=17,u=o-9,h=this.verticesArray,c=this.indicesArray,l=0,d=0,p=0,f=0,_=0,v=0;for(a=0;a<=i;++a){l=d;var m=Math.PI*a/i,g=-e*Math.cos(m),y=e*Math.sin(m);for(r=0;r<=t;++r){var T=2*Math.PI*r/t,E=y*Math.cos(T),x=y*Math.sin(T),M=1/Math.sqrt(E*E+x*x+g*g),z=Math.sqrt(x*x+E*E);if(_=0,v=z>.007?E/z:0,p=-g,f=x,r==t?(h[d++]=h[l],h[d++]=h[l+1],h[d++]=h[l+2],h[d++]=E*M,h[d++]=p*M,h[d++]=f*M,h[d++]=z>.007?-x/z:1,h[d++]=_,h[d++]=v,h[d+0]=1,h[d+1]=1,h[d+2]=1,h[d+3]=1):(h[d++]=E,h[d++]=p,h[d++]=f,h[d++]=E*M,h[d++]=p*M,h[d++]=f*M,h[d++]=z>.007?-x/z:1,h[d++]=_,h[d++]=v,h[d]=1,h[d+1]=1,h[d+2]=1,h[d+3]=1),r>0&&a>0){var w=(t+1)*a+r,b=(t+1)*a+r-1,S=(t+1)*(a-1)+r-1,A=(t+1)*(a-1)+r;a==i?(h[d-9]=h[l],h[d-8]=h[l+1],h[d-7]=h[l+2],n?(c[s++]=w,c[s++]=S,c[s++]=A):(c[s++]=w,c[s++]=A,c[s++]=S)):1==a?n?(c[s++]=w,c[s++]=b,c[s++]=S):(c[s++]=w,c[s++]=S,c[s++]=b):n?(c[s++]=w,c[s++]=S,c[s++]=A,c[s++]=w,c[s++]=b,c[s++]=S):(c[s++]=w,c[s++]=A,c[s++]=S,c[s++]=w,c[s++]=S,c[s++]=b)}d+=u}}var o=17,u=o-2,d=13;for(a=0;a<=i;++a)for(r=0;r<=t;++r)h[d++]=r/t,h[d++]=a/i,d+=u;this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.SphereGeometry=e}(),function(){var e=function(t,i,n,r,a,s,o,u){e.superClass.constructor.call(this),t=void 0!==t?t:20,i=void 0!==i?i:20,n=void 0!==n?n:100,r=Math.floor(r)||8,a=Math.floor(a)||1,s=void 0!==s&&s,o=void 0!==o?o:0,u=void 0!==u?u:2*Math.PI,this.buildGeometry(t,i,n,r,a,s,o,u)};zen3d.inherit(e,zen3d.Geometry),e.prototype.buildGeometry=function(e,t,i,n,r,a,s,o){function u(i){var r,a,u,p=new zen3d.Vector2,f=new zen3d.Vector3,_=i===!0?e:t,v=i===!0?1:-1;for(a=d,r=1;r<=n;r++)h.push(0,l*v,0,0,v,0,1,0,0,1,1,1,1,.5,.5,0,0),d++;for(u=d,r=0;r<=n;r++){var m=r/n,g=m*o+s,y=Math.cos(g),T=Math.sin(g);f.x=_*T,f.y=l*v,f.z=_*y,p.x=.5*y+.5,p.y=.5*T*v+.5,h.push(f.x,f.y,f.z,0,v,0,1,0,0,1,1,1,1,p.x,p.y,0,0),d++}for(r=0;r<n;r++){var E=a+r,x=u+r;i===!0?c.push(x,x+1,E):c.push(x+1,x,E)}}var h=this.verticesArray,c=this.indicesArray,l=i/2,d=0,p=[];!function(){var a,u,f=new zen3d.Vector3,_=new zen3d.Vector3,v=(t-e)/i;for(u=0;u<=r;u++){var m=[],g=u/r,y=g*(t-e)+e;for(a=0;a<=n;a++){var T=a/n,E=T*o+s,x=Math.sin(E),M=Math.cos(E);_.x=y*x,_.y=-g*i+l,_.z=y*M,f.set(x,v,M).normalize(),h.push(_.x,_.y,_.z,f.x,f.y,f.z,1,0,0,1,1,1,1,T,1-g,0,0),m.push(d++)}p.push(m)}for(a=0;a<n;a++)for(u=0;u<r;u++){var z=p[u][a],w=p[u+1][a],b=p[u+1][a+1],S=p[u][a+1];c.push(z,w,S),c.push(w,b,S)}}(),a===!1&&(e>0&&u(!0),t>0&&u(!1)),this.computeBoundingBox(),this.computeBoundingSphere()},zen3d.CylinderGeometry=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.uuid=zen3d.generateUUID(),this.textureType="",this.border=0,this.pixelFormat=zen3d.WEBGL_PIXEL_FORMAT.RGBA,this.pixelType=zen3d.WEBGL_PIXEL_TYPE.UNSIGNED_BYTE,this.magFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR_MIPMAP_LINEAR,this.wrapS=zen3d.WEBGL_TEXTURE_WRAP.CLAMP_TO_EDGE,this.wrapT=zen3d.WEBGL_TEXTURE_WRAP.CLAMP_TO_EDGE,this.anisotropy=1,this.generateMipmaps=!0,this.encoding=zen3d.TEXEL_ENCODING_TYPE.LINEAR,this.version=0};zen3d.inherit(e,zen3d.EventDispatcher),e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"}),this.version=0},zen3d.TextureBase=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.textureType=zen3d.WEBGL_TEXTURE_TYPE.TEXTURE_2D,this.image=null,this.mipmaps=[]};zen3d.inherit(e,zen3d.TextureBase),e.fromImage=function(t){var i=new e;return i.image=t,i.version++,i},e.fromSrc=function(t){var i=new e,n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);return(t.search(/\.(tga)$/)>0||0===t.search(/^data\:image\/tga/)?new zen3d.TGALoader:new zen3d.ImageLoader).load(t,function(e){i.pixelFormat=n?zen3d.WEBGL_PIXEL_FORMAT.RGB:zen3d.WEBGL_PIXEL_FORMAT.RGBA,i.image=e,i.version++}),i},zen3d.Texture2D=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.textureType=zen3d.WEBGL_TEXTURE_TYPE.TEXTURE_CUBE_MAP,this.images=[]};zen3d.inherit(e,zen3d.TextureBase),e.fromImage=function(t){for(var i=new e,n=i.images,r=0;r<6;r++)n[r]=t[r];return i.version++,i},e.fromSrc=function(t){function i(e){if(e&&(a.push(e),h++),h>=6)return void n();(u?new zen3d.TGALoader:new zen3d.ImageLoader).load(t[h],i)}function n(){r.pixelFormat=o?zen3d.WEBGL_PIXEL_FORMAT.RGB:zen3d.WEBGL_PIXEL_FORMAT.RGBA,r.version++}var r=new e,a=r.images,s=t[0],o=s.search(/\.(jpg|jpeg)$/)>0||0===s.search(/^data\:image\/jpeg/),u=s.search(/\.(tga)$/)>0||0===s.search(/^data\:image\/tga/),h=0;return i(),r},zen3d.TextureCube=e}(),function(){var e=function(t,i,n){e.superClass.constructor.call(this),this.image={data:t,width:i,height:n},this.pixelType=zen3d.WEBGL_PIXEL_TYPE.FLOAT,this.magFilter=zen3d.WEBGL_TEXTURE_FILTER.NEAREST,this.minFilter=zen3d.WEBGL_TEXTURE_FILTER.NEAREST,this.generateMipmaps=!1};zen3d.inherit(e,zen3d.Texture2D),e.prototype.isDataTexture=!0,zen3d.TextureData=e}(),function(){var e=function(){this.type="",this.opacity=1,this.transparent=!1,this.premultipliedAlpha=!1,this.diffuse=new zen3d.Color3(16777215),this.diffuseMap=null,this.normalMap=null,this.bumpMap=null,this.bumpScale=1,this.envMap=null,this.envMapIntensity=1,this.emissive=new zen3d.Color3(0),this.emissiveMap=null,this.emissiveIntensity=1,this.blending=zen3d.BLEND_TYPE.NORMAL,this.depthTest=!0,this.depthWrite=!0,this.side=zen3d.DRAW_SIDE.FRONT,this.shading=zen3d.SHADING_TYPE.SMOOTH_SHADING,this.acceptLight=!1};zen3d.Material=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.BASIC};zen3d.inherit(e,zen3d.Material),zen3d.BasicMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LAMBERT,this.acceptLight=!0};zen3d.inherit(e,zen3d.Material),zen3d.LambertMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PHONG,this.shininess=30,this.specular=new zen3d.Color3(6710886),this.specularMap=null,this.acceptLight=!0};zen3d.inherit(e,zen3d.Material),zen3d.PhongMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.CUBE,this.cubeMap=null};zen3d.inherit(e,zen3d.Material),zen3d.CubeMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.POINT,this.size=1,this.sizeAttenuation=!0};zen3d.inherit(e,zen3d.Material),zen3d.PointsMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),
this.type=zen3d.MATERIAL_TYPE.LINE_BASIC,this.lineWidth=1};zen3d.inherit(e,zen3d.Material),zen3d.LineBasicMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.LINE_DASHED,this.lineWidth=1,this.scale=1,this.dashSize=3,this.gapSize=1};zen3d.inherit(e,zen3d.Material),zen3d.LineDashedMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.SPRITE,this.rotation=0,this.fog=!1};zen3d.inherit(e,zen3d.Material),zen3d.SpriteMaterial=e}(),function(){var e=function(t,i,n){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.SHADER,this.vertexShader=t||"",this.fragmentShader=i||"",this.uniforms=n||{}};zen3d.inherit(e,zen3d.Material),zen3d.ShaderMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.DEPTH,this.blending=zen3d.BLEND_TYPE.NONE,this.depthTest=!1};zen3d.inherit(e,zen3d.Material),zen3d.DepthMaterial=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.MATERIAL_TYPE.PARTICLE,this.transparent=!0,this.blending=zen3d.BLEND_TYPE.ADD,this.depthTest=!0,this.depthWrite=!1};zen3d.inherit(e,zen3d.Material),zen3d.ParticleMaterial=e}(),function(){var e=function(){this.name="",this.type="",this.position=new zen3d.Vector3,this.scale=new zen3d.Vector3(1,1,1);var e=this.euler=new zen3d.Euler,t=this.quaternion=new zen3d.Quaternion;e.onChange(function(){t.setFromEuler(e,!1)}),t.onChange(function(){e.setFromQuaternion(t,void 0,!1)}),this.matrix=new zen3d.Matrix4,this.worldMatrix=new zen3d.Matrix4,this.children=new Array,this.parent=null,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0};Object.defineProperties(e.prototype,{rotation:{get:function(){return this.euler},set:function(e){this.euler.copyFrom(e),this.quaternion.setFromEuler(e)}}}),e.prototype.add=function(e){this.children.push(e),e.parent=this},e.prototype.remove=function(e){var t=this.children.indexOf(e);t!==-1&&this.children.splice(t,1),e.parent=null},e.prototype.getObjectByName=function(e){return this.getObjectByProperty("name",e)},e.prototype.getObjectByProperty=function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i],a=r.getObjectByProperty(e,t);if(void 0!==a)return a}},e.prototype.updateMatrix=function(){var e=this.matrix.transform(this.position,this.scale,this.quaternion);if(this.worldMatrix.copy(e),this.parent){var t=this.parent.worldMatrix;this.worldMatrix.premultiply(t)}for(var i=this.children,n=0,r=i.length;n<r;n++)i[n].updateMatrix()},e.prototype.getWorldDirection=function(){var e=new zen3d.Vector3,t=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(e,t,i),r.set(0,0,1).applyQuaternion(t),r}}(),e.prototype.raycast=function(){},zen3d.Object3D=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.SCENE,this.fog=null};zen3d.inherit(e,zen3d.Object3D),zen3d.Scene=e}(),function(){var e=function(e,t,i){this.fogType=zen3d.FOG_TYPE.NORMAL,this.color=new zen3d.Color3(void 0!==e?e:0),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3};zen3d.Fog=e}(),function(){var e=function(e,t){this.fogType=zen3d.FOG_TYPE.EXP2,this.color=new zen3d.Color3(void 0!==e?e:0),this.density=void 0!==t?t:25e-5};zen3d.FogExp2=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.GROUP};zen3d.inherit(e,zen3d.Object3D),zen3d.Group=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.LIGHT,this.lightType="",this.color=new zen3d.Color3(16777215),this.intensity=1};zen3d.inherit(e,zen3d.Object3D),zen3d.Light=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.AMBIENT};zen3d.inherit(e,zen3d.Light),zen3d.AmbientLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.DIRECT,this.shadow=new zen3d.DirectionalLightShadow};zen3d.inherit(e,zen3d.Light),zen3d.DirectionalLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.POINT,this.decay=2,this.distance=200,this.shadow=new zen3d.PointLightShadow};zen3d.inherit(e,zen3d.Light),zen3d.PointLight=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.lightType=zen3d.LIGHT_TYPE.SPOT,this.decay=2,this.distance=200,this.penumbra=0,this.angle=Math.PI/6,this.shadow=new zen3d.SpotLightShadow};zen3d.inherit(e,zen3d.Light),zen3d.SpotLight=e}(),function(){var e=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4;var e=new zen3d.Vector2(512,512);this.renderTarget=new zen3d.RenderTarget2D(e.x,e.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=t,this.mapSize=e,this.bias=3e-4,this.radius=2,this.windowSize=500,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};e.prototype.update=function(e){this._updateCamera(e),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},e.prototype._updateCamera=function(e){var t=this.camera,i=this._lookTarget;e.getWorldDirection(this._lookTarget),t.position.setFromMatrixPosition(e.worldMatrix),i.set(i.x+t.position.x,i.y+t.position.y,i.z+t.position.z),t.setLookAt(i,this._up),t.updateMatrix(),t.viewMatrix.getInverse(t.worldMatrix);var n=this.windowSize/2;t.setOrtho(-n,n,-n,n,1,1e3)},e.prototype._updateMatrix=function(){var e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)},zen3d.DirectionalLightShadow=e}(),function(){var e=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4;var e=new zen3d.Vector2(512,512);this.renderTarget=new zen3d.RenderTarget2D(e.x,e.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=t,this.mapSize=e,this.bias=3e-4,this.radius=2,this._lookTarget=new zen3d.Vector3,this._up=new zen3d.Vector3(0,1,0)};e.prototype.update=function(e){this._updateCamera(e),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},e.prototype._updateCamera=function(e){var t=this.camera,i=this._lookTarget;e.getWorldDirection(this._lookTarget),t.position.setFromMatrixPosition(e.worldMatrix),i.set(i.x+t.position.x,i.y+t.position.y,i.z+t.position.z),t.setLookAt(i,this._up),t.updateMatrix(),t.viewMatrix.getInverse(t.worldMatrix),t.setPerspective(2*e.angle,1,1,1e3)},e.prototype._updateMatrix=function(){var e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)},zen3d.SpotLightShadow=e}(),function(){var e=function(){this.camera=new zen3d.Camera,this.matrix=new zen3d.Matrix4;var e=new zen3d.Vector2(512,512);this.renderTarget=new zen3d.RenderTargetCube(e.x,e.y);var t=this.renderTarget.texture;t.generateMipmaps=!1,t.minFilter=zen3d.WEBGL_TEXTURE_FILTER.LINEAR,this.map=t,this.mapSize=e,this.bias=3e-4,this.radius=2,this._targets=[new zen3d.Vector3(1,0,0),new zen3d.Vector3(-1,0,0),new zen3d.Vector3(0,1,0),new zen3d.Vector3(0,-1,0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,-1)],this._ups=[new zen3d.Vector3(0,-1,0),new zen3d.Vector3(0,-1,0),new zen3d.Vector3(0,0,1),new zen3d.Vector3(0,0,-1),new zen3d.Vector3(0,-1,0),new zen3d.Vector3(0,-1,0)],this._lookTarget=new zen3d.Vector3};e.prototype.update=function(e,t){this._updateCamera(e,t),this._updateMatrix(),this.mapSize.x===this.renderTarget.width&&this.mapSize.y===this.renderTarget.height||this.renderTarget.resize(this.mapSize.x,this.mapSize.y)},e.prototype._updateCamera=function(e,t){var i=this.camera,n=this._lookTarget,r=this._targets,a=this._ups;i.position.setFromMatrixPosition(e.worldMatrix),n.set(r[t].x+i.position.x,r[t].y+i.position.y,r[t].z+i.position.z),i.setLookAt(n,a[t]),i.updateMatrix(),i.viewMatrix.getInverse(i.worldMatrix),i.setPerspective(.5*Math.PI,1,1,1e3)},e.prototype._updateMatrix=function(){var e=this.matrix,t=this.camera;e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.viewMatrix)},zen3d.PointLightShadow=e}(),function(){var e=function(){e.superClass.constructor.call(this),this.type=zen3d.OBJECT_TYPE.CAMERA,this.viewMatrix=new zen3d.Matrix4,this.projectionMatrix=new zen3d.Matrix4};zen3d.inherit(e,zen3d.Object3D),e.prototype.setLookAt=function(e,t){var i=this.position,n=new zen3d.Vector3;i.subtract(e,n),n.normalize();var r=new zen3d.Vector3;r.crossVectors(t,n),r.normalize();var a=new zen3d.Vector3;a.crossVectors(n,r),this.quaternion.setFromRotationMatrix(zen3d.helpMatrix.set(r.x,a.x,n.x,0,r.y,a.y,n.y,0,r.z,a.z,n.z,0,0,0,0,1))},e.prototype.setOrtho=function(e,t,i,n,r,a){this.projectionMatrix.set(2/(t-e),0,0,-(t+e)/(t-e),0,2/(n-i),0,-(n+i)/(n-i),0,0,-2/(a-r),-(a+r)/(a-r),0,0,0,1)},e.prototype.setPerspective=function(e,t,i,n){this.projectionMatrix.set(1/(t*Math.tan(e/2)),0,0,0,0,1/Math.tan(e/2),0,0,0,0,-(n+i)/(n-i),-2*n*i/(n-i),0,0,-1,0)},e.prototype.getWorldDirection=function(){var e=new zen3d.Vector3,t=new zen3d.Quaternion,i=new zen3d.Vector3;return function(n){var r=n||new zen3d.Vector3;return this.worldMatrix.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),r}}(),zen3d.Camera=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.geometry=t,this.material=i,this.type=zen3d.OBJECT_TYPE.MESH};zen3d.inherit(e,zen3d.Object3D),e.prototype.raycast=function(){function e(e,t,i,n,r,a,o){return zen3d.Triangle.barycoordFromPoint(e,t,i,n,s),r.multiplyScalar(s.x),a.multiplyScalar(s.y),o.multiplyScalar(s.z),r.add(a).add(o),r.clone()}function t(e,t,i,n,r,a,s){e.material;if(null===i.intersectTriangle(a,r,n,!0,s))return null;f.copy(s),f.applyMatrix4(e.worldMatrix);var o=t.ray.origin.distanceTo(f);return o<t.near||o>t.far?null:{distance:o,point:f.clone(),object:e}}var i=new zen3d.Sphere,n=new zen3d.Box3,r=new zen3d.Matrix4,a=new zen3d.Ray,s=new zen3d.Vector3,o=new zen3d.Vector3,u=new zen3d.Vector3,h=new zen3d.Vector3,c=new zen3d.Vector2,l=new zen3d.Vector2,d=new zen3d.Vector2,p=new zen3d.Vector3,f=new zen3d.Vector3;return function(s,f){var _=this.geometry,v=this.worldMatrix;if(i.copy(_.boundingSphere),i.applyMatrix4(v),s.ray.intersectsSphere(i)&&(n.copy(_.boundingBox),n.applyMatrix4(v),s.ray.intersectsBox(n))){r.getInverse(v),a.copy(s.ray).applyMatrix4(r);for(var m,g,y,T=_.indicesArray,E=_.verticesArray,x=0;x<T.length;x+=3){m=T[x],g=T[x+1],y=T[x+2],o.fromArray(E,m*_.vertexSize),u.fromArray(E,g*_.vertexSize),h.fromArray(E,y*_.vertexSize);var M=t(this,s,a,o,u,h,p);M&&(c.fromArray(E,m*_.vertexSize+13),l.fromArray(E,g*_.vertexSize+13),d.fromArray(E,y*_.vertexSize+13),M.uv=e(p,o,u,h,c,l,d),M.face=[m,g,y],M.faceIndex=m,f.push(M))}}}}(),zen3d.Mesh=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.type=zen3d.OBJECT_TYPE.SKINNED_MESH,this.skeleton=void 0};zen3d.inherit(e,zen3d.Mesh),e.prototype.updateMatrix=function(){e.superClass.updateMatrix.call(this),this.skeleton&&this.skeleton.updateBones()},zen3d.SkinnedMesh=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.geometry=t,this.material=i,this.type=zen3d.OBJECT_TYPE.POINT};zen3d.inherit(e,zen3d.Object3D),zen3d.Points=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this),this.geometry=t,this.material=i,this.type=zen3d.OBJECT_TYPE.LINE};zen3d.inherit(e,zen3d.Object3D),e.prototype.raycast=function(){},zen3d.Line=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.type=zen3d.OBJECT_TYPE.LINE_LOOP};zen3d.inherit(e,zen3d.Line),zen3d.LineLoop=e}(),function(){var e=function(t,i){e.superClass.constructor.call(this,t,i),this.type=zen3d.OBJECT_TYPE.LINE_SEGMENTS};zen3d.inherit(e,zen3d.Line),zen3d.LineSegments=e}(),function(){var e=new zen3d.Geometry;e.verticesArray=[-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1],e.indicesArray=[0,1,2,0,2,3],e.vertexSize=4,e.vertexFormat={position:{size:2,normalized:!1,stride:4,offset:0},uv:{size:2,normalized:!1,stride:4,offset:2}};var t=function(i){t.superClass.constructor.call(this),this.geometry=e,this.material=void 0!==i?i:new zen3d.SpriteMaterial,this.type=zen3d.OBJECT_TYPE.SPRITE};zen3d.inherit(t,zen3d.Object3D),t.geometry=e,zen3d.Sprite=t}(),function(){function e(e,n,r,a){return t[0]=Math.floor(a),t[1]=Math.floor(r),t[2]=Math.floor(n),t[3]=Math.floor(e),i[0]}var t=new Uint8Array(4),i=new Float32Array(t.buffer),n=function(t){n.superClass.constructor.call(this);var t=t||{};this.maxParticleCount=t.maxParticleCount||1e4,this.particleNoiseTex=t.particleNoiseTex||null,this.particleSpriteTex=t.particleSpriteTex||null,this.geometry=new zen3d.Geometry;for(var i=this.geometry.verticesArray=[],r=0;r<this.maxParticleCount;r++)i[8*r+0]=100,i[8*r+1]=0,i[8*r+2]=0,i[8*r+3]=0,i[8*r+4]=e(128,128,0,0),i[8*r+5]=e(0,254,0,254),i[8*r+6]=1,i[8*r+7]=0;this.geometry.vertexSize=8,this.geometry.vertexFormat={particlePositionsStartTime:{size:4,normalized:!1,stride:8,offset:0},particleVelColSizeLife:{size:4,normalized:!1,stride:8,offset:4}},this.geometry.usageType=zen3d.WEBGL_BUFFER_USAGE.DYNAMIC_DRAW,this.particleCursor=0,this.time=0,this.type=zen3d.OBJECT_TYPE.PARTICLE,this.material=new zen3d.ParticleMaterial};zen3d.inherit(n,zen3d.Object3D);var r=new zen3d.Vector3,a=new zen3d.Vector3,s=0,o=0,u=new zen3d.Color3,h=0,c=0,l=0,d=0;n.prototype.spawn=function(t){var t=t||{};r=void 0!==t.position?r.copy(t.position):r.set(0,0,0),a=void 0!==t.velocity?a.copy(t.velocity):a.set(0,0,0),s=void 0!==t.positionRandomness?t.positionRandomness:0,o=void 0!==t.velocityRandomness?t.velocityRandomness:0,u=void 0!==t.color?u.copy(t.color):u.setRGB(1,1,1),h=void 0!==t.colorRandomness?t.colorRandomness:1,m=void 0!==t.turbulence?t.turbulence:1,c=void 0!==t.lifetime?t.lifetime:5,l=void 0!==t.size?t.size:10,d=void 0!==t.sizeRandomness?t.sizeRandomness:0;var i=this.particleCursor,n=this.geometry.verticesArray,p=this.geometry.vertexSize;n[i*p+0]=r.x+(Math.random()-.5)*s,n[i*p+1]=r.y+(Math.random()-.5)*s,n[i*p+2]=r.z+(Math.random()-.5)*s,n[i*p+3]=this.time+.02*(Math.random()-.5);var f=a.x+(Math.random()-.5)*o,_=a.y+(Math.random()-.5)*o,v=a.z+(Math.random()-.5)*o,m=Math.floor(254*m);f=Math.floor((f- -2)/4*250),_=Math.floor((_- -2)/4*250),v=Math.floor((v- -2)/4*250),n[i*p+4]=e(f,_,v,m);var g=254*u.r+(Math.random()-.5)*h*254,y=254*u.g+(Math.random()-.5)*h*254,T=254*u.b+(Math.random()-.5)*h*254;g>254&&(g=254),g<0&&(g=0),y>254&&(y=254),y<0&&(y=0),T>254&&(T=254),T<0&&(T=0),n[i*p+5]=e(g,y,T,254),n[i*p+6]=l+(Math.random()-.5)*d,n[i*p+7]=c,this.particleCursor++,this.particleCursor>=this.maxParticleCount?(this.particleCursor=0,this.geometry.dirty=!0,this.geometry.dirtyRange.enable=!1,this.geometry.dirtyRange.start=0,this.geometry.dirtyRange.count=0):(this.geometry.dirty=!0,this.geometry.dirtyRange.enable?this.geometry.dirtyRange.count=this.particleCursor*p-this.geometry.dirtyRange.start:(this.geometry.dirtyRange.enable=!0,this.geometry.dirtyRange.start=i*p,this.geometry.dirtyRange.count=p))},n.prototype.update=function(e){this.time=e},zen3d.ParticleContainer=n}(),function(){var e=function(){e.superClass.constructor.call(this),this.type="bone",this.offsetMatrix=new zen3d.Matrix4};zen3d.inherit(e,zen3d.Object3D),zen3d.Bone=e}(),function(){var e=function(t){e.superClass.constructor.call(this),this.type="skeleton",this.bones=t||[],this.boneMatrices=new Float32Array(16*this.bones.length),this.boneTexture=void 0,this.boneTextureSize=0};zen3d.inherit(e,zen3d.Object3D);var t=new zen3d.Matrix4;e.prototype.updateBones=function(){this.updateMatrix();for(var e=0;e<this.bones.length;e++){var i=this.bones[e];t.multiplyMatrices(i.worldMatrix,i.offsetMatrix),t.toArray(this.boneMatrices,16*e)}void 0!==this.boneTexture&&this.boneTexture.version++},zen3d.Skeleton=e}(),function(){var e=function(){this._keys=[],this._values=[]};e.prototype.addFrame=function(e,t){this._keys.push(e),this._values.push(t)},e.prototype.removeFrame=function(e){var t=this.keys.indexOf(e);t>-1&&(this._keys.splice(t,1),this._values.splice(t,1))},e.prototype.clearFrame=function(){this._keys.length=0,this._values.length=0},e.prototype.sortFrame=function(){},e.prototype.getRange=function(e,t){var i=this._getLastKeyIndex(e),n=this._keys[i],r=this._keys[i+1],a=this._values[i],s=this._values[i+1];return t=t||{key1:0,value1:0,key2:0,value2:0},t.key1=n,t.key2=r,t.value1=a,t.value2=s,t},e.prototype._getLastKeyIndex=function(e){var t,i=0,n=this._keys.length;for(t=0;t<n;t++)e>=this._keys[t]&&(i=t);return i},zen3d.KeyframeData=e}(),function(){var e={key1:0,value1:0,key2:0,value2:0},t=function(e,t){this.target=void 0,this.path=void 0,this.bind(e,t),this.data=new zen3d.KeyframeData,this._frame=0,this.interpolant=!0};t.prototype.bind=function(e,t){if(t=t.split("."),t.length>1){for(var i=e[t[0]],n=1;n<t.length-1;n++)i=i[t[n]];this.path=t[t.length-1],this.target=i}else this.path=t[0],this.target=e},Object.defineProperties(t.prototype,{frame:{get:function(){return this._frame},set:function(e){this._frame=e,this._updateValue(e)}}}),t.prototype._updateValue=function(t){this.data.getRange(t,e);var i=e.key1,n=e.key2,r=e.value1,a=e.value2;if(this.interpolant)if(void 0!==r&&void 0!==a){var s=(t-i)/(n-i);this.target[this.path]=(a-r)*s+r}else this.target[this.path]=r;else this.target[this.path]=r},zen3d.KeyframeTrack=t}(),function(){var e={key1:0,value1:0,key2:0,value2:0},t=function(e,i){t.superClass.constructor.call(this,e,i)};zen3d.inherit(t,zen3d.KeyframeTrack),t.prototype._updateValue=function(t){this.data.getRange(t,e);var i=e.key1,n=e.key2,r=e.value1,a=e.value2;if(this.interpolant)if(void 0!==r&&void 0!==a){var s=(t-i)/(n-i);this.target[this.path].slerpQuaternions(r,a,s)}else this.target[this.path].copy(r);else this.target[this.path].copy(r)},zen3d.QuaternionKeyframeTrack=t}(),function(){var e={key1:0,value1:0,key2:0,value2:0},t=function(e,i){t.superClass.constructor.call(this,e,i)};zen3d.inherit(t,zen3d.KeyframeTrack),t.prototype._updateValue=function(t){this.data.getRange(t,e);var i=e.key1,n=e.key2,r=e.value1,a=e.value2;if(this.interpolant)if(void 0!==r&&void 0!==a){var s=(t-i)/(n-i);this.target[this.path].lerpVectors(r,a,s)}else this.target[this.path].copy(r);else this.target[this.path].copy(r)},zen3d.VectorKeyframeTrack=t}(),function(){var e={key1:0,value1:0,key2:0,value2:0},t=function(e,i){t.superClass.constructor.call(this,e,i)};zen3d.inherit(t,zen3d.KeyframeTrack),t.prototype._updateValue=function(t){this.data.getRange(t,e);var i=e.key1,n=e.key2,r=e.value1,a=e.value2;if(this.interpolant)if(void 0!==r&&void 0!==a){var s=(t-i)/(n-i);this.target[this.path].lerpColors(r,a,s)}else this.target[this.path].copy(r);else this.target[this.path].copy(r)},zen3d.ColorKeyframeTrack=t}(),function(){var e=function(e){this.name=e||"",this.tracks=[],this.loop=!0,this.startFrame=0,this.endFrame=0,this.frame=0};e.prototype.update=function(e){this.frame+=e,this.frame>this.endFrame&&(this.loop?this.frame=this.startFrame:this.frame=this.endFrame),this.setFrame(this.frame)},e.prototype.setFrame=function(e){for(var t=0,i=this.tracks.length;t<i;t++)this.tracks[t].frame=e;this.frame=e},zen3d.KeyframeClip=e}(),function(){var e=function(){this._clips={},this._currentClipName=""};Object.defineProperties(e.prototype,{currentClipName:{get:function(){return this._currentClipName}},currentClip:{get:function(){return this._clips[this._currentClipName]}}}),e.prototype.add=function(e){this._clips[e.name]=e},e.prototype.remove=function(e){delete this._clips[e.name]},e.prototype.update=function(e){var t=this._clips[this._currentClipName];t&&t.update(e)},e.prototype.active=function(e){var t=this._clips[e];t?(this._currentClipName=e,t.setFrame(t.startFrame)):console.warn("KeyframeAnimation: try to active a undefind clip!")},e.prototype.getAllClipNames=function(){var e=[];for(var t in this._clips)e.push(t);return e},zen3d.KeyframeAnimation=e}(),function(){var e=function(){this.texturePath="./"};e.prototype.load=function(e,t,i,n){this.texturePath=this.extractUrlBase(e),(new zen3d.FileLoader).setResponseType("json").load(e,function(e){var i=this.parse(e);t(i.object,i.animation)}.bind(this),i,n)},e.prototype.parseNodeTree=function(e){var t=new zen3d.Object3D;if(t.name=e.name,t.matrix.fromArray(e.transformation).transpose(),e.children)for(var i=0;i<e.children.length;i++){var n=this.parseNodeTree(e.children[i]);t.add(n)}return t},e.prototype.cloneNodeToBones=function(e,t){var i=new zen3d.Bone;if(i.name=e.name,i.matrix.copy(e.matrix),i.matrix.decompose(i.position,i.quaternion,i.scale),t[e.name]||(t[e.name]=[]),t[e.name].push(i),e.children)for(var n=0;n<e.children.length;n++){var r=this.cloneNodeToBones(e.children[n],t);i.add(r)}return i},e.prototype.parseSkeleton=function(e,t,i,n){for(var r=[],a=i.getObjectByName(e);a.parent;)r.push(a.parent.name),a=a.parent;r.push(a);var s,o=[],u=[],h=i.getObjectByName(function(e){for(var t,n=i.getObjectByName(e);n.parent&&(t=n.parent,!(r.indexOf(t.name)>-1));)n=t;return n.name}(t[0].name)),c=this.cloneNodeToBones(h,n);u.push(c);for(var l=0;l<t.length;l++){var d=t[l],p=c.getObjectByName(d.name);p||(h=i.getObjectByName(d.name),c=this.cloneNodeToBones(h,n),u.push(c),p=c.getObjectByName(d.name));var f=t[l].offsetmatrix;p.offsetMatrix.fromArray(f).transpose(),o.push(p)}s=new zen3d.Skeleton(o);for(var l=0;l<u.length;l++)s.add(u[l]);return s},e.prototype.parseAnimations=function(e,t){for(var i=new zen3d.KeyframeAnimation,n=0;n<e.length;n++){for(var r=e[n],a=r.name,s=r.channels,o=0,u=new zen3d.KeyframeClip(a),h=0;h<s.length;h++){var c=s[h],l=c.name;if(t[l])for(var d=0;d<t[l].length;d++){for(var p=t[l][d],f=new zen3d.VectorKeyframeTrack(p,"position"),d=0;d<c.positionkeys.length;d++){var _=c.positionkeys[d];f.data.addFrame(_[0],new zen3d.Vector3(_[1][0],_[1][1],_[1][2])),_[0]>o&&(o=_[0])}u.tracks.push(f);for(var v=new zen3d.QuaternionKeyframeTrack(p,"quaternion"),d=0;d<c.rotationkeys.length;d++){var _=c.rotationkeys[d];v.data.addFrame(_[0],new zen3d.Quaternion(_[1][1],_[1][2],_[1][3],_[1][0])),_[0]>o&&(o=_[0])}u.tracks.push(v);for(var m=new zen3d.VectorKeyframeTrack(p,"scale"),d=0;d<c.scalingkeys.length;d++){var _=c.scalingkeys[d];m.data.addFrame(_[0],new zen3d.Vector3(_[1][0],_[1][1],_[1][2])),_[0]>o&&(o=_[0])}u.tracks.push(m)}else console.log(l)}u.startFrame=0,u.endFrame=o,u.loop=!0,i.add(u)}return i},e.prototype.parse=function(e){for(var t=this.parseNodeTree(e.rootnode),i=this.parseList(e.meshes,this.parseMesh),n=this.parseList(e.materials,this.parseMaterial),r={},a={},s=0;s<e.meshes.length;s++)e.meshes[s].bones&&(a[s]=this.parseSkeleton(e.meshes[s].name,e.meshes[s].bones,t,r));var o;return e.animations&&(o=this.parseAnimations(e.animations,r)),{object:this.parseObject(e,e.rootnode,i,n,a),animation:o}},e.prototype.parseList=function(e,t){for(var i=new Array(e.length),n=0;n<e.length;++n)i[n]=t.call(this,e[n]);return i},e.prototype.parseMaterial=function(e){var t=new zen3d.PhongMaterial,i=null,n=null,r=e.properties;for(var a in e.properties)if(r=e.properties[a],"$tex.file"===r.key){if(1==r.semantic){var s=this.texturePath+r.value;s=s.replace(/.\\/g,""),i=new zen3d.Texture2D.fromSrc(s),i.wrapS=i.wrapT=zen3d.WEBGL_TEXTURE_WRAP.REPEAT}else if(2==r.semantic);else if(5==r.semantic);else if(6==r.semantic){var s=this.texturePath+r.value;s=s.replace(/.\\/g,""),n=new zen3d.Texture2D.fromSrc(s),n.wrapS=n.wrapT=zen3d.WEBGL_TEXTURE_WRAP.REPEAT}}else if("?mat.name"===r.key);else if("$clr.ambient"===r.key);else if("$clr.diffuse"===r.key){var o=r.value;t.diffuse.setRGB(o[0],o[1],o[2])}else if("$clr.specular"===r.key){var o=r.value;t.specular.setRGB(o[0],o[1],o[2])}else if("$clr.emissive"===r.key){var o=r.value;t.emissive.setRGB(o[0],o[1],o[2])}else"$mat.opacity"===r.key?(t.transparent=r.value<1,t.opacity=r.value):"$mat.shadingm"===r.key?r.value:"$mat.shininess"===r.key&&(t.shininess=r.value);return t.diffuseMap=i,t.normalMap=n,t},e.prototype.parseMesh=function(e){var t=new zen3d.Geometry,i=e.faces,n=e.vertices,r=e.normals,a=e.texturecoords&&e.texturecoords[0],s=n.length/3,o=t.verticesArray,u=e.bones,h=[];if(u){for(var c=0;c<s;c++)h[c]=[];for(var l,d,p,c=0;c<u.length;c++){l=u[c],l.name,l.offsetmatrix,d=l.weights;for(var f=0;f<d.length;f++)p=d[f],h[p[0]].push({index:c,weight:p[1]})}for(var c=0;c<s;c++){var _=h[c];_.sort(function(e,t){return t.weight-e.weight});var v=_[0]?_[0].weight:0,m=_[1]?_[1].weight:0,g=_[2]?_[2].weight:0,y=_[3]?_[3].weight:0,T=v+m+g+y;T>0&&(v/=T,m/=T,g/=T,y/=T),_[0]&&(_[0].weight=v),_[1]&&(_[1].weight=m),_[2]&&(_[2].weight=g),_[3]&&(_[3].weight=y)}}for(var c=0;c<s;c++){if(o.push(n[3*c+0]),o.push(n[3*c+1]),o.push(n[3*c+2]),o.push(r[3*c+0]),o.push(r[3*c+1]),o.push(r[3*c+2]),o.push(0),o.push(0),o.push(0),u)for(var _=h[c],E=0;E<4;E++)_[E]?o.push(_[E].index):o.push(0);else o.push(1),o.push(1),o.push(1),o.push(1);if(a?(o.push(a[2*c+0]),o.push(1-a[2*c+1])):(o.push(0),o.push(0)),u)for(var _=h[c],E=0;E<4;E++)_[E]?o.push(_[E].weight):o.push(0);else o.push(0),o.push(0)}u&&(t.vertexFormat={a_Position:{size:3,normalized:!1,stride:19,offset:0},a_Normal:{size:3,normalized:!1,stride:19,offset:3},a_Uv:{size:2,normalized:!1,stride:19,offset:13},skinIndex:{size:4,normalized:!1,stride:19,offset:9},skinWeight:{size:4,normalized:!1,stride:19,offset:15}},t.vertexSize=19);for(var x=t.indicesArray,c=0;c<i.length;c++)x.push(i[c][0]),x.push(i[c][1]),x.push(i[c][2]);return t.computeBoundingBox(),t.computeBoundingSphere(),t},e.prototype.parseObject=function(e,t,i,n,r){var a=new zen3d.Group;a.name=t.name||"",a.matrix.fromArray(t.transformation).transpose(),a.matrix.decompose(a.position,a.quaternion,a.scale);for(var s,o=0;t.meshes&&o<t.meshes.length;++o){var u=t.meshes[o];r[u]?(s=new zen3d.SkinnedMesh(i[u],n[e.meshes[u].materialindex]),s.skeleton=r[u]):s=new zen3d.Mesh(i[u],n[e.meshes[u].materialindex]),s.frustumCulled=!1,a.add(s)}for(var o=0;t.children&&o<t.children.length;++o)a.add(this.parseObject(e,t.children[o],i,n,r));return a},e.prototype.extractUrlBase=function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},zen3d.AssimpJsonLoader=e}(),function(){var e=function(){this.path=void 0,this.responseType=void 0,this.withCredentials=void 0,this.mimeType=void 0,this.requestHeader=void 0};e.prototype.load=function(e,t,i,n){void 0===e&&(e=""),void 0!=this.path&&(e=this.path+e);var r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var a=r[1],s=!!r[2],o=r[3];o=window.decodeURIComponent(o),s&&(o=window.atob(o));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":u=new ArrayBuffer(o.length);for(var c=new Uint8Array(u),l=0;l<o.length;l++)c[l]=o.charCodeAt(l);"blob"===h&&(u=new Blob([u],{type:a}));break;case"document":var d=new DOMParser;u=d.parseFromString(o,a);break;case"json":u=JSON.parse(o);break;default:u=o}window.setTimeout(function(){t&&t(u)},0)}catch(e){window.setTimeout(function(){n&&n(e)},0)}}else{var p=new XMLHttpRequest;p.open("GET",e,!0),p.addEventListener("load",function(e){var i=e.target.response;200===this.status?t&&t(i):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),t&&t(i)):n&&n(e)},!1),void 0!==i&&p.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&p.addEventListener("error",function(e){n(e)},!1),void 0!==this.responseType&&(p.responseType=this.responseType),void 0!==this.withCredentials&&(p.withCredentials=this.withCredentials),p.overrideMimeType&&p.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var f in this.requestHeader)p.setRequestHeader(f,this.requestHeader[f]);p.send(null)}},e.prototype.setPath=function(e){return this.path=e,this},e.prototype.setResponseType=function(e){return this.responseType=e,this},e.prototype.setWithCredentials=function(e){return this.withCredentials=e,this},e.prototype.setMimeType=function(e){return this.mimeType=e,this},e.prototype.setRequestHeader=function(e){return this.requestHeader=e,this},zen3d.FileLoader=e}(),function(){var e=function(){this.crossOrigin=void 0,this.path=void 0};e.prototype.load=function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var r=document.createElementNS("http://www.w3.org/1999/xhtml","img");return r.addEventListener("load",function(){t&&t(this)},!1),r.addEventListener("error",function(e){n&&n(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(r.crossOrigin=this.crossOrigin),r.src=e,r},e.prototype.setCrossOrigin=function(e){return this.crossOrigin=e,this},e.prototype.setPath=function(e){return this.path=e,this},zen3d.ImageLoader=e}(),function(){var e=function(){};e.prototype.load=function(e,t,i,n){var r=this,a=new zen3d.FileLoader;a.setResponseType("arraybuffer"),a.load(e,function(e){void 0!==t&&t(r.parse(e))},i,n)},e.prototype.parse=function(e){function t(e,t,i,n,r,a,s,o,u){var h,c,l,d=u,p=0,f=x.width;for(l=t;l!==n;l+=i)for(c=r;c!==s;c+=a,p++)h=o[p],e[4*(c+f*l)+3]=255,e[4*(c+f*l)+2]=d[3*h+0],e[4*(c+f*l)+1]=d[3*h+1],e[4*(c+f*l)+0]=d[3*h+2];return e}function i(e,t,i,n,r,a,s,o){var u,h,c,l=0,d=x.width;for(c=t;c!==n;c+=i)for(h=r;h!==s;h+=a,l+=2)u=o[l+0]+(o[l+1]<<8),e[4*(h+d*c)+0]=(31744&u)>>7,e[4*(h+d*c)+1]=(992&u)>>2,e[4*(h+d*c)+2]=(31&u)>>3,e[4*(h+d*c)+3]=32768&u?0:255;return e}function n(e,t,i,n,r,a,s,o){var u,h,c=0,l=x.width;for(h=t;h!==n;h+=i)for(u=r;u!==s;u+=a,c+=3)e[4*(u+l*h)+3]=255,e[4*(u+l*h)+2]=o[c+0],e[4*(u+l*h)+1]=o[c+1],e[4*(u+l*h)+0]=o[c+2];return e}function r(e,t,i,n,r,a,s,o){var u,h,c=0,l=x.width;for(h=t;h!==n;h+=i)for(u=r;u!==s;u+=a,c+=4)e[4*(u+l*h)+2]=o[c+0],e[4*(u+l*h)+1]=o[c+1],e[4*(u+l*h)+0]=o[c+2],e[4*(u+l*h)+3]=o[c+3];return e}function a(e,t,i,n,r,a,s,o){var u,h,c,l=0,d=x.width;for(c=t;c!==n;c+=i)for(h=r;h!==s;h+=a,l++)u=o[l],e[4*(h+d*c)+0]=u,e[4*(h+d*c)+1]=u,e[4*(h+d*c)+2]=u,e[4*(h+d*c)+3]=255;return e}function s(e,t,i,n,r,a,s,o){var u,h,c=0,l=x.width;for(h=t;h!==n;h+=i)for(u=r;u!==s;u+=a,c+=2)e[4*(u+l*h)+0]=o[c+0],e[4*(u+l*h)+1]=o[c+0],e[4*(u+l*h)+2]=o[c+0],e[4*(u+l*h)+3]=o[c+1];return e}var o=0,u=1,h=2,c=3,l=9,d=10,p=11,f=48,_=4,v=0,m=1,g=2,y=3;e.length<19&&console.error("TGALoader.parse: Not enough data to contain header.");var T=new Uint8Array(e),E=0,x={id_length:T[E++],colormap_type:T[E++],image_type:T[E++],colormap_index:T[E++]|T[E++]<<8,colormap_length:T[E++]|T[E++]<<8,colormap_size:T[E++],origin:[T[E++]|T[E++]<<8,T[E++]|T[E++]<<8],width:T[E++]|T[E++]<<8,height:T[E++]|T[E++]<<8,pixel_size:T[E++],flags:T[E++]};!function(e){switch(e.image_type){case u:case l:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case h:case c:case d:case p:e.colormap_type&&console.error("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");break;case o:console.error("TGALoader.parse.tgaCheckHeader: No data");default:console.error('TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&console.error("TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}(x),x.id_length+E>e.length&&console.error("TGALoader.parse: No data"),E+=x.id_length;var M=!1,z=!1,w=!1;switch(x.image_type){case l:M=!0,z=!0;break;case u:z=!0;break;case d:M=!0;break;case h:break;case p:M=!0,w=!0;break;case c:w=!0}var b=document.createElement("canvas");b.width=x.width,b.height=x.height;var S=b.getContext("2d"),A=S.createImageData(x.width,x.height),L=function(e,t,i,n,r){var a,s,o,u;if(s=i.pixel_size>>3,o=i.width*i.height*s,t&&(u=r.subarray(n,n+=i.colormap_length*(i.colormap_size>>3))),e){a=new Uint8Array(o);for(var h,c,l,d=0,p=new Uint8Array(s);d<o;)if(h=r[n++],c=1+(127&h),128&h){for(l=0;l<s;++l)p[l]=r[n++];for(l=0;l<c;++l)a.set(p,d+l*s);d+=s*c}else{for(c*=s,l=0;l<c;++l)a[d+l]=r[n++];d+=c}}else a=r.subarray(n,n+=t?i.width*i.height:o)
;return{pixel_data:a,palettes:u}}(M,z,x,E,T);!function(e,o,u,h,c){var l,d,p,T,E,M;switch((x.flags&f)>>_){default:case g:l=0,p=1,E=o,d=0,T=1,M=u;break;case v:l=0,p=1,E=o,d=u-1,T=-1,M=-1;break;case y:l=o-1,p=-1,E=-1,d=0,T=1,M=u;break;case m:l=o-1,p=-1,E=-1,d=u-1,T=-1,M=-1}if(w)switch(x.pixel_size){case 8:a(e,d,T,M,l,p,E,h);break;case 16:s(e,d,T,M,l,p,E,h);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}else switch(x.pixel_size){case 8:t(e,d,T,M,l,p,E,h,c);break;case 16:i(e,d,T,M,l,p,E,h);break;case 24:n(e,d,T,M,l,p,E,h);break;case 32:r(e,d,T,M,l,p,E,h);break;default:console.error("TGALoader.parse.getTgaRGBA: not support this format")}}(A.data,x.width,x.height,L.pixel_data,L.palettes);return S.putImageData(A,0,0),b},zen3d.TGALoader=e}(),function(){var e=function(){this._entities={},this.enableCounter=!1};e.prototype.getEntity=function(e){return this._entities[e]},e.prototype.getFps=function(){var e=this.getEntity("fps");return e&&e.averageDelta?Math.floor(1e3/e.averageDelta):0},e.prototype.updateFps=function(){this.enableCounter&&(this.endCounter("fps"),this.startCounter("fps",60))},e.prototype.getNow=function(){return window.performance?window.performance.now():(new Date).getTime()},e.prototype.startCounter=function(e,t){if(this.enableCounter){var i=this._entities[e];i||(i={start:0,end:0,delta:0,_cache:[],averageRange:1,averageDelta:0},this._entities[e]=i),i.start=this.getNow(),i.averageRange=t||1}},e.prototype.endCounter=function(e){if(this.enableCounter){var t=this._entities[e];if(t&&(t.end=this.getNow(),t.delta=t.end-t.start,t.averageRange>1)){t._cache.push(t.delta);var i=t._cache.length;if(i>=t.averageRange){i>t.averageRange&&(t._cache.shift(),i--);for(var n=0,r=0;r<i;r++)n+=t._cache[r];t.averageDelta=n/i}}}},zen3d.Performance=e}(),function(){var e=function(e,t){this.camera=e,this.lookAtPoint=t,this.up=new zen3d.Vector3(0,1,0),this.distance=100,this._panAngle=0,this._panRad=0,this.minPanAngle=-(1/0),this.maxPanAngle=1/0,this._tiltAngle=0,this._tiltRad=0,this.minTileAngle=-90,this.maxTileAngle=90};Object.defineProperties(e.prototype,{panAngle:{get:function(){return this._panAngle},set:function(e){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,e)),this._panRad=this._panAngle*Math.PI/180}},tiltAngle:{get:function(){return this._tiltAngle},set:function(e){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,e)),this._tiltRad=this._tiltAngle*Math.PI/180}}}),e.prototype.update=function(){var e=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),t=this.distance*Math.sin(this._tiltRad),i=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),n=this.camera,r=this.lookAtPoint;n.position.set(e+r.x,t+r.y,i+r.z),n.setLookAt(r,this.up)},zen3d.HoverController=e}();