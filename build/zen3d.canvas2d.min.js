!function(){var t={CONSTANT:function(){var t,e,i,r,s=this._renderViewport,o=s.x,n=s.y,h=s.z,a=s.w,c=this._scaleFactor;t=o,e=n,i=h,r=a,this._resolutionSize.set(i*c,r*c),this.viewport.set(t,e,i,r)},SHRINK:function(){var t,e,i,r,s=this._renderViewport,o=s.x,n=s.y,h=s.z,a=s.w,c=this._resolutionSize,d=(h-o)/(a-n),p=c.x/c.y;p>d?(i=h,r=Math.floor(i/p)):(r=a,i=Math.floor(r*p)),t=Math.floor((h-i)/2)+o,e=Math.floor((a-r)/2)+n,this.viewport.set(t,e,i,r)},EXPAND:function(){var t,e,i,r,s=this._renderViewport,o=s.x,n=s.y,h=s.z,a=s.w,c=this._resolutionSize,d=(h-o)/(a-n),p=c.x/c.y;p>d?(r=a,i=Math.floor(r*p)):(i=h,r=Math.floor(i/p)),t=Math.floor((h-i)/2)+o,e=Math.floor((a-r)/2)+n,this.viewport.set(t,e,i,r)}},e=function(e,i,r,s){zen3d.Object3D.call(this),this.type=zen3d.OBJECT_TYPE.CANVAS2D,this.frustumCulled=!1,this.geometry=new zen3d.Geometry,this.buffer=new zen3d.InterleavedBuffer(new Float32Array,5),this.buffer.dynamic=!0,this.geometry.addAttribute("a_Position",new zen3d.InterleavedBufferAttribute(this.buffer,3,0)),this.geometry.addAttribute("a_Uv",new zen3d.InterleavedBufferAttribute(this.buffer,2,3)),this.geometry.setIndex([]),this.geometry.usageType=zen3d.WEBGL_BUFFER_USAGE.DYNAMIC_DRAW,this.material=new zen3d.Canvas2DMaterial,this.sprites=[],this.drawArray=[],this._isScreenCanvas=void 0===r||r;var e=void 0!==e?e:640,i=void 0!==i?i:800;this._size=new zen3d.Vector2(e,i),this._resolutionSize=new zen3d.Vector2(e,i),this._screenMatchMode=s||t.CONSTANT,this._renderViewport=new zen3d.Vector4(0,0,e,i),this._scaleFactor=1,this.viewport=new zen3d.Vector4,this.orthoCamera=new zen3d.Camera,this.orthoCamera.setOrtho(-e/2,e/2,-i/2,i/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix)};(e.prototype=Object.create(zen3d.Object3D.prototype)).constructor=e,Object.defineProperties(e.prototype,{isScreenCanvas:{get:function(){return this._isScreenCanvas},set:function(t){this._isScreenCanvas=t}}}),e.prototype.setSize=function(t,e){this._isScreenCanvas?(this._resolutionSize.set(t,e),this._screenMatchMode.call(this),this._updateCamera()):this._size.set(t,e)},e.prototype.setRenderViewport=function(t,e,i,r){this._renderViewport.x===t&&this._renderViewport.y===e&&this._renderViewport.z===i&&this._renderViewport.w===r||(this._renderViewport.set(t,e,i,r),this._screenMatchMode.call(this),this._updateCamera())},e.prototype.setScaleFactor=function(t){this._scaleFactor!==t&&(this._scaleFactor=t,this._screenMatchMode.call(this),this._updateCamera())},e.prototype.setScreenMatchMode=function(t){this._screenMatchMode!==t&&(this._screenMatchMode=t,this._screenMatchMode.call(this),this._updateCamera())},e.prototype._updateCamera=function(){this._isScreenCanvas&&(this.orthoCamera.setOrtho(-this._resolutionSize.x/2,this._resolutionSize.x/2,-this._resolutionSize.y/2,this._resolutionSize.y/2,0,1),this.orthoCamera.viewMatrix.getInverse(this.orthoCamera.worldMatrix))},e.prototype.add=function(t){this.children.push(t)},e.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)};var i=[],r=[];e.prototype.updateSprites=function(){for(var t=0,e=0,s=this.sprites,o=this._isScreenCanvas?this._resolutionSize.x:this._size.x,n=this._isScreenCanvas?this._resolutionSize.y:this._size.y,h=0;h<s.length;h++){var a,c,d=(S=s[h]).width,p=S.height,l=S.worldMatrix.elements,u=l[0],f=l[1],y=l[3],v=l[4],_=l[6]-o/2,w=n/2-l[7]-p;a=0,c=0,i[t++]=u*a+y*c+_,i[t++]=f*a+v*c+w,i[t++]=0,i[t++]=0,i[t++]=1,a=0+d,c=0,i[t++]=u*a+y*c+_,i[t++]=f*a+v*c+w,i[t++]=0,i[t++]=1,i[t++]=1,a=0+d,c=0+p,i[t++]=u*a+y*c+_,i[t++]=f*a+v*c+w,i[t++]=0,i[t++]=1,i[t++]=0,a=0,c=0+p,i[t++]=u*a+y*c+_,i[t++]=f*a+v*c+w,i[t++]=0,i[t++]=0,i[t++]=0;var M=t/5-4;r[e++]=M+0,r[e++]=M+1,r[e++]=M+2,r[e++]=M+2,r[e++]=M+3,r[e++]=M+0}i.length=t,r.length=e;var z=this.geometry;this.buffer.setArray(new Float32Array(i)),z.index.setArray(new Uint16Array(r)),this.buffer.version++,z.index.version++,this.drawArray=[];for(var x,h=0;h<s.length;h++){var S=s[h];x!==S.texture?(this.drawArray.push({texture:S.texture,count:1}),x=S.texture):this.drawArray[this.drawArray.length-1].count++}},e.prototype.updateMatrix=function(){zen3d.Object3D.prototype.updateMatrix.call(this),this.sprites=[];for(var t=this.children,e=0,i=t.length;e<i;e++)this.cacheSprites(t[e]);for(var r=this.sprites,e=0,i=r.length;e<i;e++)r[e].updateMatrix();this.updateSprites()},e.prototype.cacheSprites=function(t){this.sprites.push(t);for(var e=0,i=t.children.length;e<i;e++)this.cacheSprites(t.children[e])},e.SCREEN_MATCH_MODE=t,zen3d.Canvas2D=e}(),function(){var t=function(){zen3d.Material.call(this),this.type=zen3d.MATERIAL_TYPE.CANVAS2D,this.depthWrite=!1,this.transparent=!0};(t.prototype=Object.create(zen3d.Material.prototype)).constructor=t,zen3d.Canvas2DMaterial=t}(),function(){var t=function(){this.width=0,this.height=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.anchorX=0,this.anchorY=0,this.matrix=new zen3d.Matrix3,this.worldMatrix=new zen3d.Matrix3,this.children=new Array,this.parent=null,this.boundingBox=new zen3d.Box2};t.prototype.add=function(t){this.children.push(t),t.parent=this},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1),t.parent=null},t.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},t.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var i=0,r=this.children.length;i<r;i++){var s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}},t.prototype.updateMatrix=function(){var t=this.matrix.transform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.anchorX*this.width,this.anchorY*this.height);if(this.worldMatrix.copy(t),this.parent){var e=this.parent.worldMatrix;this.worldMatrix.premultiply(e)}for(var i=this.children,r=0,s=i.length;r<s;r++)i[r].updateMatrix()},t.prototype.computeBoundingBox=function(){this.boundingBox.set(this.x,this.y,this.x+this.width,this.y+this.height)},zen3d.Object2D=t}(),function(){var t=function(){zen3d.Object2D.call(this),this.texture=null};(t.prototype=Object.create(zen3d.Object2D.prototype)).constructor=t,zen3d.Sprite2D=t}();